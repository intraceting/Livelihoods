!function(){"use strict";var e=function(){return(e=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function t(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var n,o,r=i.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=r.next()).done;)s.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(o)throw o.error}}return s}function i(){for(var e=[],i=0;i<arguments.length;i++)e=e.concat(t(arguments[i]));return e}var n,o=function(){function e(){this._hooks={},this._cache=[],this._hooksCache={}}return e.prototype.on=function(e,t){e&&t&&"function"==typeof t&&(this._hooks[e]||(this._hooks[e]=[]),this._hooks[e].push(t))},e.prototype.once=function(e,t){var i=this;if(e&&t&&"function"==typeof t){this.on(e,function n(o){t(o),i.off(e,n)})}},e.prototype.off=function(e,t){if(e&&this._hooks[e]&&this._hooks[e].length)if(t){var i=this._hooks[e].indexOf(t);-1!==i&&this._hooks[e].splice(i,1)}else this._hooks[e]=[]},e.prototype.emit=function(e,t,i){if(i){if(!e)return;if(-1!==this._cache.indexOf(i))this._emit(e,t);else{if(this._hooksCache.hasOwnProperty(i)||(this._hooksCache[i]={}),this._hooksCache[i].hasOwnProperty(e))return;this._hooksCache[i][e]=t}}else this._emit(e,t)},e.prototype._emit=function(e,t){e&&this._hooks[e]&&this._hooks[e].length&&i(this._hooks[e]).forEach(function(e){try{e(t)}catch(e){}})},e.prototype.set=function(e){e&&-1===this._cache.indexOf(e)&&this._cache.push(e)},e}(),r=function(e){return null!=e&&"[object Object]"==Object.prototype.toString.call(e)},s=function(e){return Array.isArray(e)},a=(n=+Date.now()+Number((""+Math.random()).slice(2,8)),function(){return n+=1}),c=function(e){return function(e,t,i){if("string"==typeof e&&"number"==typeof t&&"number"==typeof i){var n,o=[];i=i<=25?i:i%25;var r=String.fromCharCode(i+97);n=e.split(r);for(var s=0;s<n.length;s++){var a=parseInt(n[s],i);a=1*a^t;var c=String.fromCharCode(a);o.push(c)}return o.join("")}}(e,64,25)},h=function(e,t){void 0===e&&(e=function(){}),void 0===t&&(t=1e3);var i,n=Date.now()+t;return i=window.setTimeout(function o(){var r=Date.now()-n;e(),n+=t,i=window.setTimeout(o,Math.max(0,t-r))},t),function(){window.clearTimeout(i)}},u=function(e){var t=document.createElement("a");return t.href=e,t},p=function(e){var t={};try{var i=u(e).search;(i=i.slice(1)).split("&").forEach(function(e){var i,n,o=e.split("=");o.length&&(i=o[0],n=o[1]);try{t[i]=decodeURIComponent(void 0===n?"":n)}catch(e){t[i]=n}})}catch(e){}return t},f=function(e){for(var t=0,i=0,n=(e+="").length,o=0;o<n;o++)((t=31*t+e.charCodeAt(i++))>0x7fffffffffff||t<-0x800000000000)&&(t&=0xffffffffffff);return t<0&&(t+=0x7ffffffffffff),t};var l,d=(function(e,t){var i;i=function(){function e(){for(var e=0,t={};e<arguments.length;e++){var i=arguments[e];for(var n in i)t[n]=i[n]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function i(n){function o(){}function r(t,i,r){if("undefined"!=typeof document){"number"==typeof(r=e({path:"/"},o.defaults,r)).expires&&(r.expires=new Date(1*new Date+864e5*r.expires)),r.expires=r.expires?r.expires.toUTCString():"";try{var s=JSON.stringify(i);/^[\{\[]/.test(s)&&(i=s)}catch(e){}i=n.write?n.write(i,t):encodeURIComponent(String(i)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var a="";for(var c in r)r[c]&&(a+="; "+c,!0!==r[c]&&(a+="="+r[c].split(";")[0]));return document.cookie=t+"="+i+a}}function s(e,i){if("undefined"!=typeof document){for(var o={},r=document.cookie?document.cookie.split("; "):[],s=0;s<r.length;s++){var a=r[s].split("="),c=a.slice(1).join("=");i||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var h=t(a[0]);if(c=(n.read||n)(c,h)||t(c),i)try{c=JSON.parse(c)}catch(e){}if(o[h]=c,e===h)break}catch(e){}}return e?o[e]:o}}return o.set=r,o.get=function(e){return s(e,!1)},o.getJSON=function(e){return s(e,!0)},o.remove=function(t,i){r(t,"",e(i,{expires:-1}))},o.defaults={},o.withConverter=i,o}(function(){})},e.exports=i()}(l={exports:{}},l.exports),l.exports),g=function(){function e(){this.cache={}}return e.prototype.setItem=function(e,t){this.cache[e]=t},e.prototype.getItem=function(e){return this.cache[e]},e.prototype.removeItem=function(e){this.cache[e]=void 0},e.prototype.getCookie=function(e){this.getItem(e)},e.prototype.setCookie=function(e,t){this.setItem(e,t)},e}();var m,_={getItem:function(e){try{var t=localStorage.getItem(e),i=t;try{t&&"string"==typeof t&&(i=JSON.parse(t))}catch(e){}return i||{}}catch(e){}return{}},setItem:function(e,t){try{var i="string"==typeof t?t:JSON.stringify(t);localStorage.setItem(e,i)}catch(e){}},removeItem:function(e){try{localStorage.removeItem(e)}catch(e){}},getCookie:function(e,t){try{return d.get(e,{domain:t||document.domain})}catch(e){return""}},setCookie:function(e,t,i,n){try{var o=n||document.domain,r=+new Date+i;d.set(e,t,{expires:new Date(r),path:"/",domain:o})}catch(e){}},isSupportLS:function(){try{return localStorage.setItem("_ranger-test-key","hi"),localStorage.getItem("_ranger-test-key"),localStorage.removeItem("_ranger-test-key"),!0}catch(e){return!1}}()},y={getItem:function(e){try{var t=sessionStorage.getItem(e),i=t;try{t&&"string"==typeof t&&(i=JSON.parse(t))}catch(e){}return i||{}}catch(e){}return{}},setItem:function(e,t){try{var i="string"==typeof t?t:JSON.stringify(t);sessionStorage.setItem(e,i)}catch(e){}},removeItem:function(e){try{sessionStorage.removeItem(e)}catch(e){}},getCookie:function(e){this.getItem(e)},setCookie:function(e,t){this.setItem(e,t)},isSupportSession:function(){try{return sessionStorage.setItem("_ranger-test-key","hi"),sessionStorage.getItem("_ranger-test-key"),sessionStorage.removeItem("_ranger-test-key"),!0}catch(e){return!1}}()},v=function(){function e(e,t){this._storage=t&&"session"===t?y:!e&&_.isSupportLS?_:new g}return e.prototype.getItem=function(e){return this._storage.getItem(e)},e.prototype.setItem=function(e,t){this._storage.setItem(e,t)},e.prototype.getCookie=function(e,t){return this._storage.getCookie(e,t)},e.prototype.setCookie=function(e,t,i,n){this._storage.setCookie(e,t,i,n)},e.prototype.removeItem=function(e){this._storage.removeItem(e)},e}(),b=function(){function e(e,t,i){this.appid=e,this.domain=t,this.userAgent=window.navigator.userAgent,this.appVersion=window.navigator.appVersion,this.cookie_expire=i}return e.prototype.init=function(){var e=window.navigator.userAgent,t=window.navigator.language,i=document.referrer,n=i?u(i).hostname:"",o=p(window.location.href),r=/Mobile|htc|mini|Android|iP(ad|od|hone)/.test(this.appVersion)?"wap":"web";this.utm=function(e,t,i,n){var o=new v(!1),r=new v(!1,"session"),s=e?"_tea_utm_cache_"+e:"_tea_utm_cache",a=e?"_$utm_from_url_"+e:"_$utm_from_url",c={},h=["tr_shareuser","tr_admaster","tr_param1","tr_param2","tr_param3","tr_param4","$utm_from_url"],u={ad_id:Number(t.ad_id)||void 0,campaign_id:Number(t.campaign_id)||void 0,creative_id:Number(t.creative_id)||void 0,utm_source:t.utm_source,utm_medium:t.utm_medium,utm_campaign:t.utm_campaign,utm_term:t.utm_term,utm_content:t.utm_content,tr_shareuser:t.tr_shareuser,tr_admaster:t.tr_admaster,tr_param1:t.tr_param1,tr_param2:t.tr_param2,tr_param3:t.tr_param3,tr_param4:t.tr_param4};try{var p=!1;for(var f in u)u[f]&&(-1!==h.indexOf(f)?(c.hasOwnProperty("tracer_data")||(c.tracer_data={}),c.tracer_data[f]=u[f]):c[f]=u[f],p=!0);if(p)r.setItem(a,"1"),o.setCookie(s,JSON.stringify(c),n,i);else{var l=o.getCookie(s,i);l&&(c=JSON.parse(l))}r.getItem(a)&&(c.hasOwnProperty("tracer_data")||(c.tracer_data={}),c.tracer_data.$utm_from_url=1)}catch(e){return u}return c}(this.appid,o,this.domain,this.cookie_expire);var s=this.browser(),a=this.os();return{browser:s.browser,browser_version:s.browser_version,platform:r,os_name:a.os_name,os_version:a.os_version,userAgent:e,screen_width:window.screen&&window.screen.width,screen_height:window.screen&&window.screen.height,device_model:this.getDeviceModel(a.os_name),language:t,referrer:i,referrer_host:n,utm:this.utm,latest_data:this.last(i,n)}},e.prototype.last=function(e,t){var i="",n="",o="",r=location.hostname,s=!1;if(e&&t&&r!==t){i=e,n=t,s=!0;var a=p(e);a.keyword&&(o=a.keyword)}return{$latest_referrer:i,$latest_referrer_host:n,$latest_search_keyword:o,isLast:s}},e.prototype.browser=function(){var e,t,i="",n=""+parseFloat(this.appVersion),o=this.userAgent;return-1!==o.indexOf("Edge")||-1!==o.indexOf("Edg")?(i="Microsoft Edge",-1!==o.indexOf("Edge")?(e=o.indexOf("Edge"),n=o.substring(e+5)):(e=o.indexOf("Edg"),n=o.substring(e+4))):-1!==(e=o.indexOf("MSIE"))?(i="Microsoft Internet Explorer",n=o.substring(e+5)):-1!==(e=o.indexOf("Lark"))?(i="Lark",n=o.substring(e+5,e+11)):-1!==(e=o.indexOf("MetaSr"))?(i="sougoubrowser",n=o.substring(e+7,e+10)):-1!==o.indexOf("MQQBrowser")||-1!==o.indexOf("QQBrowser")?(i="qqbrowser",-1!==o.indexOf("MQQBrowser")?(e=o.indexOf("MQQBrowser"),n=o.substring(e+11,e+15)):-1!==o.indexOf("QQBrowser")&&(e=o.indexOf("QQBrowser"),n=o.substring(e+10,e+17))):-1!==o.indexOf("Chrome")?-1!==(e=o.indexOf("MicroMessenger"))?(i="weixin",n=o.substring(e+15,e+20)):-1!==(e=o.indexOf("360"))?(i="360browser",n=o.substring(o.indexOf("Chrome")+7)):-1!==o.indexOf("baidubrowser")||-1!==o.indexOf("BIDUBrowser")?(-1!==o.indexOf("baidubrowser")?(e=o.indexOf("baidubrowser"),n=o.substring(e+13,e+16)):-1!==o.indexOf("BIDUBrowser")&&(e=o.indexOf("BIDUBrowser"),n=o.substring(e+12,e+15)),i="baidubrowser"):-1!==(e=o.indexOf("xiaomi"))?-1!==o.indexOf("openlanguagexiaomi")?(i="openlanguage xiaomi",n=o.substring(e+7,e+13)):(i="xiaomi",n=o.substring(e-7,e-1)):-1!==(e=o.indexOf("TTWebView"))?(i="TTWebView",n=o.substring(e+10,e+23)):-1!==(e=o.indexOf("Chrome"))?(i="Chrome",n=o.substring(e+7)):-1!==(e=o.indexOf("Chrome"))&&(i="Chrome",n=o.substring(e+7)):-1!==o.indexOf("Safari")?-1!==(e=o.indexOf("QQ"))?(i="qqbrowser",n=o.substring(e+10,e+16)):-1!==(e=o.indexOf("Safari"))&&(i="Safari",n=o.substring(e+7),-1!==(e=o.indexOf("Version"))&&(n=o.substring(e+8))):-1!==(e=o.indexOf("Firefox"))?(i="Firefox",n=o.substring(e+8)):-1!==(e=o.indexOf("MicroMessenger"))?(i="weixin",n=o.substring(e+15,e+20)):-1!==(e=o.indexOf("QQ"))&&(i="qqbrowser",n=o.substring(e+3,e+8)),-1!==(t=n.indexOf(";"))&&(n=n.substring(0,t)),-1!==(t=n.indexOf(" "))&&(n=n.substring(0,t)),-1!==(t=n.indexOf(")"))&&(n=n.substring(0,t)),{browser:i,browser_version:n}},e.prototype.os=function(){for(var e="",t="",i=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0|Windows NT 10.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Android",r:/Android/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/}],n=0;n<i.length;n++){var o=i[n];if(o.r.test(this.userAgent)){"Mac OS X"===(e=o.s)&&this.isNewIpad()&&(e="iOS");break}}var r=function(e,t){var i=e.exec(t);return i&&i[1]?i[1]:""},s=function(e,t){var i=RegExp("(?:^|[^A-Z0-9-_]|[^A-Z0-9-]_|sprd-)(?:"+e+")","i").exec(t);return i?i.slice(1)[0]:""};/Windows/.test(e)&&(t=r(/Windows (.*)/,e),e="windows");var a,c;switch(e){case"Mac OS X":t=s("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent),e="mac";break;case"Android":a=this.userAgent,(c=r(/Android ([\.\_\d]+)/,a))||(c=r(/Android\/([\.\_\d]+)/,a)),t=c,e="android";break;case"iOS":t=this.isNewIpad()?s("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent):(t=/OS (\d+)_(\d+)_?(\d+)?/.exec(this.appVersion))?t[1]+"."+t[2]+"."+(0|t[3]):"",e="ios"}return{os_name:e,os_version:t}},e.prototype.getDeviceModel=function(e){var t="";try{if("android"===e)navigator.userAgent.split(";").forEach(function(e){e.indexOf("Build/")>-1&&(t=e.slice(0,e.indexOf("Build/")))});else if("ios"===e||"mac"===e||"windows"===e)if(this.isNewIpad())t="iPad";else{var i=navigator.userAgent.replace("Mozilla/5.0 (",""),n=i.indexOf(";");t=i.slice(0,n)}}catch(e){return t.trim()}return t.trim()},e.prototype.isNewIpad=function(){return void 0!==this.userAgent&&"MacIntel"===navigator.platform&&"number"==typeof navigator.maxTouchPoints&&navigator.maxTouchPoints>1},e}(),w={cn:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az21z1lz21z21z1bz1iz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz21z1ez18z1jz1gz49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz1kz18z1jz1gz24z18z49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k"},k="5.0.22",S=void 0,O=(new Date).getTimezoneOffset(),I=parseInt(""+-O/60,10),x=60*O,C=6048e5,T=function(){function t(e){this.is_first_time=!0,this.configPersist=!1,this.initConfig=e;var t=new b(e.app_id,e.cookie_domain||"",e.cookie_expire||C).init(),i="__tea_cache_first_"+e.app_id;this.configKey="__tea_cache_config_"+e.app_id,this.sessionStorage=new v(!1,"session"),this.localStorage=new v(!1,"local"),e.configPersist&&(this.configPersist=!0,this.storage=1===e.configPersist?this.sessionStorage:this.localStorage),this.localStorage.getItem(i)?this.is_first_time=!1:(this.is_first_time=!0,this.localStorage.setItem(i,"1")),this.envInfo={user:{user_unique_id:S,user_type:S,user_id:S,user_is_auth:S,user_is_login:S,device_id:S,web_id:S,ip_addr_id:S},header:{app_id:S,app_name:S,app_install_id:S,install_id:S,app_package:S,app_channel:S,app_version:S,os_name:t.os_name,os_version:t.os_version,device_model:t.device_model,ab_client:S,traffic_type:S,client_ip:S,device_brand:S,os_api:S,access:S,language:t.language,region:S,app_language:S,app_region:S,ab_version:S,creative_id:t.utm.creative_id,ad_id:t.utm.ad_id,campaign_id:t.utm.campaign_id,log_type:S,rnd:S,platform:t.platform,sdk_version:k,sdk_lib:"js",province:S,city:S,timezone:I,tz_offset:x,tz_name:S,sim_region:S,carrier:S,resolution:t.screen_width+"x"+t.screen_height,browser:t.browser,browser_version:t.browser_version,referrer:t.referrer,referrer_host:t.referrer_host,width:t.screen_width,height:t.screen_height,screen_width:t.screen_width,screen_height:t.screen_height,utm_term:t.utm.utm_term,utm_content:t.utm.utm_content,utm_source:t.utm.utm_source,utm_medium:t.utm.utm_medium,utm_campaign:t.utm.utm_campaign,tracer_data:JSON.stringify(t.utm.tracer_data),custom:{},wechat_unionid:S,wechat_openid:S}},this.ab_version="",this.evtParams={},this.reportErrorCallback=function(){},this.initDomain()}return t.prototype.initDomain=function(){var e=this.initConfig.channel_domain;if(e)this.domain=e;else{var t=this.initConfig.channel;this.domain=c(w[t])}},t.prototype.setDomain=function(e){this.domain=e},t.prototype.getDomain=function(){return this.domain},t.prototype.setAbVersion=function(e){this.ab_version=e},t.prototype.getAbVersion=function(){return this.ab_version},t.prototype.getUrl=function(e){var t="";switch(e){case"event":t=this.initConfig.report_url||"/list";break;case"webid":t="/webid";break;case"tobid":t="/tobid"}var i="";return this.initConfig.caller&&(i="?sdk_version="+k+"&sdk_name=web&app_id="+this.initConfig.app_id+"&caller="+this.initConfig.caller),""+this.getDomain()+t+i},t.prototype.set=function(t){var i=this;Object.keys(t).forEach(function(n){if(void 0!==t[n]&&null!==t[n]||i.delete(n),"evtParams"===n)i.evtParams=e({},i.evtParams||{},t.evtParams||{});else if("_staging_flag"===n)i.evtParams=e({},i.evtParams||{},{_staging_flag:t._staging_flag});else if("reportErrorCallback"===n&&"function"==typeof t[n])i.reportErrorCallback=t[n];else{var o="",r="";if(n.indexOf(".")>-1){var s=n.split(".");o=s[0],r=s[1]}o?"user"===o||"header"===o?i.envInfo[o][r]=t[n]:i.envInfo.header.custom[r]=t[n]:i.envInfo.user.hasOwnProperty(n)?["user_type","ip_addr_id"].indexOf(n)>-1?i.envInfo.user[n]=t[n]?Number(t[n]):t[n]:["user_id","web_id","user_unique_id"].indexOf(n)>-1?i.envInfo.user[n]=t[n]?String(t[n]):t[n]:["user_is_auth","user_is_login"].indexOf(n)>-1?i.envInfo.user[n]=Boolean(t[n]):"device_id"===n&&(i.envInfo.user[n]=t[n]):i.envInfo.header.hasOwnProperty(n)?i.envInfo.header[n]=t[n]:i.envInfo.header.custom[n]=t[n]}})},t.prototype.get=function(e){try{return e?"evtParams"===e?this.evtParams:"reportErrorCallback"===e?this[e]:this.envInfo.user.hasOwnProperty(e)?this.envInfo.user[e]:this.envInfo.header.hasOwnProperty(e)?this.envInfo.header[e]:JSON.parse(JSON.stringify(this.envInfo[e])):JSON.parse(JSON.stringify(this.envInfo))}catch(e){console.log("get config stringify error ")}},t.prototype.setStore=function(e){try{if(!this.configPersist)return;var t=this.storage.getItem(this.configKey)||{};if(t&&Object.keys(e).length){var i=Object.assign(e,t);this.storage.setItem(this.configKey,i)}}catch(e){}},t.prototype.getStore=function(){try{if(!this.configPersist)return null;var e=this.storage.getItem(this.configKey);return e&&Object.keys(e).length?e:null}catch(e){return null}},t.prototype.delete=function(e){try{if(!this.configPersist)return;var t=this.storage.getItem(this.configKey);t&&t.hasOwnProperty(e)&&(delete t[e],this.storage.setItem(this.configKey,t))}catch(e){}},t}(),A=function(){function e(e,t){this.isLog=t||!1,this.name=e||""}return e.prototype.info=function(e){this.isLog&&console.log("["+this.name+"] "+e)},e.prototype.warn=function(e){this.isLog&&console.warn("["+this.name+"] "+e)},e.prototype.error=function(e){this.isLog&&console.error("["+this.name+"] "+e)},e.prototype.throw=function(e){throw this.error(this.name),new Error(e)},e}();!function(e){e.Init="init",e.Config="config",e.Start="start",e.Ready="ready",e.TokenComplete="token-complete",e.TokenStorage="token-storage",e.TokenFetch="token-fetch",e.TokenError="token-error",e.ConfigUuid="config-uuid",e.ConfigWebId="config-webid",e.ConfigDomain="config-domain",e.CustomWebId="custom-webid",e.TokenChange="token-change",e.TokenReset="token-reset",e.ConfigTransform="config-transform",e.EnvTransform="env-transform",e.SessionReset="session-reset",e.SessionResetTime="session-reset-time",e.Event="event",e.Events="events",e.EventNow="event-now",e.CleanEvents="clean-events",e.BeconEvent="becon-event",e.SubmitBefore="submit-before",e.SubmitScuess="submit-scuess",e.SubmitAfter="submit-after",e.SubmitError="submit-error",e.SubmitVerify="submit-verify",e.Stay="stay",e.ResetStay="reset-stay",e.StayReady="stay-ready",e.SetStay="set-stay",e.RouteChange="route-change",e.RouteReady="route-ready",e.Ab="ab",e.AbVar="ab-var",e.AbAllVars="ab-all-vars",e.AbConfig="ab-config",e.AbExternalVersion="ab-external-version",e.AbVersionChangeOn="ab-version-change-on",e.AbVersionChangeOff="ab-version-change-off",e.AbOpenLayer="ab-open-layer",e.AbCloseLayer="ab-close-layer",e.AbReady="ab-ready",e.AbComplete="ab-complete",e.Profile="profile",e.ProfileSet="profile-set",e.ProfileSetOnce="profile-set-once",e.ProfileUnset="profile-unset",e.ProfileIncrement="profile-increment",e.ProfileAppend="profile-append",e.ProfileClear="profile-clear",e.Autotrack="autotrack",e.AutotrackReady="autotrack-ready",e.CepReady="cep-ready",e.TracerReady="tracer-ready"}(m||(m={}));var P=m,M=function(){function e(e){this.native=e}var t=e.prototype;return t.bridgeInject=function(){try{return!!this.native&&(AppLogBridge?(console.log("AppLogBridge is injected"),!0):(console.log("AppLogBridge is not inject"),!1))}catch(e){return console.log("AppLogBridge is not inject"),!1}},t.bridgeReady=function(){var e=this;return new Promise(function(t,i){try{e.bridgeInject()?AppLogBridge.hasStarted(function(e){console.log("AppLogBridge is started? : "+e),e?t(!0):i(!1)}):i(!1)}catch(e){console.log("AppLogBridge, error:"+JSON.stringify(e.stack)),i(!1)}})},t.setConfig=function(e){var t=this;try{Object.keys(e).forEach(function(i){"user_unique_id"===i?t.setUserUniqueId(e[i]):config[i]?t.addHeaderInfo(i,e[i]):t.removeHeaderInfo(i)})}catch(e){console.error("setConfig error")}},t.setUserUniqueId=function(e){try{AppLogBridge.setUserUniqueId(e)}catch(e){console.error("setUserUniqueId error")}},t.addHeaderInfo=function(e,t){try{AppLogBridge.addHeaderInfo(e,t)}catch(e){console.error("addHeaderInfo error")}},t.setHeaderInfo=function(e){try{AppLogBridge.setHeaderInfo(JSON.stringify(e))}catch(e){console.error("setHeaderInfo error")}},t.removeHeaderInfo=function(e){try{AppLogBridge.removeHeaderInfo(e)}catch(e){console.error("removeHeaderInfo error")}},t.reportPv=function(e){this.onEventV3("predefine_pageview",e)},t.onEventV3=function(e,t){try{AppLogBridge.onEventV3(e,t)}catch(e){console.error("onEventV3 error")}},t.profileSet=function(e){try{AppLogBridge.profileSet(e)}catch(e){console.error("profileSet error")}},t.profileSetOnce=function(e){try{AppLogBridge.profileSetOnce(e)}catch(e){console.error("profileSetOnce error")}},t.profileIncrement=function(e){try{AppLogBridge.profileIncrement(e)}catch(e){console.error("profileIncrement error")}},t.profileUnset=function(e){try{AppLogBridge.profileUnset(e)}catch(e){console.error("profileUnset error")}},t.profileAppend=function(e){try{AppLogBridge.profileAppend(e)}catch(e){console.error("profileAppend error")}},e}(),E={NO_URL:4001,IMG_ON:4e3,IMG_CATCH:4002,BEACON_FALSE:4003,XHR_ON:500,RESPONSE:5001,TIMEOUT:5005};function j(e,t,i,n,o,r,s,a){try{var c=new XMLHttpRequest,h=a||"POST";c.open(h,""+e,!0),c.setRequestHeader("Content-Type","application/json; charset=utf-8"),s&&c.setRequestHeader("X-MCS-AppKey",""+s),n&&(c.withCredentials=!0),c.onload=function(){if(o){var e=null;if(c.responseText){try{e=JSON.parse(c.responseText)}catch(t){e={}}o(e,t)}}},i&&(c.timeout=i,c.ontimeout=function(){r&&r(t,E.TIMEOUT)}),c.onerror=function(){c.abort(),r&&r(t,E.XHR_ON)},c.send(JSON.stringify(t))}catch(e){}}var z=4001,R=4e3,N=4002,D=4003,B=function(e,t,i,n){try{var o=e.match(/\/v\d\//),r="";r=o?o[0]:-1!==e.indexOf("/v1/")?"/v1/":"/v2/";var s=e.split(r)[0];if(!s)return void n(e,t,z);t.forEach(function(o){var r=function(e){var t="";for(var i in e)e.hasOwnProperty(i)&&void 0!==e[i]&&(t+="&"+i+"="+encodeURIComponent(JSON.stringify(e[i])));return t="&"===t[0]?t.slice(1):t}(o),a=new Image(1,1);a.onload=function(){a=null,i&&i()},a.onerror=function(){a=null,n&&n(e,t,R)},a.src=s+"/gif?"+r})}catch(i){n&&n(e,t,N,i.message)}},q=function(e,t,i,n,o,r,s){var a=window.navigator.userAgent;if(-1===window.navigator.appName.indexOf("Microsoft Internet Explorer")||-1===a.indexOf("MSIE 8.0")&&-1===a.indexOf("MSIE 9.0")){if(s)return window.navigator&&window.navigator.sendBeacon?void(window.navigator.sendBeacon(e,JSON.stringify(t))?o():r(e,t,D)):void B(e,t,o,r)}else B(e,t,o,r);j(e,t,i,n,o,r)},V=function(){function t(){this.enable_ttwebid=!1,this.eventCache=[],this.beconEventCache=[]}return t.prototype.apply=function(e,t){var i=this;this.collect=e,this.config=t,this.configManager=e.configManager,this.cacheStorgae=new v(!0),this.localStorage=new v(!1),this.maxReport=t.max_report||10,this.reportTime=t.reportTime||30,this.timeout=t.timeout||1e5,this.enable_ttwebid=t.enable_ttwebid,this.reportUrl=this.configManager.getUrl("event"),this.eventKey="__tea_cache_events_"+this.configManager.get("app_id"),this.beconKey="__tea_cache_events_becon_"+this.configManager.get("app_id"),this.abKey="__tea_sdk_ab_version_"+this.configManager.get("app_id"),this.collect.on(P.Ready,function(){i.reportAll(!1)}),this.collect.on(P.ConfigDomain,function(){i.reportUrl=i.configManager.getUrl("event")}),this.collect.on(P.Event,function(e){i.event(e)}),this.collect.on(P.BeconEvent,function(e){i.beconEvent(e)}),this.collect.on(P.CleanEvents,function(){i.reportAll(!1)}),this.linster()},t.prototype.linster=function(){var e=this;window.addEventListener("unload",function(){e.reportAll(!0)},!1),function(e){navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?window.addEventListener("pagehide",e,!1):window.addEventListener("beforeunload",e,!1)}(function(){e.reportAll(!0)}),document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&e.reportAll(!0)},!1)},t.prototype.reportAll=function(e){this.report(e),this.reportBecon()},t.prototype.event=function(e){var t=this;try{var n=i(e,this.cacheStorgae.getItem(this.eventKey)||[]);if(this.cacheStorgae.setItem(this.eventKey,n),this.reportTimeout&&clearTimeout(this.reportTimeout),n.length>=this.maxReport)this.report(!1);else{var o=this.reportTime;this.reportTimeout=setTimeout(function(){t.report(!1),t.reportTimeout=null},o)}}catch(e){}},t.prototype.beconEvent=function(e){var t=i(e,this.cacheStorgae.getItem(this.beconKey)||[]);this.cacheStorgae.setItem(this.beconKey,t),this.collect.destroyInstance||this.collect.tokenManager.getReady()&&this.collect.sdkReady&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(t)),!0))},t.prototype.reportBecon=function(){var e=this.cacheStorgae.getItem(this.beconKey)||[];e&&e.length&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(e)),!0))},t.prototype.report=function(e){if(!this.collect.destroyInstance&&this.collect.tokenManager.getReady()&&this.collect.sdkReady){var t=this.cacheStorgae.getItem(this.eventKey)||[];if(t.length){var i=this.split(this.merge(t));this.cacheStorgae.removeItem(this.eventKey),this.send(i,e)}}},t.prototype.merge=function(t){var i=this,n=this.configManager.get(),o=n.header,r=n.user;o.custom=JSON.stringify(o.custom);var s=this.configManager.get("evtParams"),a=t.map(function(t){Object.keys(s).length&&(t.params=e({},s,t.params));var n=i.localStorage.getItem(i.abKey);return n&&n.uuid&&n.uuid===r.user_unique_id&&i.configManager.getAbVersion()&&(t.ab_sdk_version=i.configManager.getAbVersion()),t.session_id=i.collect.sessionManager.getSessionId(),t.params=JSON.stringify(t.params),t}),c=JSON.parse(JSON.stringify({events:a,user:r,header:o}));c.local_time=Math.floor(Date.now()/1e3),c.user_unique_type=this.config.enable_ttwebid?this.config.user_unique_type:void 0;var h=[];return h.push(c),h},t.prototype.split=function(e){return e=e.map(function(e){var t=[];return t.push(e),t})},t.prototype.send=function(e,t){var i=this;e.length&&e.forEach(function(e){try{var n=JSON.parse(JSON.stringify(e));i.config.filter&&((n=i.config.filter(n))||console.warn("filter must return data !!")),i.collect.eventFilter&&n&&((n=i.collect.eventFilter(n))||console.warn("filterEvent api must return data !!"));var o=n||e;i.collect.emit(P.SubmitBefore,o),i.collect.emit(P.SubmitVerify,o),q(i.reportUrl,o,i.timeout,i.enable_ttwebid,function(e,t){e&&0!==e.e?i.collect.emit(P.SubmitError,{type:"f_data",eventData:t,errorCode:e.e,response:e}):i.collect.emit(P.SubmitScuess,{eventData:t,res:e})},function(e,t){i.configManager.get("reportErrorCallback")(e,t),i.collect.emit(P.SubmitError,{type:"f_net",eventData:e,errorCode:t})},t),i.collect.emit(P.SubmitAfter,o)}catch(e){console.warn("something error, "+JSON.stringify(e.stack))}})},t}(),L=function(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(10):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e)}().replace(/-/g,"").slice(0,19)},U=function(){function e(){this.cacheToken={},this.enableCookie=!1,this.enable_ttwebid=!1,this.enableCustomWebid=!1}return e.prototype.apply=function(e,t){var i=this;this.collect=e,this.config=t,this.configManager=this.collect.configManager,this.storage=new v(!1),this.tokenKey="__tea_cache_tokens_"+t.app_id,this.enable_ttwebid=t.enable_ttwebid,this.enableCustomWebid=t.enable_custom_webid,this.collect.on(P.ConfigUuid,function(e){i.setUuid(e)}),this.collect.on(P.ConfigWebId,function(e){i.setWebId(e)}),this.enableCookie=t.cross_subdomain,this.expiresTime=t.cookie_expire||6048e5,this.cookieDomain=t.cookie_domain||"",this.checkStorage()},e.prototype.checkStorage=function(){var e=this;if(this.enableCookie){var t=this.storage.getCookie(this.tokenKey,this.cookieDomain);this.cacheToken=t&&"string"==typeof t?JSON.parse(t):{}}else this.cacheToken=this.storage.getItem(this.tokenKey)||{};this.tokenType=this.cacheToken&&this.cacheToken._type_?this.cacheToken._type_:"default","custom"!==this.tokenType||this.enableCustomWebid?this.enableCustomWebid?this.collect.on(P.CustomWebId,function(){e.tokenReady=!0,e.collect.emit(P.TokenComplete)}):this.checkEnv()||(this.enable_ttwebid?this.completeTtWid(this.cacheToken):this.check()):this.remoteWebid()},e.prototype.check=function(){this.cacheToken&&this.cacheToken.web_id?this.complete(this.cacheToken):this.config.disable_webid?this.complete({web_id:L(),user_unique_id:this.configManager.get("user_unique_id")||L()}):this.remoteWebid()},e.prototype.checkEnv=function(){if(-1!==window.navigator.userAgent.indexOf("miniProgram")){var e=p(window.location.href);if(e&&e.Web_ID){var t=this.configManager.get("user_unique_id");return this.complete({web_id:""+e.Web_ID,env_uuid:t}),!0}return!1}return!1},e.prototype.remoteWebid=function(){var e=this;j(this.configManager.getUrl("webid"),{app_key:this.config.app_key,app_id:this.config.app_id,url:location.href,user_agent:window.navigator.userAgent,referer:document.referrer,user_unique_id:""},3e3,!1,function(t){t&&0===t.e?e.complete({web_id:e.configManager.get("web_id")||t.web_id,user_unique_id:e.configManager.get("user_unique_id")||t.web_id}):(e.collect.emit(P.TokenError),console.warn("[]appid: "+e.config.app_id+" webid error, init error~"))},function(){e.collect.emit(P.TokenError),console.warn("[]appid: "+e.config.app_id+", get webid error, init error~")})},e.prototype.complete=function(e){var t=e.web_id,i=e.user_unique_id;e.timestamp=Date.now(),this.collect.configManager.set({web_id:t,user_unique_id:i}),this.setStorage(e),this.tokenReady=!0,this.collect.emit(P.TokenComplete)},e.prototype.completeTtWid=function(e){var t=e.user_unique_id||"",i=this.configManager.get("user_unique_id");(i||t)&&this.configManager.set({user_unique_id:i||t}),this.setStorage(e),this.tokenReady=!0,this.collect.emit(P.TokenComplete)},e.prototype.setUuid=function(e){if(e){var t=String(e),i=this.configManager.get("user_unique_id"),n=this.cacheToken&&this.cacheToken.user_unique_id;if(t===i&&t===n)return;this.configManager.set({user_unique_id:t}),this.cacheToken?this.cacheToken.user_unique_id=t:(this.cacheToken={},this.cacheToken.user_unique_id=t),this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken),this.collect.emit(P.TokenChange,"uuid"),this.collect.emit(P.SessionReset)}else this.clearUuid()},e.prototype.clearUuid=function(){this.config.enable_ttwebid||this.configManager.get("web_id")&&(this.configManager.set({user_unique_id:this.configManager.get("web_id")}),this.cacheToken&&this.cacheToken.web_id&&(this.cacheToken.user_unique_id=this.cacheToken.web_id,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken)),this.collect.emit(P.TokenReset))},e.prototype.setWebId=function(e){if(e&&!this.config.enable_ttwebid){this.cacheToken&&this.cacheToken.web_id?this.cacheToken.web_id!==e&&(this.cacheToken.user_unique_id=this.cacheToken.web_id===this.cacheToken.user_unique_id?e:this.cacheToken.user_unique_id,this.cacheToken.web_id=e):(this.cacheToken={},this.cacheToken.web_id=e,this.cacheToken.user_unique_id=e),this.cacheToken.timestamp=Date.now();var t=this.configManager.get("web_id"),i=this.configManager.get("user_unique_id");i&&i!==t||(this.configManager.set({user_unique_id:e}),this.collect.emit(P.TokenChange,"uuid")),t!==e&&(this.configManager.set({web_id:e}),this.collect.emit(P.TokenChange,"webid")),this.setStorage(this.cacheToken)}},e.prototype.setStorage=function(e){e._type_=this.enableCustomWebid?"custom":"default",delete e["diss".split("").reverse().join("")],this.enableCookie||this.enable_ttwebid?this.storage.setCookie(this.tokenKey,e,this.expiresTime,this.cookieDomain):this.storage.setItem(this.tokenKey,e),this.cacheToken=e},e.prototype.getReady=function(){return this.tokenReady},e.prototype.getTobId=function(){var e=this,t=this.configManager.getUrl("tobid");return new Promise(function(i){j(t,{app_id:e.config.app_id,user_unique_id:e.configManager.get("user_unique_id"),web_id:e.configManager.get("web_id")},3e4,e.enable_ttwebid,function(e){e&&0===e.e?i(e.tobid):i("")},function(){i("")})})},e}(),J=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},W=function(){function e(){}return e.prototype.apply=function(e,t){var i=this;this.collect=e,this.storage=new v(!1,"session"),this.sessionKey="__tea_session_id_"+t.app_id,this.expireTime=t.expireTime||18e5,this.disableSession=t.disable_session,this.disableSession||(this.setSessionId(),this.collect.on(P.SessionReset,function(){i.resetSessionId()}),this.collect.on(P.SessionResetTime,function(){i.updateSessionIdTime()}))},e.prototype.updateSessionIdTime=function(){var e=this.storage.getItem(this.sessionKey);if(e&&e.sessionId){var t=e.timestamp;Date.now()-t>this.expireTime?e={sessionId:J(),timestamp:Date.now()}:e.timestamp=Date.now(),this.storage.setItem(this.sessionKey,e),this.resetExpTime()}},e.prototype.setSessionId=function(){var e=this,t=this.storage.getItem(this.sessionKey);t&&t.sessionId?t.timestamp=Date.now():t={sessionId:J(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,t),this.sessionExp=setInterval(function(){e.checkEXp()},this.expireTime)},e.prototype.getSessionId=function(){var e=this.storage.getItem(this.sessionKey);return this.disableSession?"":e&&e.sessionId?e.sessionId:""},e.prototype.resetExpTime=function(){var e=this;this.sessionExp&&(clearInterval(this.sessionExp),this.sessionExp=setInterval(function(){e.checkEXp()},this.expireTime))},e.prototype.resetSessionId=function(){var e={sessionId:J(),timestamp:Date.now()};this.storage.setItem(this.sessionKey,e)},e.prototype.checkEXp=function(){var e=this.storage.getItem(this.sessionKey);e&&e.sessionId&&(Date.now()-e.timestamp+30>=this.expireTime&&(e={sessionId:J(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,e)))},e}(),K={autotrack:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/autotrack.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/autotrack.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/autotrack.js"},object:"LogAutoTrack"},ab:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/ab.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/ab.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/ab.js"},object:"LogAb"},stay:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/stay.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/stay.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/stay.js"},object:"LogStay"},route:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/route.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/route.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/route.js"},object:"LogRoute"},cep:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/cep.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/cep.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/cep.js"},object:"LogCep"},tracer:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/tracer.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/tracer.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/tracer.js"},object:"LogTracer"}},H=function(){function t(e){this.disableAutoPageView=!1,this.bridgeReport=!1,this.staging=!1,this.pluginInstances=[],this.sended=!1,this.started=!1,this.destroyInstance=!1,this.sdkReady=!1,this.adapters={},this.name=e,this.hook=new o,this.logger=new A(e),this.remotePlugin=new Map,this.Types=P,this.adapters.fetch=j,this.adapters.storage=v}return t.usePlugin=function(e,i,n){if(i){for(var o=!1,r=0,s=t.plugins.length;r<s;r++){if(t.plugins[r].name===i){t.plugins[r].plugin=e,t.plugins[r].options=n||{},o=!0;break}}o||t.plugins.push({name:i,plugin:e,options:n})}else t.plugins.push({plugin:e})},t.prototype.usePlugin=function(e,t,i){e&&(t?"string"==typeof t?this.remotePlugin.get(e)||this.remotePlugin.set(e,{src:t,call:i}):this.remotePlugin.get(e)||this.remotePlugin.set(e,{instance:t}):this.remotePlugin.get(e)||this.remotePlugin.set(e,"sdk"))},t.prototype.init=function(e){var i,n=this;this.inited?console.log("init can be call only one time"):e&&r(e)?e.app_id&&("number"==typeof(i=e.app_id)&&!isNaN(i))?!e.app_key||function(e){return"string"==typeof e}(e.app_key)?(e.channel_domain||-1!==["cn","sg","va"].indexOf(e.channel)||(console.warn("channel must be `cn`, `sg`,`va` !!!"),e.channel="cn"),this.appBridge=new M(e.Native),this.bridgeReport=this.appBridge.bridgeInject(),this.configManager=new T(e),this.initConfig=e,this.bridgeReport||(this.configManager.set({app_id:e.app_id}),this.eventManager=new V,this.tokenManager=new U,this.sessionManager=new W,Promise.all([new Promise(function(e){n.once(P.TokenComplete,function(){e(!0)})}),new Promise(function(e){n.once(P.Start,function(){e(!0)})})]).then(function(){try{t.plugins.reduce(function(e,t){var i=t.plugin,o=t.options,r=Object.assign(n.initConfig,o),s=new i;return s.apply(n,r),e.push(s),e},n.pluginInstances)}catch(e){console.log("load plugin error, "+e.message)}n.sdkReady=!0,n.emit(P.Ready),console.info("["+n.name+"] appid: "+e.app_id+", userInfo:"+JSON.stringify(n.configManager.get("user"))),console.info("["+n.name+"] appid: "+e.app_id+", sdk is ready, version is "+k+", you can report now !!!");try{(window.opener||window.parent).postMessage("[tea-sdk]ready","*")}catch(e){}e.disable_auto_pv||n.pageView(),n.on(P.TokenChange,function(t){"webid"===t&&n.pageView(),console.info("["+n.name+"] appid: "+e.app_id+" token change, new userInfo:"+JSON.stringify(n.configManager.get("user")))}),n.on(P.TokenReset,function(){console.info("["+n.name+"] appid: "+e.app_id+" token reset, new userInfo:"+JSON.stringify(n.configManager.get("user")))}),n.on(P.RouteChange,function(t){t.init||e.disable_route_report||n.pageView()})}),this.tokenManager.apply(this,e),this.eventManager.apply(this,e),this.sessionManager.apply(this,e),this.emit(P.Init)),this.inited=!0):console.warn("app_key param is error, must be string, please check!"):console.warn("app_id param is error, must be number, please check!"):console.warn("init params error,please check")},t.prototype.config=function(t){if(this.inited)if(t&&r(t))if(this.bridgeReport)this.appBridge.setConfig(t);else{t._staging_flag&&1===t._staging_flag&&(this.staging=!0),t.disable_auto_pv&&(this.disableAutoPageView=!0,delete t.disable_auto_pv);var i=e({},t);if(this.initConfig&&this.initConfig.configPersist){var n=this.configManager.getStore();n&&(i=Object.assign(n,t)),this.configManager.setStore(t)}i.web_id,i.user_unique_id;var o=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&(i[n[o]]=e[n[o]])}return i}(i,["web_id","user_unique_id"]);i.hasOwnProperty("web_id")&&this.emit(P.ConfigWebId,i.web_id),i.hasOwnProperty("user_unique_id")&&this.emit(P.ConfigUuid,i.user_unique_id),this.configManager.set(o)}else this.logger.warn("config params is error, please check");else this.logger.warn("config must be use after function init")},t.prototype.setDomain=function(e){this.configManager&&this.configManager.setDomain(e),this.emit(P.ConfigDomain)},t.prototype.getConfig=function(e){return this.configManager.get(e)},t.prototype.send=function(){this.start()},t.prototype.start=function(){this.inited&&!this.sended&&(this.sended=!0,this.emit(P.Start))},t.prototype.event=function(e,t){var i=this;try{if(this.initConfig&&this.initConfig.disable_track_event)return;var n=[];Array.isArray(e)?e.forEach(function(e){n.push(i.processEvent(e[0],e[1]||{}))}):n.push(this.processEvent(e,t)),this.bridgeReport?n.forEach(function(e){var t=e.event,n=e.params;i.appBridge.onEventV3(t,JSON.stringify(n))}):n.length&&(this.emit(P.Event,n),this.emit(P.SessionResetTime))}catch(e){console.warn("something error, please check")}},t.prototype.beconEvent=function(e,t){if(!this.initConfig||!this.initConfig.disable_track_event){var i=[];i.push(this.processEvent(e,t||{})),i.length&&(this.emit(P.BeconEvent,i),this.emit(P.SessionResetTime))}},t.prototype.processEvent=function(e,t){void 0===t&&(t={});try{var i=e;/^event\./.test(e)&&(i=e.slice(6));var n=t;"object"!=typeof n&&(n={}),n.profile?delete n.profile:n.event_index=a();var o=void 0;return n.local_ms?(o=n.local_ms,delete n.local_ms):o=+new Date,{event:i,params:n,local_time_ms:o,is_bav:this.initConfig&&this.initConfig.autotrack?1:0}}catch(i){return{event:e,params:t}}},t.prototype.filterEvent=function(e){this.eventFilter=e},t.prototype.on=function(e,t){this.hook.on(e,t)},t.prototype.once=function(e,t){this.hook.once(e,t)},t.prototype.off=function(e,t){this.hook.off(e,t)},t.prototype.emit=function(e,t,i){this.hook.emit(e,t,i)},t.prototype.set=function(e){this.hook.set(e)},t.prototype.pageView=function(){this.disableAutoPageView||this.predefinePageView()},t.prototype.predefinePageView=function(t){void 0===t&&(t={});var i={title:document.title||location.pathname,url:location.href,url_path:location.pathname,time:Date.now(),referrer:window.document.referrer,$is_first_time:""+this.configManager.is_first_time},n=e({},i,t);this.event("predefine_pageview",n)},t.prototype.clearEventCache=function(){this.emit(P.CleanEvents)},t.prototype.setWebIDviaUnionID=function(e){if(e){var t=f(e);this.config({web_id:""+t,wechat_unionid:e}),this.emit(P.CustomWebId)}},t.prototype.setWebIDviaOpenID=function(e){if(e){var t=f(e);this.config({web_id:""+t,wechat_openid:e}),this.emit(P.CustomWebId)}},t.prototype.resetStayDuration=function(e,t,i){void 0===e&&(e=""),void 0===t&&(t=""),void 0===i&&(i=""),this.emit(P.ResetStay,{url_path:e,title:t,url:i},P.Stay)},t.prototype.resetStayParams=function(e,t,i){void 0===e&&(e=""),void 0===t&&(t=""),void 0===i&&(i=""),this.emit(P.SetStay,{url_path:e,title:t,url:i},P.Stay)},t.prototype.getToken=function(t,i){var n=this,o=!1,r=function(i){if(!o){o=!0;var r=n.configManager.get().user;return i&&(r.tobid=i,r["diss".split("").reverse().join("")]=i),t(e({},r))}},s=function(){n.tokenManager.getTobId().then(function(e){r(e)})};this.sdkReady?s():(i&&setTimeout(function(){r()},i),this.on(P.Ready,function(){s()}))},t.prototype.profileSet=function(e){this.bridgeReport?this.appBridge.profileSet(JSON.stringify(e)):this.emit(P.ProfileSet,e,P.Profile)},t.prototype.profileSetOnce=function(e){this.bridgeReport?this.appBridge.profileSetOnce(JSON.stringify(e)):this.emit(P.ProfileSetOnce,e,P.Profile)},t.prototype.profileIncrement=function(e){this.bridgeReport?this.appBridge.profileIncrement(JSON.stringify(e)):this.emit(P.ProfileIncrement,e,P.Profile)},t.prototype.profileUnset=function(e){this.bridgeReport?this.appBridge.profileUnset(e):this.emit(P.ProfileUnset,e,P.Profile)},t.prototype.profileAppend=function(e){this.bridgeReport?this.appBridge.profileAppend(JSON.stringify(e)):this.emit(P.ProfileAppend,e,P.Profile)},t.prototype.setExternalAbVersion=function(e){this.emit(P.AbExternalVersion,"string"==typeof e&&e?(""+e).trim():null,P.Ab)},t.prototype.getVar=function(e,t,i){this.emit(P.AbVar,{name:e,defaultValue:t,callback:i},P.Ab)},t.prototype.getABconfig=function(e,t){this.emit(P.AbConfig,{param:e,callback:t},P.Ab)},t.prototype.getAbSdkVersion=function(){return this.configManager.getAbVersion()},t.prototype.onAbSdkVersionChange=function(e){var t=this;return this.emit(P.AbVersionChangeOn,e,P.Ab),function(){t.emit(P.AbVersionChangeOff,e,P.Ab)}},t.prototype.offAbSdkVersionChange=function(e){this.emit(P.AbVersionChangeOff,e,P.Ab)},t.prototype.openOverlayer=function(){this.emit(P.AbOpenLayer,"",P.Ab)},t.prototype.closeOverlayer=function(){this.emit(P.AbCloseLayer,"",P.Ab)},t.prototype.getAllVars=function(e){this.emit(P.AbAllVars,e,P.Ab)},t.prototype.autoInitializationRangers=function(e){var t,i,n,o,r,s,a,c;i=(t=e).app_id,n=t.channel,o=t.onTokenReady,r=w[n]+"/webid",s=new v(!1),a="__tea_cache_tokens_"+i,(c=s.getItem(a))&&c.web_id?o(c.web_id):q(r,{app_key:"",app_id:i,url:location.href,user_agent:window.navigator.userAgent,referer:document.referrer},3e3,!1,function(e){if(e&&0===e.e){o(e.web_id);var t={web_id:e.web_id,user_unique_id:e.web_id,timestamp:Date.now()};s.setItem(a,t)}else o("")},function(){o("")},!0)},t.prototype.destoryInstace=function(){this.destroyInstance||(this.destroyInstance=!0,this.off(P.TokenComplete))},t.plugins=[],t}(),Q=function(){function e(){}return e.prototype.apply=function(e,t){var i=this,n=e.adapters.fetch;if(t.event_verify_url)if("string"==typeof t.event_verify_url){if(this.url=t.event_verify_url+"/v1/list_test",this.url){var o=e.Types;e.on(o.SubmitBefore,function(e){n(i.url,e,3e4)})}}else console.log("please use correct et_test url")},e}(),X=function(){function t(){}return t.prototype.apply=function(e,t){var i=this;this.collect=e,this.config=t,this.duration=6e4,this.reportUrl=e.configManager.getDomain()+"/profile/list";var n=e.Types,o=e.adapters.fetch;this.fetch=o,this.cache={},this.collect.on(n.ProfileSet,function(e){i.setProfile(e)}),this.collect.on(n.ProfileSetOnce,function(e){i.setOnceProfile(e)}),this.collect.on(n.ProfileUnset,function(e){i.unsetProfile(e)}),this.collect.on(n.ProfileIncrement,function(e){i.incrementProfile(e)}),this.collect.on(n.ProfileAppend,function(e){i.appendProfile(e)}),this.collect.on(n.ProfileClear,function(){i.cache={}}),this.ready(n.Profile)},t.prototype.ready=function(e){if(this.collect.set(e),this.collect.hook._hooksCache.hasOwnProperty(e)){var t=this.collect.hook._hooksCache[e];if(!Object.keys(t).length)return;for(var i in t)this.collect.hook.emit(i,t[i])}},t.prototype.report=function(e,t){void 0===t&&(t={});try{if(this.config.disable_track_event)return;var i=[];i.push(this.collect.processEvent(e,t));var n=this.collect.eventManager.merge(i);this.fetch(this.reportUrl,n)}catch(e){}},t.prototype.setProfile=function(t){var i=this.formatParams(t);i&&Object.keys(i).length&&(this.pushCache(i),this.report("__profile_set",e({},i,{profile:!0})))},t.prototype.setOnceProfile=function(t){var i=this.formatParams(t,!0);i&&Object.keys(i).length&&(this.pushCache(i),this.report("__profile_set_once",e({},i,{profile:!0})))},t.prototype.incrementProfile=function(t){t?this.report("__profile_increment",e({},t,{profile:!0})):console.warn("please check the params, must be object!!!")},t.prototype.unsetProfile=function(t){if(t){var i={};i[t]="1",this.report("__profile_unset",e({},i,{profile:!0}))}else console.warn("please check the key, must be string!!!")},t.prototype.appendProfile=function(t){if(t){var i={};for(var n in t)"string"==typeof t[n]||"Array"===Object.prototype.toString.call(t[n]).slice(8,-1)?i[n]=t[n]:console.warn("please check the value of param: "+n+", must be string or array !!!");Object.keys(i).length&&this.report("__profile_append",e({},i,{profile:!0}))}else console.warn("please check the params, must be object!!!")},t.prototype.pushCache=function(e){var t=this;Object.keys(e).forEach(function(i){t.cache[i]={val:t.clone(e[i]),timestamp:Date.now()}})},t.prototype.formatParams=function(e,t){var i=this;void 0===t&&(t=!1);try{if(!e||"[object Object]"!==Object.prototype.toString.call(e))return void console.warn("please check the params type, must be object !!!");var n={};for(var o in e)"string"==typeof e[o]||"number"==typeof e[o]||"Array"===Object.prototype.toString.call(e[o]).slice(8,-1)?n[o]=e[o]:console.warn("please check the value of params:"+o+", must be string,number,Array !!!");var r=Object.keys(n);if(!r.length)return;var s=Date.now();return r.filter(function(n){var o=i.cache[n];return t?!o:!(o&&i.compare(o.val,e[n])&&s-o.timestamp<i.duration)}).reduce(function(e,t){return e[t]=n[t],e},{})}catch(e){console.log("error")}},t.prototype.compare=function(e,t){try{return JSON.stringify(e)===JSON.stringify(t)}catch(e){return!1}},t.prototype.clone=function(e){try{return JSON.parse(JSON.stringify(e))}catch(t){return e}},t.prototype.unReady=function(){console.warn("sdk is not ready, please use this api after start")},t}(),F=function(){function e(){var e=this;this.setInterval=function(){e.clearIntervalFunc=h(function(){e.isSessionhasEvent&&e.endCurrentSession()},e.sessionInterval)},this.clearInterval=function(){e.clearIntervalFunc&&e.clearIntervalFunc()}}return e.prototype.apply=function(e,t){var i=this;if(this.collect=e,!t.disable_heartbeat){this.sessionInterval=6e4,this.startTime=0,this.lastTime=0,this.setInterval();var n=this.collect.Types;this.collect.on(n.SessionReset,function(){i.process()})}},e.prototype.endCurrentSession=function(){this.collect.event("_be_active",{start_time:this.startTime,end_time:this.lastTime,url:window.location.href,referrer:window.document.referrer,title:document.title||location.pathname}),this.isSessionhasEvent=!1,this.startTime=0},e.prototype.process=function(){this.isSessionhasEvent||(this.isSessionhasEvent=!0,this.startTime=+new Date);var e=this.lastTime||+new Date;this.lastTime=+new Date,this.lastTime-e>this.sessionInterval&&(this.clearInterval(),this.endCurrentSession(),this.setInterval())},e}();var $=function(){function e(){}return e.prototype.apply=function(e,t){var i=this;if(this.collect=e,this.config=t,!this.config.channel_domain){var n=e.adapters.fetch;if(this.fetch=n,!t.disable_track_event&&!t.disable_sdk_monitor){this.url=e.configManager.getUrl("event");var o=this.collect.Types;this.collect.on(o.Ready,function(){i.sdkOnload()}),this.collect.on(o.SubmitError,function(e){var t=e.eventData,n=e.errorCode;i.sdkError(t,n)})}}},e.prototype.sdkOnload=function(){var e=this;try{var t=this.collect.configManager.get(),i=t.header,n=t.user,o=i.app_id,r=i.app_name,s=i.sdk_version,a=n.web_id,c={events:[{event:"onload",params:JSON.stringify({app_id:o,app_name:r||"",sdk_version:s,sdk_type:"script",sdk_config:this.config,sdk_desc:"TOC"}),local_time_ms:Date.now()}],user:{user_unique_id:a},header:{}};setTimeout(function(){e.fetch(e.url,[c],3e4,!1,function(){},function(){},"566f58151b0ed37e")},16)}catch(e){}},e.prototype.sdkError=function(e,t){var i=this;try{var n=e[0],o=n.user,r=n.header,s=[];e.forEach(function(e){e.events.forEach(function(e){s.push(e)})});var a={events:s.map(function(e){return{event:"on_error",params:JSON.stringify({error_code:t,app_id:r.app_id,app_name:r.app_name||"",error_event:e.event,sdk_version:r.sdk_version,local_time_ms:e.local_time_ms,tea_event_index:Date.now(),params:e.params,header:JSON.stringify(r),user:JSON.stringify(o)}),local_time_ms:Date.now()}}),user:{user_unique_id:o.user_unique_id},header:{}};setTimeout(function(){i.fetch(i.url,[a],3e4,!1,function(){},function(){},"566f58151b0ed37e")},16)}catch(e){}},e}(),Z=["getConfig","getAbSdkVersion"],G=["init","usePlugin","autoInitializationRangers"],Y=function(){function e(e){this.task=[],this.Collector=e,this.collectMap=new Map}return e.prototype.processTask=function(){var e=this;if(this.task.length){var t=this.findIndex(this.task,G,"0");-1!==t?(this.processCmd.apply(this,i(this.task[t])),this.task.forEach(function(n,o){o!==t&&e.processCmd.apply(e,i(n))}),this.task=[]):console.warn("init or use must be first call")}},e.prototype.processCmd=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(s(e)){var i=this.processScope(e[0]),n=i.scope,o=i.cmd;if(e.splice(0,1),-1!==Z.indexOf(o))return this.callCmd(n,o,e);this.callCmd(n,o,e)}},e.prototype.callCmd=function(e,t,n){try{if(-1!==G.indexOf(t)&&(this.collectMap.get(e)||(this.collect=new this.Collector(e),this.collectMap.set(e,this.collect))),!this.collectMap.get(e))return void console.log("init or use must be first call");var o=this.collectMap.get(e);if(o.__proto__.hasOwnProperty(t)){if(-1!==Z.indexOf(t))return o[t].apply(o,i(n));o[t].apply(o,i(n))}else o.event.apply(o,i([t],n))}catch(e){}},e.prototype.findIndex=function(e,t,i){var n=this,o=-1;try{e.forEach(function(e,r){var s=void 0!==i?e[i]:e,a=n.processScope(s).cmd;-1!==t.indexOf(a)&&(o=r)})}catch(e){return o}return o},e.prototype.processScope=function(e){var t="default";if(e.indexOf(".")>-1){var i=e.split(".");t=i[0],e=i[1]}return{scope:t,cmd:e}},e}(),ee=function(){function e(){this.verifyReady=!1,this.waitTime=5e3,this.cleanStatus=!1}return e.prototype.apply=function(e,t){var i=this;this.collector=e,this.config=t;var n=e.adapters.storage;this.cacheStorgae=new n(!1,"session"),this.eventStorage=[],this.collector.on("submit-verify",function(e){e&&e.length&&i.eventStore(e[0])}),this.checkCache()},e.prototype.checkCache=function(){var e=this;this.verifyCookieKey="__applog_verify_set_"+this.config.app_id;this.cacheStorgae.getCookie(this.verifyCookieKey);var t=this.cacheStorgae.getItem(this.verifyCookieKey);this.sign=t&&t.sign||"",this.origin=t&&t.origin||"*";var i=setTimeout(function(){e.cleanVerify(),clearTimeout(i),e.collector.off("submit-verify")},this.waitTime);window.addEventListener("message",function(t){t&&t.data&&"simulator:verify"===t.data.type&&(clearTimeout(i),e.receMessage(t))},!0)},e.prototype.receMessage=function(e){if(!this.cleanStatus){var t=e.data;this.verifyReady=!0,this.sign=t.sign,this.origin=e.origin,this.cacheStorgae.setItem(this.verifyCookieKey,JSON.stringify({sign:t.sign,origin:e.origin})),this.eventStorage.length&&this.postVerify(this.eventStorage,t.sign,e.origin)}},e.prototype.eventStore=function(e){this.cleanStatus||(this.verifyReady?this.postVerify(e,this.sign,this.origin):this.eventStorage.push(e))},e.prototype.cleanVerify=function(){this.cleanStatus=!0,this.eventStorage=[]},e.prototype.postVerify=function(e,t,i){try{var n=[];s(e)?e.forEach(function(e){n.push(e)}):n.push(e);var o={type:"simulator:verify:event",sign:t,pageUrl:window.location.href,events:n};(window.opener||window.parent).postMessage(o,i)}catch(e){console.log("web verify post message error ~")}},e}(),te="undefined"!=typeof window?(window.LogPluginObject||(window.LogPluginObject={}),window.LogPluginObject):null,ie=function(){function e(){}return e.prototype.apply=function(e,t){this._plugin={},this.config=t,this.collect=e,this.channel=t.channel||"cn",this.loadExtend()},e.prototype.loadExtend=function(){var e=this;try{this.collect.remotePlugin.forEach(function(t,i){if("sdk"===t)if(K.hasOwnProperty(i)){var n=K[i].object,o=K[i].src[e.channel]+"?query="+Date.now();e.exist(i,n,o)}else console.warn("your"+i+" is not existplease check plugin name");else"object"==typeof t&&(t.src?e.exist(i,t.call,t.src):e.process(i,t.instance,"INSTANCE"))})}catch(e){console.log("load extend error")}},e.prototype.exist=function(e,t,i){var n=this;te[t]?this.process(e,te[t]):this.loadPlugin(e,i,function(){n.process(e,te[t]),console.log("load "+e+" success")},function(){console.log("load "+e+" error")})},e.prototype.process=function(e,t,i){try{if(i){var n=new t;n.apply&&n.apply(this.collect,this.config),console.log("excude "+e+" success")}else t&&t(this.collect,this.config)}catch(t){console.log("excude "+e+" error, message:"+t.message)}},e.prototype.loadPlugin=function(e,t,i,n){var o=this;try{var r=document.createElement("script");r.src=t,this._plugin[e]||(this._plugin[e]=[]),this._plugin[e].push(i),r.onerror=function(){n(t)},r.onload=function(){o._plugin[e].forEach(function(e){e()})},document.getElementsByTagName("head")[0].appendChild(r)}catch(e){}},e}();H.usePlugin(ie,"extend"),H.usePlugin(ee,"verify"),H.usePlugin(Q,"et"),H.usePlugin(X,"profile"),H.usePlugin(F,"heartbeat"),H.usePlugin($,"monitor"),function(e){if("undefined"!=typeof window){var t=function(){if("undefined"!=typeof window)return window.LogAnalyticsObject||window.TeaAnalyticsObject}();if(t&&window[t]){var i=window[t];i.sdkLoad?console.log("you page has load sdk file already, do not load another sdk file"):(e.task=i.q||[],window[t]=e.processCmd.bind(e),window[t].sdkLoad=!0,e.processTask())}}}(new Y(H))}();
