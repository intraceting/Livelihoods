var __tea_iife_export__=function(){"use strict";var t,e=function(){return(e=Object.assign||function(t){for(var e,i=1,a=arguments.length;i<a;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},i=function(t){return null!=t&&"[object Object]"==Object.prototype.toString.call(t)},a=(t=+Date.now()+Number((""+Math.random()).slice(2,8)),function(t){!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?window.addEventListener("pagehide",t,!1):window.addEventListener("beforeunload",t,!1)}),n=function(){var t=0;return["hidden","msHidden","webkitHidden"].forEach(function(e){void 0!==document[e]&&(t=1)}),t},s=function(){function t(t,e){this.maxDuration=432e5,this.aliveDTime=6e4,this.options={aliveName:"predefine_page_alive",params:{}},this.collect=t,this.config=e,this.pageStartTime=Date.now(),this.sessionStartTime=this.pageStartTime,this.timerHandler=null,i(e.enable_stay_duration)&&(this.options=Object.assign(this.options,e.enable_stay_duration))}return t.prototype.setParams=function(t,e,i){this.set_path=t,this.set_url=i,this.set_title=e},t.prototype.enable=function(t,e,i){this.url_path=t,this.url=i,this.title=e,this.disableCallback=this.enablePageAlive()},t.prototype.disable=function(){this.disableCallback(),this.pageStartTime=Date.now()},t.prototype.sendEvent=function(t){void 0===t&&(t=!1);var i=t?this.aliveDTime:Date.now()-this.sessionStartTime;i<0||Date.now()-this.pageStartTime>this.maxDuration||(this.collect.beconEvent(this.options.aliveName,e({url_path:this.getParams("url_path"),title:this.getParams("title"),url:this.getParams("url"),duration:i,is_support_visibility_change:n(),startTime:this.sessionStartTime},this.options.params)),this.sessionStartTime=Date.now())},t.prototype.getParams=function(t){switch(t){case"url_path":return this.set_path||this.url_path||location.pathname;case"title":return this.set_title||this.title||document.title||location.pathname;case"url":return this.set_url||this.url||location.href}},t.prototype.setUpTimer=function(){var t=this;return this.timerHandler&&clearInterval(this.timerHandler),setInterval(function(){Date.now()-t.sessionStartTime>t.aliveDTime&&t.sendEvent(!0)},1e3)},t.prototype.visibilitychange=function(){"hidden"===document.visibilityState?this.timerHandler&&(clearInterval(this.timerHandler),this.sendEvent()):"visible"===document.visibilityState&&(this.sessionStartTime=Date.now(),this.timerHandler=this.setUpTimer())},t.prototype.beforeunload=function(){document.hidden||this.sendEvent()},t.prototype.enablePageAlive=function(){var t=this;return this.timerHandler=this.setUpTimer(),document.addEventListener("visibilitychange",this.visibilitychange.bind(this)),a(this.beforeunload.bind(this)),function(){t.beforeunload(),document.removeEventListener("visibilitychange",t.visibilitychange.bind(t)),window.removeEventListener("beforeunload",t.beforeunload.bind(t)),window.removeEventListener("pagehide",t.beforeunload.bind(t))}},t}(),o=function(){function t(t,e){var a=this;this.maxDuration=432e5,this.aliveDTime=6e4,this.options={closeName:"predefine_page_close",params:{}},this.visibilitychange=function(){"hidden"===document.visibilityState?a.activeEndTime=Date.now():"visible"===document.visibilityState&&(a.activeEndTime&&(a.totalTime+=a.activeEndTime-a.activeStartTime,a.activeTimes+=1),a.activeEndTime=void 0,a.activeStartTime=Date.now())},this.beforeunload=function(){if(a.totalTime+=(a.activeEndTime||Date.now())-a.activeStartTime,a.config.autotrack){try{window.sessionStorage.setItem("_tea_cache_duration",JSON.stringify({duration:a.totalTime,page_title:document.title||location.pathname}))}catch(t){}}a.sendEventPageClose()},this.collect=t,this.config=e,this.maxDuration=e.maxDuration||864e5,this.pageStartTime=Date.now(),i(e.enable_stay_duration)&&(this.options=Object.assign(this.options,e.enable_stay_duration)),this.resetData()}return t.prototype.setParams=function(t,e,i){this.set_path=t,this.set_url=i,this.set_title=e},t.prototype.enable=function(t,e,i){this.url_path=t,this.url=i,this.title=e,this.disableCallback=this.enablePageClose()},t.prototype.disable=function(){this.disableCallback()},t.prototype.resetData=function(){this.activeStartTime=void 0===this.activeStartTime?this.pageStartTime:Date.now(),this.activeEndTime=void 0,this.activeTimes=1,this.totalTime=0},t.prototype.sendEventPageClose=function(){var t=Date.now()-this.pageStartTime;this.totalTime<0||t<0||this.totalTime>=this.maxDuration||(this.collect.beconEvent(this.options.closeName,e({url_path:this.getParams("url_path"),title:this.getParams("title"),url:this.getParams("url"),active_times:this.activeTimes,duration:this.totalTime,total_duration:t,is_support_visibility_change:n()},this.options.params)),this.pageStartTime=Date.now(),this.resetData())},t.prototype.getParams=function(t){switch(t){case"url_path":return this.set_path||this.url_path||location.pathname;case"title":return this.set_title||this.title||document.title||location.pathname;case"url":return this.set_url||this.url||location.href}},t.prototype.enablePageClose=function(){var t=this;return document.addEventListener("visibilitychange",this.visibilitychange.bind(this)),a(this.beforeunload.bind(this)),function(){t.beforeunload(),document.removeEventListener("visibilitychange",t.visibilitychange.bind(t)),window.removeEventListener("beforeunload",t.beforeunload.bind(t)),window.removeEventListener("pagehide",t.beforeunload.bind(t))}},t}(),r=function(){function t(){}return t.prototype.apply=function(t,e){var i=this;if(this.collect=t,this.config=e,this.config.enable_stay_duration){this.title=document.title||location.pathname,this.url=location.href,this.url_path=location.pathname,this.pageAlive=new s(t,e),this.pageClose=new o(t,e);var a=this.collect.Types;this.collect.on(a.ResetStay,function(t){var e=t.url_path,a=t.title,n=t.url;i.resetStayDuration(e,a,n)}),this.collect.on(a.RouteChange,function(t){t.init||e.disable_route_report||i.resetStayDuration()}),this.collect.on(a.SetStay,function(t){var e=t.url_path,a=t.title,n=t.url;i.setStayParmas(e,a,n)}),this.enable(this.url_path,this.title,this.url),this.ready(a.Stay),this.collect.emit(a.StayReady)}},t.prototype.ready=function(t){if(this.collect.set(t),this.collect.hook._hooksCache.hasOwnProperty(t)){var e=this.collect.hook._hooksCache[t];if(!Object.keys(e).length)return;for(var i in e)this.collect.hook.emit(i,e[i])}},t.prototype.enable=function(t,e,i){this.pageAlive.enable(t,e,i),this.pageClose.enable(t,e,i)},t.prototype.disable=function(){this.pageAlive.disable(),this.pageClose.disable()},t.prototype.setStayParmas=function(t,e,i){void 0===t&&(t=""),void 0===e&&(e=""),void 0===i&&(i=""),this.pageAlive.setParams(t,e,i),this.pageClose.setParams(t,e,i)},t.prototype.reset=function(t,e,i){this.disable(),this.enable(t,e,i)},t.prototype.resetStayDuration=function(t,e,i){this.reset(t,e,i)},t}();try{var l="undefined"!=typeof window?(window.LogPluginObject||(window.LogPluginObject={}),window.LogPluginObject):null;l&&(l.LogStay=function(t,e){(new r).apply(t,e)})}catch(t){console.log(t)}return r}();
