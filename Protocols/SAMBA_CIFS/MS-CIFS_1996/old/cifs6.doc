{\rtf1\ansi \deff4\deflang1033{\fonttbl{\f0\froman\fcharset0\fprq2 Tms Rmn;}{\f1\froman\fcharset2\fprq2 Symbol;}{\f2\fswiss\fcharset0\fprq2 Helv;}{\f3\fmodern\fcharset0\fprq1 Courier;}
{\f4\froman\fcharset0\fprq2 Times New Roman;}{\f5\fswiss\fcharset0\fprq2 Arial;}{\f6\froman\fcharset0\fprq2 MS Serif;}{\f7\fswiss\fcharset0\fprq2 MS Sans Serif;}{\f8\froman\fcharset0\fprq2 Times;}{\f9\fswiss\fcharset0\fprq2 Helvetica;}
{\f10\fswiss\fcharset0\fprq2 System;}{\f11\fmodern\fcharset0\fprq1 Courier New;}{\f12\froman\fcharset0\fprq2 New York;}{\f13\fswiss\fcharset0\fprq2 Geneva;}{\f14\fswiss\fcharset0\fprq2 AvantGarde;}{\f15\froman\fcharset0\fprq2 ITC Bookman;}
{\f16\fswiss\fcharset0\fprq2 Helvetica-Narrow;}{\f17\froman\fcharset0\fprq2 NewCenturySchlbk;}{\f18\froman\fcharset0\fprq2 Palatino;}{\f19\froman\fcharset0\fprq2 ZapfChancery;}{\f20\fdecor\fcharset2\fprq2 ZapfDingbats;}{\f21\fnil\fcharset2\fprq2 Marlett;}
{\f22\fmodern\fcharset0\fprq1 Lucida Console;}{\f23\fswiss\fcharset0\fprq2 Lucida Sans Unicode;}{\f24\fnil\fcharset2\fprq2 Wingdings;}{\f25\fswiss\fcharset0\fprq2 Arial Narrow;}{\f26\fswiss\fcharset0\fprq2 Arial Black;}
{\f27\fswiss\fcharset0\fprq2 Arial Rounded MT Bold;}{\f28\froman\fcharset0\fprq2 Book Antiqua;}{\f29\froman\fcharset0\fprq2 Bookman Old Style;}{\f30\fswiss\fcharset0\fprq2 Century Gothic;}{\f31\froman\fcharset0\fprq2 Century Schoolbook;}
{\f32\fnil\fcharset2\fprq2 Monotype Sorts;}{\f33\fswiss\fcharset0\fprq2 Haettenschweiler;}{\f34\fdecor\fcharset0\fprq2 Algerian;}{\f35\fdecor\fcharset0\fprq2 Braggadocio;}{\f36\fswiss\fcharset0\fprq2 Britannic Bold;}
{\f37\fscript\fcharset0\fprq2 Brush Script MT;}{\f38\fdecor\fcharset0\fprq2 Colonna MT;}{\f39\fdecor\fcharset0\fprq2 Desdemona;}{\f40\froman\fcharset0\fprq2 Footlight MT Light;}{\f41\froman\fcharset0\fprq2 Garamond;}{\f42\fswiss\fcharset0\fprq2 Impact;}
{\f43\fdecor\fcharset0\fprq2 Kino MT;}{\f44\froman\fcharset0\fprq2 Wide Latin;}{\f45\fscript\fcharset0\fprq2 Matura MT Script Capitals;}{\f46\fdecor\fcharset0\fprq2 Playbill;}{\f47\fmodern\fcharset2\fprq1 MS LineDraw;}{\f48\fswiss\fcharset0\fprq2 Tahoma;}
{\f49\fnil\fcharset2\fprq2 MS Outlook;}{\f50\fscript\fcharset0\fprq2 Comic Sans MS;}{\f51\froman\fcharset255\fprq2 Roman;}{\f52\fscript\fcharset255\fprq2 Script;}{\f53\fmodern\fcharset255\fprq2 Modern;}{\f54\fswiss\fcharset0\fprq1 MS Dialog;}
{\f55\fswiss\fcharset0\fprq2 Verdana;}{\f56\fswiss\fcharset0\fprq2 MS Shell Dlg;}{\f57\fmodern\fcharset0\fprq1 Roman 10cpi;}{\f58\froman\fcharset238\fprq2 Times New Roman CE;}{\f59\froman\fcharset204\fprq2 Times New Roman Cyr;}
{\f60\froman\fcharset161\fprq2 Times New Roman Greek;}{\f61\froman\fcharset162\fprq2 Times New Roman Tur;}{\f62\froman\fcharset186\fprq2 Times New Roman Baltic;}{\f63\fswiss\fcharset238\fprq2 Arial CE;}{\f64\fswiss\fcharset204\fprq2 Arial Cyr;}
{\f65\fswiss\fcharset161\fprq2 Arial Greek;}{\f66\fswiss\fcharset162\fprq2 Arial Tur;}{\f67\fswiss\fcharset186\fprq2 Arial Baltic;}{\f68\fmodern\fcharset238\fprq1 Courier New CE;}{\f69\fmodern\fcharset204\fprq1 Courier New Cyr;}
{\f70\fmodern\fcharset161\fprq1 Courier New Greek;}{\f71\fmodern\fcharset162\fprq1 Courier New Tur;}{\f72\fmodern\fcharset186\fprq1 Courier New Baltic;}{\f73\fswiss\fcharset238\fprq2 Tahoma CE;}{\f74\fswiss\fcharset204\fprq2 Tahoma Cyr;}
{\f75\fswiss\fcharset161\fprq2 Tahoma Greek;}{\f76\fswiss\fcharset162\fprq2 Tahoma Tur;}{\f77\fswiss\fcharset186\fprq2 Tahoma Baltic;}{\f78\fmodern\fcharset238\fprq1 Lucida Console CE;}{\f79\fmodern\fcharset204\fprq1 Lucida Console Cyr;}
{\f80\fmodern\fcharset161\fprq1 Lucida Console Greek;}{\f81\fmodern\fcharset162\fprq1 Lucida Console Tur;}{\f82\fswiss\fcharset238\fprq2 Lucida Sans Unicode CE;}{\f83\fswiss\fcharset204\fprq2 Lucida Sans Unicode Cyr;}
{\f84\fswiss\fcharset161\fprq2 Lucida Sans Unicode Greek;}{\f85\fswiss\fcharset162\fprq2 Lucida Sans Unicode Tur;}{\f86\fswiss\fcharset238\fprq2 Arial Narrow CE;}{\f87\fswiss\fcharset204\fprq2 Arial Narrow Cyr;}
{\f88\fswiss\fcharset161\fprq2 Arial Narrow Greek;}{\f89\fswiss\fcharset162\fprq2 Arial Narrow Tur;}{\f90\fswiss\fcharset186\fprq2 Arial Narrow Baltic;}{\f91\fswiss\fcharset238\fprq2 Arial Black CE;}{\f92\fswiss\fcharset204\fprq2 Arial Black Cyr;}
{\f93\fswiss\fcharset161\fprq2 Arial Black Greek;}{\f94\fswiss\fcharset162\fprq2 Arial Black Tur;}{\f95\fswiss\fcharset186\fprq2 Arial Black Baltic;}{\f96\froman\fcharset238\fprq2 Bookman Old Style CE;}
{\f97\froman\fcharset204\fprq2 Bookman Old Style Cyr;}{\f98\froman\fcharset161\fprq2 Bookman Old Style Greek;}{\f99\froman\fcharset162\fprq2 Bookman Old Style Tur;}{\f100\froman\fcharset186\fprq2 Bookman Old Style Baltic;}
{\f101\froman\fcharset238\fprq2 Garamond CE;}{\f102\froman\fcharset204\fprq2 Garamond Cyr;}{\f103\froman\fcharset161\fprq2 Garamond Greek;}{\f104\froman\fcharset162\fprq2 Garamond Tur;}{\f105\froman\fcharset186\fprq2 Garamond Baltic;}
{\f106\fswiss\fcharset238\fprq2 Impact CE;}{\f107\fswiss\fcharset204\fprq2 Impact Cyr;}{\f108\fswiss\fcharset161\fprq2 Impact Greek;}{\f109\fswiss\fcharset162\fprq2 Impact Tur;}{\f110\fswiss\fcharset186\fprq2 Impact Baltic;}}{\colortbl;\red0\green0\blue0;
\red0\green0\blue255;\red0\green255\blue255;\red0\green255\blue0;\red255\green0\blue255;\red255\green0\blue0;\red255\green255\blue0;\red255\green255\blue255;\red0\green0\blue128;\red0\green128\blue128;\red0\green128\blue0;\red128\green0\blue128;
\red128\green0\blue0;\red128\green128\blue0;\red128\green128\blue128;\red192\green192\blue192;}{\stylesheet{\sa240\widctlpar\tx576 \f4\fs20 \snext0 Normal;}{\s1\fi-432\li432\sb240\sa60\keepn\widctlpar\tx432\tx576 \b\f5\fs32\kerning28 \sbasedon0\snext0 
heading 1;}{\s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 \sbasedon0\snext0 heading 2;}{\s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 \sbasedon0\snext0 heading 3;}{
\s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 \sbasedon0\snext0 heading 4;}{\s5\fi-1008\li1008\sb100\sa100\widctlpar\tx576\tx1008 \b\f25\fs22 \sbasedon0\snext0 heading 5;}{\s6\fi-1152\li1152\sb40\sa240\sl-238\slmult0
\widctlpar\tx576\tx1152 \b\f25\fs21 \sbasedon0\snext0 heading 6;}{\s7\fi-1296\li1296\sb240\sa60\sl-240\slmult0\keepn\widctlpar\tx360\tx600\tx840\tx1296 \f4\fs20 \sbasedon0\snext0 heading 7;}{\s8\fi-1440\li1440\sb240\sa60\sl-240\slmult0
\keepn\widctlpar\tx360\tx600\tx840\tx1440 \i\f4\fs20 \sbasedon0\snext0 heading 8;}{\s9\fi-1584\li1584\sb240\sa60\sl-240\slmult0\keepn\widctlpar\tx360\tx600\tx840\tx1584 \b\i\f4\fs18 \sbasedon0\snext0 heading 9;}{\*\cs10 \additive Default Paragraph Font;}{
\s15\qc\sb240\sa240\widctlpar\tx360\tx600\tx840 \b\f4\fs32\kerning28 \sbasedon0\snext15 Title;}{\s16\keepn\widctlpar\tx576\tqr\tx9360 \f11\fs20 \sbasedon0\snext16 I-D Header;}{\s17\li600\sa240\widctlpar\tx576 \f4\fs20 \sbasedon0\snext0 toc 4;}{
\s18\widctlpar\tx576 \b\caps\f4\fs20 \sbasedon0\snext18 toc 1;}{\s19\li202\widctlpar\tx576 \scaps\f4\fs20 \sbasedon0\snext19 toc 2;}{\s20\li403\widctlpar\tx576\tx1440\tqr\tldot\tx9350 \i\f4\fs20\lang1024 \sbasedon0\snext20 toc 3;}{
\s21\sa240\sl-240\slmult0\widctlpar\tx360\tx600\tx840 \f4\fs20 \sbasedon0\snext21 Body Text 2;}{\s22\sa240\sl-240\slmult0\widctlpar\tx576\tx1152\tx1728\tx2304 \f11\fs20 \sbasedon0\snext22 Code;}{\s23\sa240\widctlpar\tx576\tqc\tx4320\tqr\tx8640 \f4\fs20 
\sbasedon0\snext23 header;}{\s24\sl-240\slmult0\keep\keepn\widctlpar\tx360\tx600\tx840 \f4\fs20 \sbasedon0\snext24 Diagram;}{\s25\sb240\sa240\widctlpar\tx576 \b\f5\fs32 \sbasedon0\snext0 Heading;}{\s26\li800\sa240\widctlpar\tx576 \f4\fs20 
\sbasedon0\snext0 toc 5;}{\s27\li1000\sa240\widctlpar\tx576 \f4\fs20 \sbasedon0\snext0 toc 6;}{\s28\li1200\sa240\widctlpar\tx576 \f4\fs20 \sbasedon0\snext0 toc 7;}{\s29\li1400\sa240\widctlpar\tx576 \f4\fs20 \sbasedon0\snext0 toc 8;}{
\s30\li1600\sa240\widctlpar\tx576 \f4\fs20 \sbasedon0\snext0 toc 9;}{\s31\sa240\widctlpar\tx576\tqc\tx4320\tqr\tx8640 \f4\fs20 \sbasedon0\snext31 footer;}}{\*\revtbl {Unknown;}}{\info{\title A Common Internet File System Protocol (CIFS/1.0)}{\author Dilip C. Naik}
{\keywords SMB, File System, Distributed, Remote}{\operator Dilip C. Naik}{\creatim\yr1997\mo3\dy19\hr19\min37}{\revtim\yr1997\mo3\dy19\hr20}{\printim\yr1997\mo3\dy19\hr14\min24}{\version2}{\edmins0}{\nofpages1}{\nofwords41109}{\nofchars234322}
{\*\company Microsoft}{\vern57443}}\margl0\margr1872 \widowctrl\ftnbj\aenddoc\noextrasprl\prcolbl\cvmme\sprsspbf\brkfrm\swpbdr\hyphcaps0\formshade\fracwidth \fet0\sectd \psz1\linex0\endnhere\titlepg {\header \pard\plain 
\s23\sa240\widctlpar\tx576\tqc\tx4320\tqr\tx8640 \f4\fs20 INTERNET-DRAFT\tab CIFS/1.0\tab {\field{\*\fldinst  DATE \\@ "MM/dd/yy" }{\fldrslt {\lang1024 03/19/97}}}
\par }{\footer \pard\plain \s31\sa240\widctlpar\tx576\tqc\tx4320\tqr\tx8640 \f4\fs20 {\field{\*\fldinst  AUTHOR }{\fldrslt {\lang1024 Leach, Naik}}}\tab expires September, 1997\tab [Page {\field{\*\fldinst  PAGE }{\fldrslt {\lang1024 32}}}]
\par }{\footerf \pard\plain \s31\sa240\widctlpar\tx576\tqc\tx4320\tqr\tx8640 \f4\fs20 {\field{\*\fldinst  AUTHOR }{\fldrslt {\lang1024 Leach, Naik}}}\tab expires September, 1997\tab  [Page {\field{\*\fldinst  PAGE }{\fldrslt {\lang1024 1}}}]
\par }{\*\pnseclvl1\pnucrm\pnstart1\pnindent720\pnhang{\pntxta .}}{\*\pnseclvl2\pnucltr\pnstart1\pnindent720\pnhang{\pntxta .}}{\*\pnseclvl3\pndec\pnstart1\pnindent720\pnhang{\pntxta .}}{\*\pnseclvl4\pnlcltr\pnstart1\pnindent720\pnhang{\pntxta )}}{\*\pnseclvl5
\pndec\pnstart1\pnindent720\pnhang{\pntxtb (}{\pntxta )}}{\*\pnseclvl6\pnlcltr\pnstart1\pnindent720\pnhang{\pntxtb (}{\pntxta )}}{\*\pnseclvl7\pnlcrm\pnstart1\pnindent720\pnhang{\pntxtb (}{\pntxta )}}{\*\pnseclvl8\pnlcltr\pnstart1\pnindent720\pnhang
{\pntxtb (}{\pntxta )}}{\*\pnseclvl9\pnlcrm\pnstart1\pnindent720\pnhang{\pntxtb (}{\pntxta )}}\pard\plain \s16\keepn\widctlpar\tx576\tqr\tx9360 \f11\fs20 Network Working Group\tab Paul J. Leach, Microsoft
\par INTERNET-DRAFT\tab Dilip C. Naik, Microsoft
\par draft-leach-cifs-v1-spec-02.txt
\par Category: Informational
\par Expires September 13, 1997\tab March 13, 1997
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 
\par \pard\plain \s15\qc\sb240\sa240\widctlpar\tx360\tx600\tx840 \b\f4\fs32\kerning28 {\f5 A Common Internet File System (CIFS/1.0) Protocol
\par }\pard\plain \qc\sa240\widctlpar\tx576 \f4\fs20 {\i Preliminary Draft
\par }\pard\plain \s25\sb240\sa240\widctlpar\tx576 \b\f5\fs32 {\*\bkmkstart _Toc382909238}{\*\bkmkstart _Toc382911149}Status of this Mem{\*\bkmkend _Toc382909238}{\*\bkmkend _Toc382911149}o
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 
This document is an Internet-Draft. Internet-Drafts are working documents of the Internet Engineering Task Force (IETF), its areas, and its working groups. Note that other groups may also distribute working documents as Internet-Drafts.
\par Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or made obsolete by other documents at any time. It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in pr
ogress".
\par To learn the current status of any Internet-Draft, please check the "{\f11 1id-abstracts.txt}" listing contained in the Internet-Drafts Shadow Directories on {\f11 ftp.is.co.za} (Africa),{\f11  nic.nordu.net} (Europe), {\f11 munnari.oz.au} (Pacific Rim), 
{\f11 ds.internic.net} (US East Coast), or {\f11 ftp.isi.edu} (US West Coast).
\par Distribution of this document is unlimited. Please send comments to the authors at <{\f11 cifs@microsoft.com}>. Discussion of CIFS is on the mailing list <cifs@listserv.msn.com>; subscribe by sending a message to <ListServ@listserv.msn.co
m> with a body of "subscribe CIFS you@your.domain". There is a CIFS home page at <http://www.microsoft.com/intdev/cifs>.
\par \pard\plain \s25\sb240\sa240\widctlpar\tx576 \b\f5\fs32 {\i  }{\*\bkmkstart _Toc382909239}{\*\bkmkstart _Toc382911150}Abstract{\*\bkmkend _Toc382909239}{\*\bkmkend _Toc382911150}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 
This document describes the CIFS file sharing protocol, version 1.0.  Client systems use this protocol to request file and  print services from server systems over a network. It is based on the Server Message Block protocol widely in use by personal compu
ters and workstations running a wide variety of operating systems.
\par {\*\bkmkstart _Toc382909240}{\*\bkmkstart _Toc382911151}Table Of Contents{\*\bkmkend _Toc382909240}{\*\bkmkend _Toc382911151}
\par \pard\plain \s18\widctlpar\tx576\tqr\tldot\tx10358 \b\caps\f4\fs20 {\field\fldedit{\*\fldinst  TOC \\o "1-3" }{\fldrslt {\lang1024 Status of this Memo\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911149 \\h }{\lang1024 {\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310034003900000000}}}{\fldrslt {\lang1024 1}}}{\lang1024 
\par Abstract\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911150 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310035003000000000}}}{\fldrslt {\lang1024 1}}}{\lang1024 

\par Table Of Contents\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911151 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310035003100000000}}}{\fldrslt {\lang1024 1}}}{
\lang1024 
\par }\pard \s18\widctlpar\tx403\tx576\tqr\tldot\tx10358 {\lang1024 1\tab Introduction\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911152 \\h }{\lang1024 {\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310035003200000000}}}{\fldrslt {\lang1024 5}}}{\lang1024 
\par }\pard\plain \s19\li202\widctlpar\tx576\tx800\tqr\tldot\tx10358 \scaps\f4\fs20 {\lang1024 1.1\tab Summary of features\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911153 \\h }{\lang1024 {\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310035003300000000}}}{\fldrslt {\lang1024 5}}}{\lang1024 
\par }\pard\plain \s20\li403\widctlpar\tx576\tx1440\tqr\tldot\tx9350 \i\f4\fs20\lang1024 1.1.1\tab File access\tab {\field{\*\fldinst  PAGEREF _Toc382911154 \\h {{\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310035003400000000}}}{\fldrslt 5}}
\par 1.1.2\tab File and record locking\tab {\field{\*\fldinst  PAGEREF _Toc382911155 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310035003500000000}}}{\fldrslt 6}}
\par 1.1.3\tab Safe caching, read-ahead, and write-behind\tab {\field{\*\fldinst  PAGEREF _Toc382911156 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310035003600000000}}}{\fldrslt 6}}

\par 1.1.4\tab File change notification\tab {\field{\*\fldinst  PAGEREF _Toc382911157 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310035003700000000}}}{\fldrslt 6}}
\par 1.1.5\tab Protocol version negotiation\tab {\field{\*\fldinst  PAGEREF _Toc382911158 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310035003800000000}}}{\fldrslt 6}}
\par 1.1.6\tab Extended attributes\tab {\field{\*\fldinst  PAGEREF _Toc382911159 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310035003900000000}}}{\fldrslt 6}}
\par 1.1.7\tab Distributed replicated virtual volumes\tab {\field{\*\fldinst  PAGEREF _Toc382911160 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310036003000000000}}}{\fldrslt 6}}
\par 1.1.8\tab Server name resolution independence\tab {\field{\*\fldinst  PAGEREF _Toc382911161 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310036003100000000}}}{\fldrslt 7}}
\par 1.1.9\tab Batched requests\tab {\field{\*\fldinst  PAGEREF _Toc382911162 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310036003200000000}}}{\fldrslt 7}}
\par \pard\plain \s18\widctlpar\tx403\tx576\tqr\tldot\tx10358 \b\caps\f4\fs20 {\lang1024 2\tab Protocol Operation Overview\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911163 \\h }{\lang1024 {\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310036003300000000}}}{\fldrslt {\lang1024 7}}}{\lang1024 
\par }\pard\plain \s19\li202\widctlpar\tx576\tx800\tqr\tldot\tx10358 \scaps\f4\fs20 {\lang1024 2.1\tab Server Name Determination\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911164 \\h }{\lang1024 {\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310036003400000000}}}{\fldrslt {\lang1024 7}}}{\lang1024 
\par 2.2\tab Server Name Resolution\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911165 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310036003500000000}}}{\fldrslt {
\lang1024 8}}}{\lang1024 
\par 2.3\tab Sample Message Flow\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911166 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310036003600000000}}}{\fldrslt {
\lang1024 8}}}{\lang1024 
\par 2.4\tab Message Format\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911167 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310036003700000000}}}{\fldrslt {\lang1024 9}}}
{\lang1024 
\par }\pard\plain \s20\li403\widctlpar\tx576\tx1440\tqr\tldot\tx9350 \i\f4\fs20\lang1024 2.4.1\tab Notation\tab {\field{\*\fldinst  PAGEREF _Toc382911168 \\h {{\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310036003800000000}}}{\fldrslt 9}}
\par 2.4.2\tab SMB header\tab {\field{\*\fldinst  PAGEREF _Toc382911169 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310036003900000000}}}{\fldrslt 10}}
\par \pard\plain \s19\li202\widctlpar\tx576\tx800\tqr\tldot\tx10358 \scaps\f4\fs20 {\lang1024 2.5\tab CIFS Protocol Dialect Negotiation\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911170 \\h }{\lang1024 {\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310037003000000000}}}{\fldrslt {\lang1024 11}}}{\lang1024 
\par 2.6\tab Message Transport\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911171 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310037003100000000}}}{\fldrslt {\lang1024 
11}}}{\lang1024 
\par }\pard\plain \s20\li403\widctlpar\tx576\tx1440\tqr\tldot\tx9350 \i\f4\fs20\lang1024 2.6.1\tab Connection Establishment\tab {\field{\*\fldinst  PAGEREF _Toc382911172 \\h {{\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310037003200000000}}}{\fldrslt 11}}
\par 2.6.2\tab Server-side Connection Procedures\tab {\field{\*\fldinst  PAGEREF _Toc382911173 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310037003300000000}}}{\fldrslt 12}}
\par 2.6.3\tab Connection Management\tab {\field{\*\fldinst  PAGEREF _Toc382911174 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310037003400000000}}}{\fldrslt 12}}
\par \pard\plain \s19\li202\widctlpar\tx576\tx800\tqr\tldot\tx10358 \scaps\f4\fs20 {\lang1024 2.7\tab Opportunistic Locks\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911175 \\h }{\lang1024 {\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310037003500000000}}}{\fldrslt {\lang1024 13}}}{\lang1024 
\par }\pard\plain \s20\li403\widctlpar\tx576\tx1440\tqr\tldot\tx9350 \i\f4\fs20\lang1024 2.7.1\tab Exclusive Oplocks\tab {\field{\*\fldinst  PAGEREF _Toc382911176 \\h {{\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310037003600000000}}}{\fldrslt 13}}
\par 2.7.2\tab Batch Oplocks\tab {\field{\*\fldinst  PAGEREF _Toc382911177 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310037003700000000}}}{\fldrslt 14}}
\par 2.7.3\tab Level II Oplocks\tab {\field{\*\fldinst  PAGEREF _Toc382911178 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310037003800000000}}}{\fldrslt 16}}
\par \pard\plain \s19\li202\widctlpar\tx576\tx800\tqr\tldot\tx10358 \scaps\f4\fs20 {\lang1024 2.8\tab Security Model\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911179 \\h }{\lang1024 {\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310037003900000000}}}{\fldrslt {\lang1024 17}}}{\lang1024 
\par 2.9\tab Resource Share/Access Example\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911180 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310038003000000000}}}{\fldrslt 
{\lang1024 18}}}{\lang1024 
\par 2.10\tab Authentication\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911181 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310038003100000000}}}{\fldrslt {\lang1024 19}
}}{\lang1024 
\par }\pard\plain \s20\li403\widctlpar\tx576\tx1440\tqr\tldot\tx9350 \i\f4\fs20\lang1024 2.10.1\tab Pre NT LM 0.12\tab {\field{\*\fldinst  PAGEREF _Toc382911182 \\h {{\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310038003200000000}}}{\fldrslt 20}}
\par 2.10.2\tab NT LM 0.12\tab {\field{\*\fldinst  PAGEREF _Toc382911183 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310038003300000000}}}{\fldrslt 21}}
\par \pard\plain \s19\li202\widctlpar\tx576\tx800\tqr\tldot\tx10358 \scaps\f4\fs20 {\lang1024 2.11\tab Distributed Filesystem (DFS) Support\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911184 \\h }{\lang1024 {\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310038003400000000}}}{\fldrslt {\lang1024 21}}}{\lang1024 
\par }\pard\plain \s18\widctlpar\tx403\tx576\tqr\tldot\tx10358 \b\caps\f4\fs20 {\lang1024 3\tab SMB Message Formats and Data Types\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911185 \\h }{\lang1024 {\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310038003500000000}}}{\fldrslt {\lang1024 22}}}{\lang1024 
\par }\pard\plain \s19\li202\widctlpar\tx576\tx800\tqr\tldot\tx10358 \scaps\f4\fs20 {\lang1024 3.1\tab SMB Header\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911186 \\h }{\lang1024 {\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310038003600000000}}}{\fldrslt {\lang1024 22}}}{\lang1024 
\par }\pard\plain \s20\li403\widctlpar\tx576\tx1440\tqr\tldot\tx9350 \i\f4\fs20\lang1024 3.1.1\tab Flags field\tab {\field{\*\fldinst  PAGEREF _Toc382911187 \\h {{\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310038003700000000}}}{\fldrslt 22}}
\par 3.1.2\tab Flags2 Field\tab {\field{\*\fldinst  PAGEREF _Toc382911188 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310038003800000000}}}{\fldrslt 24}}
\par 3.1.3\tab Tid Field\tab {\field{\*\fldinst  PAGEREF _Toc382911189 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310038003900000000}}}{\fldrslt 24}}
\par 3.1.4\tab Pid Field\tab {\field{\*\fldinst  PAGEREF _Toc382911190 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310039003000000000}}}{\fldrslt 25}}
\par 3.1.5\tab Mid Field\tab {\field{\*\fldinst  PAGEREF _Toc382911191 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310039003100000000}}}{\fldrslt 25}}
\par 3.1.6\tab Status Field\tab {\field{\*\fldinst  PAGEREF _Toc382911192 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310039003200000000}}}{\fldrslt 26}}
\par 3.1.7\tab Timeouts\tab {\field{\*\fldinst  PAGEREF _Toc382911193 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310039003300000000}}}{\fldrslt 26}}
\par 3.1.8\tab Data Buffer ({\caps Buffer}) and String Formats\tab {\field{\*\fldinst  PAGEREF _Toc382911194 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310039003400000000}}}{\fldrslt 26
}}
\par \pard\plain \s19\li202\widctlpar\tx576\tx800\tqr\tldot\tx10358 \scaps\f4\fs20 {\lang1024 3.2\tab File Names\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911195 \\h }{\lang1024 {\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310039003500000000}}}{\fldrslt {\lang1024 27}}}{\lang1024 
\par 3.3\tab Wildcards\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911196 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310039003600000000}}}{\fldrslt {\lang1024 28}}}{
\lang1024 
\par 3.4\tab DFS Pathnames\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911197 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310039003700000000}}}{\fldrslt {\lang1024 28}}}
{\lang1024 
\par 3.5\tab Time And Date Encoding\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911198 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310039003800000000}}}{\fldrslt {
\lang1024 29}}}{\lang1024 
\par 3.6\tab Access Mode Encoding\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911199 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100310039003900000000}}}{\fldrslt {
\lang1024 30}}}{\lang1024 
\par 3.7\tab Access Mask Encoding\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911200 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320030003000000000}}}{\fldrslt {
\lang1024 31}}}{\lang1024 
\par 3.8\tab Open Function Encoding\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911201 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320030003100000000}}}{\fldrslt {
\lang1024 32}}}{\lang1024 
\par 3.9\tab Open Action Encoding\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911202 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320030003200000000}}}{\fldrslt {
\lang1024 32}}}{\lang1024 
\par 3.10\tab File Attribute Encoding\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911203 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320030003300000000}}}{\fldrslt {
\lang1024 33}}}{\lang1024 
\par 3.11\tab Extended File Attribute Encoding\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911204 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320030003400000000}}
}{\fldrslt {\lang1024 33}}}{\lang1024 
\par 3.12\tab Batching Requests ("AndX" Messages)\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911205 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320030003500000000}}
}{\fldrslt {\lang1024 36}}}{\lang1024 
\par 3.13\tab "Transaction" Style Subprotocols\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911206 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320030003600000000}}
}{\fldrslt {\lang1024 37}}}{\lang1024 
\par }\pard\plain \s20\li403\widctlpar\tx576\tx1440\tqr\tldot\tx9350 \i\f4\fs20\lang1024 3.13.1\tab SMB_COM_TRANSACTION and SMB_COM_TRANSACTION2 Formats\tab {\field{\*\fldinst  PAGEREF _Toc382911207 \\h {{\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320030003700000000}}}{\fldrslt 38}}
\par 3.13.2\tab SMB_COM_NT_TRANSACTION Formats\tab {\field{\*\fldinst  PAGEREF _Toc382911208 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320030003800000000}}}{\fldrslt 40}}
\par 3.13.3\tab Functional Description\tab {\field{\*\fldinst  PAGEREF _Toc382911209 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320030003900000000}}}{\fldrslt 42}}
\par \pard\plain \s19\li202\widctlpar\tx576\tx800\tqr\tldot\tx10358 \scaps\f4\fs20 {\lang1024 3.14\tab Valid SMB Requests by Negotiated Dialect\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911210 \\h }{\lang1024 {\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320031003000000000}}}{\fldrslt {\lang1024 46}}}{\lang1024 
\par }\pard\plain \s18\widctlpar\tx403\tx576\tqr\tldot\tx10358 \b\caps\f4\fs20 {\lang1024 4\tab SMB Requests\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911211 \\h }{\lang1024 {\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320031003100000000}}}{\fldrslt {\lang1024 47}}}{\lang1024 
\par }\pard\plain \s19\li202\widctlpar\tx576\tx800\tqr\tldot\tx10358 \scaps\f4\fs20 {\lang1024 4.1\tab Session Requests\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911212 \\h }{\lang1024 {\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320031003200000000}}}{\fldrslt {\lang1024 48}}}{\lang1024 
\par }\pard\plain \s20\li403\widctlpar\tx576\tx1440\tqr\tldot\tx9350 \i\f4\fs20\lang1024 4.1.1\tab NEGOTIATE: Negotiate Protocol\tab {\field{\*\fldinst  PAGEREF _Toc382911213 \\h {{\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320031003300000000}}}{\fldrslt 48}}
\par 4.1.2\tab SESSION_SETUP_ANDX: Session Setup\tab {\field{\*\fldinst  PAGEREF _Toc382911214 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320031003400000000}}}{\fldrslt 51}}
\par 4.1.3\tab LOGOFF_ANDX: User Logoff\tab {\field{\*\fldinst  PAGEREF _Toc382911215 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320031003500000000}}}{\fldrslt 56}}
\par 4.1.4\tab TREE_CONNECT_ANDX:  Tree Connect\tab {\field{\*\fldinst  PAGEREF _Toc382911216 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320031003600000000}}}{\fldrslt 56}}
\par 4.1.5\tab TREE_DISCONNECT:  Tree Disconnect\tab {\field{\*\fldinst  PAGEREF _Toc382911217 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320031003700000000}}}{\fldrslt 59}}
\par 4.1.6\tab TRANS2_QUERY_FS_INFORMATION: Get File System Information\tab {\field{\*\fldinst  PAGEREF _Toc382911218 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320031003800000000}}
}{\fldrslt 59}}
\par 4.1.7\tab ECHO: Ping the Server\tab {\field{\*\fldinst  PAGEREF _Toc382911219 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320031003900000000}}}{\fldrslt 64}}
\par {\kerning28 4.1.8}\tab {\kerning28 NT_CANCEL: Cancel request}\tab {\field{\*\fldinst  PAGEREF _Toc382911220 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320032003000000000}}
}{\fldrslt 65}}
\par \pard\plain \s19\li202\widctlpar\tx576\tx800\tqr\tldot\tx10358 \scaps\f4\fs20 {\lang1024 4.2\tab File Requests\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911221 \\h }{\lang1024 {\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320032003100000000}}}{\fldrslt {\lang1024 66}}}{\lang1024 
\par }\pard\plain \s20\li403\widctlpar\tx576\tx1440\tqr\tldot\tx9350 \i\f4\fs20\lang1024 4.2.1\tab NT_CREATE_ANDX: Create or Open File\tab {\field{\*\fldinst  PAGEREF _Toc382911222 \\h {{\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320032003200000000}}}{\fldrslt 66}}
\par {\kerning28 4.2.2}\tab {\kerning28 NT_TRANSACT_CREATE: Create or Open File with EAs or SD}\tab {\field{\*\fldinst  PAGEREF _Toc382911223 \\h {{\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320032003300000000}}}{\fldrslt 69}}
\par 4.2.3\tab CREATE_TEMPORARY: Create Temporary File\tab {\field{\*\fldinst  PAGEREF _Toc382911224 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320032003400000000}}}{\fldrslt 70}}
\par 4.2.4\tab READ_ANDX:  Read Bytes\tab {\field{\*\fldinst  PAGEREF _Toc382911225 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320032003500000000}}}{\fldrslt 71}}
\par 4.2.5\tab WRITE_ANDX:  Write Bytes to file or resource\tab {\field{\*\fldinst  PAGEREF _Toc382911226 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320032003600000000}}}{\fldrslt 72}}

\par 4.2.6\tab LOCKING_ANDX:  Lock or Unlock Byte Ranges\tab {\field{\*\fldinst  PAGEREF _Toc382911227 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320032003700000000}}}{\fldrslt 73}}

\par 4.2.7\tab SEEK: Seek in File\tab {\field{\*\fldinst  PAGEREF _Toc382911228 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320032003800000000}}}{\fldrslt 76}}
\par 4.2.8\tab FLUSH: Flush File\tab {\field{\*\fldinst  PAGEREF _Toc382911229 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320032003900000000}}}{\fldrslt 78}}
\par 4.2.9\tab CLOSE: Close File\tab {\field{\*\fldinst  PAGEREF _Toc382911230 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320033003000000000}}}{\fldrslt 78}}
\par 4.2.10\tab DELETE: Delete File\tab {\field{\*\fldinst  PAGEREF _Toc382911231 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320033003100000000}}}{\fldrslt 79}}
\par 4.2.11\tab RENAME: Rename File\tab {\field{\*\fldinst  PAGEREF _Toc382911232 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320033003200000000}}}{\fldrslt 80}}
\par 4.2.12\tab MOVE:  Rename File\tab {\field{\*\fldinst  PAGEREF _Toc382911233 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320033003300000000}}}{\fldrslt 81}}
\par 4.2.13\tab COPY: Copy File\tab {\field{\*\fldinst  PAGEREF _Toc382911234 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320033003400000000}}}{\fldrslt 83}}
\par 4.2.14\tab TRANS2_QUERY_PATH_INFORMATION: Get File Attributes given Path\tab {\field{\*\fldinst  PAGEREF _Toc382911235 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320033003500000000}
}}{\fldrslt 84}}
\par 4.2.15\tab TRANS2_QUERY_FILE_INFORMATION: Get File Attributes Given FID\tab {\field{\*\fldinst  PAGEREF _Toc382911236 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320033003600000000}}
}{\fldrslt 91}}
\par {\caps 4.2.16}\tab {\caps TRANS2_SET_PATH_INFORMATION}: Set File Attributes given Path\tab {\field{\*\fldinst  PAGEREF _Toc382911237 \\h {{\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320033003700000000}}}{\fldrslt 91}}
\par {\caps 4.2.17}\tab {\caps TRANS2_SET_FILE_INFORMATION}: Set File Attributes Given FID\tab {\field{\*\fldinst  PAGEREF _Toc382911238 \\h {{\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320033003800000000}}}{\fldrslt 93}}
\par \pard\plain \s19\li202\widctlpar\tx576\tx800\tqr\tldot\tx10358 \scaps\f4\fs20 {\lang1024\kerning28 4.3}{\lang1024 \tab }{\lang1024\kerning28 Directory Requests}{\lang1024 \tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911239 \\h }{\lang1024 
{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320033003900000000}}}{\fldrslt {\lang1024 94}}}{\lang1024 
\par }\pard\plain \s20\li403\widctlpar\tx576\tx1440\tqr\tldot\tx9350 \i\f4\fs20\lang1024 4.3.1\tab DELETE_DIRECTORY: Delete Directory\tab {\field{\*\fldinst  PAGEREF _Toc382911240 \\h {{\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320034003000000000}}}{\fldrslt 95}}
\par 4.3.2\tab CHECK_DIRECTORY: Check Directory\tab {\field{\*\fldinst  PAGEREF _Toc382911241 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320034003100000000}}}{\fldrslt 95}}
\par 4.3.3\tab TRANS2_FIND_FIRST2: Search Directory using Wildcards\tab {\field{\*\fldinst  PAGEREF _Toc382911242 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320034003200000000}}
}{\fldrslt 96}}
\par 4.3.4\tab TRANS2_FIND_NEXT2: Resume Directory Search Using Wildcards\tab {\field{\*\fldinst  PAGEREF _Toc382911243 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320034003300000000}}
}{\fldrslt 101}}
\par {\kerning28 4.3.5}\tab {\kerning28 FIND_CLOSE2: Close Directory Search}\tab {\field{\*\fldinst  PAGEREF _Toc382911244 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320034003400000000}}
}{\fldrslt 102}}
\par {\kerning28 4.3.6}\tab {\kerning28 NT_TRANSACT_NOTIFY_CHANGE: Request Change Notification}\tab {\field{\*\fldinst  PAGEREF _Toc382911245 \\h {{\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320034003500000000}}}{\fldrslt 102}}
\par \pard\plain \s19\li202\widctlpar\tx576\tx800\tqr\tldot\tx10358 \scaps\f4\fs20 {\lang1024 4.4\tab DFS Operations\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911246 \\h }{\lang1024 {\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320034003600000000}}}{\fldrslt {\lang1024 104}}}{\lang1024 
\par }\pard\plain \s20\li403\widctlpar\tx576\tx1440\tqr\tldot\tx9350 \i\f4\fs20\lang1024 {\caps 4.4.1}\tab {\caps TRANS2_GET_DFS_REFERRAL: }Retrieve Distributed Filesystem{\caps  }Referral\tab {\field{\*\fldinst  PAGEREF _Toc382911247 \\h {{\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320034003700000000}}}{\fldrslt 104}}
\par 4.4.2\tab TRANS2_REPORT_DFS_INCONSISTENCY: Inform a server about DFS Error\tab {\field{\*\fldinst  PAGEREF _Toc382911248 \\h {{\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320034003800000000}}}{\fldrslt 107}}
\par \pard\plain \s19\li202\widctlpar\tx576\tx800\tqr\tldot\tx10358 \scaps\f4\fs20 {\lang1024 4.5\tab Print Spooling Operations\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911249 \\h }{\lang1024 {\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320034003900000000}}}{\fldrslt {\lang1024 107}}}{\lang1024 
\par }\pard\plain \s20\li403\widctlpar\tx576\tx1440\tqr\tldot\tx9350 \i\f4\fs20\lang1024 4.5.1\tab OPEN_PRINT_FILE: Create Print Spool file\tab {\field{\*\fldinst  PAGEREF _Toc382911250 \\h {{\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320035003000000000}}}{\fldrslt 107}}
\par 4.5.2\tab GET_PRINT_QUEUE: Get Printer Queue Entries\tab {\field{\*\fldinst  PAGEREF _Toc382911251 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320035003100000000}}}{\fldrslt 108}}

\par \pard\plain \s19\li202\widctlpar\tx576\tx800\tqr\tldot\tx10358 \scaps\f4\fs20 {\lang1024\kerning28 4.6}{\lang1024 \tab }{\lang1024\kerning28 Miscellaneous Operations}{\lang1024 \tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911252 \\h }{\lang1024 
{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320035003200000000}}}{\fldrslt {\lang1024 110}}}{\lang1024 
\par }\pard\plain \s20\li403\widctlpar\tx576\tx1440\tqr\tldot\tx9350 \i\f4\fs20\lang1024 {\kerning28 4.6.1}\tab {\kerning28 NT_TRANSACT_IOCTL}\tab {\field{\*\fldinst  PAGEREF _Toc382911253 \\h {{\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320035003300000000}}}{\fldrslt 110}}
\par {\kerning28 4.6.2}\tab {\kerning28 NT_TRANSACT_QUERY_SECURITY_DESC}\tab {\field{\*\fldinst  PAGEREF _Toc382911254 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320035003400000000}}
}{\fldrslt 110}}
\par {\kerning28 4.6.3}\tab {\kerning28 NT_TRANSACT_SET_SECURITY_DESC}\tab {\field{\*\fldinst  PAGEREF _Toc382911255 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320035003500000000}}
}{\fldrslt 111}}
\par \pard\plain \s18\widctlpar\tx403\tx576\tqr\tldot\tx10358 \b\caps\f4\fs20 {\lang1024 5\tab Obsolescent SMB Requests\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911256 \\h }{\lang1024 {\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320035003600000000}}}{\fldrslt {\lang1024 111}}}{\lang1024 
\par }\pard\plain \s19\li202\widctlpar\tx576\tx800\tqr\tldot\tx10358 \scaps\f4\fs20 {\lang1024 5.1\tab CLOSE_PRINT_FILE:  Close and Spool Print Job\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911257 \\h }{\lang1024 {\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320035003700000000}}}{\fldrslt {\lang1024 111}}}{\lang1024 
\par 5.2\tab CREATE: Create File\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911258 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320035003800000000}}}{\fldrslt {
\lang1024 112}}}{\lang1024 
\par 5.3\tab CREATE_DIRECTORY: Create Directory\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911259 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320035003900000000}}
}{\fldrslt {\lang1024 113}}}{\lang1024 
\par 5.4\tab CREATE_NEW: Create File\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911260 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320036003000000000}}}{\fldrslt {
\lang1024 113}}}{\lang1024 
\par 5.5\tab LOCK_AND_READ: Lock and Read Bytes\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911261 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320036003100000000}}
}{\fldrslt {\lang1024 114}}}{\lang1024 
\par 5.6\tab LOCK_BYTE_RANGE: Lock Bytes\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911262 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320036003200000000}}}{\fldrslt {
\lang1024 115}}}{\lang1024 
\par 5.7\tab OPEN: Open File\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911263 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320036003300000000}}}{\fldrslt {\lang1024 116
}}}{\lang1024 
\par 5.8\tab OPEN_ANDX:  Open File\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911264 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320036003400000000}}}{\fldrslt {
\lang1024 118}}}{\lang1024 
\par 5.9\tab PROCESS_EXIT: Process Exit\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911265 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320036003500000000}}}{\fldrslt {
\lang1024 119}}}{\lang1024 
\par 5.10\tab QUERY_INFORMATION:  Get File Attributes\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911266 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320036003600000000}}
}{\fldrslt {\lang1024 120}}}{\lang1024 
\par 5.11\tab QUERY_INFORMATION2: Get File Information\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911267 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320036003700000000}
}}{\fldrslt {\lang1024 120}}}{\lang1024 
\par 5.12\tab READ: Read File\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911268 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320036003800000000}}}{\fldrslt {\lang1024 
121}}}{\lang1024 
\par 5.13\tab READ_MPX: Read Block Multiplex\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911269 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320036003900000000}}
}{\fldrslt {\lang1024 122}}}{\lang1024 
\par 5.14\tab READ_RAW: Read Raw\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911270 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320037003000000000}}}{\fldrslt {
\lang1024 124}}}{\lang1024 
\par 5.15\tab SEARCH: Search Directory using Wildcards\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911271 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320037003100000000}
}}{\fldrslt {\lang1024 126}}}{\lang1024 
\par 5.16\tab SET_INFORMATION: Set File Attributes\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911272 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320037003200000000}}
}{\fldrslt {\lang1024 128}}}{\lang1024 
\par 5.17\tab SET_INFORMATION2: Set File Information\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911273 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320037003300000000}}
}{\fldrslt {\lang1024 129}}}{\lang1024 
\par 5.18\tab QUERY_INFORMATION_DISK: Get Disk Attributes\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911274 \\h }{\lang1024 {\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320037003400000000}}}{\fldrslt {\lang1024 129}}}{\lang1024 
\par 5.19\tab TRANS2_OPEN2: Create or Open File with Extended Attributes\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911275 \\h }{\lang1024 {\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320037003500000000}}}{\fldrslt {\lang1024 130}}}{\lang1024 
\par 5.20\tab TREE_CONNECT: Tree Connect\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911276 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320037003600000000}}}{\fldrslt {
\lang1024 132}}}{\lang1024 
\par 5.21\tab UNLOCK_BYTE_RANGE: Unlock Bytes\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911277 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320037003700000000}}
}{\fldrslt {\lang1024 132}}}{\lang1024 
\par 5.22\tab WRITE: Write Bytes\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911278 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320037003800000000}}}{\fldrslt {
\lang1024 133}}}{\lang1024 
\par 5.23\tab WRITE_AND_UNLOCK: Write Bytes and Unlock Range\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911279 \\h }{\lang1024 {\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320037003900000000}}}{\fldrslt {\lang1024 134}}}{\lang1024 
\par 5.24\tab WRITE_AND_CLOSE:  Write Bytes and Close File\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911280 \\h }{\lang1024 {\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320038003000000000}}}{\fldrslt {\lang1024 135}}}{\lang1024 
\par 5.25\tab WRITE_MPX: Write Block Multiplex\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911281 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320038003100000000}}
}{\fldrslt {\lang1024 136}}}{\lang1024 
\par 5.26\tab WRITE_PRINT_FILE: Write to Print File\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911282 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320038003200000000}}
}{\fldrslt {\lang1024 138}}}{\lang1024 
\par 5.27\tab WRITE_RAW: Write Raw Bytes\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911283 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320038003300000000}}}{\fldrslt {
\lang1024 139}}}{\lang1024 
\par }\pard\plain \s18\widctlpar\tx403\tx576\tqr\tldot\tx10358 \b\caps\f4\fs20 {\lang1024 6\tab SMB Symbolic Constants\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911284 \\h }{\lang1024 {\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320038003400000000}}}{\fldrslt {\lang1024 142}}}{\lang1024 
\par }\pard\plain \s19\li202\widctlpar\tx576\tx800\tqr\tldot\tx10358 \scaps\f4\fs20 {\lang1024 6.1\tab SMB Command Codes\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911285 \\h }{\lang1024 {\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320038003500000000}}}{\fldrslt {\lang1024 142}}}{\lang1024 
\par 6.2\tab SMB_COM_TRANSACTION2 Subcommand codes\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911286 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320038003600000000}}
}{\fldrslt {\lang1024 144}}}{\lang1024 
\par 6.3\tab SMB_COM_NT_TRANSACTION Subcommand Codes\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911287 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320038003700000000}}
}{\fldrslt {\lang1024 145}}}{\lang1024 
\par 6.4\tab SMB Protocol Dialect Constants\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911288 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320038003800000000}}
}{\fldrslt {\lang1024 145}}}{\lang1024 
\par }\pard\plain \s18\widctlpar\tx403\tx576\tqr\tldot\tx10358 \b\caps\f4\fs20 {\lang1024 7\tab Error Codes and Classes\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911289 \\h }{\lang1024 {\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320038003900000000}}}{\fldrslt {\lang1024 146}}}{\lang1024 
\par 8\tab Legal Notice\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911290 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320039003000000000}}}{\fldrslt {\lang1024 150}}}{
\lang1024 
\par 9\tab References\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911291 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320039003100000000}}}{\fldrslt {\lang1024 150}}}{
\lang1024 
\par 10\tab Security Considerations\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911292 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320039003200000000}}}{\fldrslt {
\lang1024 151}}}{\lang1024 
\par }\pard\plain \s19\li202\widctlpar\tx576\tx800\tqr\tldot\tx10358 \scaps\f4\fs20 {\lang1024 10.1\tab Share level protection\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911293 \\h }{\lang1024 {\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320039003300000000}}}{\fldrslt {\lang1024 151}}}{\lang1024 
\par 10.2\tab Plaintext Password Authentication\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911294 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320039003400000000}}
}{\fldrslt {\lang1024 151}}}{\lang1024 
\par 10.3\tab LANMAN 2.1 (and earlier) Challenge/Response\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911295 \\h }{\lang1024 {\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320039003500000000}}}{\fldrslt {\lang1024 151}}}{\lang1024 
\par }\pard\plain \s20\li403\widctlpar\tx576\tx1440\tqr\tldot\tx9350 \i\f4\fs20\lang1024 10.3.1\tab Known Plaintext Attacks\tab {\field{\*\fldinst  PAGEREF _Toc382911296 \\h {{\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320039003600000000}}}{\fldrslt 152}}
\par 10.3.2\tab Small Key Space\tab {\field{\*\fldinst  PAGEREF _Toc382911297 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320039003700000000}}}{\fldrslt 152}}
\par 10.3.3\tab Chosen Plaintext Attacks\tab {\field{\*\fldinst  PAGEREF _Toc382911298 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320039003800000000}}}{\fldrslt 152}}
\par 10.3.4\tab Dictionary Attacks\tab {\field{\*\fldinst  PAGEREF _Toc382911299 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100320039003900000000}}}{\fldrslt 152}}
\par 10.3.5\tab Badly Chosen Passwords\tab {\field{\*\fldinst  PAGEREF _Toc382911300 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100330030003000000000}}}{\fldrslt 152}}
\par \pard\plain \s19\li202\widctlpar\tx576\tx800\tqr\tldot\tx10358 \scaps\f4\fs20 {\lang1024 10.4\tab NT LM 0.12 Challenge/Response\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911301 \\h }{\lang1024 {\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100330030003100000000}}}{\fldrslt {\lang1024 153}}}{\lang1024 
\par 10.5\tab Other attacks\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911302 \\h }{\lang1024 {\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100330030003200000000}}}{\fldrslt {\lang1024 153}
}}{\lang1024 
\par }\pard\plain \s20\li403\widctlpar\tx576\tx1440\tqr\tldot\tx9350 \i\f4\fs20\lang1024 10.5.1\tab Hijack connections\tab {\field{\*\fldinst  PAGEREF _Toc382911303 \\h {{\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100330030003300000000}}}{\fldrslt 153}}
\par 10.5.2\tab Downgrade attack\tab {\field{\*\fldinst  PAGEREF _Toc382911304 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100330030003400000000}}}{\fldrslt 153}}
\par 10.5.3\tab Spoofing by Counterfeit Servers\tab {\field{\*\fldinst  PAGEREF _Toc382911305 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100330030003500000000}}}{\fldrslt 154}}
\par 10.5.4\tab Storing Passwords Safely\tab {\field{\*\fldinst  PAGEREF _Toc382911306 \\h {{\*\datafield 08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100330030003600000000}}}{\fldrslt 154}}
\par \pard\plain \s18\widctlpar\tx403\tx576\tqr\tldot\tx10358 \b\caps\f4\fs20 {\lang1024 11\tab Authors\rquote  Addresses\tab }{\field{\*\fldinst {\lang1024  PAGEREF _Toc382911307 \\h }{\lang1024 {\*\datafield 
08d0c9ea79f9bace118c8200aa004ba90b02000000080000000e0000005f0054006f006300330038003200390031003100330030003700000000}}}{\fldrslt {\lang1024 154}}}{\lang1024 
\par }\pard\plain \s16\sa240\widctlpar\tx576 \f11\fs20 }}\pard\plain \s16\sa240\widctlpar\tx576 \f11\fs20 
\par \pard\plain \s1\fi-432\li432\sb240\sa60\keepn\widctlpar\tx432\tx576 \b\f5\fs32\kerning28 {\*\bkmkstart _Toc365655245}{\*\bkmkstart _Toc382909241}{\*\bkmkstart _Toc382911152}1\tab Introduction{\*\bkmkend _Toc365655245}{\*\bkmkend _Toc382909241}
{\*\bkmkend _Toc382911152}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 
This document describes the file and print sharing protocol for a proposed Common Internet File System (CIFS). CIFS is intended to provide an open cross-platform mechanism for client systems to request file and print services from server systems over a ne
twork. It is based on th
e standard Server Message Block (SMB) protocol widely in use by personal computers and workstations running a wide variety of operating systems. An earlier version of this protocol was documented as part of the X/OPEN (now Open Group) CAE series of standa
rds [7]; this document updates the specification to include the latest shipping versions, and is published to allow the creation of implementations that interoperate with those implementations.
\par Use of the Internet and the World Wide Web has been characteriz
ed by read-only access. Existing protocols such as FTP are good solutions for one-way file transfer. However, new read/write interfaces will become increasingly necessary as the Internet becomes more interactive and collaborative. Adoption of a common fil
e sharing protocol having modern semantics such as shared files, byte-range locking, coherent caching, change notification, replicated storage, etc. would provide important benefits to the Internet community.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc365655246}1.1\tab  }{\*\bkmkstart _Toc382909242}{\*\bkmkstart _Toc382911153}Summary of features{\*\bkmkend _Toc365655246}{\*\bkmkend _Toc382909242}
{\*\bkmkend _Toc382911153}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 The protocol supports the following features:
\par {\pntext\pard\plain\fs20 o\tab}\pard \sa240\widctlpar\tx576{\*\pn \pnlvlblt\pnstart1\pnindent360 {\pntxtb o}}File access
\par {\pntext\pard\plain\fs20 o\tab}File and record locking
\par {\pntext\pard\plain\fs20 o\tab}Safe caching, read-ahead, and write-behind
\par {\pntext\pard\plain\fs20 o\tab}File change notification
\par {\pntext\pard\plain\fs20 o\tab}Protocol version negotiation
\par {\pntext\pard\plain\fs20 o\tab}Extended attributes
\par {\pntext\pard\plain\fs20 o\tab}Distributed replicated virtual volumes
\par {\pntext\pard\plain\fs20 o\tab}Server name resolution independence
\par {\pntext\pard\plain\fs20 o\tab}Batched requests
\par {\pntext\pard\plain\fs20 o\tab}Unicode file names
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655247}1.1.1\tab  }{\*\bkmkstart _Toc382909243}{\*\bkmkstart _Toc382911154}File access{\*\bkmkend _Toc365655247}
{\*\bkmkend _Toc382909243}{\*\bkmkend _Toc382911154}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 The protocol supports the usual set of file operations: open, close, read, write, and seek.
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655248}1.1.2\tab  }{\*\bkmkstart _Toc382909244}{\*\bkmkstart _Toc382911155}File and record locking{\*\bkmkend _Toc365655248}
{\*\bkmkend _Toc382909244}{\*\bkmkend _Toc382911155}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 
The protocol supports file and record locking, as well as unlocked access to files. Applications that lock files can not be improperly interfered with by applications that do not; once a file or record is locked, non-locking applications are denied access
 to the file.
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655249}1.1.3\tab  }{\*\bkmkstart _Toc382909245}{\*\bkmkstart _Toc382911156}Safe caching, read-ahead, and write-behind
{\*\bkmkend _Toc365655249}{\*\bkmkend _Toc382909245}{\*\bkmkend _Toc382911156}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 The protocol supports caching, read-ahead, and write-behind, even for unlocked files, as long as they are safe. All these optimizations are safe as long as only one client is accessing a file; 
read-caching and read-ahead are safe with many clients accessing a file as long as all are just reading. If many clients are writing a file simultaneously, then none are safe, and all file operations have to go to the server. The protocol notifies all cli
ents accessing a file of changes in the number and access mode of clients accessing the file, so that they can use the most optimized safe access method.
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655250}1.1.4\tab  }{\*\bkmkstart _Toc382909246}{\*\bkmkstart _Toc382911157}File change notification{\*\bkmkend _Toc365655250}
{\*\bkmkend _Toc382909246}{\*\bkmkend _Toc382911157}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 Applications can register with a server to be notified if and when file
 or directory contents are modified. They can use this to (for example) know when a display needs to be refreshed, without having to constantly poll the server.
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655251}1.1.5\tab  }{\*\bkmkstart _Toc382909247}{\*\bkmkstart _Toc382911158}Protocol version negotiation{\*\bkmkend _Toc365655251}
{\*\bkmkend _Toc382909247}{\*\bkmkend _Toc382911158}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 There are several different versions and sub-versions of this protocol; a particular version is referred to as a {\i dialect}
.  When two machines first come into network contact they negotiate the dialect to be used. Different dialects can include both new messages as well as changes to the fields and semantics of existing messages in other dialects.
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655252}1.1.6\tab  }{\*\bkmkstart _Toc382909248}{\*\bkmkstart _Toc382911159}Extended attributes{\*\bkmkend _Toc365655252}
{\*\bkmkend _Toc382909248}{\*\bkmkend _Toc382911159}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 In addition to many built-in file attributes, such as creation and modification times,  non-file system attributes can be added by applications, such as the author's name, content description, {\i etc.}
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655253}1.1.7\tab  }{\*\bkmkstart _Toc382909249}{\*\bkmkstart _Toc382911160}Distributed replicated virtual volumes
{\*\bkmkend _Toc365655253}{\*\bkmkend _Toc382909249}{\*\bkmkend _Toc382911160}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 The protocol supports file system subtrees which look like to clients as if they are on a single volume and server, but which actually span multiple volumes and servers. The files and directories of such a su
btree can be physically moved to different servers, and their names do not have to change, isolating clients from changes in the server configuration. These subtrees can also be transparently replicated for load sharing and fault tolerance. When a client 
requests a file, the protocol uses referrals to transparently direct a client to the server that stores it.
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655254}1.1.8\tab  }{\*\bkmkstart _Toc382909250}{\*\bkmkstart _Toc382911161}Server name resolution independence
{\*\bkmkend _Toc365655254}{\*\bkmkend _Toc382909250}{\*\bkmkend _Toc382911161}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 The protocol allows clients to resolve server names using any name resolution mechanism. In particular, it
 allows using the DNS, permitting access to the file systems of other organizations over the Internet, or hierarchical organization of servers' names within an organization. Earlier versions of the protocol only supported a flat server name space.
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\*\bkmkstart _Toc365655255}{\*\bkmkstart _Toc382909251}{\*\bkmkstart _Toc382911162}1.1.9\tab Batched requests{\*\bkmkend _Toc365655255}
{\*\bkmkend _Toc382909251}{\*\bkmkend _Toc382911162}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 The protocol supports the batching of multiple requests into a single message, in order to minimize round trip latencies, even when a later request depends on the results of an earlier one.
\par \pard\plain \s1\fi-432\li432\sb240\sa60\keepn\widctlpar\tx432\tx576 \b\f5\fs32\kerning28 {\b0 {\*\bkmkstart _Toc365655256}2\tab  }{\*\bkmkstart _Toc382909252}{\*\bkmkstart _Toc382911163}Protocol Operation Overview{\*\bkmkend _Toc365655256}
{\*\bkmkend _Toc382909252}{\*\bkmkend _Toc382911163}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 In order to access a file on a server, a client has to:
\par {\pntext\pard\plain\fs20 o\tab}\pard \fi-360\li360\sa240\widctlpar\tx576{\*\pn \pnlvlblt\pnstart1\pnindent360 {\pntxtb o}}Parse the full file name to determine the server name, and the relative name within that server.
\par {\pntext\pard\plain\fs20 o\tab}Resolve the server name to a transport address (this may be cached)
\par {\pntext\pard\plain\fs20 o\tab}Make a connection to the server (if no connection is already available)
\par {\pntext\pard\plain\fs20 o\tab}Exchange CIFS messages (see below for an example)
\par \pard \sa240\widctlpar\tx576 This process may be repeated as many times as desired. Once the connection has been idle for a while, it may be torn down.{\b\cf2 
\par }\pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc365655257}2.1\tab  }{\*\bkmkstart _Toc382909253}{\*\bkmkstart _Toc382911164}Server Name Determination{\*\bkmkend _Toc365655257}{\*\bkmkend _Toc382909253}
{\*\bkmkend _Toc382911164}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 How the client determines the name of the server and the relative name within the server  is outside of the scope of this specification. However, just for expository purposes, here are three examples.
\par In the  URL "{\ul\cf2 file://fs.megacorp.com/users/fred/stuff.txt}
", the client could take the part between the leading double slashes and the next slash as the server name and the remainder as the relative name -- in this example "fs.megacorp.com" and "/users/fred/stuff.txt", respectively.
\par In the path name "\\\\corpserver\\public\\policy.doc" the client could take the part between the leading double backslashes and the next slash as the server name, and the remainder as the relative name -- in this example, "corpserver" and "\\public\\
policy.doc" respectively.
\par In the path name "x:\\policy.doc" the client could use "x" as an index into a table that contains a server name and a file name prefix. If the contents of such a table for "x" were "corpserver" and "\\
public", then the server name and relative name would be the same as in the previous example.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc365655258}2.2\tab  }{\*\bkmkstart _Toc382909254}{\*\bkmkstart _Toc382911165}Server Name Resolution{\*\bkmkend _Toc365655258}{\*\bkmkend _Toc382909254}
{\*\bkmkend _Toc382911165}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 
Like server name determination, how the client resolves the name to the transport address of the server is outside the scope of this specification. All that is required by CIFS is that a CIFS client MUST have some means to resolve the name of a CIFS serve
r to a transport address, and that a CIFS server MUST register its name with a name resolution service known its clients.
\par Some examples of name resolution mechanisms include: using the Doma
in Name System (DNS) [1,2], and using NETBIOS name resolution (see RFC 1001 and RFC 1002 [3,4]). The server name can also be specified as the string form of an IPv4 address in the usual dotted decimal notation, {\i e.g.}
, "157.33.135.101"; in this case, "resolution" consists of converting to the 32 bit IPv4 address.
\par Which method is used is configuration dependent; the default SHOULD be DNS to encourage interoperability over the Internet.
\par Note: The name resolution mechanism used may place constraints on the form of the server name; for example, in the case of NETBIOS, the server name must be 15 characters or less, and be upper case.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc358532122}{\*\bkmkstart _Toc365655259}{\*\bkmkstart _Toc358532121}2.3\tab  }{\*\bkmkstart _Toc382909255}{\*\bkmkstart _Toc382911166}Sample Message Flow
{\*\bkmkend _Toc358532122}{\*\bkmkend _Toc365655259}{\*\bkmkend _Toc382909255}{\*\bkmkend _Toc382911166}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 
The following illustrates a typical message exchange sequence for a client connecting to a user level server, opening a file, reading its data, closing the file, and disconnecting from the server. Note: using the CIFS request batching mechanism (called th
e "AndX" mechanism), the second to sixth messages in this sequence can be combined into one, so there are really only three round trips in the sequence, and the last one can be done asynchronously by the client.
\par \trowd \trgaph108\trleft94 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4054\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10264 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Command\line =========================={\f11\fs18 \cell }
Server Response\line =========================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft94 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4054\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10264 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_NEGOTIATE\cell 
Must be the first message sent by client to the server.  Includes a list of SMB dialects supported by the client.  Server response indicates which SMB dialect should be used.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 SMB_COM_SESSION_SETUP_ANDX\cell }
Transmits the user's name and credentials to the server for verification.  Successful server response has Uid field set in SMB header used for subsequent SMBs on behalf of this user.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 SMB_COM_TREE_CONNECT\cell }
Transmits the name of the disk share the client wants to access.  Successful server response has Tid field set in SMB header used for subsequent SMBs referring to this resource.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 SMB_COM_OPEN\cell }Transmits the name of the file, relative to Tid, the client wants to open.  Successful server response includes a f
ile id (Fid) the client should supply for subsequent operations on this file.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 SMB_COM_READ\cell }
Client supplies Tid, Fid, file offset, and number of bytes to read.  Successful server response includes the requested file data.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 {\f11\fs18 SMB_COM_CLOSE\cell }Client closes the file represented by Tid and Fid.  Server responds with success code.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft94 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4054\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10264 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
{\f11\fs18 SMB_COM_TREE_DISCONNECT\cell }Client disconnects from resource represented by Tid.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc365655260}2.4
\tab  }{\*\bkmkstart _Toc382909256}{\*\bkmkstart _Toc382911167}Message Format{\*\bkmkend _Toc358532121}{\*\bkmkend _Toc365655260}{\*\bkmkend _Toc382909256}{\*\bkmkend _Toc382911167}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 Clients exchange messages with a server to access resources on that server.  These messages are called Server Message Blocks (SMBs), and every SMB message has a common format.
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655261}2.4.1\tab  }{\*\bkmkstart _Toc382909257}{\*\bkmkstart _Toc382911168}Notation{\*\bkmkend _Toc365655261}
{\*\bkmkend _Toc382909257}{\*\bkmkend _Toc382911168}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 
This specification makes use of "C"-like notation to describe the formats of messages. Unlike the "C" language, which allows for implementation flexibility in laying out structures, this specification adopts the following rules.  Multi-byte values are alw
ays transmitted least significant byte first. All fields, except "bit-fields", are aligned on the nea
rest byte boundary (even if longer than a byte), and there is no implicit padding. Fields using the "bit field" notation are defined to be laid out within the structure with the first-named field occupying the lowest order bits, the next named field the n
ext lowest order bits, and so on. 
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655262}2.4.2\tab  }{\*\bkmkstart _Toc382909258}{\*\bkmkstart _Toc382911169}SMB header{\*\bkmkend _Toc365655262}
{\*\bkmkend _Toc382909258}{\*\bkmkend _Toc382911169}
\par \pard\plain \s22\sa240\sl-240\slmult0\widctlpar\tx576\tx1152\tx1728\tx2304 \f11\fs20 typedef unsigned char UCHAR;          // 8 unsigned bits\line typedef unsigned short USHORT;        // 16 unsigned bits\line 
typedef unsigned long ULONG;          // 32 unsigned bits\line \line typedef struct \{\line     ULONG LowPart;\line     LONG HighPart;\line \} LARGE_INTEGER;                      // 64 bits of data\line \line typedef struct  \{\line 
    UCHAR Protocol[4];                // Contains 0xFF,'SMB'\line     UCHAR Command;                    // Command code\line     union \{\line         struct \{\line             UCHAR ErrorClass;         // Error class\line 
            UCHAR Reserved;           // Reserved for future use\line             USHORT Error;             // Error code\line         \} DosError;\line         ULONG Status;                 // 32-bit error code\line     \} Status;\line     
UCHAR Flags;                      // Flags\line     USHORT Flags2;                    // More flags\line     union \{\line         USHORT Pad[6];                // Ensure section is 12 bytes long\line         struct \{\line 
            USHORT PidHigh;           // High part of PID\line             ULONG  Unused;            // Not used\line             ULONG  Unused2;\line     \} Extra;\line     \};\line     USHORT Tid;                       // Tree identifier\line 
    USHORT Pid;                       // Caller's process id\line     USHORT Uid;                       // Unauthenticated user id\line     USHORT Mid;                       // multiplex id\line 
    UCHAR  WordCount;                 // Count of parameter words\line     USHORT ParameterWords[ WordCount ];    // The parameter words\line     USHORT ByteCount;                 // Count of bytes\line     UCHAR  Buffer[ ByteCount ];       // The bytes
\line \} SMB_HEADER;\line 
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 All SMBs have identical format up to the {\i ParameterWords} fields.  \line Different SMBs have a different number and interpretation of  {\i ParameterWords} and {\i Buffer}.  All reserved fields in t
he SMB header must be zero.
\par {\pntext\pard\plain\fs20 o\tab}\pard \fi-360\li360\sa240\widctlpar\tx576{\*\pn \pnlvlblt\pnstart1\pnindent360 {\pntxtb o}}{\i Command} is the operation code which this SMB is requesting, or responding to.
\par {\pntext\pard\plain\fs20 o\tab}{\i Status.DosError.ErrorClass} and {\i Status.DosError.Error}
 are set by the server and combine to give the error code of any failed server operation.  If the client is capable of receiving 32 bit error returns, the status is returned in {\i Status.Status}
 instead.  When an error is returned, the server may choose to return only the header portion of the response SMB.
\par {\pntext\pard\plain\fs20 o\tab}{\i Flags} and {\i Flags2} contain bits which, depending on the negotiated protocol dialect, indicate various client capabilities.
\par {\pntext\pard\plain\fs20 o\tab}{\i PidHigh} is used in the {\i NtCreateAndX} request SMB
\par {\pntext\pard\plain\fs20 o\tab}{\i Tid} identifies the subdirectory, or "tree", on the server which the client is accessing.  SMBs which do not reference a particular tree should set {\i Tid} to 0xFFFF.
\par {\pntext\pard\plain\fs20 o\tab}{\i Pid} is the caller's process id, and is generated by the client to uniquely identify a process within the client computer.
\par {\pntext\pard\plain\fs20 o\tab}{\i Mid} is reserved for multiplexing multiple messages on a single transport connection.  A
 response message will always contain the same value as the corresponding request message. The client MUST not have multiple outstanding requests to a server with the same {\i Mid.}
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc358532123}{\*\bkmkstart _Toc365655263}2.5\tab  }{\*\bkmkstart _Toc382909259}{\*\bkmkstart _Toc382911170}CIFS Protocol Dialect{\*\bkmkend _Toc358532123}
 Negotiation{\*\bkmkend _Toc365655263}{\*\bkmkend _Toc382909259}{\*\bkmkend _Toc382911170}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 The first message sent from an CIFS client to an CIFS server must be one whose {\i Command}
 field is SMB_COM_NEGOTIATE.  The format of this client request includes an array of NULL terminated strings indicating the dialects of the CIFS protocol which the client supports.  The server compares this lis
t against the list of dialects the server supports and returns the index of the chosen dialect in the response message.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc358532124}{\*\bkmkstart _Toc359233282}{\*\bkmkstart _Toc365655264}2.6\tab  }{\*\bkmkstart _Toc382909260}{\*\bkmkstart _Toc382911171}Message Transport
{\*\bkmkend _Toc358532124}{\*\bkmkend _Toc359233282}{\*\bkmkend _Toc365655264}{\*\bkmkend _Toc382909260}{\*\bkmkend _Toc382911171}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 
When using a reliable connection oriented transport, the CIFS protocol makes no higher level attempts to ensure sequenced delivery of messages between the client and server.  The transport must have some mechanism to detect failures of either the client o
r server node, and to deliver such an indication to the client or server software so they can clean up state.  Whe
n a reliable transport connection from a client terminates, all work in progress by that client is terminated by the server and all resources open by that client on the server are closed. Message transport is done using NETBIOS session service (see sectio
n 5.3 of RFC 1001 and section 4.3 of RFC 1002).
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655265}2.6.1\tab  }{\*\bkmkstart _Toc382909261}{\*\bkmkstart _Toc382911172}Connection Establishment{\*\bkmkend _Toc365655265}
{\*\bkmkend _Toc382909261}{\*\bkmkend _Toc382911172}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 After the server name has been resolved to an IP address, then a connection to the server needs to be established if one has not already been set up. Connection establishment is done using the {\i Call}
 primitive of the NETBIOS session service, which requires the client to provide a "calling name" and a "called name". The calling name is not significant in CIFS, except that an identical name from the same transport address is assumed to represent the sa
me client; the called name is always "*SMBSERVER      ". Over TCP, the {\i Call} primitive results in a "Session Request" packet to port 139 (see section 4.3.2 of RFC 1002).
\par \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 2.6.1.1\tab Backwards compatability
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 If a CIFS client wishes to interoperate with older SMB servers, then if the {\i Call}
 is rejected by the server, it can retry with a new called name. The choice of the new called name depends on the name resolution mechanism used. If DNS was used, the called name should be constructed from the first component of the server's DNS name, tru
ncated to 15 characters if necessary, and then padded to 16 characters with blank (20 hex) characters. If NETBIOS was used, then the called named is just the NETBIOS name. If these fail, then a NETBIOS "Adapter St
atus" request may be made to obtain the server's NETBIOS name, and the connection establishment retried with that as the called name.
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655266}2.6.2\tab  }{\*\bkmkstart _Toc382909262}{\*\bkmkstart _Toc382911173}Server-side Connection Procedures
{\*\bkmkend _Toc365655266}{\*\bkmkend _Toc382909262}{\*\bkmkend _Toc382911173}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 A CIFS server MUST register a NETBIOS {\i Listen} that accepts any calling name on the name "*SMBSERVER     ".
\par In addition, if it wishes to support older SMB clients, it MAY have a NETBIOS name and register a Listen on that name.
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655267}2.6.3\tab  }{\*\bkmkstart _Toc382909263}{\*\bkmkstart _Toc382911174}Connection Management{\*\bkmkend _Toc365655267}
{\*\bkmkend _Toc382909263}{\*\bkmkend _Toc382911174}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 Once a connection is established, the rules for reliable transport connection dissolution are:
\par {\pntext\pard\plain\fs20 o\tab}\pard \fi-360\li360\sa240\widctlpar\tx576{\*\pn \pnlvlblt\pnstart1\pnindent360 {\pntxtb o}}
If a server receives a transport establishment request from a client with which it is already conversing, the server may terminate all other transport connections to that client.  This is to recover from the situation where the client was suddenly reboote
d and was unable to cleanly terminate its resource sharing activities with the server.
\par {\pntext\pard\plain\fs20 o\tab}A server may drop the transport connection to a client at any time if the client is generating malformed or illogical requests.  However, wherever possi
ble the server should first return an error code to the client indicating the cause of the abort.
\par {\pntext\pard\plain\fs20 o\tab}If a server gets a hard error on the transport (such as a send failure) the transport connection to that client may be aborted.
\par {\pntext\pard\plain\fs20 o\tab}
A server may terminate the transport connection when the client has no open resources on the server, however, we recommend that the termination be performed only after some time has passed or if resources are scarce on the server.  This will help performa
nce in that the transport connection will not need to be reestablished if activity soon begins anew. Client software is expected to be able to automatically reconnect to the server if this happens.{\*\bkmkstart _Toc358532126}.   
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc358532129}{\*\bkmkstart _Toc365655268}{\*\bkmkend _Toc358532126}2.7\tab  }{\*\bkmkstart _Toc382909264}{\*\bkmkstart _Toc382911175}Opportunistic Locks
{\*\bkmkend _Toc358532129}{\*\bkmkend _Toc365655268}{\*\bkmkend _Toc382909264}{\*\bkmkend _Toc382911175}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 
Network performance can be increased if the client can locally buffer file data.  For example, the client does not have to write information into a file on the server if the client knows that no other process is accessing the data.  Likewise, the client c
an buffer read-ahead data from the file if the client knows that no other process is writing the data.
\par The mechanism which allows clients to dynamically alter their buffering strategy in a consistent manner is knows as "opportunistic locks", or {\i oplocks}
 for short.  Versions of the CIFS file sharing protocol including and newer than the "LANMAN1.0" dialect support oplocks.
\par There are three different types of oplocks:
\par {\pntext\pard\plain\fs20 o\tab}\pard \fi-360\li360\sa240\widctlpar\tx576{\*\pn \pnlvlblt\pnstart1\pnindent360 {\pntxtb o}}An{\i  exclusive} oplock allows a client to open a file for exclusive access and allows the client to perform arbitrary buffering

\par {\pntext\pard\plain\fs20 o\tab}A{\i  batch }oplock allows a client to keep a file open on the server even though the local accessor on the client machine has closed the file.
\par {\pntext\pard\plain\fs20 o\tab}A{\i  Level II }oplock indicates there are multiple readers of a file, and no writers.  Level II oplocks are supported if the negotiated dialect is {\f11\fs18 NT LM 0.12} or later.
\par \pard \sa240\widctlpar\tx576 When a client opens a file, it requests the server to grant it a particular type of oplock on the file.  The response from the server indicates the type of oplock granted to the client.  The client uses the granted oplock typ
e to adjust its buffering policy.
\par The {\f11\fs18 SMB_COM_LOCKING_ANDX} SMB is used to convey oplock break and response information.
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc358532130}{\*\bkmkstart _Toc365655269}2.7.1\tab  }{\*\bkmkstart _Toc382909265}{\*\bkmkstart _Toc382911176}Exclusive Oplocks
{\*\bkmkend _Toc358532130}{\*\bkmkend _Toc365655269}{\*\bkmkend _Toc382909265}{\*\bkmkend _Toc382911176}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 
If a client is granted an exclusive oplock, it may buffer lock information, read-ahead data, and write data on the client because the client knows that it is the only accessor to the file.  The basic protocol is that the redirector on the client opens the
 file request
ing that an oplock be given to the client.  If the file is open by anyone else, then the client is refused the oplock and no local buffering may be performed on the local client.  This also means that no readahead may be performed to the file, unless the 
redirector knows that it has the read ahead range locked.  If the server grants the exclusive oplock, the client can perform certain optimizations for the file such as buffering lock, read, and write data.
\par \pard \sa240\keepn\widctlpar\tx576 The exclusive oplock protocol is:
\par \trowd \trgaph108\trleft360 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4590\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5299\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client\cell <->\cell Server\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft360 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 
\clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx2700\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4590\clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5299\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 
\cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 A\line ==============\cell B\line ===========\cell \line ===\cell \line ================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\trowd \trgaph108\trleft360 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx2700\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4590\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5299\clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Open ("foo")\cell \cell {\f11 ->\cell }\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell \cell {\f11 <-\cell }Open OK.  Exclusive oplock granted.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell Open("foo")\cell {\f11 ->\cell }\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell \cell {\f11 <-\cell }
oplock break to A\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 lock(s)\cell \cell {\f11 ->\cell }\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell \cell {\f11 <-\cell }lock(s) response(s)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
write(s)\cell \cell {\f11 ->\cell }\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell \cell {\f11 <-\cell }write(s) response(s)\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 close or done\cell \cell {\f11 ->\cell }\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft360 \clbrdrl\brdrs\brdrw30\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx2700\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4590\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \cellx5299\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell \cell {\f11 <-\cell }
open response to B\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par As can be seen, when client A opens the file, i
t can request an exclusive oplock.  Provided no one else has the file open on the server, then the oplock is granted to client A.  If, at some point in the future, another client, such as client B, requests an open to the same file, then the server must h
ave client A break its oplock.  Breaking the oplock involves client A sending the server any lock or write data that it has buffered, and then letting the server know that it has acknowledged that the oplock has been broken.  This synchronization message 
informs the server that it is now permissible to allow client B to complete its open.
\par Client A must also purge any readahead buffers that it has for the file.  This is not shown in the above diagram since no network traffic is needed to do this.
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc358532131}{\*\bkmkstart _Toc365655270}2.7.2\tab  }{\*\bkmkstart _Toc382909266}{\*\bkmkstart _Toc382911177}Batch Oplocks
{\*\bkmkend _Toc358532131}{\*\bkmkend _Toc365655270}{\*\bkmkend _Toc382909266}{\*\bkmkend _Toc382911177}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 Batch oplocks are used where common programs on a client behave in such a way that causes the amount of network traffic on a wire to go beyond an acceptable level for the functionality provided by the program.

\par For example, the command processor executes commands from within a command procedure by performing the following steps:
\par {\pntext\pard\plain\fs20 o\tab}\pard \fi-360\li720\sa240\widctlpar\tx576{\*\pn \pnlvlblt\pnstart1\pnindent360 {\pntxtb o}}Opening the command procedure.
\par {\pntext\pard\plain\fs20 o\tab}Seeking to the "next" line in the file.
\par {\pntext\pard\plain\fs20 o\tab}Reading the line from the file.
\par {\pntext\pard\plain\fs20 o\tab}Closing the file.
\par {\pntext\pard\plain\fs20 o\tab}Executing the command.
\par \pard \sa240\widctlpar\tx576 
This process is repeated for each command executed from the command procedure file.  As is obvious, this type of programming model causes an inordinate amount of processing of files, thereby creating a lot of network traffic that could otherwise be curtai
led if the program were to simply open the file, read a line, execute the command, and then read the next line.
\par Batch oplocking curtails the amount of network traffic by allowing the client to skip the extraneous open and close requests.  When the command processor then asks for the next line in the file, the client can either ask for the next line from the server,
 or it may have already read the data from the file as readahead data.  In either case, the amount of network traffic from the client is greatly reduced.
\par If the server receives either a rename or a delete request for the file that has a batch oplock, it must inform the client that the oplock is to be broken.  The client can then change to a mode where the file is repeatedly opened and closed.
\par The batch oplock protocol is:
\par \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\tx360\tx600\tx840 \f4\fs20 
\par \trowd \trgaph108\trleft360 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4206\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5040\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx9810 \pard \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 Client\cell <->\cell Server\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft360 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx2250\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4206\clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5040\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 
\cellx9809 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 A\line ===========\cell B\line ============\cell \line ====\cell \line ===============================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd 
\trgaph108\trleft360 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx2250\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4206\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5040\clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx9809 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Open("foo")\cell \cell {\f11 ->\cell }\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell \cell {\f11 <-\cell }Open OK.  Batch oplock granted.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Read\cell \cell {\f11 ->\cell }\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell \cell {\f11 <-\cell }data
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 <close>\cell \cell {\f11 \cell }\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 <open>\cell \cell {\f11 \cell }\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 <seek>\cell \cell {\f11 \cell }
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell \cell {\f11 ->\cell }read\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell \cell {\f11 <-\cell }data\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 <close>\cell \cell {\f11 \cell }
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell Open("foo")\cell {\f11 ->\cell }\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell \cell {\f11 <-\cell }Oplock break to A\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Close\cell \cell {
\f11 ->\cell }\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell \cell {\f11 <-\cell }Close OK to A\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd 
\trgaph108\trleft360 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx2250\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4206\clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5040\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx9809 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell \cell {\f11 <-\cell }Open OK to B\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par When client A opens the file, it can request an oplock.  Provided no one else has the file open on the server, then the oplock is granted to client A.  Client A, in this case, keeps the file open for its caller across multiple open/close operations.  Data
 may be read ahead for the caller and other optimizations, such as buffering locks, can also be performed.
\par When another client requests an open, rename, or delete operation to the server for the file, however, client A must cleanup its buffered data and synchronize with the server.  Most of the time this involves actually closing the file, provided that client
 A's caller actually believes that he has closed the file.  Once the file is actually closed, client B's open request can be completed.
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc358532132}{\*\bkmkstart _Toc365655271}2.7.3\tab  }{\*\bkmkstart _Toc382909267}{\*\bkmkstart _Toc382911178}Level II Oplocks
{\*\bkmkend _Toc358532132}{\*\bkmkend _Toc365655271}{\*\bkmkend _Toc382909267}{\*\bkmkend _Toc382911178}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 Level II oplocks allow multiple clients to have the same file open, providing that no client is p
erforming write operations to the file.  This is important for many environments because most compatibility mode opens from down-level clients map to an open request for shared read/write access to the file.  While it makes sense to do this, it also tends
 to break oplocks for other clients even though neither client actually intends to write to the file.
\par The Level II oplock protocol is: 
\par \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\tx360\tx600\tx840 \f4\fs20 
\par \trowd \trgaph108\trleft360 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4140\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4950\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10440 \pard \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 Client\cell <->\cell Server\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft360 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx2250\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4140\clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4950\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 
\cellx10440 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 A\line ===========\cell B\line ===========\cell \line ====\cell \line ====================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\trowd \trgaph108\trleft360 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx2250\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4140\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4950\clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10440 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Open("foo")\cell \cell {\f11 ->\cell }\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell \cell {\f11 <-\cell }Open OK.  Exclusive oplock granted.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Read\cell \cell {\f11 ->\cell }\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell \cell {\f11 <-\cell }data
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell Open("foo")\cell {\f11 ->\cell }\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell \cell {\f11 <-\cell }Break to Level II oplock to A\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 lock(s)
\cell \cell {\f11 ->\cell }\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell \cell {\f11 <-\cell }lock(s) response(s)\cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 done\cell \cell {\f11 ->\cell }\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft360 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx2250\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4140\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \cellx4950\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10440 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell \cell {\f11 <-\cell }
Open OK.  Oplock II oplock granted to B\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 \tab \tab  \line 
This sequence of events is very much like an exclusive oplock.  The basic difference is that the server informs the client that it should break to a level II lock when no one has been writing the file.  That is, client A, for example, may have opened the 
file for a desired access of READ, and a share access of READ/WRITE.  This means, by definition, that client A will not performed any writes to the file.
\par When client B opens the file, the server must synchronize with client A in case client A has any buffer
ed locks.  Once it is synchronized, client B's open request may be completed.  Client B, however, is informed that he has a level II oplock, rather than an exclusive oplock to the file.
\par In this case, no client that has the file open with a level II oplock may buffer any lock information on the local client machine.  This allows the server to guarantee that if any write operation is performed, it need only notify the level II clients that
 the lock should be broken without having to synchronize all of the accessors of the file.
\par The level II oplock may be {\i broken to none}
, meaning that some client that had the file opened has now performed a write operation to the file.  Because no level II client may buffer lock information, the server is in a consistent state.  The writing client, for example, could not have written to 
a locked range, by definition.  Read ahead data may be buffered in the client machines, however, thereby cutting down on the amount of network traffic required to the file.  Once the level II oplo
ck is broken, however, the buffering client must flush its buffers and degrade to performing all operations on the file across the network.  No oplock break response is expected from a client when the server breaks a client from {\i level II} to {\i none}
.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc359225993}{\*\bkmkstart _Toc365655272}{\*\bkmkstart _Toc358532133}2.8\tab  }{\*\bkmkstart _Toc382909268}{\*\bkmkstart _Toc382911179}Security
{\*\bkmkend _Toc359225993} Model{\*\bkmkend _Toc365655272}{\*\bkmkend _Toc382909268}{\*\bkmkend _Toc382911179}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 
Each server makes a set of resources available to clients on the network.  A resource being shared may be a directory tree, named pipe, printer, etc.  So far as clients are concerned, the server has no storage or service dependencies on any othe
r servers; a client considers the server to be the sole provider of the file (or other resource) being accessed.
\par The CIFS protocol requires server authentication of users before file accesses are allowed, and each server authenticates its own users.  A client system must send authentication information to the server before the server will allow access to its resourc
es.
\par The CIFS protocol defines two methods which can be selected by the server for security:  {\i share level} and {\i user level}:
\par {\pntext\pard\plain\fs20 o\tab}\pard \fi-360\li360\sb20\sa240\widctlpar\tx576{\*\pn \pnlvlblt\pnstart1\pnindent360 {\pntxtb o}}A {\i share level} server
 makes some directory on a disk device (or other resource) available.  An optional password may be required to gain access.  Thus any user on the network who knows the name of the server, the name of the resource and the password has access to the resourc
e.  Share level security servers may use different passwords for the same shared resource with different passwords allowing different levels of access. 
\par {\pntext\pard\plain\fs20 o\tab}A {\i user level} server makes some direc\-tory on a disk device (or other resource) available but in addit
ion requires the client to provide a user name and corresponding user password to gain access. User level servers are preferred over share level servers for any new server implementation, since organizations generally find {\i user level}
 servers easier to administer as employees come and go. User level servers may use the account name to check access control lists on individual files, or may have one access control list that applies to all files in the directory.
\par \pard \sa240\widctlpar\tx576 When a {\i user level} server validates the account \-name and password presented by the client, an identifier representing that authenti\-cated instance of the user is returned to the client in the {\i Uid}
 field of the response SMB.  This {\i Uid} must be included in all further requests made on behalf of the user from that client.  A {\i share level} server returns no useful information in the {\i Uid} field.
\par The user level security model was added after the original dialect of the CIFS protocol was issued, and subsequently some clients may not be capable of sending account nam
e and passwords to the server.  A server in user level security mode communicating with one of these clients will allow a client to connect to resources even if the client has not sent account name and password information:
\par 1. If the client's computer name is identical to an account-name known on the server, and if the password supplied to connect to the shared resource matches that account\rquote s password, an implicit "user logon" will be performed using those values.

\par If the above fails, the server may fail the request or assign a default account name of its choice.
\par 2. The value of {\i Uid} in subsequent requests by the client will be ignored and all access will be validated assuming the account name selected above.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc365655273}2.9\tab  }{\*\bkmkstart _Toc382909269}{\*\bkmkstart _Toc382911180}Resource Share/Access Example{\*\bkmkend _Toc365655273}
{\*\bkmkend _Toc382909269}{\*\bkmkend _Toc382911180}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 The following examples illustrate a possible command line user interface for a server to offer a disk resource, and for a client to connect to and use that resource.
\par a) NET SHARE
\par The {\i NET SHARE} command, when executed on the server, specifies a directory name to be made available to clients on the network.  A share name must be given, and this name is presented by clients wishing to access the directory.
\par \pard \fi-360\li720\sa240\widctlpar\tx576 Examples:
\par \pard \li720\sa240\widctlpar\tx576 {\f11\fs18 NET SHARE  src=c:\\dir1\\src  "bonzo"
\par }assigns password {\i bonzo} to all files within directory {\i c:\\dir1\\src} and its subdirectories with the share name {\i src} being the name used to connect to this resource.
\par \pard \fi-360\li720\sa240\widctlpar\tx576 {\f11\fs18 NET SHARE  c=c:\\        " "        RO
\par NET SHARE  work=c:\\work  "flipper"  RW
\par }\pard \li720\sa240\widctlpar\tx576 offers read-only access to everything on the {\i C} drive. Offers read-write access to all files within the {\i C:\\work} direc\-tory and its subdirectories.
\par \pard \sa240\widctlpar\tx576 The above example is appropriate for servers operating as a {\i share} {\i level} server.  A {\i user} {\i level}
 server would not require the permissions or password, since the combination of the client's account name and specific access control lists on files is sufficient to govern access.
\par b) NET USE
\par Clients can gain access to one or more offered directories via the {\i NET USE} command.  Once the {\i NET USE} command is issued the user can access the files freely without further special requirements.
\par \pard \fi-360\li720\sa240\widctlpar\tx576 Examples:
\par {\f11\fs18 1.  NET USE  d: \\\\Server1\\src  "bonzo"
\par }\pard \li720\sa240\widctlpar\tx576 gains full access to the files and directories on Server1 matching the offer defined by the netname {\i src} with the password of {\i bonzo}.  The user may now address files on {\i Server1 c:\\dir1\\src}
 by referencing d:. E.g. "type d:srcfile1.c".
\par \pard \fi-360\li720\sa240\widctlpar\tx576 {\f11\fs18 2.  NET USE  e: \\\\Server1\\c
\par 3.  NET USE  f: \\\\Server1\\work   "flipper"
\par }\pard \li720\sa240\widctlpar\tx576 Now any read request to any file on that node (drive c) is valid (e.g. "type e:\\bin\\
foo.bat").  Read-write requests only succeed to files whose pathnames start with f: (e.g. "copy foo f:foo.tmp" copies foo to Server1 c:\\work\\foo.tmp).
\par \pard \sa240\widctlpar\tx576 For {\i user level} servers, the client would not provide a password with the {\i NET USE} command.
\par The client software must remember the drive identifier sup\-plied with the NET USE request and associate it with the {\i Tid} value returned by the server in the SMB header.  Subsequent requests using this {\i Tid} must include only the pathnam
e relative to the con\-
nected subtree as the server treats the subtree as the root directory (virtual root).  When the user references one of the remote drives, the client software looks through its list of drives for that node and includes the tree id ass
ociated with this drive in the {\i Tid} field of each request.
\par Note that one shares a directory and all files underneath that directory are then affected.  If a particu\-lar file is within the range of multiple shares, con\-necting to any of the share ranges gains
 access to the file with the permissions specified for the offer named in the NET USE.  The server will not check for nested directories with more restrictive permissions.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Ref363023135}{\*\bkmkstart _Toc365655274}{\*\bkmkend _Toc358532133}2.10\tab  }{\*\bkmkstart _Toc382909270}{\*\bkmkstart _Toc382911181}Authentication
{\*\bkmkend _Ref363023135}{\*\bkmkend _Toc365655274}{\*\bkmkend _Toc382909270}{\*\bkmkend _Toc382911181}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 An CIFS server keeps an encrypted form of a client\rquote 
s password.  To gain authenticated access to server resources, the server sends a challenge to the client, which the client responds to in a way that proves it knows the client's password. 
\par Authentication makes use of DES encryption [5] in block mode.  We denote the D
ES encryption function as E(K,D), which accepts a seven byte key (K) and an eight byte data block (D) and produces an eight byte encrypted data block as its value.  If the data to be encrypted is longer than eight bytes, the encryption function is applied
 to each block of eight bytes in sequence and the results are appended together.  If the key is longer than seven bytes, the data is first completely encrypted using the first seven bytes of the key, then the second seven bytes, etc., appending the result
s each time.  In other words, to encrypt the 16 byte quantity D0D1 with the 14 byte key K0K1, 
\par \tab {\f11 E(K0K1,D0D1) = E(K0,D0)E(K0,D1)E(K1,D0)E(K1,D1)}
\par The {\i EncryptionKey} field in the {\f11\fs18 SMB_COM_NEGPROT}
 response contains an 8 byte challenge denoted below as "C8", chosen to be unique to prevent replay attacks; the client responds with a 24 byte response denoted "P24", and computed as described below. (Note: the name "{\i EncryptionKey}
" is historical -- it doesn't actually hold an encryption key.)
\par Clients send the response to the challenge in the {\f11\fs18 SMB_COM_TREE_CONNECT}, {\f11\fs18 SMB_COM_TREE_CONNECT_ANDX}, and/or {\f11\fs18 SMB_COM_SESSION_SETUP_ANDX} request which follows the {\f11\fs18 SMB_COM_NEGPROT}
 message exchange.  The server must validate the response by performing the same computations the client did to create it, and ensuring the strings match.
\par If the comparisons fail, the client system may be incapable of encryption; if so the string may be the user password in clear text.  The server should try to validating the string as though it were the unencrypted password.
\par The SMB field used to store the response depends upon the request:
\par {\pntext\pard\plain\fs20 o\tab}\pard \fi-360\li1080\sa240\widctlpar\tx576{\*\pn \pnlvlblt\pnstart1\pnindent360 {\pntxtb o}}{\i Password} in {\f11\fs18 SMB_COM_TREE_CONNECT}
\par {\pntext\pard\plain\f11\fs18 o\tab}{\i Password} in {\f11\fs18 SMB_COM_TREE_CONNECT_ANDX
\par {\pntext\pard\plain\fs20 o\tab}}{\i\f11\fs18 AccountPassword}{\f11\fs18  in SMB}_COM_SESSION_SETUP_ANDX
\par \pard \sa240\widctlpar\tx576 (Note: again, the names are historical, and do not reflect this usage.)
\par The contents of the response to the challenge depends on the CIFS dialect, as outlined in the following sections:
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655275}2.10.1\tab  }{\*\bkmkstart _Toc382909271}{\*\bkmkstart _Toc382911182}Pre NT LM 0.12{\*\bkmkend _Toc365655275}
{\*\bkmkend _Toc382909271}{\*\bkmkend _Toc382911182}
\par {\pntext\pard\plain\fs20 o\tab}\pard\plain \fi-360\li360\sa240\widctlpar\tx576{\*\pn \pnlvlblt\pnstart1\pnindent360 {\pntxtb o}}\f4\fs20 The client and server both compute
\par \pard \sa240\widctlpar\tx576{\*\pn \pnlvlcont\pndec }\tab {\f11 P16 = E(P14,S8)}
\par \pard \fi1152\sa240\widctlpar\tx576{\*\pn \pnlvlcont\pndec }and
\par \pard \sa240\widctlpar\tx576{\*\pn \pnlvlcont\pndec }\tab {\f11 P24 = E(P21,C8)
\par where:
\par {\pntext\pard\plain\fs20 o\tab}}\pard \fi-360\li720\sa240\widctlpar\tx576{\*\pn \pnlvlblt\pnstart1\pnindent360 {\pntxtb o}}P14 is a 14 byte string containing the user\rquote s password in clear text, upper cased, padded with spaces
\par {\pntext\pard\plain\fs20 o\tab}S8 is an eight byte string whose value is available from Microsoft upon request.
\par {\pntext\pard\plain\fs20 o\tab}P21 is a twenty one byte string obtained by appending five null bytes to the string P16, just computed
\par {\pntext\pard\plain\fs20 o\tab}C8 is the value of the challenge sent in the EncryptionKey field in the {\f11\fs18 SMB_COM_NEGPROT} response for this connection.
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655276}2.10.2\tab  }{\*\bkmkstart _Toc382909272}{\*\bkmkstart _Toc382911183}NT LM 0.12{\*\bkmkend _Toc365655276}
{\*\bkmkend _Toc382909272}{\*\bkmkend _Toc382911183}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 The client and server both compute
\par \tab {\f11 P16 = MD4(U(PN))}
\par \pard \fi1152\sa240\widctlpar\tx576 and
\par \pard \sa240\widctlpar\tx576 \tab {\f11 P24 = E(P21, C8)
\par }where:
\par {\pntext\pard\plain\fs20 o\tab}\pard \fi-360\li720\sa240\widctlpar\tx576{\*\pn \pnlvlblt\pnstart1\pnindent360 {\pntxtb o}}PN is a string containing the user\rquote s password in clear text, case sensitive, no maximum length
\par {\pntext\pard\plain\fs20 o\tab}U(x) of an ASCII string "x" is that string converted to Unicode
\par {\pntext\pard\plain\fs20 o\tab}MD4(x) of an octet string "x" is the 16 byte MD4 message digest [6] of that string
\par {\pntext\pard\plain\fs20 o\tab}P21 and C8 are as above.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc358532136}{\*\bkmkstart _Toc365655277}2.11\tab  }{\*\bkmkstart _Toc382909273}{\*\bkmkstart _Toc382911184}Distributed Filesystem (DFS) Support
{\*\bkmkend _Toc358532136}{\*\bkmkend _Toc365655277}{\*\bkmkend _Toc382909273}{\*\bkmkend _Toc382911184}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 {\cf1 Protocol dialects of }{\f11\cf1 NT LM 0.12}{\cf1  and later support distributed filesystem  operations. The distributed filesystem gives a way for this protocol to use a single consistent file naming s
cheme which may span a collection of different servers and shares. The distributed filesystem model employed is a referral - based model. This protocol specifies the manner in which clients receive referrals.
\par The client can set a flag in the request SMB header indicating that the client wants the server to resolve this SMB's paths within the DFS known to the server. The server attempts to resolve the requested name to a file contained within the local director
y tree indicated by the TID of the request and proceeds normally. If the request pathname resolves to a file on a different system, the server returns the following error:
\par }\pard \li288\ri288\sa240\widctlpar\tx576 {\f11\fs18\cf1 STATUS_DFS_PATH_NOT_COVERED}{\f11\cf1  }{\cf1 
- the server does not support the part of the DFS namespace needed to resolved the pathname in the request. The client should request a referral from this server for further information.
\par }\pard \sa240\widctlpar\tx576 {\cf1 A client asks for a referral with the }{\f11\fs18\cf1 TRANS2_DFS_GET_REFERRAL}{\cf1  request containing the DFS}{\i\cf1  }{\cf1 pathname of interest. The response from the server indicates how the client should proceed.

\par The method by which the topological knowledge of the DFS is stored and maintained by the servers is not specified by this protocol.
\par }\pard\plain \s1\fi-432\li432\sb240\sa60\keepn\widctlpar\tx432\tx576 \b\f5\fs32\kerning28 {\b0 {\*\bkmkstart _Toc358532137}{\*\bkmkstart _Toc365655278}3\tab  }{\*\bkmkstart _Toc382909274}{\*\bkmkstart _Toc382911185}SMB Message Formats
{\*\bkmkend _Toc358532137} and Data Types{\*\bkmkend _Toc365655278}{\*\bkmkend _Toc382909274}{\*\bkmkend _Toc382911185}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 
This section describes the entire set of SMB commands and responses exchanged between CIFS clients and servers.  It also details which SMBs are introduced into the protocol as higher dialect levels are negotiated.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc358532138}{\*\bkmkstart _Toc365655279}3.1\tab  }{\*\bkmkstart _Toc382909275}{\*\bkmkstart _Toc382911186}SMB Header{\*\bkmkend _Toc358532138}
{\*\bkmkend _Toc365655279}{\*\bkmkend _Toc382909275}{\*\bkmkend _Toc382911186}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 While each SMB command has specific encodings, there are some fields in the SMB header which have meaning to all SMBs.  These fields and considerations are described in the following sections.
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc358532139}{\*\bkmkstart _Toc365655280}3.1.1\tab  }{\*\bkmkstart _Toc382909276}{\*\bkmkstart _Toc382911187}Flags field
{\*\bkmkend _Toc358532139}{\*\bkmkend _Toc365655280}{\*\bkmkend _Toc382909276}{\*\bkmkend _Toc382911187}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 This field contains 8 individual flags, numbered from least significant to most significant, and have the following meanings:
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx720\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx7920\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 
\cellx9990 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Bit\line ===\cell Meaning\line ================================================\cell Earliest Dialect\line ============\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx720\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx7920\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx9990 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20  0\cell When set (returned) from the server in the SMB_COM_NEGOTIATE response SMB, this bit indicates t
hat the server  supports the "sub dialect" consisting of the LockandRead and WriteandUnlock protocols defined later in this document.\cell LANMAN1.0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 1\cell 
When on (on an SMB request being sent to the server), the client guarantees that there is a receive buffer posted such that a send without acknowledgment can be used by the server to respond to the client's request.\cell \cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 2\cell Reserved (must be zero).\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 3\cell When on, all pathnames in this SMB must be treated as caseless.  When off, the pathnames are case sensitive.\cell LANMAN1.0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 4\cell 
When on (in  SMB_COM_SESSION_SETUP_ANDX  defined later in this document), all paths sent to the server by the client are already canonicalized.  This means that file/directory names are in upper case, are valid characters, . and .. have been removed, and 
single backslashes are used as separators.\cell LANMAN1.0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 5\cell 
When on (in  SMB_COM_OPEN, SMB_COM_CREATE and SMB_COM_CREATE_NEW), this indicates that the client is requesting that the file be "opportunistically" locked if this pro\-
cess is the only process which has the file open at the time of the open request.  If the server "grants" this oplock request, then this bit should remain set in the corresponding response SMB to indicate to the client that the oplock request was granted.
  See the discussion of "oplock" in the sections defining the SMB_COM_OPEN_ANDX and SMB_COM_LOCKING_ANDX protocols later in this document (this bit has the same function as bit 1 of Flags if the SMB_COM_OPEN_ANDX SMB).\cell LANMAN1.0\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 6\cell When on (in core protocol
s SMB_COM_OPEN_ANDX, SMB_COM_CREATE and SMB_COM_CREATE_NEW), this indicates that the server should notify the client on any action which can modify the file (delete, setattrib, rename, etc.) by another client.  If not set, the server need only notify the 
client about another open request by a different client.  See the discussion of "oplock" in the sec\-
tions defining the SMB_COM_OPEN_ANDX  and SMB_COM_LOCKING_ANDX SMBs later in this document (this bit has the same function as bit 2 of smb_flags of the SMB_COM_OPEN_ANDX SMB).  Bit6 only has meaning if bit5 is set..\cell LANMAN1.0\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx720\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx7920
\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx9990 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 7\cell 
When on, this SMB is being sent from the server in response to a client request.  The Command field usually contains the same value in a proto\-
col request from the client to the server as in the matching response from the server to the client.  This bit unambiguously distinguishes the command request from the command response.\cell {\f11\fs18 PC NETWORK PROGRAM 1.0}\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc358532140}{\*\bkmkstart _Toc365655281}3.1.2\tab  }{\*\bkmkstart _Toc382909277}
{\*\bkmkstart _Toc382911188}Flags2 Field{\*\bkmkend _Toc358532140}{\*\bkmkend _Toc365655281}{\*\bkmkend _Toc382909277}{\*\bkmkend _Toc382911188}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 This field contains six individual flags, numbered from least significant bit to most significant bit, which are defined below.  Flags which not defined must be set to zero.
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx810\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx7920\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\clcfpat7\clcbpat8\clshdng3000 \cellx9990 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Bit\line ===\cell Meaning\line ===============================================\cell Earliest Dialect\line ============\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx810\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx7920\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx9990 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 0\cell If set in a request, the server may return long components in path names in the response.\cell \cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 1\cell If set, the client is aware of extended attributes.\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\cf1 12\cell If set, any request pathnames in this SMB should be resolved in the Distributed File System.\cell }{\f11\fs18\cf1 NT LM 0.12}{\cf1 \cell }\pard\plain \widctlpar\intbl 
\f4\fs20 {\cf1 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 13\cell 
If set, indicates that a read will be permitted if the client does not have read permission but does have execute permission.  This flag is only useful on a read request.\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 14\cell 
If set, specifies that the returned error code is a 32 bit error code in Status.Status.  Otherwise the Status.DosError.ErrorClass and Status.DosError.Error fields contain the DOS-style error information.  When passing NT status codes is negotiated, this f
lag should be set for every SMB.\cell {\f11\fs18 NT LM 0.12}\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx810\clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx7920\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx9990 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 15\cell If set, any fields of datatype STRING in this SMB message are encoded as UNICODE.  Otherwise, they are in ASCII.\cell {\f11\fs18 NT LM 0.12}\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc358532141}{\*\bkmkstart _Toc365655282}3.1.3\tab  }{\*\bkmkstart _Toc382909278}{\*\bkmkstart _Toc382911189}Tid Field
{\*\bkmkend _Toc358532141}{\*\bkmkend _Toc365655282}{\*\bkmkend _Toc382909278}{\*\bkmkend _Toc382911189}
\par \pard\plain \ri-45\sa240\widctlpar\tx50\tx576\tqr\tx2557\tx6917 \f4\fs20 {\i Tid} represents an instance of an authenticated connection to a server resource.  {\i Tid}
 is returned by the server to the client when the client successfully connects to a resource, and the client uses {\i Tid} in subsequent requests referring to the resource.
\par \pard \ri-45\sa240\widctlpar\tx576\tqr\tx8120 If the server is executing in share level security mode, {\i Tid} is the only thing used to allow access to the shared resource. Thus if the user is able to
 perform a successful connection to the server specifying the appropriate netname and passwd (if any) the resource may be accessed according to the access rights associated with the shared resource (same for all who gained access this way).
\par \pard \ri-45\sa240\widctlpar\tx576\tqr\tx8122 If however the server is executing in user level security mode, access to the resource is based on the {\i Uid }(validated on {\f11\fs18 the SMB_COM_SESSION_SETUP_ANDX} request) and the {\i Tid}
 is NOT associated with access control but rather merely defines the resource (such as the shared directory tree).
\par \pard \ri-45\sa240\widctlpar\tx576\tqr\tx8128 In most SMB requests, {\i Tid} must contain a valid value. Exceptions include prior to getting a {\i Tid} established including {\f11\fs18 SMB_COM_NEGOTIATE}, {\f11\fs18 SMB_COM_TREE_CONNECT}, {\f11\fs18 
SMB_COM_ECHO}, and {\f11\fs18 SMB_COM_SESSION_SETUP_ANDX}. 0xFFFF should be used for Tid for these situations.  The server is always responsible for enforcing use of a valid {\i Tid} where appropriate.
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc358532142}{\*\bkmkstart _Toc365655283}3.1.4\tab  }{\*\bkmkstart _Toc382909279}{\*\bkmkstart _Toc382911190}Pid Field
{\*\bkmkend _Toc358532142}{\*\bkmkend _Toc365655283}{\*\bkmkend _Toc382909279}{\*\bkmkend _Toc382911190}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 {\i Pid} uniquely identifies a client process.  Clients inform servers of the creation of a new process by simply introducing a new {\i Pid} value into the dialogue for new processes.
\par In the core protocol, the SMB_COM_PROCESS_EXIT SMB was used to indicate the catastrophic termination of a process on the client.  In the single tasking DOS system, it was possible for hard errors to occur caus\-
ing the destruction of the process with files remaining open.  Thus a SMB_COM_PROCESS_EXIT SMB was sent for this occurrence to allow the server to close all files opened by that process.
\par In the {\f11\fs18 LANMAN 1.0} and newer dialects, no SMB_COM_PROCESS_EXIT SMB is sent.  T
he client operating system must ensure that the appropriate close and cleanup SMBs will be sent when the last process referencing the file closes it.  From the server's point of view, there is no concept of FIDs "belonging to" processes.  A FID returned b
y the server to one process may be used by any other process using the same transport connection and {\i Tid}.  There is no process creation SMB sent to the server; it is up to the client to ensure only valid client processes gain access to {\i Fid}
s (and {\i Tid}s).  On SMB_COM_TREE_DISCONNECT (or when the client and server session is terminated) the server will invalidate any files opened by any process on that client.
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc358532143}{\*\bkmkstart _Toc365655284}3.1.5\tab  }{\*\bkmkstart _Toc382909280}{\*\bkmkstart _Toc382911191}Mid Field
{\*\bkmkend _Toc358532143}{\*\bkmkend _Toc365655284}{\*\bkmkend _Toc382909280}{\*\bkmkend _Toc382911191}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 Clients using the {\f11\fs18 LANMAN 1.0} and newer dialects will typically be multitasked and allow multiple asyn\-chronous input/output requests per task.  Therefore a multiplex ID ({\i Mid}
) is used along with {\i Pid} to allow multiplexing the single client and server connection among the client's multiple processes, threads, and requests per thread.
\par Regardless of negotiated dialect, the server is responsible for ensuring that every response contains the same {\i Mid} and {\i Pid} values as its request.  The client may then use the {\i Mid} and {\i Pid} values for associat\-
ing requests and responses and may have up to the nego\-tiated number of requests outstanding at any time to a particular server.
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc358532144}{\*\bkmkstart _Toc365655285}3.1.6\tab  }{\*\bkmkstart _Toc382909281}{\*\bkmkstart _Toc382911192}Status Field
{\*\bkmkend _Toc358532144}{\*\bkmkend _Toc365655285}{\*\bkmkend _Toc382909281}{\*\bkmkend _Toc382911192}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 An SMB returns error information to the client in the {\i Status} field.  Protocol dialects prior to {\f11\fs18 NT LM 0.12} return status to the client using the combination of {\i Status.DosError.ErrorClass}
 and {\i Status.DosError.Error}.  Beginning with {\f11\fs18 NT LM 0.12} CIFS servers can return 32 bit error information to clients using {\i Status.Status} if the incoming client SMB has bit 14 set in the {\i Flags2}
 field of the SMB header. The contents of response parameters is not guaranteed in the case of an error return, and must be ignored.  For write behind activity, a subsequent write or close of the file may return the fact that a previous write
 failed.  Normally write behind failures are limited to hard disk errors and device out of space.
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc358532145}{\*\bkmkstart _Toc365655286}3.1.7\tab  }{\*\bkmkstart _Toc382909282}{\*\bkmkstart _Toc382911193}Timeouts
{\*\bkmkend _Toc358532145}{\*\bkmkend _Toc365655286}{\*\bkmkend _Toc382909282}{\*\bkmkend _Toc382911193}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 
In general, SMBs are not expected to block at the server; they should return "immediately".  But some SMB requests do indicate timeout periods for the completion of the request on the server.  If a server implementation can not support timeouts, then an e
rror can be returned just as if a timeout had occurred if the resource is not available immediately upon request.
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc358532146}{\*\bkmkstart _Toc365655287}3.1.8\tab  }{\*\bkmkstart _Toc382909283}{\*\bkmkstart _Toc382911194}Data Buffer ({\i\caps 
Buffer}) and String Formats{\*\bkmkend _Toc358532146}{\*\bkmkend _Toc365655287}{\*\bkmkend _Toc382909283}{\*\bkmkend _Toc382911194}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 
The data portion of SMBs typically contains the data to be read or written, file paths, or directory paths.  The format of the data portion depends on the message.  All fields in the data portion have the same format.  In every case it consists of an iden
tifier byte followed by the data.
\par 
\par \trowd \trqc\trgaph108\trrh40\trleft-1508 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx1001\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4871\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\clcfpat7\clcbpat8\clshdng3000 \cellx5818 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Identifier\line ===============\cell Description\line =========================\cell Value\line =====\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \trowd \trqc\trgaph108\trrh40\trleft-1508 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx1001\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \cellx4871\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx5818 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Data Block
\par Dialect
\par Pathname
\par ASCII
\par Variable block\cell See Below
\par Null terminated String
\par Null terminated String
\par Null terminated String
\par See Below\cell 1
\par 2
\par 3
\par 4
\par 5\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par When the identifier indicates a data block or variable block then the format is a word indicating the length followed by the data.
\par In all dialects prior to {\f11\fs18 NT LM 0.12}, all strings are encoded in ASCII.  If the agreed dialect is {\f11\fs18 NT LM 0.12}{\f11  }or later, Unicode strings may be exchanged.{\f11\fs18  }
Unicode strings include file names, resource names, and user names.  This applies to null-terminated strings, length specified strings and the type-prefixed strings.  In all cases where a string is passed 
in Unicode format, the Unicode string must be word-aligned with respect to the beginning of the SMB.  Should the string not naturally fall on a two-byte boundary, a null byte of padding will be inserted, and the Unicode string will begin at the next addre
ss.  In the description of the SMBs, items that may be encoded in Unicode or ASCII are labeled as STRING.  If the encoding is ASCII, even if the negotiated string is Unicode, the quantity is labeled as UCHAR.
\par For type-prefixed Unicode strings, the padding b
yte is found after the type byte.  The type byte is 4 (indicating SMB_FORMAT_ASCII) independent of whether the string is ASCII or Unicode. For strings whose start addresses are found using offsets within the fixed part of the SMB (as opposed to simply bei
ng found at the byte following the preceding field,) it is guaranteed that the offset will be properly aligned.
\par Strings that are never passed in Unicode are:
\par {\pntext\pard\plain\fs20 o\tab}\pard \fi-360\li720\sa240\widctlpar\tx576{\*\pn \pnlvlblt\pnstart1\pnindent360 {\pntxtb o}}The protocol strings in the Negotiate SMB request.
\par {\pntext\pard\plain\fs20 o\tab}The service name string in the Tree Connect And X SMB.
\par \pard \sa240\widctlpar\tx576 When Unicode is negotiated, bit 15 should be set in the {\i Flags2} field of every SMB header.
\par Despite the flexible encoding scheme, no field of a data portion may be omitted or included out of order.  In addition, neither an {\i WordCount} nor {\i ByteCount} of value 0 at the end of a message may be omitted.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc358532147}{\*\bkmkstart _Toc365655288}3.2\tab  }{\*\bkmkstart _Toc382909284}{\*\bkmkstart _Toc382911195}File Names{\*\bkmkend _Toc358532147}
{\*\bkmkend _Toc365655288}{\*\bkmkend _Toc382909284}{\*\bkmkend _Toc382911195}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 File names in the CIFS protocol consist of components separated by a backslash ('\\').  Early clients of the CIFS protocol required that the name 
components adhere to an 8.3 format name.   These names consist of two parts:  a basename of no more than 8 characters, and an extension of no more than 3 characters.  The basename and extension are separated by a '.'.  All characters are legal in the base
name and extension {\i except} the space character (0x20) and:
\par \pard \li720\sa240\widctlpar\tx576 " . / \\[]{\lang1024 :+|}<>=;,*?
\par \pard \sa240\widctlpar\tx576 If the client has indicated long name support by setting {\i bit2} in the {\i Flags2} field of the SMB header, this indicates that the client is not bound by the 8.3 convention.  Specifical
ly this indicates that any SMB which returns file names to the client may return names which do not adhere to the 8.3 convention, and have a total length of up to 255 characters.  This capability was introduced with the {\f11\fs18 LM1.2X002 }
protocol dialect.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc358532148}{\*\bkmkstart _Toc365655289}3.3\tab  }{\*\bkmkstart _Toc382909285}{\*\bkmkstart _Toc382911196}Wildcards{\*\bkmkend _Toc358532148}
{\*\bkmkend _Toc365655289}{\*\bkmkend _Toc382909285}{\*\bkmkend _Toc382911196}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 
Some SMB requests allow wildcards to be given for the filename.  The wildcard allows a number of files to be operated on as a unit without having to separately enumerate the files and individually operate on each one from the client.
\par If the client is using 8.3 names, each part of the name ( base (8) or extension (3) ) is treated separately.  For long filenames the . in the name is significant even though there is no longer a restriction on the size of each of the components.
\par The ? character is a wild card for a single character. If a filename part commences with one or more "?"s then exactly that number of characters will be matched by the wildcards, e.g., "??x" equals "abx" but not "abcx" or "ax".  When a filename part has t
railing "?"s then it matches the specified number of characters or less, e.g., "x??" matches "xab", "xa" and "x", but not "xabc".  If only "?"s are present in the filename part, then it is handled as for trailing "?"s
\par The * character matches an entire part of the name, as does an empty specification for that part.  A part consisting of * means that the rest of the component should be filled with ? and the search should be performed with this wildcard character.  For ex
ample, "*.abc" or ".abc" match any file with an extension of "abc".  "*.*", "*" or "null" match all files in a directory.
\par If the negotiated dialect is "{\f11\fs18 NT LM 0.12" }or later, and the client requires MS-DOS wildcard matching semantics,  UNICODE wildcards should be translated according to the following rules:
\par     Translate the ? literal to > 
\par     Translate the . literal to " if it is followed by a ? or a *
\par     Translate the * literal to < if it is followed by a .
\par The translation can be performed in-place.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc358532149}{\*\bkmkstart _Toc365655290}3.4\tab  }{\*\bkmkstart _Toc382909286}{\*\bkmkstart _Toc382911197}DFS Pathnames{\*\bkmkend _Toc358532149}
{\*\bkmkend _Toc365655290}{\*\bkmkend _Toc382909286}{\*\bkmkend _Toc382911197}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 A DFS pathname adheres to the standard described in the FileNames section.  A DFS enabled client accessing a DFS share should set the {\i Flags2}
 bit 12 in all name based SMB requests indicating to the server that the enclosed pathname should be resolved in the Distributed File System namespace. The pathname should always have the full file name, including the server name and share name. If the se
rver can resolve the DFS name to a piece of local storage, the local storage will be accessed. If the server determines that the DFS name actually maps to a different 
server share, the access to the name will fail with the 32 bit status STATUS_PATH_NOT_COVERED ({\cf1 0xC0000257), or DOS error ERRsrv/ERRbadpath.}
\par On receiving this error, the DFS enabled client should ask the server for a {\i referral} (see TRANS2_GET_DFS_REFERRAL). The referral request should contain the full file name. 
\par The response to the request will contain a list of server and share names to try, and the part of the request file name that junctions to the list of server shares. If the ServerType field of the ref
erral is set to 1 (SMB server), then the client should resubmit the request with the {\i original}
 file name to one of the server shares in the list, once again setting the Flags2 bit 12 bit in the SMB. If the ServerType field is not 1, then the client should strip off the part of the file name that junctions to the server share before resubmitting th
e request to one of servers in the list.
\par A response to a referral request may elicit a response that does {\i not} have the StorageServers bit set. In that case, the client should resubmit the {\i referral request}
 to one of the servers in the list, until it finally obtains a referral response that has the StorageServers bit set, at which point the client can resubmit the request SMB to one of the listed server shares.
\par If, after getting a referral with the StorageServers bit set and resubmitting the request to one of the server shares in the list, the server fails the request with STATUS_PATH_NOT_COVERED, it must be the case that there is an inconsistency between the vi
ew of the DFS namespace held by the server granting the referral and the server listed in that referral. In this case, the client may inform the server granting the referral of this inconsistency via the TRANS2_REPORT_DFS_INCONSISTENCY SMB.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc358532150}{\*\bkmkstart _Toc365655291}3.5\tab  }{\*\bkmkstart _Toc382909287}{\*\bkmkstart _Toc382911198}Time And Date Encoding{\*\bkmkend _Toc358532150}
{\*\bkmkend _Toc365655291}{\*\bkmkend _Toc382909287}{\*\bkmkend _Toc382911198}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 When SMB requests or responses encode time values, the following describes the various encodings used.
\par struct \{\line         USHORT Day : 5;\line         USHORT Month : 4;\line         USHORT Year : 7;\line \} SMB_DATE;
\par 
\par The Year field has a range of 0-119, which represents years 1980 - 2099.  The Month is encoded as 1-12, and the day ranges from 1-31
\par struct \{\line         USHORT TwoSeconds : 5;\line         USHORT Minutes : 6;\line         USHORT Hours : 5;\line \} SMB_TIME;
\par 
\par Hours ranges from 0-23, Minutes range from 0-59, and TwoSeconds ranges from 0-29 representing two second increments within the minute.
\par typedef struct \{\line     ULONG LowTime;\line     LONG HighTime;\line \} TIME;
\par 
\par TIME indicates a signed 64-bit integer representing either an absolute time or a time interval.  Times are specified in unit
s of 100ns.  A positive value expresses an absolute time, where the base time (the 64-bit integer with value 0) is the beginning of the year 1601 AD in the Gregorian calendar.  A negative value expresses a time interval relative to some base time, usually
 the current time.
\par typedef unsigned long UTIME;
\par UTIME is the number of seconds since Jan 1, 1970, 00:00:00.0.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc358532151}{\*\bkmkstart _Ref365651428}{\*\bkmkstart _Ref365651433}{\*\bkmkstart _Toc365655292}3.6\tab  }{\*\bkmkstart _Toc382909288}
{\*\bkmkstart _Toc382911199}Access Mode Encoding{\*\bkmkend _Toc358532151}{\*\bkmkend _Ref365651428}{\*\bkmkend _Ref365651433}{\*\bkmkend _Toc365655292}{\*\bkmkend _Toc382909288}{\*\bkmkend _Toc382911199}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 Various client requests and server responses, such as SMB_COM_OPEN, pass file access modes encoded into a USHORT.  The encoding of these is as follows:
\par     1111 11\line     5432 1098 7654 3210\line     rWrC rLLL rSSS rAAA
\par  where:
\par     W - Write through mode.  No read ahead or write behind allowed on\line         this file or device.  When the response is returned, data is\line         expected to be on the disk or device.
\par     S - Sharing mode:\line         0 - Compatibility mode\line         1 - Deny read/write/execute (exclusive)\line         2 - Deny write\line         3 - Deny read/execute\line         4 - Deny none
\par     A - Access mode\line         0 - Open for reading\line         1 - Open for writing\line         2 - Open for reading and writing\line         3 - Open for execute
\par     rSSSrAAA = 11111111 (hex FF) indicates FCB open (???)
\par     C - Cache mode\line         0 - Normal file\line         1 - Do not cache this file
\par     L - Locality of reference\line         0 - Locality of reference is unknown\line         1 - Mainly sequential access\line         2 - Mainly random access\line         3 - Random access with some locality\line         4 to 7 - Currently undefined

\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Ref365636870}{\*\bkmkstart _Toc365655293}{\*\bkmkstart _Toc358532152}3.7\tab  }{\*\bkmkstart _Toc382909289}{\*\bkmkstart _Toc382911200}Access Mask Encoding
{\*\bkmkend _Ref365636870}{\*\bkmkend _Toc365655293}{\*\bkmkend _Toc382909289}{\*\bkmkend _Toc382911200}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 typedef ULONG ACCESS_MASK; 
\par {\fs24 
\par }The {\b ACCESS_MASK} structure is one 32 bit value containing standard, specific, and generic rights. These rights are used in access-control entries (ACEs) and are the primary means of specifying the requested or granted access to an object. {\fs24 

\par }The bits in this value are allocated as follows: {\fs2   }{\fs24 
\par }\trowd \trgaph108\trleft252 \cellx1710\cellx10836 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\b Bits}{\b\fs24 \cell }{\b Meaning}{\b\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\b\fs24 \row }\trowd 
\trgaph108\trleft252 \cellx1710\cellx10836 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 0 through 15{\fs24 \cell }Specific rights. Contains the access mask specific to the object type associated with the mask.{
\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\trowd \trgaph108\trleft252 \cellx1710\cellx10836 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 16 through 23{\fs24 \cell }
Standard rights. Contains the object's standard access rights and can be a combination of the following predefined flags:\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 {\fs24 
\par }\trowd \trgaph108\trleft252 \cellx1242\cellx3316\cellx10368 \pard \sa240\widctlpar\intbl\tx576 {\b Bit\cell Flag\cell Meaning\cell }\pard \widctlpar\intbl {\b \row }\trowd \trgaph108\trleft252 \cellx1242\cellx3316\cellx10368 \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 16{\fs24 \cell }DELETE{\fs24 \cell }Delete access {\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 17{\fs24 \cell }READ_CONTROL{\fs24 \cell }Read access to the owner, group, and discretionary access-control list (ACL) of the security descriptor {\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {
\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 18{\fs24 \cell }WRITE_DAC{\fs24 \cell }Write access to the discretionary access-control list (ACL) {\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {
\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 19{\fs24 \cell }WRITE_OWNER{\fs24 \cell }Write access to owner {\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\trowd \trgaph108\trleft252 
\cellx1242\cellx3316\cellx10368 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 20{\fs24 \cell }SYNCHRONIZE{\fs24 \cell }Windows NT: Synchronize access {\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row 
}\pard \sa240\sl-120\slmult0\widctlpar\tx576 {\fs2   }{\fs24 
\par }\trowd \trgaph108\trleft252 \cellx1710\cellx10836 \pard \sa240\widctlpar\intbl\tx576 {\b Bits}{\fs24 \cell }{\b Meaning}{\fs24 \cell }\pard \widctlpar\intbl {\fs24 \row }\trowd \trgaph108\trleft252 \cellx1710\cellx10836 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 24{\fs24 \cell }
Access system security (ACCESS_SYSTEM_SECURITY). This flag is not a typical access type. It is used to indicate access to a system ACL. This type of access requires the calling process to have a specific privilege.{\fs24 \cell }\pard\plain 
\widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 25{\fs24 \cell }Maximum allowed (MAXIMUM_ALLOWED){\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 26 through 27{\fs24 \cell }Reserved{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 28{\fs24 \cell }Generic all (GENERIC_ALL){\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 29{\fs24 \cell }Generic execute (GENERIC_EXECUTE){
\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 30{\fs24 \cell }Generic write (GENERIC_WRITE){\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 
\row }\trowd \trgaph108\trleft252 \cellx1710\cellx10836 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 31{\fs24 \cell }Generic read (GENERIC_READ)\cell \pard\plain \widctlpar\intbl \f4\fs20 {\f11 \row }\pard\plain 
\s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Ref365651301}{\*\bkmkstart _Toc365655294}3.8\tab  }{\*\bkmkstart _Toc382909290}{\*\bkmkstart _Toc382911201}Open Function Encoding{\*\bkmkend _Ref365651301}
{\*\bkmkend _Toc365655294}{\*\bkmkend _Toc382909290}{\*\bkmkend _Toc382911201}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 {\i OpenFunction} specifies the action to be taken depending on whether or not the file exists.  This word has the following format:
\par bits:
\par     1111 11\line     5432 1098 7654 3210\line     rrrr rrrr rrrC rrOO
\par where:
\par     C - Create (action to be taken if file does not exist).\line \tab 0 -- Fail.\line \tab 1 -- Create file.
\par     r - reserved (must be zero).
\par     O - Open (action to be taken if file exists).\line \tab 0 - Fail.\line \tab 1 - Open file.\line \tab 2 - Truncate file.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Ref365651322}{\*\bkmkstart _Ref365651363}{\*\bkmkstart _Toc365655295}3.9\tab  }{\*\bkmkstart _Toc382909291}{\*\bkmkstart _Toc382911202}Open Action Encoding
{\*\bkmkend _Ref365651322}{\*\bkmkend _Ref365651363}{\*\bkmkend _Toc365655295}{\*\bkmkend _Toc382909291}{\*\bkmkend _Toc382911202}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 {\i Action} in the response to an open or create request describes the action taken as a result of the request.  It has the following format:
\par bits:
\par     1111 11\line     5432 1098 7654 3210\line     Lrrr rrrr rrrr rrOO
\par where:
\par     L - Lock (single user total file lock status).\line \tab 0 -- file opened by another user (or mode not sup\-ported by server).\line \tab 1 -- file is opened only by this user at the present  time.
\par     r - reserved (must be zero).
\par     O - Open (action taken on Open).\line \tab 1 - The file existed and was opened.\line \tab 2 - The file did not exist but was created.\line \tab 3 - The file existed and was truncated.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Ref365632120}{\*\bkmkstart _Toc365655296}3.10\tab  }{\*\bkmkstart _Toc382909292}{\*\bkmkstart _Toc382911203}File Attribute Encoding{\*\bkmkend _Toc358532152}
{\*\bkmkend _Ref365632120}{\*\bkmkend _Toc365655296}{\*\bkmkend _Toc382909292}{\*\bkmkend _Toc382911203}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 When SMB messages exchange file attribute information, it is encoded in 16 bits as:
\par \trowd \trgaph108\trleft450 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx1710\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5040 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Value\line =======\cell Description\line =====================
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft450 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx1710\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx5040 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 0x01\cell Read only file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 0x02\cell Hidden file\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 0x04\cell System file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 0x08\cell Volume\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 0x10\cell Directory\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 0x20\cell Archive file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft450 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx1710\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx5040 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
others\cell Reserved - must be 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Ref365631713}{\*\bkmkstart _Ref365636964}{\*\bkmkstart _Toc365655297}{\*\bkmkstart _Toc358532153}3.11\tab  }{\*\bkmkstart _Toc382909293}
{\*\bkmkstart _Toc382911204}Extended File Attribute{\*\bkmkend _Ref365631713} Encoding{\*\bkmkend _Ref365636964}{\*\bkmkend _Toc365655297}{\*\bkmkend _Toc382909293}{\*\bkmkend _Toc382911204}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 The extended file attributes is a 32 bit value composed of attributes and flags.
\par \pard \sa240\keepn\widctlpar\tx576 Any combination of the following attributes is acceptable, except all other file attributes override FILE_ATTR_NORMAL:
\par \trowd \trgaph108\trleft-108 \cellx2340\cellx3330\cellx10080 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Name
\par ====\cell Value
\par =====\cell Meaning
\par =======\cell \pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\trowd \trgaph108\trleft-108 \cellx2340\cellx3330\cellx10080 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ATTR_ARCHIVE{\fs24 \cell }0x020\cell 
The file has not been archived since it was last modified. Applications use this attribute to mark files for backup or removal.{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ATTR_COMPRESSED{\fs24 \cell }0x800\cell 
The file or directory is compressed. For a file, this means that all of the data in the file is compressed. For a directory, this means that compression is the default for newly created files and subdirectories.{\fs24 \cell }\pard\plain \widctlpar\intbl 
\f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ATTR_NORMAL{\fs24 \cell }0x080\cell The file has no other attributes set. This attribute is valid only if used alone.{\fs24 \cell }\pard\plain 
\widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ATTR_HIDDEN{\fs24 \cell }0x002\cell The file is hidden. It is not to be included in an ordinary directory listing.{\fs24 \cell 
}\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ATTR_READONLY{\fs24 \cell }0x001\cell 
The file is read only. Applications can read the file but cannot write to it or delete it.{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ATTR_TEMPORARY
\cell 0x100\cell The file is temporary\cell \pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ATTR_DIRECTORY\cell 0x010\cell The file is a directory\cell \pard\plain 
\widctlpar\intbl \f4\fs20 {\fs24 \row }\trowd \trgaph108\trleft-108 \cellx2340\cellx3330\cellx10080 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ATTR_SYSTEM{\fs24 \cell }0x004\cell 
The file is part of or is used exclusively by the operating system.{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard \sa240\widctlpar\tx576 
\par \pard \sa240\keepn\widctlpar\tx576 Any combination of the following flags is acceptable:
\par \trowd \trgaph108\trleft-108 \cellx2430\cellx4140\cellx10080 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Name
\par ====\cell Value
\par =====\cell Meaning
\par =======\cell \pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\trowd \trgaph108\trleft-108 \cellx2430\cellx4140\cellx10080 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 WRITE_THROUGH\cell 0x80000000\cell 
Instructs the operating system to write through any intermediate cache and go directly to the file. The operating system can still cache write operations, but cannot lazily flush them.{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row 
}\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 NO_BUFFERING\cell 0x20000000\cell 
Requests the server to open the file with no intermediate buffering or caching; the server is not obliged to honor the request. An application must meet certain requirements when working with files opened with FILE_FLAG_NO_BUFFERING. File access must begi
n at offsets within the file that are integer m
ultiples of the volume's sector size; and must be for numbers of bytes that are integer multiples of the volume's sector size. For example, if the sector size is 512 bytes, an application can request reads and writes of 512, 1024, or 2048 bytes, but not o
f 335, 981, or 7171 bytes. {\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 RANDOM_ACCESS\cell 0x10000000\cell 
Indicates that the application intends to access the file randomly. The server MAY use this flag to optimize file caching.{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SEQUENTIAL_SCAN\cell 0x08000000\cell Indicates that the file is to be accessed sequential
ly from beginning to end. Windows uses this flag to optimize file caching. If an application moves the file pointer for random access, optimum caching may not occur; however, correct operation is still guaranteed. Specifying this flag can increase perform
ance for applications that read large files using sequential access. Performance gains can be even more noticeable for applications that read large files mostly sequentially, but occasionally skip over small ranges of bytes.{\fs24 \cell }\pard\plain 
\widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 DELETE_ON_CLOSE{\fs24 \cell }0x04000000\cell Requ
ests that the server is delete the file immediately after all of its handles have been closed.{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
BACKUP_SEMANTICS{\fs24 \cell }0x02000000\cell 
Indicates that the file is being opened or created for a backup or restore operation. The server SHOULD allow the client to override normal file security checks, provided it has the necessary permission to do so.{\fs24 \cell }\pard\plain \widctlpar\intbl 
\f4\fs20 {\fs24 \row }\trowd \trgaph108\trleft-108 \cellx2430\cellx4140\cellx10080 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 POSIX_SEMANTICS{\fs24 \cell }0x01000000\cell 
Indicates that the file is to be accessed according to POSIX rules. This includes allowing multiple files with names differing only in case, for f
ile systems that support such naming. (Use care when using this option because files created with this flag may not be accessible by applications written for MS-DOS, Windows 3.{\i x}, or Windows NT.)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard 
\sa240\widctlpar\tx576 
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc365655298}3.12\tab  }{\*\bkmkstart _Toc382909294}{\*\bkmkstart _Toc382911205}Batching Requests ("AndX" Messages{\*\bkmkend _Toc358532153})
{\*\bkmkend _Toc365655298}{\*\bkmkend _Toc382909294}{\*\bkmkend _Toc382911205}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 {\f11\fs18 LANMAN1.0} and later dialects of the CIFS protocol allow multiple SMB requests to be sent in one message to the server.  Messages of this type are called AndX SMBs, and they obey the following rules:

\par {\pntext\pard\plain\fs20 o\tab}\pard \fi-360\li360\sa240\widctlpar\tx576{\*\pn \pnlvlblt\pnstart1\pnindent360 {\pntxtb o}}The embedded command does not repeat the SMB header information.  Rather the next SMB starts at the {\i WordCount} field.
\par {\pntext\pard\plain\fs20 o\tab}
All multiple (chained) requests must fit within the negotiated transmit size.  For example, if SMB_COM_TREE_CONNECT_ANDX included OPENandX SMB_COM_OPEN_ANDX which included SMB_COM_WRITE were sent, they would all have to fit within the nego\-
tiated buffer size.  This would limit the size of the write.
\par {\pntext\pard\plain\fs20 o\tab}There is one message sent containing the chained requests and there is one response message to the chained requests.  The server may NOT elect to send separate responses to each of the chained requests.
\par {\pntext\pard\plain\fs20 o\tab}
All chained responses must fit within the negotiated transmit size.  This limits the maximum value on an embedded SMB_COM_READ for example.  It is the client's responsibility to not request more bytes than will fit within the multiple response.
\par {\pntext\pard\plain\fs20 o\tab}The server will implicitly use the result of the first command in the "X" command.  For example the {\i Tid} obtained via SMB_COM_TREE_CONNECT_ANDX would be used in the embedded SMB_COM_OPEN_ANDX and the {\i Fid}
 obtained in the SMB_COM_OPEN_ANDX would be used in the embedded SMB_COM_READ.
\par {\pntext\pard\plain\fs20 o\tab}Each chained request can only refer\-ence the same {\i Fid} and {\i Tid} as the other commands in the combined request.  The chained requests can be thought of as performing a single (multi-part) opera\-
tion on the same resource.
\par {\pntext\pard\plain\fs20 o\tab}The first {\i Command}
 to encounter an error will stop all further processing of embedded commands.  The server will not back out commands that succeeded.  Thus if a chained request contained SMB_COM_OPEN_ANDX and SMB_COM_READ an
d the server was able to open the file successfully but the read encountered an error, the file would remain open.  This is exactly the same as if the requests had been sent separately.
\par {\pntext\pard\plain\fs20 o\tab}
If an error occurs while processing chained requests, the last response (of the chained responses in the buffer) will be the one which encountered the error.  Other unprocessed chained requests will have been ignored when the server encountered the error 
and will not be represented in the chained response.  Actually the last valid {\i AndXCommand} (if any) will represent the SMB on which the error occurred.  If no valid {\i AndXCommand}
 is present, then the error occurred on the first request/response and {\i Command} contains the command which failed.  In all cases the error information are returned in the SMB header at the start of the response buffer.
\par {\pntext\pard\plain\fs20 o\tab}Each chained request and response contains the offset (from the start of the SMB header) to the next chained request/response (in the {\i AndXOffset} field in the various "and X" protocols 
defined later e.g. SMB_COM_OPEN_ANDX).  This allows building the requests unpacked.  There may be space between the end of the previous request (as defined by {\i WordCount} and {\i ByteCount}
) and the start of the next chained request.  This simplifies the building of chained protocol requests.  Note that because the client must know the size of the data being returned in order to post the correct number of receives (e.g. SMB_COM_TRANSACTION,
 SMB_COM_READ_MPX), the data in each response SMB is expected to be truncat
ed to the maximum number of 512 byte blocks (sectors) which will fit (starting at a 32 bit boundary) in the negotiated buffer size with the odd bytes remaining (if any) in the final buffer.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc365655299}{\*\bkmkstart _Toc358532155}{\*\bkmkstart _Toc358532154}3.13\tab  }{\*\bkmkstart _Toc382909295}{\*\bkmkstart _Toc382911206}
"Transaction" Style Subprotocols{\*\bkmkend _Toc365655299}{\*\bkmkend _Toc382909295}{\*\bkmkend _Toc382911206}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 {\f11\fs18 SMB_COM_TRANSACTION} performs a symbolically named transaction.  This transaction is known only by a name (no file handle used).  {\f11\fs18 SMB_COM_TRANSACTION2}
 likewise performs a transaction, but a word parameter is used to identify the transaction instead of a name{\f11\fs18 .  SMB_COM_NT_TRANSACTION} is used for commands that potentially need to transfer a large amount of data (greater than 64K bytes).

\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc358532205}{\*\bkmkstart _Toc365655300}3.13.1\tab  }{\*\bkmkstart _Toc382909296}{\*\bkmkstart _Toc382911207}
SMB_COM_TRANSACTION and SMB_COM_TRANSACTION2 Formats{\*\bkmkend _Toc358532205}{\*\bkmkend _Toc365655300}{\*\bkmkend _Toc382909296}{\*\bkmkend _Toc382911207}
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4860\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Primary Client Request\line ===============================
\cell Description\line ====================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Command\cell {\f11\fs18 SMB_COM_TRANSACTION or SMB_COM_TRANSACTION2}\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words;   value = (14 + SetupCount)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT TotalParameterCount;\cell Total parameter bytes being sent\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT TotalDataCount;\cell Total data bytes being sent\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT MaxParameterCount;\cell Max parameter bytes to return
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT MaxDataCount;\cell Max data bytes to return\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR MaxSetupCount;\cell Max setup words to return\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 UCHAR Reserved;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Flags;\cell Additional information:\cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell bit 0 - also disconnect TID in {\i\caps Tid}\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell bit 1 - one-way transaction (no response)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Timeout;
\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Reserved2;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ParameterCount;\cell Parameter bytes sent this buffer\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT ParameterOffset;\cell Offset (from header start) to Parameters\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DataCount;\cell Data bytes sent this buffer
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DataOffset;\cell Offset (from header start) to data\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR SetupCount;\cell Count of setup words\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UCHAR Reserved3;\cell Reserved (pad above to word)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Setup[SetupCount];\cell Setup words (# = SetupWordCount)\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING Name[];\cell Name of transaction ({\f11\fs18 NULL} if {\f11\fs18 SMB_COM_TRANSACTION2})\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Pad[];\cell Pad to SHORT or LONG\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UCHAR Parameters[ ParameterCount];\cell Parameter bytes (# = ParameterCount)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Pad1[];\cell Pad to SHORT or LONG
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Data[ DataCount ];\cell Data bytes (# = DataCount)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 

\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4860\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Interim Server Response\line ===============================
\cell Description\line ====================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl
\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4860\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Secondary Client Request\line ===============================
\cell Description\line ====================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Command\cell {\f11\fs18 SMB_COM_TRANSACTION_SECONDARY\cell }\pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 8\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT TotalParameterCount;\cell Total parameter bytes being sent\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT TotalDataCount;\cell Total data bytes being sent\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 USHORT ParameterCount;\cell Parameter bytes sent this buffer\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ParameterOffset;\cell 
Offset (from header start) to Parameters\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ParameterDisplacement;\cell Displacement of these Parameter bytes\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DataCount;\cell Data bytes sent this buffer\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DataOffset;\cell Offset (from header start) to data\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DataDisplacement;\cell Displacement of these data bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT Fid;\cell {\i\caps Fid} for handle based requests, else {\f11\fs18 0xFFFF}.  This field is present only if this is an {\f11\fs18 SMB_COM_TRANSACTION2} request.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Pad[];\cell 
Pad to SHORT or LONG\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Parameters[ParameterCount];\cell Parameter bytes (# = ParameterCount)\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Pad1[];\cell Pad to SHORT or LONG\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl
\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Data[DataCount];\cell Data bytes (# = DataCount)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4860\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ===============================\cell 
Description\line ====================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of data bytes; value = 10 + {\i\caps SetupCount}\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT TotalParameterCount;\cell Total parameter bytes being sent\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT TotalDataCount;\cell Total data bytes being sent\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT Reserved;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ParameterCount;\cell Parameter bytes sent this buffer\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ParameterOffset;\cell Offset (from header start) to Parameters\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ParameterDisplacement;\cell Displacement of these Parameter bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 USHORT DataCount;\cell Data bytes sent this buffer\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DataOffset;\cell Offset (from header start) to data
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DataDisplacement;\cell Displacement of these data bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR SetupCount;\cell Count of setup words\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 UCHAR Reserved2;\cell Reserved (pad above to word)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Setup[SetupWordCount];\cell 
Setup words (# = SetupWordCount)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Pad[];\cell Pad to SHORT or LONG\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 UCHAR Parameters[ParameterCount];\cell Parameter bytes (# = ParameterCount)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Pad1[];\cell 
Pad to SHORT or LONG\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Data[DataCount];\cell Data bytes (# = DataCount)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc358532206}{\*\bkmkstart _Toc365655301}3.13.2\tab  }{\*\bkmkstart _Toc382909297}{\*\bkmkstart _Toc382911208}
SMB_COM_NT_TRANSACTION Formats{\*\bkmkend _Toc358532206}{\*\bkmkend _Toc365655301}{\*\bkmkend _Toc382909297}{\*\bkmkend _Toc382911208}
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4860\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Primary Client Request\line ===============================
\cell Description\line ====================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words;   value = (19 + SetupCount)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR MaxSetupCount;\cell Max setup words to return\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Reserved;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG TotalParameterCount;\cell 
Total parameter bytes being sent\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG TotalDataCount;\cell Total data bytes being sent\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG MaxParameterCount;\cell Max parameter bytes to return\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG MaxDataCount;\cell Max data bytes to return\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 ULONG ParameterCount;\cell Parameter bytes sent this buffer\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG ParameterOffset;\cell 
Offset (from header start) to Parameters\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG DataCount;\cell Data bytes sent this buffer\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG DataOffset;\cell Offset (from header start) to data\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR SetupCount;\cell Count of setup words\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Function;\cell 
The transaction function code\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Buffer[1];\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Setup[SetupWordCount];\cell Setup words\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT ByteCount;\cell Count of data bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Pad1[];\cell Pad to LONG\cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Parameters[ParameterCount];\cell Parameter bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Pad2[];\cell Pad to LONG\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 
\cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Data[DataCount];   Data bytes\cell \cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4860\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Interim Server Response\line ===============================
\cell Description\line ====================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl
\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4860\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Secondary Client Request\line ===============================
\cell Description\line ====================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 18\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Reserved[3];\cell MBZ\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG TotalParameterCount;\cell 
Total parameter bytes being sent\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG TotalDataCount;\cell Total data bytes being sent\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG ParameterCount;\cell Parameter bytes sent this buffer\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG ParameterOffset;\cell Offset (from header start) to Parameters\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG ParameterDisplacement;\cell Specifies the offset from the start of the overall parameter block to the parameter bytes that are contained in this message\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG DataCount;\cell Data bytes sent this buffer\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG DataOffset;\cell Offset (from header start) to data\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
ULONG DataDisplacement;\cell Specifies the offset from the start of the overall data block to the data bytes that are contained in this message.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Reserved1;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Pad1[];\cell Pad to LONG\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Parameters[ParameterCount];\cell Parameter bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Pad
2[];\cell Pad to LONG\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Data[DataCount];\cell Data bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard 
\sa240\widctlpar\tx576 
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4860\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ===============================\cell 
Description\line ====================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of data bytes;  value = 18 + SetupCount\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Reserved[3];\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
ULONG TotalParameterCount;\cell Total parameter bytes being sent\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG TotalDataCount;\cell Total data bytes being sent
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG ParameterCount;\cell Parameter bytes sent this buffer\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG ParameterOffset;\cell Offset (from header start) to Parameters\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG ParameterDisplacement;\cell Specifies the offset from the start of the overall parameter block to the parameter bytes that are contained in this message\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG DataCount;\cell Data bytes sent this buffer\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG DataOffset;\cell Offset (from header start) to data\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
ULONG DataDisplacement;\cell Specifies the offset from the start of the overall data block to the data bytes that are contained in this message.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR SetupCount;\cell Count of setup words\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT Setup[SetupWordCount];\cell Setup words\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Pad1[];\cell Pad to LONG\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Parameters[ParameterCount];\cell Parameter bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UCHAR Pad2[];\cell Pad to SHORT or LONG\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Data[DataCount];\cell Data bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc358532207}{\*\bkmkstart _Toc365655302}3.13.3\tab  }{\*\bkmkstart _Toc382909298}{\*\bkmkstart _Toc382911209}Functional Description
{\*\bkmkend _Toc358532207}{\*\bkmkend _Toc365655302}{\*\bkmkend _Toc382909298}{\*\bkmkend _Toc382911209}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 The {\f11\fs18 SMB_COM_TRANSACTION} command's scope includes named pipes and mailslots.  Where the resource is uni\-directional (such as class 2 writes to mailslots), {\i bit1} of {\i Flags}
 in the request can be set indicating that no response is needed.  The other transactions accommodate {\f11\fs18 IOCTL} requests and file system requests which require the transfer of an extended attribute list.
\par The transaction {\i Setup} information and/or {\i Parameters} define functions specific to a particular resource on a par\-ticular server.  Therefore the functions supported are not defined by the protocol, but by client and server implementa\-
tions.  The transaction protocol simply provides a means of delivering them and retrieving the results.
\par The number of bytes needed in order to perform the transaction request may be more than will fit in a single buffer.
\par At the time of the request, the client knows the number of parameter and data bytes expected to be sent and passes this information to the server via the primary request ({\i TotalParameterCount} and {\i TotalDataCount}
).  This may be reduced by lowering the total number of bytes expected ({\i TotalParameterCount} and {\i TotalDataCount}) in each (if any) secondary request.
\par When the amount of parameter bytes received (total of each {\i ParameterCount}) equals the total amount of parameter bytes expected (smallest {\i TotalParameterCount}) received, then the server has received all the parameter bytes.
\par Likewise, when the amount of data bytes received (total of each {\i DataCount}) equals the total amount of data bytes expected (smallest {\i TotalDataCount}) received, then the server has received all the data bytes.
\par The parameter bytes should normally be sent first followed by the data bytes.  However, the server knows where each begins and ends in each buffer by the offset fields ({\i ParameterOffset} and {\i DataOffset}) and the length fields ({\i ParameterCount}
 and {\i DataCount}).  The displacement of the bytes (relative to start of each) is also known ({\i ParameterDisplacement} and {\i DataDisplacement}
).  Thus the server is able to reassemble the parameter and data bytes should the individual requests be received out of sequence.
\par If all parameter bytes and data bytes fit into a single buffer, then no interim response is expected and no secon\-dary request is sent.
\par The client knows the maximum amount of data bytes and parameter bytes which the server may return (from {\i MaxParameterCount} and {\i MaxDataCount} of the requ
est).  Thus the client initializes its bytes expected variables to these values.  The server then informs the client of the actual amounts being returned via each message of the server response ({\i TotalParameterCount} and {\i TotalDataCount}
).  The server may reduce the expected bytes by lowering the total number of bytes expected ({\i TotalParameterCount} and/or {\i TotalDataCount}) in each (any) response.
\par When the amount of parameter bytes received (total of each {\i ParameterCount}) equals the total amount of parameter bytes expected (smallest {\i TotalParameterCount}) received, then the client has received all the parameter bytes.
\par Likewise, when the amount of data bytes received (total of each {\i DataCount}) equals the total amount of data bytes expected (smallest {\i TotalDataCount}) received, then the client has received all the data bytes.
\par The parameter bytes should normally be returned first fol\-lowed by the data bytes.  However, the client knows where each begins and ends in each buffer by the offset fields ({\i ParameterOffset} and {\i DataOffset}) and the length fields ({\i 
ParameterCount} and {\i DataCount}).  The displacement of the bytes (relative to start of each) is also known ({\i ParameterDisplacement} and {\i DataDisplacement}
).  The client is able to reassemble the parameter and data bytes should the server responses be received out of sequence.
\par If a connectionless transport is being used, the transaction requests must be properly sequenced in the {\i Connectionless.SequenceNumber} SMB header field.  The {\i Mid} of any secondary client requests must match the {\i Mid} of
 the primary client request.  The server responds to each request piece except the last one with a response indicating that the server is ready for the next piece.  The last piece is responded to with the first piece of the result data.  The client then s
ends an {\f11\fs18 SMB_COM_TRANSACTION_SECONDARY} SMB with {\i ParameterDisplacement} set to the number of parameter bytes received so far and {\i DataDisplacement} set to the number of data bytes received so far and {\i ParameterCount}, {\i 
ParameterOffset}, {\i DataCount}, and {\i DataOffset }set
 to zero (0).  The server responds with the next piece of the transaction result.  The process is repeated until all of the response information has been received.  When the transaction has been completed, the client must send another sequenced command (s
uch as an {\f11\fs18 SMB_COM_ECHO}) to the server to allow the server to know that the final piece was received and that resources allocated to the transaction command may be released.
\par The flow for these transactions over a connection oriented transport is:
\par {\pntext\pard\plain\fs20 1.\tab}\pard \li120\sa240\widctlpar\tx576{\*\pn \pnlvlbody\pndec\pnstart1\pnindent360\pnhang{\pntxta .}}
The client sends the primary client request identifying the total bytes (both parameters and data) which are expected to be sent and contains the set up words and as many of the parameter and data bytes as will fit in a negotiated size buffer.  This reque
st also identifies the maximum number of bytes (setup, parameters and data) the server is to return on the transaction completion.  If all the bytes fit in the single buffer, skip to step 4.
\par {\pntext\pard\plain\fs20 2.\tab}The server responds with a single interim response meaning "OK, send the remainder of the bytes" or (if error response) terminate the transaction.
\par {\pntext\pard\plain\fs20 3.\tab}The client then sends another buffer full of bytes to the server.  This step is repeated until all of the bytes are sent and received.
\par {\pntext\pard\plain\fs20 4.\tab}The Server sets up and performs the transaction with the information provided.
\par {\pntext\pard\plain\fs20 5.\tab}
Upon completion of the transaction, the server sends back (up to) the number of parameter and data bytes requested (or as many as will fit in the negotiated buffer size).  This step is repeated until all result bytes have been returned.
\par \pard \sa240\widctlpar\tx576 The flow for the transaction protocol when the request parameters and data do not all fit in a single buffer is:
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4860\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5670\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client\line ===============================\cell <->\line ====\cell Server\line ==============================\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5670\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 Primary TRANSACTION request\cell }{\f11 ->\cell }\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 \cell }{\f11 <-\cell }Interim Server Response\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 Secondary TRANSACTION request 1\cell }{\f11 ->\cell }\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {
\f11\fs18 Secondary TRANSACTION request 2\cell }{\f11 ->\cell }\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 Secondary TRANSACTION request N\cell }{\f11 ->
\cell }\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell {\f11 <-\cell }{\f11\fs18 TRANSACTION} response 1\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell {\f11 <-\cell }{\f11\fs18 TRANSACTION} response 2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5670\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell {\f11 <-\cell }{\f11\fs18 TRANSACTION} response m\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
The flow for the transaction protocol when the request parameters and data does all fit in a single buffer is:
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4860\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5670\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client\line ===============================\cell <->\line ====\cell Server\line ==============================\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5670\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 Primary TRANSACTION request\cell }{\f11 ->\cell }\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell {\f11 <-\cell }{\f11\fs18 TRANSACTION} response 1\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 \cell {\f11 <-\cell }{\f11\fs18 TRANSACTION} response 2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5670\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell {\f11 <-\cell }{\f11\fs18 TRANSACTION} response m\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par The flow for the transaction protocol over a connectionless transport is:
\par {\pntext\pard\plain\fs20 1.\tab}\pard \li120\sa240\widctlpar\tx576{\*\pn \pnlvlbody\pndec\pnstart1\pnindent360\pnhang{\pntxta .}}
The client sends the primary client request identifying the total bytes (both parameters and data) which are expected to be sent and contains the set up words and as many of the parameter and data bytes as will fit in a negotiated size buffer.  This reque
st also identifies the maximum number of bytes (setup, parameters and data) the server is to return on completion.  If all the bytes fit in the single buffer, skip to step 4.
\par {\pntext\pard\plain\fs20 2.\tab}The server responds with a single interim response meaning "OK, send the remainder of the bytes" or (if error response) terminate the transaction.
\par {\pntext\pard\plain\fs20 3.\tab}The client then sends another buffer full of bytes to the server.  The server responds with an interim server response. This step is repeated until all of the bytes are sent and received.
\par {\pntext\pard\plain\fs20 4.\tab}The Server sets up and performs the transaction with the information provided.
\par {\pntext\pard\plain\fs20 5.\tab}Upon completion of the transaction, the server sends back (up to) the number of parameter and data bytes requested (or as many as will fit in the negotiated buffer size).
\par {\pntext\pard\plain\fs20 6.\tab}The client responds with a transaction secondary request.  The server sends back more response data. This step is repeated until all result bytes have been returned.
\par {\pntext\pard\plain\fs20 7.\tab}\pard \fi-360\li360\sa240\widctlpar\tx576{\*\pn \pnlvlbody\pndec\pnstart1\pnindent360\pnhang{\pntxta .}}The client sends a sequenced request to the server such as{\f11\fs18  SMB_COM_ECHO}
\par \pard \ri-242\sa240\widctlpar\tx576 The primary transaction request through the final response make up the complete transaction exchange, thus the {\i Tid}, {\i Pid}, {\i Uid} and {\i Mid} must remain constant and can be used as appropri
ate by both the server and the client.  Of course, other SMB requests may intervene as well.
\par There are (at least) three ways that actual server responses have been observed to differ from what might be expected.  First, some servers will send Pad bytes to move the DataOffset to a 2- or 4-byte boundary even if there are no data bytes; the point he
re is that the ByteCount must be used instead of ParameterOffset plus ParameterCount to infer the actual message length.  Second, some servers always return MaxPara
meterCount bytes even if the particular Transact2 has no parameter response.  Finally, in case of an error, some servers send the "traditional WordCount==0/ByteCount==0" response while others generate a Transact response format.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc365655303}3.14\tab  }{\*\bkmkstart _Toc382909299}{\*\bkmkstart _Toc382911210}Valid SMB Requests by Negotiated Dialect{\*\bkmkend _Toc358532155}
{\*\bkmkend _Toc365655303}{\*\bkmkend _Toc382909299}{\*\bkmkend _Toc382911210}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 The following SMB messages may be exchanged by CIFS clients and servers if the "{\f11\fs18 PC NETWORK PROGRAM 1.0"} dialect is negotiated:
\par \trowd \trgaph108\trleft-108 \cellx4500\cellx9000 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_CREATE_DIRECTORY\cell SMB_COM_DELETE_DIRECTORY\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd 
\trgaph108\trleft-108 \cellx4500\cellx9000 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_OPEN\cell SMB_COM_CREATE\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_CLOSE\cell SMB_COM_FLUSH\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_DELETE\cell 
SMB_COM_RENAME\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_QUERY_INFORMATION\cell SMB_COM_SET_INFORMATION\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_READ\cell SMB_COM_WRITE\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
SMB_COM_LOCK_BYTE_RANGE\cell SMB_COM_UNLOCK_BYTE_RANGE\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_CREATE_TEMPORARY\cell SMB_COM_CREATE_NEW\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_CHECK_DIRECTORY\cell SMB_COM_PROCESS_EXIT\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_SEEK\cell SMB_COM_TREE_CONNECT\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_TREE_DISCONNECT
\cell SMB_COM_NEGOTIATE\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_QUERY_INFORMATION_DISK\cell SMB_COM_SEARCH\cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_OPEN_PRINT_FILE\cell SMB_COM_WRITE_PRINT_FILE\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft-108 \cellx4500\cellx9000 \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_CLOSE_PRINT_FILE\cell SMB_COM_GET_PRINT_QUEUE\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par If the "{\f11\fs18 LANMAN 1.0"} dialect is negotiated, all of the messages in the previous list must be supported.  Clients negotiating {\f11\fs18 LANMAN 1.0}
 and higher dialects will probably no longer send SMB_COM_PROCESS_EXIT, and the response format for SMB_COM_NEGOTIATE is modified as well.  New messages introduced with the {\f11\fs18 LANMAN 1.0} dialect are:
\par 
\par \trowd \trgaph108\trleft-108 \cellx4320\cellx9000 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_LOCK_AND_READ\cell SMB_COM_WRITE_AND_UNLOCK\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd 
\trgaph108\trleft-108 \cellx4320\cellx9000 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_READ_RAW\cell SMB_COM_READ_MPX\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_WRITE_MPX\cell SMB_COM_WRITE_RAW\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_WRITE_COMPLETE
\cell SMB_COM_WRITE_MPX_SECONDARY\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_SET_INFORMATION2\cell SMB_COM_QUERY_INFORMATION2\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_LOCKING_ANDX\cell SMB_COM_TRANSACTION\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_TRANSACTION_SECONDARY\cell SMB_COM_IOCTL\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
SMB_COM_IOCTL_SECONDARY\cell SMB_COM_COPY\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_MOVE\cell SMB_COM_ECHO\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_WRITE_AND_CLOSE\cell SMB_COM_OPEN_ANDX\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_READ_ANDX\cell SMB_COM_WRITE_ANDX\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
SMB_COM_SESSION_SETUP_ANDX\cell SMB_COM_TREE_CONNECT_ANDX\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_FIND\cell SMB_COM_FIND_UNIQUE\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft-108 \cellx4320\cellx9000 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_FIND_CLOSE\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard 
\sa240\widctlpar\tx576 
\par The "{\f11\fs18 LM1.2X002"} dialect introduces these new SMBs:
\par \trowd \trgaph108\trleft-108 \cellx4320\cellx9000 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_TRANSACTION2\cell SMB_COM_TRANSACTION2_SECONDARY\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd 
\trgaph108\trleft-108 \cellx4320\cellx9000 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_FIND_CLOSE2\cell SMB_COM_LOGOFF_ANDX\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 

\par {\f11\fs18 "NT LM 0.12"} dialect introduces:
\par \trowd \trgaph108\trleft-108 \cellx4320\cellx9000 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_NT_TRANSACT\cell SMB_COM_NT_TRANSACT_SECONDARY\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd 
\trgaph108\trleft-108 \cellx4320\cellx9000 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_NT_CREATE_ANDX\cell SMB_COM_NT_CANCEL\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_NT_RENAME\cell SMB_COM_READ_BULK\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft-108 \cellx4320\cellx9000 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_WRITE_BULK\cell SMB_COM_WRITE_BULK_DATA\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s1\fi-432\li432\sb240\sa60\keepn\widctlpar\tx432\tx576 \b\f5\fs32\kerning28 {\b0 
{\*\bkmkstart _Toc365655304}{\*\bkmkend _Toc358532154}4\tab  }{\*\bkmkstart _Toc382909300}{\*\bkmkstart _Toc382911211}SMB Requests{\*\bkmkend _Toc365655304}{\*\bkmkend _Toc382909300}{\*\bkmkend _Toc382911211}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 
This section lists the "best practice" SMB requests -- ones that would permit a client to exercise full CIFS functionality and optimum performance when interoperating with a server speaking the latest dialect as of this writing ("NT LM 0.12"). 
\par Note that, as of this 
writing, no existing client restricts itself to only these requests, so no useful server can be written that supports just them. The classification is provided so that future clients will be written to permit future servers to be simpler.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc365655305}4.1\tab  }{\*\bkmkstart _Toc382909301}{\*\bkmkstart _Toc382911212}Session Requests{\*\bkmkend _Toc365655305}{\*\bkmkend _Toc382909301}
{\*\bkmkend _Toc382911212}
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc358532156}{\*\bkmkstart _Toc365655306}4.1.1\tab  }{\*\bkmkstart _Toc382909302}{\*\bkmkstart _Toc382911213}
NEGOTIATE: Negotiate Protocol{\*\bkmkend _Toc358532156}{\*\bkmkend _Toc365655306}{\*\bkmkend _Toc382909302}{\*\bkmkend _Toc382911213}
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4320\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ============================\cell Description\line 
=======================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4320\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes; min = 2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 struct \{
\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \tab UCHAR BufferFormat;\cell 0x02 -- Dialect\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \tab UCHAR DialectName[];\cell ASCII null-terminated string\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4320\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
\} Dialects[];\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 {\f11\fs18 
\par }
The Client sends a list of dialects that it can communicate with.  The response is a selection of one of those dialects (numbered 0 through n) or -1 (hex FFFF) indicating that none of the dialects were acceptable.  The negotiate message is binding on the 
virtual circuit and must be sent.  One and only one negotiate message may be sent, subsequent negotiate requests will be rejected with an error response and no action will be taken.
\par The protocol does not impose any particular structure to the dialect strings.  Implementers of particular protocols may choose to include, for example, version numbers in the string.
\par If the server does not understand any of the dialect strings, or if {\f11\fs18 PC NETWORK PROGRAM 1.0} is the chosen dialect, the response format is
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4320\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ============================\cell Description\line 
=======================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4320\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 1\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DialectIndex;\cell Index of selected dialect\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \cellx4320\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell 
Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par \pard \sa240\keepn\widctlpar\tx576 If the chosen dialect is greater than core up to and including {\f11\fs18 LANMAN2.1}, the protocol response format is
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4320\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ============================\cell Description\line 
=======================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4320\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 13\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT  DialectIndex;\cell Index of selected dialect\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT  SecurityMode;\cell Security mode:\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell bit 0: 0 = share, 1 = user\cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell bit 1: 1 = use challenge/response authentication\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT  MaxBufferSize;\cell Max transmit buffer size (>= 1024)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT  MaxMpxCount;\cell Max pending multiplexed requests\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT  MaxNumberVcs;\cell Max VCs between client and server
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT  RawMode; \cell Raw modes supported:\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell  bit 0: 1 = Read Raw supported\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell 
 bit 1: 1 = Write Raw supported\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG SessionKey;\cell Unique token identifying this session\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_TIME ServerTime;\cell Current time at server\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_DATE ServerDate;\cell Current date at server\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT ServerTimeZone;\cell Current time zone at server\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT  EncryptionKeyLength;\cell MBZ if this is not LM2.1\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT  Reserved;\cell MBZ\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT  ByteCount \cell Count of data bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR EncryptionKey[];
\cell The challenge encryption key\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4320\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING PrimaryDomain[];\cell The server's primary domain\cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \pard \sa240\widctlpar\tx576 {\i 
\par MaxBufferSize} is the size of the largest message which the client can legitimately send to the server
\par If  {\i bit0} of the {\i Flags} field is set in the negotiate response, this indicates the server supports the SMB_COM_LOCK_AND_READ and SMB_COM_WRITE_AND_UNLOCK client requests.
\par If the {\i SecurityMode} field indicates the server is running in {\i user mode}, the client must send appropriate SMB_COM_SESSION_SETUP_ANDX requests before the server will allow the client to access resources.   If the {\i SecurityMode}
 fields indicates the client should use challenge/response authentication, the client should use the authentication mechanism specified in section 2.10.
\par Clients should submit no more than {\i MaxMpxCount} distinct unanswered SMBs to the server when using multiplexed reads or writes (see sections {\field{\*\fldinst  REF _Ref363022514 \\n }{\fldrslt 5.13}} and {\field{\*\fldinst  REF _Ref363022529 \\n 
}{\fldrslt 5.25}})
\par Clients using the  {\f11\fs18 "MICROSOFT NETWORKS 1.03"} dialect use a different form of raw reads than documented here, and servers are better off setting {\i RawMode} in this response to 0 for such sessions.
\par If the negotiated dialect is "{\f11\fs18 DOS LANMAN2.1}" or "{\f11\fs18 LANMAN2.1"}, then {\i PrimaryDomain} string should be included in this response.
\par If the negotiated dialect is {\f11\fs18 NT LM 0.12}, the response format is
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx3960\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==========================\cell Description\line 
=========================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3960\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 17\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DialectIndex;\cell Index of selected dialect\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UCHAR SecurityMode;\cell Security mode:\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell bit 0: 0 = share, 1 = user\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell bit 1: 1 = encrypt passwords\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT MaxMpxCount;\cell Max pending multiplexed requests\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT MaxNumberVcs;\cell Max VCs between client and server
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG MaxBufferSize;\cell Max transmit buffer size\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG MaxRawSize;\cell Maximum raw buffer size\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
ULONG SessionKey;\cell Unique token identifying this session\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Capabilities;\cell Server capabilities\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG SystemTimeLow;\cell System (UTC) time of the server (low).\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG SystemTimeHigh;\cell System (UTC) time of the server (high).\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ServerTimeZone;\cell Time zone of server (min from UTC)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UCHAR EncryptionKeyLength;\cell Length of encryption key.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR EncryptionKey[];\cell The challenge encryption key\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl
\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3960\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR OemDomainName[];\cell The name of the domain (in OEM chars)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par In addition to the definitions above, {\i MaxBufferSize} is the size of the largest message which the client can legitimately send to the server.  If the client is using a connectionless protocol,  {\i MaxBufferSize}
 must be set to the smaller of the server's internal buffer size and the amount of data which can be placed in a response packet.
\par {\i MaxRawSize} specifies the maximum message size the server can send or receive for SMB_COM_WRITE_RAW or SMB_COM_READ_RAW.
\par Connectionless clients must set {\i Sid} to 0 in the SMB request header.
\par \pard \sa240\keepn\widctlpar\tx576 {\i Capabilities} allows the server to tell the client what it supports.  The bit definitions are:
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx3150\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4590\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 
\cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Capability Name\line ====================\cell Encoding\line ========\cell Meaning\line =====================================\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3150\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4590\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 CAP_RAW_MODE\cell 0x0001\cell The server supports SMB_COM_READ_RAW and SMB_COM_WRITE_RAW\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 CAP_MPX_MODE\cell 0x0002\cell The server supports SMB_COM_READ_MPX and SMB_COM_WRITE_MPX\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 CAP_UNICODE\cell 0x0004\cell The server supports Unicode strings\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
CAP_LARGE_FILES\cell 0x0008\cell The server supports large files with 64 bit offsets\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 CAP_NT_SMBS\cell 0x0010\cell 
The server supports the SMBs particular to the {\f11\fs18 NT LM 0.12} dialect\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 CAP_RPC_REMOTE_APIS\cell 0x0020\cell 
The sever supports remote API requests via RPC\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 CAP_STATUS32\cell 0x0040\cell 
The server can respond with 32 bit status codes in Status.Status\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 CAP_LEVEL_II_OPLOCKS\cell 0x0080\cell 
The server supports level 2 oplocks\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 CAP_LOCK_AND_READ\cell 0x0100\cell The server supports the SMB_COM_LOCK_AND_READ SMB
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 CAP_NT_FIND\cell 0x0200\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl
\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3150\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4590\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\cf1 CAP_DFS\cell 0x1000\cell This server is DFS aware\cell }\pard\plain \widctlpar\intbl \f4\fs20 
\row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3150\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4590\clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\cf1 \cell \cell \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\cf1 
\row }\pard \sa240\widctlpar\tx576 {\*\bkmkstart _Toc358532157}
\par \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 4.1.1.1\tab Errors
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 SUCCESS/SUCCESS\line ERRSRV/ERRerror
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655307}4.1.2\tab  }{\*\bkmkstart _Toc382909303}{\*\bkmkstart _Toc382911214}SESSION_SETUP_ANDX: Session Setup
{\*\bkmkend _Toc358532157}{\*\bkmkend _Toc365655307}{\*\bkmkend _Toc382909303}{\*\bkmkend _Toc382911214}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 This SMB is used to further "Set up" the session normally just established via the negotiate protocol.
\par One primary function is to perform a "user logon" in the case where the server is in {\i user level} security mode.  The {\i Uid} in the SMB header is set by the client to be the userid desired for the {\i AccountName} and validated by the {\i 
AccountPassword}.
\par \pard \sa240\keepn\widctlpar\tx576 If the negotiated protocol is prior to {\f11\fs18 NT LM 0.12}, the format of SMB_COM_SESSION_SETUP_ANDX is:
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4590\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==============================\cell Description
\line =====================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4590\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170
 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 10\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR AndXCommand;\cell Secondary (X) command; 0xFF = none\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UCHAR AndXReserved;\cell Reserved (must be 0)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT AndXOffset;\cell Offset to next command WordCount\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT MaxBufferSize;\cell Client maximum buffer size\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT MaxMpxCount;\cell Actual maximum multiplexed pending requests\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 USHORT VcNumber;\cell 0 = first (only), nonzero=additional VC number\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG SessionKey;\cell 
Session key (valid iff VcNumber != 0)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT PasswordLength;\cell Account password size\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Reserved;\cell Must be 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes;    min = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UCHAR AccountPassword[];\cell Account Password\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING AccountName[];\cell Account Name\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING PrimaryDomain[];\cell Client's primary domain\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING NativeOS[];\cell Client's native operating system\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \cellx4590\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING NativeLanMan[];\cell 
Client's native LAN Manager type\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par and the response is:
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 3\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR AndXCommand;\cell Secondary (X) command;  0xFF = none\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UCHAR AndXReserved;\cell Reserved (must be 0)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT AndXOffset;\cell Offset to next command WordCount\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Action;\cell Request mode:\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell bit0 = logged in as GUEST\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell 
Count of data bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING NativeOS[];\cell Server's native operating system\cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING NativeLanMan[];\cell Server's native LAN Manager type\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 STRING PrimaryDomain[];\cell Server's primary domain\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par If the server is in "share level security mode", the account name and passwd should be ignored by the server.
\par If challenge/response authentication is not being used, {\i AccountPassword} should be a null terminated ASCII string with {\i PasswordLength}
 set to the string size including the null; the password will case insensitive. If challenge/response authentication is being used (see section {\field{\*\fldinst  REF _Ref363023135 \\n }{\fldrslt 2.10}}), then {\i AccountPassword}
 will be the response to the server's challenge, and {\i PasswordLength} should be set to its length.
\par The server validates the name and password supplied and if valid, it registers the user identifier on this session as representing the specified {\i AccountName}.  The {\i Uid}
  field in the SMB header will then be used to validate access on subsequent SMB requests.  The SMB requests where permission checks are required are those which refer to a symbolically named resource such as SMB_COM_OPEN, SMB_COM_RENAME, SMB_COM_DELETE, 
etc..  The value of the {\i Uid} is relative to a specific client/server session so it is possible to have the same {\i Uid} value represent two different users on two dif\-ferent sessions at the server.
\par Multiple session setup commands may be sent to register additional users on this session.  If the server receives an additional SMB_COM_SESSION_SETUP_ANDX, only the {\i Uid}, {\i AccountName} and {\i AccountPassword}
 fields need contain valid values (the server MUST ignore the other fields).
\par The client writes the name of its domain in {\i PrimaryDomain} if it knows what the domain name is.  If the domain name is unknown, the client either encodes it as a NULL string, or as a question mark.
\par If {\i bit0} of {\i Action} is set, this informs the client that although the server did not recognize the {\i AccountName}
, it logged the user in as a guest.  This is optional behavior by the server, and in any case one would ordinarily expect guest privileges to limited.
\par Another function of the Session Set Up protocol is to inform the server of the maximum values which will be utilized by this client.  Here {\i MaxBufferSize} is the maximum message size which t
he client can receive.  Thus although the server may support 16k buffers (as returned in the SMB_COM_NEGOTIATE response), if the client only has 4k buffers, the value of {\i MaxBufferSize} here would be 4096.  The minimum allowable value for {\i 
MaxBufferSize}
 is 1024.  The SMB_COM_NEGOTIATE response includes the server buffer size supported.  Thus this is the maximum SMB message size which the client can send to the server.  This size may be larger than the size returned to the server from the client via the 
SMB_COM_SESSION_SETUP_AND X proto\-
col which is the maximum SMB message size which the server may send to the client.  Thus if the server's buffer size were 4k and the client's buffer size were only 2K,  the client could send up to 4k (standard) write requests bu
t must only request up to 2k for (standard) read requests.
\par The field, {\i MaxMpxCount} informs the server of the maximum number of requests which the client will have outstanding to the server simultaneously (see sections {\field{\*\fldinst  REF _Ref363023468 \\n }{\fldrslt 5.13}} and {\field{\*\fldinst  REF _
Ref363023460 \\n }{\fldrslt 5.25}}).
\par The {\i VcNumber} field specifies whether the client wants this to be the first VC or an additional VC.
\par The values for {\i MaxBufferSize}, {\i MaxMpxCount}, and {\i VcNumber} must be less than or equal to the maximum values supported by the server as returned in the SMB_COM_NEGOTIATE response.
\par If the server gets a SMB_COM_SESSION_SETUP_ANDX request with {\i VcNumber} of 0 and other VCs are still connected to that client, they will be aborted thus freeing any resources held by the server.  This condition co
uld occur if the client was rebooted and reconnected to the server before the transport level had informed the server of the previous VC termination.
\par If the negotiated SMB dialect is "{\f11\fs18 NT LM 0.12"} or later, the format of the response SMB is unchanged, but the request is:
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4590\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==============================\cell Description
\line =====================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4590\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170
 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 13\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR AndXCommand;\cell Secondary (X) command;  0xFF = none\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UCHAR AndXReserved;\cell Reserved (must be 0)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT AndXOffset;\cell Offset to next command WordCount\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT MaxBufferSize;\cell Client's maximum buffer size\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT MaxMpxCount;\cell Actual maximum multiplexed pending requests\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 USHORT VcNumber;\cell 0 = first (only), nonzero=additional VC number\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG SessionKey;\cell 
Session key (valid iff VcNumber != 0)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT CaseInsensitivePasswordLength;\cell Account password size, ANSI\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT CaseSensitivePasswordLength;\cell Account password size, Unicode\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Reserved;\cell must be 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
ULONG Capabilities;\cell Client capabilities\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes;    min = 0\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR CaseInsensitivePassword[];\cell Account Password, ANSI\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR CaseSensitivePassword[];\cell Account Password, Unicode\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING AccountName[];\cell Account Name, Unicode\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
STRING PrimaryDomain[];\cell Client's primary domain, Unicode\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING NativeOS[];\cell 
Client's native operating system, Unicode\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4590\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING NativeLanMan[];\cell Client's native LAN Manager type, Unicode\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par \pard \sa240\keepn\widctlpar\tx576 The client expresses its capabilities to the server encoded in the {\i Capabilities} field:
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx3780\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5310\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 
\cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Capability Name\line ========================\cell Encoding\line =========\cell Description\line ================================\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3780\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5310\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 CAP_UNICODE\cell 0x0004\cell The client can use UNICODE strings\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 CAP_LARGE_FILES\cell 0x0008\cell The client can deal with files having 64 bit offsets\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 CAP_NT_SMBS\cell 0x0010\cell The client understands the SMBs introduced with the {\f11\fs18 NT LM 0.12} dialect.  Implies CAP_NT_FIND.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\caps CAP_NT_FIND}\cell 0x0200\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
CAP_ STATUS32\cell 0x0040\cell The client can receive 32 bit errors encoded in {\i Status.Status}\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \cellx3780\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5310\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 CAP_LEVEL_II_OPLOCKS\cell 0x0080\cell The client understands Level II oplocks\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par The entire message sent and received including the optional ANDX SMB must fit in the negotiated maximum transfer size.  The following are the only valid SMB commands for {\i AndXCommand} for SMB_COM_SESSION_SETUP_ANDX
\par \trowd \trgaph108\trleft-108 \cellx4320\cellx8748 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_TREE_CONNECT_ANDX\cell SMB_COM_OPEN\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd 
\trgaph108\trleft-108 \cellx4320\cellx8748 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_OPEN_ANDX\cell SMB_COM_CREATE\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_CREATE_NEW\cell SMB_COM_CREATE_DIRECTORY\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_DELETE
\cell SMB_COM_DELETE_DIRECTORY\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_FIND\cell SMB_COM_FIND_UNIQUE\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_COPY\cell SMB_COM_RENAME\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
SMB_COM_NT_RENAME\cell SMB_COM_CHECK_DIRECTORY\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_QUERY_INFORMATION\cell SMB_COM_SET_INFORMATION\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_NO_ANDX_COMMAND\cell SMB_COM_OPEN_PRINT_FILE\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_GET_PRINT_QUEUE\cell SMB_COM_TRANSACTION\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft-108 \cellx4320\cellx8748 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\*\bkmkstart _Toc358532158}4.1.2.1\tab Errors
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 ERRSRV/ERRerror\tab - no NEG_PROT issued\line ERRSRV/ERRbadpw\tab - password not correct for given username\line ERRSRV/ERRtoomanyuids\tab - maximum number of users per session exceeded\line ERRSRV/ERRnosupport
\tab - chaining of this request to the previous one is not supported
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655308}4.1.3\tab  }{\*\bkmkstart _Toc382909304}{\*\bkmkstart _Toc382911215}LOGOFF_ANDX: User Logoff{\*\bkmkend _Toc358532158}
{\*\bkmkend _Toc365655308}{\*\bkmkend _Toc382909304}{\*\bkmkend _Toc382911215}
\par \pard\plain \sa240\keepn\widctlpar\tx576 \f4\fs20 This SMB is the inverse of SMB_COM_SESSION_SETUP_ANDX.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR AndXCommand;\cell Secondary (X) command;  0xFF = none\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UCHAR AndXReserved;\cell Reserved (must be 0)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT AndXOffset;\cell Offset to next command WordCount\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR AndXCommand;\cell Secondary (X) command;  0xFF = none\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UCHAR AndXReserved;\cell Reserved (must be 0)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT AndXOffset;\cell Offset to next command WordCount\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par The user represented by {\i Uid} in the SMB header is logged off.  The server closes all files currently open by this user, and invalidates any outstanding requests with this {\i Uid}.
\par SMB_COM_SESSION_SETUP_ANDX is the only valid {\i AndXCommand}. for this SMB.
\par \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\*\bkmkstart _Toc358532160}4.1.3.1\tab Errors
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 ERRSRV/invnid\tab - TID was invalid\line ERRSRV/baduid\tab - UID was invalid
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Ref365634416}{\*\bkmkstart _Toc365655309}4.1.4\tab  }{\*\bkmkstart _Toc382909305}{\*\bkmkstart _Toc382911216}
TREE_CONNECT_ANDX:  Tree Connect{\*\bkmkend _Toc358532160}{\*\bkmkend _Ref365634416}{\*\bkmkend _Toc365655309}{\*\bkmkend _Toc382909305}{\*\bkmkend _Toc382911216}
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5040\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line =================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5040\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 4\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR AndXCommand;\cell Secondary (X) command; 0xFF = none\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UCHAR AndXReserved;\cell Reserved (must be 0)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT AndXOffset;\cell Offset to next command WordCount\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Flags;\cell Additional information\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell bit 0 set = disconnect Tid\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT PasswordLength;\cell 
Length of Password[]\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes;    min = 3\cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Password[];\cell Password\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 STRING Path[];\cell Server name and share name\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5040\clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING Service[];\cell Service name\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par The serving machine verifies the combination and returns an error code or an identifier.  The full name is included in this request message and the identifier identifying the connection is returned in the {\i Tid} field of the SMB header.  The {\i Tid}
 field in the client request is ignored.  The meaning of this identifier ({\i Tid}) is server specific; the client must not associate any specific meaning to it.
\par If the negotiated dialect is LANMAN1.0 or later, then it is a protocol violation for the client to send this message prior to a successful SMB_COM_SESSION_SETUP_ANDX, and the server ignores {\i Password}.
\par If the negotiated dialect is prior to LANMAN1.0 and the client has not sent a successful SMB_COM_SESSION_SETUP_ANDX request when the tree connect arrives, a user level security mode server must nevertheless validate the client's credentials as discussed e
arlier in this document.
\par {\i Path} follows UNC style syntax, that is to say it is encoded as \\\\server\\share and it indicates the name of the resource to which the client wishes to connect.
\par Because {\i Password} may be an authentication response, it is a variable length field with the length specified by {\i PasswordLength}.   If authentication is not being used, {\i Password} should be a null terminated ASCII string with {\i PasswordLength}
 set to the string size including the terminating null.
\par The server can enforce whatever policy it desires to govern share access. Typically, if the server is paused, administrative privilege is required
 to connect to any share; if the server is not paused, administrative privilege is required only for administrative shares (C$, etc.). Other such policies may include valid times of day, software usage license limits, number of simultaneous server users o
r share users, etc.
\par The Service component indicates the type of resource the client intends to access.  Valid values are:
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx1440\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 
\cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Service\line ========\cell Description\line ========================\cell Earliest Dialect Allowed\line ================================\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx1440\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 A:\cell disk share\cell {\f11\fs18 PC NETWORK PROGRAM 1.0}\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LPT1:\cell printer\cell {\f11\fs18 PC NETWORK PROGRAM 1.0}\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 IPC
\cell named pipe\cell {\f11\fs18 MICROSOFT NETWORKS 3.0}\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 COMM\cell communications device\cell {\f11\fs18 
MICROSOFT NETWORKS 3.0}\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx1440\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 
\clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ?????\cell 
any type of device\cell {\f11\fs18 MICROSOFT NETWORKS 3.0}\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par If {\i bit0} of {\i Flags} is set, the tree connection to {\i Tid} in the SMB header should be disconnected.  If this tree disconnect fails, the error should be ignored.
\par If the negotiated dialect is earlier than DOS {\f11\fs18 LANMAN2.1}, the response to this SMB is:
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4860\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ================================\cell Description
\line ===================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR AndXCommand;\cell Secondary (X) command;  0xFF = none\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UCHAR AndXReserved;\cell Reserved (must be 0)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT AndXOffset;\cell Offset to next command WordCount\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes;    min = 3\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par If the negotiated is DOS {\f11\fs18 LANMAN2.1} or later, the response to this SMB is:
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4860\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ================================\cell Description
\line ===================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 3\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR AndXCommand;\cell Secondary (X) command;  0xFF = none\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UCHAR AndXReserved;\cell Reserved (must be 0)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT AndXOffset;\cell Offset to next command WordCount\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT OptionalSupport;\cell Optional support bits\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes;    min = 3\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UCHAR Service[];\cell Service type connected to.  Always ANSII.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING NativeFileSystem[];\cell Native file system for this tree\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par {\i NativeFileSystem} is the name of the filesystem; values to be expected include FAT, NTFS, etc. 
\par {\i OptionalSupport} bits has the encoding:
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4500\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx6120\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 
\cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Name\line =============================\cell Encoding\line =========\cell Description\line ==========================\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4500\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx6120\clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\caps SMB_SUPPORT_SEARCH_BITS}{\b\i\caps\ul \cell }0x0001\cell \cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4500\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \cellx6120\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\caps SMB_SHARE_IS_IN_DFS}
\cell 0x0002\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par Some servers negotiate "DOS LANMAN2.1" dialect or later and still send the "downlevel" (i.e. wordcount==2) response.  Valid AndX following commands are
\par \trowd \trgaph108\trleft-108 \cellx3690\cellx7650\cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_OPEN\cell SMB_COM_OPEN_ANDX\cell SMB_COM_CREATE\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\trowd \trgaph108\trleft-108 \cellx3690\cellx7650\cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_CREATE_NEW\cell SMB_COM_CREATE_DIRECTORY\cell SMB_COM_DELETE\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_DELETE_DIRECTORY\cell SMB_COM_FIND\cell SMB_COM_COPY\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_FIND_UNIQUE\cell SMB_COM_RENAME\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
SMB_COM_CHECK_DIRECTORY\cell SMB_COM_QUERY_INFORMATION\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_GET_PRINT_QUEUE\cell SMB_COM_OPEN_PRINT_FILE\cell 
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_TRANSACTION\cell SMB_COM_NO_ANDX_CMD\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd 
\trgaph108\trleft-108 \cellx3690\cellx7650\cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_SET_INFORMATION\cell SMB_COM_NT_RENAME\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\*\bkmkstart _Toc358532161}4.1.4.1\tab Errors
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 ERRDOS/ERRnomem\line ERRDOS/ERRbadpath\line ERRDOS/ERRinvdevice\line ERRSRV/ERRaccess\line ERRSRV/ERRbadpw\line ERRSRV/ERRinvnetname
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655310}4.1.5\tab  }{\*\bkmkstart _Toc382909306}{\*\bkmkstart _Toc382911217}TREE_DISCONNECT:  Tree Disconnect
{\*\bkmkend _Toc358532161}{\*\bkmkend _Toc365655310}{\*\bkmkend _Toc382909306}{\*\bkmkend _Toc382911217}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 This message informs the server that the client no longer wishes to access the resource connected to with a prior SMB_COM_TREE_CONNECT or SMB_COM_TREE_CONNECT_ANDX.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par The resource sharing connection identified by {\i Tid} in the SMB header is logically disconnected from the server. {\i Tid}
 is invalidated; it will not be recognized if used by the client for subsequent requests. All locks, open files, etc. created on behalf of {\i Tid} are released.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\*\bkmkstart _Toc358532233}{\*\bkmkstart _Toc358532182}{\*\bkmkstart _Toc358532251}
{\*\bkmkstart _Toc358532201}{\*\bkmkstart _Toc358532245}{\*\bkmkstart _Toc358532163}4.1.5.1\tab Errors
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 ERRSRV/ERRinvnid\line ERRSRV/ERRbaduid
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655311}4.1.6\tab  }{\*\bkmkstart _Toc382909307}{\*\bkmkstart _Toc382911218}TRANS2_QUERY_FS_INFORMATION{\*\bkmkend _Toc358532233}
: Get File System Information{\*\bkmkend _Toc365655311}{\*\bkmkend _Toc382909307}{\*\bkmkend _Toc382911218}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 This transaction requests information about a filesystem on the server.
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell 
Value\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 WordCount;\cell 15\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
TotalParameterCount;\cell 2 or 4\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 MaxSetupCount;\cell 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SetupCount;\cell 1 or 2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Setup[0];\cell 
TRANS2_QUERY_FS_INFORMATION \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt
\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell \cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
Parameter Block Encoding\line ==================================\cell Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl
\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Information Level;\cell Level of information requested\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576\tx1440\tx2880\tx4320 
\par \pard \fi-1440\li1440\sa240\widctlpar\tx576\tx1440\tx2880\tx4320 The  filesystem is identified by {\i Tid} in the SMB header.
\par \pard \sa240\widctlpar\tx576\tx1440\tx2880\tx4320 {\i MaxDataCount} in the transaction request must be large enough to accommodate the response.
\par \pard \sa240\widctlpar\tx576 The encoding of the response parameter block depends on the {\i InformationLevel} requested.  {\kerning28 Information levels whose values are greater than 0x102 are mapped to corresponding calls to }{\f11\fs18\kerning28 
NtQueryVolumeInformationFile}{\kerning28  calls by the server.  The two levels below 0x102 are described below.  The requested information is placed in the }{\i\kerning28 Data}{\kerning28  portion of the transaction response.
\par }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4590\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5805 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 InformationLevel\line \line =============================\cell 
Value\line \line ======\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4590\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5805 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_INFO_ALLOCATION\cell 1\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
SMB_INFO_VOLUME\cell 2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_QUERY_FS_VOLUME_INFO\cell 0x102\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_QUERY_FS_SIZE_INFO\cell 0x103\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
SMB_QUERY_FS_DEVICE_INFO\cell 0x104\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4590\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5805 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_QUERY_FS_ATTRIBUTE_INFO\cell 0x105\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard 
\sa240\widctlpar\tx576 {\kerning28 
\par }The following sections describe the {\i InformationLevel} dependent encoding of the data part of the transaction response.
\par \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\*\bkmkstart _Toc358532234}4.1.6.1\tab SMB_INFO_ALLOCATION{\*\bkmkend _Toc358532234}
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx3060\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Data Block Encoding\line ===================\cell Description
\line ================================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3060\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG idFileSystem;\cell File system identifier.  NT server always returns 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG cSectorUnit;\cell Number of sectors per allocation unit\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG cUnit;\cell Total number of allocation units\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
ULONG cUnitAvail;\cell Total number of available allocation units\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3060\clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT cbSector;\cell Number of bytes per sector\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\*\bkmkstart _Toc358532235}4.1.6.2\tab SMB_INFO_VOLUME{\*\bkmkend _Toc358532235}
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx3060\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Data Block Encoding\line ===================\cell Description
\line ================================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3060\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG ulVsn;\cell Volume serial number\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR cch;\cell Number of  characters in Label\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \cellx3060\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING Label;\cell 
The volume label\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\*\bkmkend _Toc358532182}4.1.6.3\tab SMB_QUERY_FS_VOLUME_INFO
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx3060\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Data Block Encoding\line ===================\cell Description
\line ================================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3060\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LARGE_INTEGER\cell Volume Creation Time\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG\cell Volume Serial Number\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 
\cellx3060\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG\cell Length of Volume Label in bytes\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 BYTE\cell Reserved\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 BYTE\cell Reserved\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3060
\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING Label;\cell The volume label\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par 
\par \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 4.1.6.4\tab SMB_QUERY_FS_SIZE_INFO
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx3060\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Data Block Encoding
\par ===================\cell Description\line ================================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3060\clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LARGE_INTEGER\cell Total Number of Allocation units on the Volume\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LARGE_INTEGER\cell Number of free Allocation units on the Volume\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl
\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3060\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG\cell Number of sectors in each Allocation unit\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \cellx3060\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG\cell 
Number of bytes in each sector\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 4.1.6.5\tab SMB_QUERY_FS_DEVICE_INFO
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx3240\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Data Block Encoding\line ====================\cell 
Value\line ===============================================\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3240\clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 ULONG\cell DeviceType; Values as specified below\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row 
}\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3240\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 {\kerning28 ULONG\cell Characteristics of the device; Values as specified below\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard \sa240\widctlpar\tx576 {\f11 
\par For DeviceType, note that the values 0-32767 are reserved for the exclusive use of Microsoft Corporation. The following device types are currently defined:
\par }
\par \trowd \trgaph108\trleft-108\trbrdrt\brdrs\brdrw30\brdrcf11 \trbrdrb\brdrs\brdrw30\brdrcf11 \clbrdrt\brdrs\brdrw30\brdrcf11 \clbrdrb\brdrs\brdrw15\brdrcf11 \cellx4189\clbrdrt\brdrs\brdrw30\brdrcf11 \clbrdrb\brdrs\brdrw15\brdrcf11 \cellx5966 \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_BEEP\cell 0x00000001\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft-108\trbrdrt\brdrs\brdrw30\brdrcf11 \trbrdrb\brdrs\brdrw30\brdrcf11 
\cellx4189\cellx5966 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_CD_ROM\cell 0x00000002\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_CD_ROM_FILE_SYSTEM\cell 0x00000003\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
FILE_DEVICE_CONTROLLER\cell 0x00000004\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_DATALINK\cell 0x00000005\cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_DFS\cell 0x00000006\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 FILE_DEVICE_DISK\cell 0x00000007\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_DISK_FILE_SYSTEM\cell 0x00000008\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_FILE_SYSTEM\cell 0x00000009\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_INPORT_PORT\cell 0x0000000a\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_KEYBOARD\cell 
0x0000000b\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_MAILSLOT\cell 0x0000000c\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_MIDI_IN\cell 0x0000000d\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
FILE_DEVICE_MIDI_OUT\cell 0x0000000e\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_MOUSE\cell 0x0000000f\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_MULTI_UNC_PROVIDER\cell 0x00000010\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_NAMED_PIPE\cell 0x00000011\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_NETWORK\cell 
0x00000012\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_NETWORK_BROWSER\cell 0x00000013\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_NETWORK_FILE_SYSTEM\cell 0x00000014\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 FILE_DEVICE_NULL\cell 0x00000015\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_PARALLEL_PORT\cell 0x00000016\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_PHYSICAL_NETCARD\cell 0x00000017\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_PRINTER\cell 0x00000018\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_SCANNER\cell 
0x00000019\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_SERIAL_MOUSE_PORT\cell 0x0000001a\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_SERIAL_PORT\cell 0x0000001b\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
FILE_DEVICE_SCREEN\cell 0x0000001c\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_SOUND\cell 0x0000001d\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_STREAMS\cell 0x0000001e\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 FILE_DEVICE_TAPE\cell 0x0000001f\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_TAPE_FILE_SYSTEM\cell 0x00000020\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_TRANSPORT\cell 0x00000021\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_UNKNOWN\cell 0x00000022\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_VIDEO\cell 
0x00000023\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_VIRTUAL_DISK\cell 0x00000024\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_WAVE_IN\cell 0x00000025\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
FILE_DEVICE_WAVE_OUT\cell 0x00000026\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_8042_PORT\cell 0x00000027\cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_NETWORK_REDIRECTOR\cell 0x00000028\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_BATTERY\cell 0x00000029\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_BUS_EXTENDER\cell 
0x0000002a\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_MODEM\cell 0x0000002b\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft-108
\trbrdrt\brdrs\brdrw30\brdrcf11 \trbrdrb\brdrs\brdrw30\brdrcf11 \clbrdrb\brdrs\brdrw30\brdrcf11 \cellx4189\clbrdrb\brdrs\brdrw30\brdrcf11 \cellx5966 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_DEVICE_VDM
\cell 0x0000002c\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 {\f11 \tab 
\par }{\i\f11 
Some of these device types are not currently accesible over the network and may never be accessible over the network. Some may change to be accessible over the network. The values for device types that may never be accessible over the network may be redef
ined to be just resrved at some date in the future. }{\f11 
\par }{\i\f11 Characteristics}{\f11  is the sum of any of the following:
\par }\trowd \trgaph108\trleft-108\trbrdrt\brdrs\brdrw30\brdrcf11 \trbrdrb\brdrs\brdrw30\brdrcf11 \clbrdrt\brdrs\brdrw30\brdrcf11 \cellx4189\clbrdrt\brdrs\brdrw30\brdrcf11 \cellx5966 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 FILE_REMOVABLE_MEDIA\cell 0x00000001\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft-108\trbrdrt\brdrs\brdrw30\brdrcf11 \trbrdrb\brdrs\brdrw30\brdrcf11 \cellx4189\cellx5966 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_READ_ONLY_DEVICE\cell 0x00000002\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_FLOPPY_DISKETTE\cell 
0x00000004\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_WRITE_ONE_MEDIA\cell 0x00000008\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_REMOTE_DEVICE\cell 0x00000010\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
FILE_DEVICE_IS_MOUNTED\cell 0x00000020\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft-108\trbrdrt\brdrs\brdrw30\brdrcf11 \trbrdrb\brdrs\brdrw30\brdrcf11 \clbrdrb\brdrs\brdrw30\brdrcf11 \cellx4189\clbrdrb\brdrs\brdrw30\brdrcf11 
\cellx5966 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_VIRTUAL_VOLUME\cell 0x00000040\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 {\i\f11 
\par }\pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 4.1.6.6\tab SMB_QUERY_FS_ATTRIBUTE_INFO
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx3060\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Data Block Encoding
\par ===================\cell Description\line ================================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3060\clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG\cell File System Attributes; possible values described below\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LONG\cell Maximum length of each file name component in number of bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl
\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3060\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG\cell Length, in bytes, of the name of the file system\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 
\clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3060\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING\cell 
Name of the file system\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 {\f11 
\par Where }{\i\f11 FileSystemAttributes}{\f11  is the sum of any of the following:
\par }\trowd \trgaph108\trleft-108\trbrdrt\brdrs\brdrw30\brdrcf11 \trbrdrb\brdrs\brdrw30\brdrcf11 \clbrdrt\brdrs\brdrw30\brdrcf11 \cellx4189\clbrdrt\brdrs\brdrw30\brdrcf11 \cellx5966 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 FILE_CASE_SENSITIVE_SEARCH\cell 0x00000001\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft-108\trbrdrt\brdrs\brdrw30\brdrcf11 \trbrdrb\brdrs\brdrw30\brdrcf11 \cellx4189\cellx5966 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_CASE_PRESERVED_NAMES\cell 0x00000002\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_PRSISTENT_ACLS
\cell 0x00000004\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_FILE_COMPRESSION\cell 0x00000008\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_VOLUME_QUOTAS\cell 0x00000010\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
FILE_DEVICE_IS_MOUNTED\cell 0x00000020\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft-108\trbrdrt\brdrs\brdrw30\brdrcf11 \trbrdrb\brdrs\brdrw30\brdrcf11 \clbrdrb\brdrs\brdrw30\brdrcf11 \cellx4189\clbrdrb\brdrs\brdrw30\brdrcf11 
\cellx5966 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_VOLUME_IS_COMPRESSED\cell 0x00008000\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 4.1.6.7\tab Errors
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 ERRSRV/invnid\tab - TID was invalid\line ERRSRV/baduid\tab - UID was invalid\line ERRHRD/ERRnotready\tab - the file system has been removed\line ERRHRD/ERRdata\tab - disk I/O error\line ERRSRV/ERRaccess\tab 
- user does not have the right to perform this operation\line ERRSRV/ERRinvdevice\tab - resource identified by TID is not a file system
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655312}4.1.7\tab  }{\*\bkmkstart _Toc382909308}{\*\bkmkstart _Toc382911219}ECHO: Ping the Server{\*\bkmkend _Toc365655312}
{\*\bkmkend _Toc382909308}{\*\bkmkend _Toc382911219}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 This request is used to test the connection to the server, and to see if the server is still responding.
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell 
Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 1\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT EchoCount;\cell Number of times to echo data back\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT ByteCount;\cell Count of data bytes;    min = 1\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Buffer[1];\cell Data to echo\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell 
Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 1\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT SequenceNumber;\cell Sequence number of this echo\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT ByteCount;\cell Count of data bytes;    min = 4\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Buffer[1];\cell Echoed data\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par Each response echoes the data sent, though {\i ByteCount} may indicate no data  If {\i EchoCount} is zero, no response is sent.
\par {\i Tid} in the SMB header is ignored, so this request may be sent to the server even if there are no valid tree connections to the server.
\par The flow for the ECHO protocol is:
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5940\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line =================================\cell {\f11 <->}\line ====\cell Server Response\line 
============================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5940
\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Echo Request (EchoCount == n)\cell {\f11 ->\cell }\cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell {\f11 <-\cell }Echo Response 1\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 \cell {\f11 <-\cell }Echo Response 2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5940\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 \cell {\f11 <-\cell }Echo Response n\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\*\bkmkstart _Toc358532255}{\*\bkmkend _Toc358532251}4.1.7.1\tab Errors
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 ERRSRV/ERRbaduid\tab - UID was invalid\line ERRSRV/ERRnoaccess\tab - session has not been established\line ERRSRV/ERRnosupport\tab - ECHO function is not supported
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5\kerning28 {\*\bkmkstart _Toc365655313}4.1.8\tab  }{\kerning28 {\*\bkmkstart _Toc382909309}{\*\bkmkstart _Toc382911220}NT_CANCEL: Cancel request
{\*\bkmkend _Toc358532255}{\*\bkmkend _Toc365655313}{\*\bkmkend _Toc382909309}{\*\bkmkend _Toc382911220}
\par }\pard\plain \sa240\widctlpar\tx576 \f4\fs20 {\kerning28 This SMB allows a client to cancel a request currently pending at the server.
\par }\trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Client Request\line ==================================\cell 
Description\line =================================\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 UCHAR WordCount;\cell No words are sent (== 0)\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd 
\trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 USHORT ByteCount;\cell No bytes (==0)\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard \sa240\widctlpar\tx576 {\kerning28 
\par The }{\i\kerning28 Sid}{\kerning28 , }{\i\kerning28 Uid}{\kerning28 , }{\i\kerning28 Pid}{\kerning28 , }{\i\kerning28 Tid}{\kerning28 , and }{\i\kerning28 Mid}{\kerning28  fields of the SMB are used to locate an pending serv
er request from this session.  If a pending request is found, it is "hurried along" which may result in success or failure of the original request.  No other response is generated for this SMB.
\par }\pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc365655314}4.2\tab  }{\*\bkmkstart _Toc382909310}{\*\bkmkstart _Toc382911221}File Requests{\*\bkmkend _Toc365655314}{\*\bkmkend _Toc382909310}
{\*\bkmkend _Toc382911221}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20  
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655315}4.2.1\tab  }{\*\bkmkstart _Toc382909311}{\*\bkmkstart _Toc382911222}NT_CREATE_ANDX: Create or Open File
{\*\bkmkend _Toc358532201}{\*\bkmkend _Toc365655315}{\*\bkmkend _Toc382909311}{\*\bkmkend _Toc382911222}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 This command is used to create or open a file or a directory. 
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line =================================\cell 
Description\line ==================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 24\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR AndXCommand;\cell Secondary command;  0xFF = None\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UCHAR AndXReserved;\cell Reserved (must be 0)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT AndXOffset;\cell Offset to next command WordCount\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Reserved;\cell Reserved (must be 0)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT NameLength;\cell Length of Name[] in bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Flags;
\cell Create bit set:
\par 0x02 - Request an oplock
\par 0x04 - Request a batch oplock
\par 0x08 - Target of open must be directory\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG RootDirectoryFid;\cell If non-zero, open is relative to this directory
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ACCESS_MASK DesiredAccess;\cell access desired\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LARGE_INTEGER AllocationSize;\cell Initial allocation size\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG ExtFileAttributes;\cell File attributes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG ShareAccess;
\cell Type of share access\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG CreateDisposition;\cell Action to take if file exists or not\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG CreateOptions;\cell Options to use if creating a file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG ImpersonationLevel;\cell Security QOS information\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 UCHAR SecurityFlags;\cell Security tracking mode flags:\line 0x1 - SECURITY_CONTEXT_TRACKING\line 0x2 - SECURITY_EFFECTIVE_ONLY\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Length of byte parameters\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING Name[];\cell 
File to open or create\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par The {\i DesiredAccess} parameter is specified in section {\field{\*\fldinst  REF _Ref365636870 \\n }{\fldrslt 3.7}} on {\field{\*\fldinst  REF _Ref365636870 \\* MERGEFORMAT }{\fldrslt  Access Mask Encoding}}.
\par If no value is specified, it still allows an application to query attributes without actually accessing the file.
\par The {\i ExtFIleAttributes} parameter specifies the file attributes and flags for the file. The parameter's value is the sum of allowed attributes and flags defined in section {\field{\*\fldinst  REF _Ref365631713 \\n }{\fldrslt 3.11}} on 
{\field{\*\fldinst  REF _Ref365636964 \\* MERGEFORMAT }{\fldrslt  Extended File Attribute Encoding}}
\par The {\i ShareAccess} field Specifies how this file can be shared. This parameter must be some combination of the following values: {\fs24 
\par }\trowd \trgaph108\trleft-108 \cellx2610\cellx4320\cellx10440 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Name{\fs24 \cell }Value\cell Meaning{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row 
}\trowd \trgaph108\trleft-108 \cellx2610\cellx4320\cellx10440 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\fs24 \cell }0\cell Prevents the file from being shared.{\fs24 \cell }\pard\plain \widctlpar\intbl 
\f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_SHARE_READ{\fs24 \cell }{\f11 0x00000001}\cell Other open operations can be performed on the file for read access. {\fs24 \cell }\pard\plain 
\widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_SHARE_WRITE{\fs24 \cell }{\f11 0x00000002}\cell Other open operations can be performed on the file for write access.{\fs24 
\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\trowd \trgaph108\trleft-108 \cellx2610\cellx4320\cellx10440 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_SHARE_DELETE\cell {\f11 0x00000004\cell }
Other open operations can be performed on the file for delete access.\cell \pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard \sa240\widctlpar\tx576 {\i 
\par }The {\i CreateDisposition} parameter can contain one of the following values: 
\par \trowd \trgaph108\trleft-108 \cellx2610\cellx10476 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 CREATE_NEW{\fs24 \cell }Creates a new file. The function fails if the specified file already exists.{\fs24 \cell 
}\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\trowd \trgaph108\trleft-108 \cellx2610\cellx10476 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 CREATE_ALWAYS{\fs24 \cell }
Creates a new file. The function overwrites the file if it exists.{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 OPEN_EXISTING{\fs24 \cell }
Opens the file. The function fails if the file does not exist.{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 OPEN_ALWAYS{\fs24 \cell }
Opens the file, if it exists. If the file does not exist, act like CREATE_NEW.{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\trowd \trgaph108\trleft-108 \cellx2610\cellx10476 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 TRUNCATE_EXISTING{\fs24 \cell }Opens the file. Once opened, the 
file is truncated so that its size is zero bytes. The calling process must open the file with at least GENERIC_WRITE access. The function fails if the file does not exist.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 

\par The {\i ImpersonationLevel} parameter can contain one or more of the following values: 
\par \trowd \trgaph108\trleft-108 \cellx3690\cellx10476 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SECURITY_ANONYMOUS{\fs24 \cell }Specifies to impersonate the client at the Anonymous impersonation level.\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft-108 \cellx3690\cellx10476 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SECURITY_IDENTIFICATION{\fs24 \cell }
Specifies to impersonate the client at the Identification impersonation level.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SECURITY_IMPERSONATION{\fs24 \cell }
Specifies to impersonate the client at the Impersonation impersonation level.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft-108 \cellx3690\cellx10476 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 SECURITY_DELEGATION{\fs24 \cell }Specifies to impersonate the client at the Delegation impersonation level.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par The {\i SecurityFlags} parameter can have either of the following two flags set:{\fs24 
\par }\trowd \trgaph108\trleft-108 \cellx3780\cellx10476 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SECURITY_CONTEXT_TRACKING{\fs24 \cell }
Specifies that the security tracking mode is dynamic. If this flag is not specified, Security Tracking Mode is static.{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\trowd \trgaph108\trleft-108 \cellx3780\cellx10476 \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SECURITY_EFFECTIVE_ONLY{\fs24 \cell }
Specifies that only the enabled aspects of the client's security context are available to the server. If you do not specify this flag, all aspects of the client's security context are available. This flag allows the client to limit the groups and privileg
es that a server can use while impersonating the client.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par The response is as follows:
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line =================================\cell 
Description\line ==================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 26\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR AndXCommand;  Secondary command;\cell 0xFF = None\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UCHAR AndXReserved;\cell MBZ\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT AndXOffset;\cell Offset to next command WordCount\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR OplockLevel;\cell The oplock level granted\line {\kerning28 0 - No oplock granted\line 1 - Exclusive oplock granted\line 2 - Batch oplock granted
\line 3 - Level II oplock granted}\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Fid;\cell The file ID\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG CreateAction;\cell The action taken\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 TIME CreationTime;\cell The time the file was created\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 TIME LastAccessTime;\cell The time the file was accessed
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 TIME LastWriteTime;\cell The time the file was last written\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 TIME ChangeTime;\cell The time the file was last changed\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG ExtFileAttributes;\cell The file attributes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
LARGE_INTEGER AllocationSize;\cell The number of byes allocated\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LARGE_INTEGER EndOfFile;\cell The end of file offset
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT FileType;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DeviceState;\cell state of IPC device (e.g. pipe)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
BOOLEAN Directory;\cell TRUE if this is a directory\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \pard \sa240\widctlpar\tx576 
\par The following SMBs may follow SMB_COM_NT_CREATE_ANDX:
\par \trowd \trgaph108\trleft360 \cellx2700\cellx5670 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_READ\cell SMB_COM_READ_ANDX\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft360 
\cellx2700\cellx5670 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_IOCTL\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 {\kerning28 {\*\bkmkstart _Toc358532250}
{\*\bkmkstart _Toc365655316}{\*\bkmkstart _Toc358532167}{\*\bkmkstart _Toc358532202}{\*\bkmkstart _Toc358532174} }{\f25\kerning28 {\*\bkmkstart _Toc382909312}{\*\bkmkstart _Toc382911223}
\par }\pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\kerning28 4.2.2\tab NT_TRANSACT_CREATE{\*\bkmkend _Toc358532250}: Create or Open File with EAs or SD{\*\bkmkend _Toc365655316}{\*\bkmkend _Toc382909312}
{\*\bkmkend _Toc382911223}
\par }\pard\plain \sa240\keepn\widctlpar\tx576 \f4\fs20 This command is used to create or open a file or a directory, when EAs or an SD must be applied to the file.
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5400\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Request Parameter Block Encoding\line 
===================================\cell Description\line ================================\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5400
\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 ULONG Flags;\cell Creation flags (see below)\cell }\pard\plain \widctlpar\intbl 
\f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 ULONG RootDirectoryFid;\cell Optional directory for relative open\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row 
}\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 ACCESS_MASK DesiredAccess;\cell Desired access\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 LARGE_INTEGER AllocationSize;\cell The initial allocation size in bytes, if file created\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 ULONG ExtFileAttributes;\cell The extended file attributes\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 ULONG ShareAccess;\cell The share access \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 {\kerning28 ULONG CreateDisposition;\cell Action to take if file exists or not \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 
ULONG CreateOptions;\cell Options for creating a new file\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 ULONG SecurityDescriptorLength;\cell 
Length of SD in bytes\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 ULONG EaLength;\cell Length of EA in bytes\cell }\pard\plain 
\widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 ULONG NameLength;\cell Length of name in characters\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row 
}\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 ULONG ImpersonationLevel;\cell Security QOS information \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 UCHAR SecurityFlags;\cell Security QOS information \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 STRING Name[NameLength];\cell The name of the file (not NULL terminated)\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrt
\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5400\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 
\cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 \cell \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5400\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10350 \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 \cell \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5400\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 
\cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Data Block Encoding\line ===================================\cell Description\line ================================\cell }\pard\plain 
\widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5400\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10350 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 UCHAR SecurityDescriptor[ SecurityDescriptorLength];\cell \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5400\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
{\kerning28 UCHAR ExtendedAttributes[EaLength];\cell \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard \sa240\widctlpar\tx576 {\kerning28 
\par }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4050\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\clcfpat7\clcbpat8\clshdng3000 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Creation Flag Name\line ==========================\cell Value\line ======\cell Description\line 
==================================\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4050\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 NT_CREATE_REQUEST_OPLOCK\cell 0x02\cell 
Level I oplock requested\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 NT_CREATE_REQUEST_OPBATCH\cell 0x04\cell Batch oplock requested\cell 
}\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4050\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 
\clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 
NT_CREATE_OPEN_TARGET_DIR\cell 0x08\cell Target for open is a directory\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard \sa240\widctlpar\tx576 {\kerning28 
\par }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Output Parameter Block Encoding\line 
==================================\cell Description\line ==================================\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220
\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 UCHAR OplockLevel;\cell The oplock level granted\cell }\pard\plain 
\widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 UCHAR Reserved;\cell \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 USHORT Fid;\cell The file ID\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 {\kerning28 ULONG CreateAction;\cell The action taken\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 ULONG EaErrorOffset;\cell 
Offset of the EA error\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 TIME CreationTime;\cell The time the file was created\cell }\pard\plain 
\widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 TIME LastAccessTime;\cell The time the file was accessed\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 
\row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 TIME LastWriteTime;\cell The time the file was last written\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 TIME ChangeTime;\cell The time the file was last changed\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 ULONG ExtFileAttributes;\cell The file attributes\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 LARGE_INTEGER AllocationSize;\cell The number of byes allocated\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 LARGE_INTEGER EndOfFile;\cell The end of file offset\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 USHORT FileType;\cell \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 
USHORT DeviceState;\cell state of IPC device (e.g. pipe)\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220
\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 BOOLEAN Directory;\cell TRUE if this is a directory
\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard \sa240\widctlpar\tx576 {\kerning28 
\par See the description of NT_CREATE_ANDX for the definition of the parameters.
\par }\pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655317}{\*\bkmkend _Toc358532167}4.2.3\tab  }{\*\bkmkstart _Toc382909313}{\*\bkmkstart _Toc382911224}
CREATE_TEMPORARY: Create Temporary File{\*\bkmkend _Toc365655317}{\*\bkmkend _Toc382909313}{\*\bkmkend _Toc382911224}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 The server creates a data file in {\i Directory} relative to {\i Tid} in the SMB header and assigns a unique name to it.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell 
Server Response\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 3\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT reserved;\cell Ignored by the server\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UTIME CreationTime;
\cell New file's creation time stamp\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes;  min = 2\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR BufferFormat;\cell 0x04\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
STRING DirectoryName[];\cell Directory name\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 1\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Fid;\cell File handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell 
Count of data bytes;  min = 2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR BufferFormat;\cell 0x04\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd 
\trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING Filename[];\cell File name\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par {\i Fid} is the returned handle for future file access. {\i Filename} is the name of the file which was created within the requested {\i Directory}.   It is opened in compatibility mode with read/write access for the client.
\par Support of {\i CreationTime} by the server is optional.
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655318}4.2.4\tab  }{\*\bkmkstart _Toc382909314}{\*\bkmkstart _Toc382911225}READ_ANDX:  Read {\*\bkmkend _Toc358532202}Bytes
{\*\bkmkend _Toc365655318}{\*\bkmkend _Toc382909314}{\*\bkmkend _Toc382911225}
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4950\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Large File Client Request\line ================================
\cell Description\line ===================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4950\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 10 or 12\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR AndXCommand;\cell Secondary (X) command;  0xFF = none\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR AndXReserved;\cell Reserved (must be 0)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT AndXOffset;
\cell Offset to next command WordCount\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Fid;\cell File handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Offset;\cell Offset in file to begin read\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT MaxCount;\cell Max number of bytes to return\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT MinCount;\cell Reserved\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Reserved;\cell Must be 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Remaining;\cell Reserved\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
ULONG OffsetHigh;\cell Upper 32 bits of offset (only if WordCount is 12)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4950
\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4950\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ================================\cell 
Description\line ===================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4950\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 12\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR AndXCommand;\cell Secondary (X) command;  0xFF = none\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UCHAR AndXReserved;\cell Reserved (must be 0)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT AndXOffset;\cell Offset to next command WordCount\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Remaining;\cell Reserved -- must be -1\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DataCompactionMode;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Reserved;\cell 
Reserved (must be 0)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DataLength;\cell Number of data bytes (min = 0)\cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DataOffset;\cell Offset (from header start) to data\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Reserved[5];\cell Reserved (must be 0)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;
\cell Count of data bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Pad[];\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 
\clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4950\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Data[ DataLength];\cell Data from resource\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par If the negotiated dialect is {\f11\fs18 NT LM 0.12} or later, the client may use the 12 parameter word  version of the request.  This version allows specification of 64 bit file offsets.
\par If CAP_LARGE_READX was indicated by the server in the negotiate protocol response, the request's {\i MaxCount} field may exceed the negotiated buffer size if {\i Fid} refers to a disk file.  The server may arbitrarily elect to return fewer than {\i 
MaxCount} bytes in response.
\par The following SMBs may follow SMB_COM_READ_ANDX: \line SMB_COM_CLOSE
\par \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 4.2.4.1\tab Errors
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 ERRDOS/ERRnoaccess\line ERRDOS/ERRbadfid\line ERRDOS/ERRlock\line ERRDOS/ERRbadaccess\line ERRSRV/ERRinvid\line ERRSRV/ERRbaduid
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc358532203}{\*\bkmkstart _Toc365655319}{\*\bkmkstart _Toc358532191}{\*\bkmkstart _Toc358532175}{\*\bkmkend _Toc358532174}4.2.5\tab  }
{\*\bkmkstart _Toc382909315}{\*\bkmkstart _Toc382911226}WRITE_ANDX:  Write Bytes to file or resource{\*\bkmkend _Toc358532203}{\*\bkmkend _Toc365655319}{\*\bkmkend _Toc382909315}{\*\bkmkend _Toc382911226}
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4860\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ===============================\cell 
Description\line ====================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 12 or 14\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR AndXCommand;\cell Secondary (X) command;  0xFF = none\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR AndXReserved;\cell Reserved (must be 0)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT AndXOffset;
\cell Offset to next command WordCount\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Fid;\cell File handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Offset;\cell Offset in file to begin write\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Reserved;\cell Must be 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT WriteMode;\cell 
Write mode bits:\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell 0 - write through\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Remaining;\cell Bytes remaining to satisfy request\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT Reserved;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DataLength;\cell Number of data bytes in buffer (>=0)\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DataOffset;\cell Offset to data bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG OffsetHigh;\cell Upper 32 bits of offset (only present if WordCount = 14)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Pad[];\cell 
Pad to SHORT or LONG\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Data[DataLength];\cell Data to write\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard 
\sa240\widctlpar\tx576 
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4860\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ===============================\cell 
Description\line ====================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 6\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR AndXCommand;\cell Secondary (X) command;  0xFF = none\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UCHAR AndXReserved;\cell Reserved (must be 0)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT AndXOffset;\cell Offset to next command WordCount\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Count;\cell Number of bytes written\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Remaining;\cell Reserved\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Reserved;\cell \cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par A {\i ByteCount} of 0 does not truncate the file.  Rather a zero length write merely transfers zero bytes of information to the file.  A request such as SMB_COM_WRITE must be used to truncate the file.
\par If {\i WriteMode} has bit0 set in the request and {\i Fid} refers to a disk file, the response is not sent from the server until the data is on stable storage.
\par If the negotiated dialect is {\f11\fs18 NT LM 0.12} or later, the 14 word format of this SMB may be used to access portions of files requiring offsets expressed as 64 bits. Otherwise, the OffsetHigh field must be omitted from the request.
\par The following are the valid {\i AndXCommand} values for this SMB:
\par \trowd \trgaph108\trleft450 \cellx3690\cellx6750 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_READ\cell SMB_COM_READ_ANDX\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft450 
\cellx3690\cellx6750 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_LOCK_AND_READ\cell SMB_COM_WRITE_ANDX\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft450 \cellx3690\cellx6750 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_CLOSE\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 
{\*\bkmkstart _Toc358532195}{\*\bkmkstart _Toc358532177}{\*\bkmkend _Toc358532191}4.2.5.1\tab Errors
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 ERRDOS/ERRnoaccess\line ERRDOS/ERRbadfid\line ERRDOS/ERRlock\line ERRDOS/ERRbadaccess\line ERRSRV/ERRinvid\line ERRSRV/ERRbaduid
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655320}4.2.6\tab  }{\*\bkmkstart _Toc382909316}{\*\bkmkstart _Toc382911227}LOCKING_ANDX:  Lock or Unlock Byte
{\*\bkmkend _Toc358532195} Ranges{\*\bkmkend _Toc365655320}{\*\bkmkend _Toc382909316}{\*\bkmkend _Toc382911227}
\par \pard\plain \ri-432\sa240\widctlpar\tx576 \f4\fs20 SMB_COM_LOCKING_ANDX allows both locking and/or unlocking of file range(s).
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell 
Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 8\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR AndXCommand;\cell Secondary (X) command;  0xFF = none\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UCHAR AndXReserved;\cell Reserved (must be 0)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT AndXOffset;\cell Offset to next command WordCount\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Fid;\cell File handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR LockType;\cell See LockType table below\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR OplockLevel;
\cell The new oplock level\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Timeout;\cell Milliseconds to wait for unlock\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT NumberOfUnlocks;\cell Num. unlock range structs following\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT NumberOfLocks;\cell Num. lock range structs following\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT ByteCount;\cell Count of data bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LOCKING_ANDX_RANGE Unlocks[];\cell Unlock ranges\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LOCKING_ANDX_RANGE Locks[];\cell Lock ranges\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4410\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5400\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LockType Flag Name\line ============================\cell Value\line =====\cell Description\line 
================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4410\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5400
\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 LOCKING_ANDX_SHARED_LOCK\cell }0x01\cell Read-only lock\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 LOCKING_ANDX_OPLOCK_RELEASE\cell }0x02\cell Oplock break notification\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 LOCKING_ANDX_CHANGE_LOCKTYPE\cell }0x04\cell Change lock type\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 LOCKING_ANDX_CANCEL_LOCK\cell }0x08\cell Cancel outstanding request\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4410\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5400\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 LOCKING_ANDX_LARGE_FILES\cell }0x10\cell Large file locking format\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard 
\sa240\widctlpar\tx576 
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LOCKING_ANDX_RANGE Format\line =====================================================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl
\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Pid;\cell 
PID of process "owning" lock\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Offset;\cell Offset to bytes to [un]lock\cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Length;\cell Number of bytes to [un]lock\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Large File LOCKING_ANDX_RANGE Format\line =====================================================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl
\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Pid;\cell 
PID of process "owning" lock\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Pad;\cell Pad to DWORD align (mbz)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG OffsetHigh;\cell Offset to bytes to [un]lock (high)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG OffsetLow;\cell Offset to bytes to [un]lock (low)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
ULONG LengthHigh;\cell Number of bytes to [un]lock (high)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG LengthLow;\cell Number of bytes to [un]lock (low)\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell 
Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR AndXCommand;\cell Secondary (X) command;  0xFF = none\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UCHAR AndXReserved;\cell Reserved (must be 0)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT AndXOffset;\cell Offset to next command WordCount\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par Locking is a simple mechanism for excluding other processes read/write access to regions of a file.  The locked regions can be anywhere in the logical file.  Locking beyond end-of-file is permitted.  Any process using the {\i Fid} speci\-
fied in this request's {\i Fid} has access to the locked bytes, other processes will be denied the locking of the same bytes.
\par The proper method for using locks is not to rely on being denied read or write access on any of the read/write proto\-cols but rather to attempt the locking protocol and proceed with the read/write only if the locks succeeded.
\par Locking a range of bytes will fail if any subranges or over\-lapping ranges are locked.  In other words, if any of the specified bytes are already locked, the lock will fail.
\par If {\i NumberOfUnlocks} is non-zero, the {\i Unlocks} vector contains {\i NumberOfUnlocks} elements.  Each element requests that a lock at {\i Offset} of {\i Length} be released.  If {\i NumberOfLocks} is nonzero, the {\i Locks} vector contains {\i 
NumberOfLocks} elements.  Each element requests the acquisition of a lock at {\i Offset} of {\i Length}.
\par {\i Timeout}
 is the maximum amount of time to wait for the byte range(s) specified to become unlocked.  A timeout value of 0 indicates that the server should fail immediately if any lock range specified is locked.  A timeout value of -1 indicates that the server shou
ld wait as long as it takes for each byte range specified 
to become unlocked so that it may be again locked by this protocol.  Any other value of smb_timeout specifies the maximum number of milliseconds to wait for all lock range(s) specified to become available.
\par If any of the lock ranges timeout because of the area to be locked is already locked (or the lock fails), the other ranges in the protocol request which were successfully locked as a result of this protocol will be unlocked (either all requested ranges wi
ll be locked when this protocol returns to the client or none).
\par If {\i LockType} has the {\f11\fs18 LOCKING_ANDX_SHARED_LOCK} flag set, the lock is specified as a shared lock.  Locks for both read and write (where{\f11\fs18  LOCKING_ANDX_SHARED_LOCK}
 is clear) should be prohibited, but other shared locks should be permitted.  If shared locks can not be supported by a server, the server should map the lock to a lock for both read and write.  Closing a file with locks still in force causes the locks to
 be released in no defined order.
\par If {\i LockType} has the {\f11\fs18 LOCKING_ANDX_LARGE_FILES} flag set and if the negotiated protocol is {\f11\fs18 NT LM 0.12} or later, then the Locks and Unlocks vectors are in the Large File {\f11\fs18 LOCKING_ANDX_RANGE}
 format.  This allows specification of 64 bit offsets for very large files.
\par If the one and only member of the {\i Locks} vector has the {\f11\fs18 LOCKING_ANDX_CANCEL_LOCK} flag set in the {\i LockType} field, the client is requesting the server to cancel a previously requested, but not yet responded to, lock.
\par If LockType has the {\f11\fs18 LOCKING_ANDX_CHANGE_LOCKTYPE} flag set, the client is requesting that th
e server atomically change the lock type from a shared lock to an exclusive lock or vice versa.  If the server can not do this in an atomic fashion, the server must reject this request.  NT and W95 servers do not support this capability.
\par Oplocks are described in the "Opportunistic Locks" section elsewhere in this document.  A client requests an oplock by setting the appropriate bit in the SMB_COM_OPEN_ANDX request when the file is being opened in a mode which is not exclusive.  The server
 responds by settin
g the appropriate bit in the response SMB indicating whether or not the oplock was granted.  By granting the oplock, the server tells the client the file is currently only being used by this one client process at the current time.  The client can therefor
e safely do read ahead and write behind as well as local cach\-
ing of file locks knowing that the file will not be accessed/changed in any way by another process while the oplock is in effect.  The client will be notified when any other process attempts to open or modify the oplocked file.
\par When another user attempts to open or otherwise modify the file which a client has oplocked, the server delays the second attempt and notifies the client via an {\f11\fs18 SMB_LOCKING_ANDX SMB}
 asynchronously sent from the server to the client.  This message has the {\f11\fs18 LOCKING_ANDX_OPLOCK_RELEASE} flag set indicating to the client that the oplock is being broken. {\i OplockLevel} indicates the type of oplock the client now owns. If {\i 
OplockLevel} is 0, the client possesses no oplocks on the file at all, if {\i OplockLevel}
 is 1 the client possesses a Level II oplock.  The client is expected to flush any dirty buffers to the server, submit any file locks and respond to the server with either an {\f11\fs18 SMB_LOCKING_ANDX} SMB having the {\f11\fs18 
LOCKING_ANDX_OPLOCK_RELEASE} flag set, or with a file close if the file is no longer in use by the client.  If the client sends an {\f11\fs18 SMB_LOCKING_ANDX} SMB with the{\f11\fs18  LOCKING_ANDX_OPLOCK_RELEASE} flag set and {\i NumberOfLocks}
 is zero, the server does not send a response.  Since a close being sen
t to the server and break oplock notification from the server could cross on the wire, if the client gets an oplock notification on a file which it does not have open, that notification should be ignored.
\par Due to timing, the client could get an "oplock broken" notification in a user's data buffer as a result of this notification crossing on the wire with a {\f11\fs18 SMB_COM_READ_RAW}
 request.  The client must detect this (use length of msg, "FFSMB", MID of -1 and {\i Command} of {\f11\fs18 SMB_COM_LOCKING_ANDX}) and honor the "oplock broken" notification as usual.  The server must also note on receipt of an {\f11\fs18 
SMB_COM_READ_RAW}
 request that there is an outstanding (unanswered) "oplock broken" notification to the client and return a zero length response denoting failure of the read raw request.  The client should (after responding to the "oplock broken" notification), use a stan
\-dard read protocol to redo the read request.  This allows a file to actually contain data matching an "oplock broken" notification and still be read correctly.
\par The entire message sent and received including the optional second protocol must fit in the negotiated maximum transfer size.  The following are the only valid SMB commands for {\i AndXCommand} for SMB_COM_LOCKING_ANDX:
\par \trowd \trgaph108\trleft540 \cellx3322\cellx7200 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_READ\cell SMB_COM_READ_ANDX\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft540 
\cellx3322\cellx7200 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_WRITE\cell SMB_COM_WRITE_ANDX\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft540 \cellx3322\cellx7200 \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_FLUSH\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\*\bkmkend _Toc358532175}
{\*\bkmkend _Toc358532177}4.2.6.1\tab Errors
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 ERRDOS/ERRbadfile\line ERRDOS/ERRbadfid\line ERRDOS/ERRlock\line ERRDOS/ERRinvdevice\line ERRSRV/ERRinvid\line ERRSRV/ERRbaduid
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655321}4.2.7\tab  }{\*\bkmkstart _Toc382909317}{\*\bkmkstart _Toc382911228}SEEK: Seek in File{\*\bkmkend _Toc365655321}
{\*\bkmkend _Toc382909317}{\*\bkmkend _Toc382911228}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 The seek message is sent to set the current file pointer for {\i Fid}.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 4\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Fid;\cell File handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Mode;\cell Seek mode:\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell 0 = from start of file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell 1 = from current position\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell 2 = from end of file\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LONG Offset;\cell Relative offset\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl
\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par  The starting point of the seek is set by {\i Mode}:
\par \trowd \trgaph108\trrh-240\trleft727 \cellx1177\cellx5947 \pard \sa240\widctlpar\intbl\tx576 0\cell seek from start of file\cell \pard \widctlpar\intbl \row \trowd \trgaph108\trrh-240\trleft727 \cellx1177\cellx5947 \pard \sa240\widctlpar\intbl\tx576 1
\cell seek from current file pointer\cell \pard \widctlpar\intbl \row \trowd \trgaph108\trrh-240\trleft727 \cellx1177\cellx5947 \pard \sa240\widctlpar\intbl\tx576 2\cell seek from end of file\cell \pard \widctlpar\intbl \row \pard \sa240\widctlpar\tx576 

\par The "current position" reflects the offset plus data length specified in the previous read, write or seek request, and the pointer set by this command will be replaced by the offset specified in the next read, write or seek command.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20  UCHAR WordCount;\cell Count of parameter words = 2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20  ULONG Offset;\cell Offset from start of file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20  USHORT ByteCount;\cell 
Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par The response returns the new file pointer in {\i Offset}
 which is expressed as the offset from the start of the file, and may be beyond the current end of file.  An attempt to seek to before the start of file sets the current file pointer to start of the file.
\par This request should generally only be issued by clients wishing to find the size of a file, since all read and write requests include the read or write file position as part of the SMB.  This request is inappropriate for  very large files, as the offsets 
specified are only 32 bits.  A seek which results in an Offset which can not be expressed in 32 bits returns the least significant.
\par \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 4.2.7.1\tab Errors
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 ERRDOS/ERRbadfid\line ERRDOS/ERRnoaccess\line ERRSRV/ERRinvdevice\line ERRSRV/ERRinvid\line ERRSRV/ERRbaduid
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc358532168}{\*\bkmkstart _Toc365655322}{\*\bkmkstart _Toc358532165}{\*\bkmkend _Toc358532245}{\*\bkmkend _Toc358532163}4.2.8\tab  }
{\*\bkmkstart _Toc382909318}{\*\bkmkstart _Toc382911229}FLUSH: Flush File{\*\bkmkend _Toc358532168}{\*\bkmkend _Toc365655322}{\*\bkmkend _Toc382909318}{\*\bkmkend _Toc382911229}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 The flush SMB is sent to ensure all data and allocation information for the corresponding file has been written to stable storage.  When the {\i Fid}
 has a value -1 (hex FFFF) the server performs a flush for all file handles associated with the client and {\i Pid}.  The response is not sent until the writes are complete.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 1\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Fid;\cell File handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130
\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par This client request is probably expensive to perform at the server, since the server's operating system is generally scheduling disk writes is a way which is optimal for the system's read and write activity integrated over the entire popula
tion of clients.  This message from a client "interferes" with the server's ability to optimally schedule the disk activity; clients are discouraged from overuse of this SMB request.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\*\bkmkstart _Toc358532169}4.2.8.1\tab Errors
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 ERRDOS/ERRbadfid\line ERRSRV/ERRinvid\line ERRSRV/ERRbaduid
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655323}4.2.9\tab  }{\*\bkmkstart _Toc382909319}{\*\bkmkstart _Toc382911230}CLOSE: Close File{\*\bkmkend _Toc365655323}
{\*\bkmkend _Toc382909319}{\*\bkmkend _Toc382911230}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 The close message is sent to invalidate a file hand
le for the requesting process.  All locks or other resources held by the requesting process on the file should be released by the server.  The requesting process can no longer use {\i Fid} for further file access requests.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 3\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Fid;\cell File handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UTIME LastWriteTime\cell 
Time of last write\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 
\clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 

\par If {\i LastWriteTime}
 is 0, the server should allow its local operating system to set the file's times.  Otherwise, the server should set the time to the values requested.  Failure to set the times, even if requested by the client in the request message, should not result in 
an error response from the server.
\par If {\i Fid} refers to a print spool file, the file should be spooled to the printer at this time.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 4.2.9.1\tab Errors
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 ERRDOS/ERRbadfid\line ERRSRV/ERRinvdevice\line ERRSRV/ERRinvid\line ERRSRV/ERRbaduid
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655324}4.2.10\tab  }{\*\bkmkstart _Toc382909320}{\*\bkmkstart _Toc382911231}DELETE: Delete File{\*\bkmkend _Toc358532169}
{\*\bkmkend _Toc365655324}{\*\bkmkend _Toc382909320}{\*\bkmkend _Toc382911231}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 The delete file message is sent to delete a data file.  The appropriate {\i Tid}
 and additional pathname are passed.  Read only files may not be deleted, the read-only attribute must be reset prior to file deletion.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 1\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT SearchAttributes;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell 
Count of data bytes;    min = 2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR BufferFormat;\cell 0x04\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd 
\trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING FileName[];\cell File name\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par Multiple files may be deleted in response to a single request as SMB_COM_DELETE supports wildcards 
\par {\i SearchAttributes} indicates the attributes that the target file(s) must have.  If the attribute is zero then only normal files are deleted.  If the system file or hidden attributes are specified then the delete is inclusive -both the specified type
(s) of files and normal files are deleted.  Attributes are described in the "Attribute Encoding" section of this document.
\par If {\i bit0} of the {\i Flags2} field of the SMB header is set, a pattern is passed in, and the file has a long name, then the passed pattern  much match the long file name for the delete to succeed.  If {\i bit0}
 is clear, a pattern is passed in, and the file has a long name, then the passed pattern must match the file's short name for the deletion to succeed.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\*\bkmkstart _Toc358532170}4.2.10.1\tab Errors
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 ERRDOS/ERRbadpath\line ERRDOS/ERRbadfile\line ERRDOS/ERRnoaccess\line ERRHRD/ERRnowrite\line ERRSRV/ERRaccess\line ERRSRV/ERRinvdevice\line ERRSRV/ERRinvid\line ERRSRV/ERRbaduid
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\*\bkmkstart _Toc365655325}{\*\bkmkstart _Toc382909321}{\*\bkmkstart _Toc382911232}4.2.11\tab RENAME: Rename File{\*\bkmkend _Toc358532170}
{\*\bkmkend _Toc365655325}{\*\bkmkend _Toc382909321}{\*\bkmkend _Toc382911232}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 The rename file message is sent to change the name of a file.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 1\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT SearchAttributes;\cell Target file attributes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT ByteCount;\cell Count of data bytes;    min = 4\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR BufferFormat1;\cell 0x04\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING OldFileName[];\cell Old file name\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR BufferFormat2;\cell 0x04\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130
\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING NewFileName[];\cell New file name\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par Files {\i OldFileName} must exist and {\i NewFileName} must not.  Both pathnames must be relative to the {\i Tid} specified in the request.  Open files may be renamed.
\par Multiple files may be renamed in response to a single request as Rename File supports wildcards in the file name (last component of the pathname).
\par {\i SearchAttributes} indicates the attributes that the target file(s) must have.  If {\i SearchAttributes}
 is zero then only normal files are renamed.  If the system file or hidden attributes are specified then the rename is inclusive -both the specified type(s) of files and normal files are renamed.  The encoding of {\i SearchAttributes}
 is described in section {\field{\*\fldinst  REF _Ref365632120 \\n }{\fldrslt 3.10}} - {\field{\*\fldinst  REF _Ref365632120 \\* MERGEFORMAT }{\fldrslt  File Attribute Encoding}}.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\*\bkmkstart _Toc358532180}4.2.11.1\tab Errors
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 ERRDOS/ERRbadpath\line ERRDOS/ERRbadfile\line ERRDOS/ERRnoaccess\line ERRDOS/ERRdiffdevice\line ERRHRD/ERRnowrite\line ERRSRV/ERRaccess\line ERRSRV/ERRinvdevice\line ERRSRV/ERRinvid\line ERRSRV/ERRbaduid
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\*\bkmkstart _Toc365655326}{\*\bkmkstart _Toc382909322}{\*\bkmkstart _Toc382911233}4.2.12\tab MOVE:  Rename File{\*\bkmkend _Toc365655326}
{\*\bkmkend _Toc382909322}{\*\bkmkend _Toc382911233}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 The source file is copied to the destination and the source is subsequently deleted.
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell 
Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 3\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Tid2;\cell Second (target) file id\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT OpenFunction;
\cell what to do if target file exists\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Flags;\cell Flags to control move operations:\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell 0 - target must be a file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell 1 - target must be a directory\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell 
2 - reserved (must be 0)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell 3 - reserved (must be 0)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell 4 - verify all writes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;
\cell Count of data bytes;    min = 2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Format1;\cell 0x04\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING OldFileName[];\cell Old file name\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 UCHAR FormatNew;\cell 0x04\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING NewFileName[];\cell New file name\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard 
\sa240\widctlpar\tx576 
\par {\i OldFileName} is copied to {\i NewFileName}, then {\i OldFileName} is deleted.  Both {\i OldFileName} and  {\i NewFileName} must refer to paths on the same server.  {\i NewFileName} can refer to either a file or a direc\-
tory.  All file components except the last must exist; directories will not be created.
\par {\i NewFileName} can be required to be a file or a directory by the Flags field.
\par The {\i Tid} in the header is associated with the source while {\i Tid2} is associated with the destination.  These fields may contain the same or differing valid values. {\i Tid2} can be set to -1 indicating that this is to be the same {\i Tid}
 as in the SMB header.  This allows use of the move protocol with {\f11\fs18 SMB_TREE_CONNECT_ANDX.
\par }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell 
Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 1\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Count;\cell Number of files moved\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell 
Count of data bytes;    min = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR ErrorFileFormat;\cell 0x04  (only if error)\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING ErrorFileName[];\cell Pathname of file where error occurred\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par The source path must refer to an existing file or files.  Wildcards are permitted.  Source files specified by wildcards are processed until an error is encountered. If an error is encountered, the expanded name of the file is returned in ErrorFileName.  W
ildcards are not permitted in {\i NewFileName}.
\par {\i OpenFunction} controls what should happen if the destination file exists.  If ({\i OpenFunction} & 0x30) == 0, the operation should fail if the destination exists.  If ({\i OpenFunction} & 0x30) == 0x20, the destination file should be overwritten.

\par \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\*\bkmkstart _Toc358532197}{\*\bkmkend _Toc358532180}4.2.12.1\tab Errors
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 ERRDOS/ERRfilexists\line ERRDOS/ERRbadfile\line ERRDOS/ERRnoaccess\line ERRDOS/ERRnofiles\line ERRDOS/ERRbadshare\line ERRHRD/ERRnowrite\line ERRSRV/ERRnoaccess\line ERRSRV/ERRinvdevice\line ERRSRV/ERRinvid
\line ERRSRV/ERRbaduid\line ERRSRV/ERRnosupport\line ERRSRV/ERRaccess
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\*\bkmkstart _Toc365655327}{\*\bkmkstart _Toc382909323}{\*\bkmkstart _Toc382911234}4.2.13\tab COPY: Copy File{\*\bkmkend _Toc358532197}
{\*\bkmkend _Toc365655327}{\*\bkmkend _Toc382909323}{\*\bkmkend _Toc382911234}
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell 
Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 3\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Tid2;\cell Second (target) path TID\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT OpenFunction;
\cell What to do if target file exists\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Flags;\cell Flags to control copy operation:\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell bit 0 - target must be a file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell bit 1 - target must be a dir.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell 
bit 2 - copy target mode:\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell 0 = binary, 1 = ASCII\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell bit 3 - copy source mode:\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell 
0 = binary, 1 = ASCII\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell bit 4 - verify all writes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell bit 5 - tree copy\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell 
Count of data bytes;    min = 2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR SourceFileNameFormat;\cell 0x04\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING SourceFileName;\cell Pathname of source file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR TargetFileNameFormat;\cell 0x04\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING TargetFileName;\cell 
Pathname of target file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par \pard \ri-864\sa240\widctlpar\tx576 The file at {\i SourceName} is copied to {\i TargetFileName}, both of which must refer to paths on the same server.
\par \pard \sa240\widctlpar\tx576 The {\i Tid} in the header is associated with the source while {\i Tid2} is associated with the destination.  These fields may contain the same or differing valid values. {\i Tid2}
 can be set to -1 indicating that this is to be the same {\i Tid} as in the SMB header.  This allows use of the move protocol with {\f11\fs18 SMB_TREE_CONNECT_ANDX.
\par }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell 
Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 1\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Count;\cell Number of files copied\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell 
Count of data bytes;    min = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR ErrorFileFormat;\cell 0x04 (only if error)\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING ErrorFileName;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par The source path must refer to an existing file or files.  Wildcards are permitted.  Source files specified by wildcards are processed until an error is encountered. If an error is encountered, the expanded name of the file is returned in ErrorFileName.  W
ildcards are not permitted in {\i TargetFileName}.  {\i TargetFileName} can refer to either a file or a direc\-tory.
\par The destination can be required to be a file or a directory by the bits in {\i Flags}.  If neither {\i bit0} nor {\i bit1} are set, the destination may be either a file or a directory.  {\i Flags}
 also controls the copy mode.  In a binary copy for the source, the copy stops the first time an EOF (control-Z) is encountered. In a binary copy for the target, the server must make sure that there is exactly one EOF in the target file and that 
it is the last character of the file.
\par If the destination is a file and the source contains wildcards, the destination file will either be truncated or appended to at the start of the operation depending on bits in {\i OpenFunction}
 (see section 3.7).  Subsequent files will then be appended to the file.
\par If the negotiated dialect is {\f11\fs18  LM1.2X002} or later, {\i bit5} of {\i Flags} is used to specify a tree copy on the remote server.  When this option is selected the destination must not be an existing file and the source mode m
ust be binary.  A request with {\i bit5} set and either {\i bit0} or {\i bit3} set is therefore an error.  When the tree copy mode is selected, the {\i Count} field in the server response is undefined.
\par \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\*\bkmkstart _Toc358532236}{\*\bkmkstart _Toc358532172}{\*\bkmkstart _Toc358532198}4.2.13.1\tab Errors
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 ERRDOS/ERRfilexists\line ERRDOS/ERRshare\line ERRDOS/ERRnofids\line ERRDOS/ERRbadfile\line ERRDOS/ERRnoaccess\line ERRDOS/ERRnofiles\line ERRDOS/ERRbadshare\line ERRSRV/ERRnoaccess\line ERRSRV/ERRinvdevice\line 
ERRSRV/ERRinvid\line ERRSRV/ERRbaduid\line ERRSRV/ERRaccess
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655328}4.2.14\tab  }{\*\bkmkstart _Toc382909324}{\*\bkmkstart _Toc382911235}TRANS2_QUERY_PATH_INFORMATION
{\*\bkmkend _Toc358532236}: Get File Attributes given Path{\*\bkmkend _Toc365655328}{\*\bkmkend _Toc382909324}{\*\bkmkend _Toc382911235}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 {\kerning28 This request is used to get information about a specific file or subdirectory.
\par }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4050\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Client Request\line ==========================\cell 
Value\line =========================================\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4050\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 WordCount\cell 15\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 MaxSetupCount\cell 0\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 
SetupCount\cell 1\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Setup[0]\cell TRANS2_QUERY_PATH_INFORMATION\cell }\pard\plain 
\widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4050\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 \cell \cell }\pard\plain \widctlpar\intbl \f4\fs20 {
\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4050\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 \cell \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd 
\trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4050\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Parameter Block Encoding\line ==========================
\cell Description\line =========================================\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4050\clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 USHORT InformationLevel;\cell Level of information requested\cell }\pard\plain 
\widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 ULONG Reserved;\cell Must be zero\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd 
\trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4050\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 STRING FileName;\cell File or directory name\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard \sa240\widctlpar\tx576 {\kerning28 
\par The following InformationLevels may be requested:
\par }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4950\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5993 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Information Level\line \line 
================================\cell Value\line \line =====\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4950\clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrr\brdrs\brdrw30\brdrcf1 \cellx5993 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 SMB_INFO_STANDARD\cell 1\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 SMB_INFO_QUERY_EA_SIZE\cell 2\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 {\kerning28 SMB_INFO_QUERY_EAS_FROM_LIST\cell 3\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 SMB_INFO_QUERY_ALL_EAS\cell 4\cell 
}\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 SMB_INFO_IS_NAME_VALID\cell 6\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row 
}\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 SMB_QUERY_FILE_BASIC_INFO\cell 0x101\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 SMB_QUERY_FILE_STANDARD_INFO\cell 0x102\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
{\kerning28 SMB_QUERY_FILE_EA_INFO\cell 0x103\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 SMB_QUERY_FILE_NAME_INFO\cell 0x104\cell 
}\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 SMB_QUERY_FILE_ALL_INFO\cell 0x107\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row 
}\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 SMB_QUERY_FILE_ALT_NAME_INFO\cell 0x108\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 SMB_QUERY_FILE_STREAM_INFO\cell 0x109\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb
\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4950\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx5993 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {
\kerning28 SMB_QUERY_FILE_COMPRESSION_INFO\cell 0x10B\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard \sa240\widctlpar\tx576 {\kerning28 
\par The requested information is placed in the Data portion of the transaction response.  For the information levels greater than 0x100, the transaction response has 1 parameter word which should be ignored by the client.
\par }The following sections describe the {\i InformationLevel} dependent encoding of the data part of the transaction response.
\par \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\kerning28 {\*\bkmkstart _Toc358532237}4.2.14.1\tab SMB_INFO_STANDARD & SMB_INFO_QUERY_EA_SIZE{\*\bkmkend _Toc358532237}
\par }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4860\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Data Block Encoding\line ===============================\cell 
Description\line ====================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_DATE CreationDate;\cell Date when file was created\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_TIME CreationTime;\cell Time when file was created\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
SMB_DATE LastAccessDate;\cell Date of last file access\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_TIME LastAccessTime;\cell Time of last file access\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_DATE LastWriteDate;\cell Date of last write to the file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_TIME LastWriteTime;\cell Time of last write to the file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG  DataSize;\cell File Size\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG AllocationSize;\cell 
Size of filesystem allocation unit\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Attributes;\cell File Attributes\cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG EaSize;\cell Size of file's EA information ({\f11\fs18 SMB_INFO_QUERY_EA_SIZE})\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\kerning28 {\*\bkmkstart _Toc358532238}4.2.14.2\tab SMB_INFO_QUERY_EAS_FROM_LIST & SMB_INFO_QUERY_ALL_EAS{\*\bkmkend _Toc358532238}
\par }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx3240\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Response Field\line ====================\cell Value
\line ===============================================\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3240\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 MaxDataCount\cell Length of EAlist found (minimum value is 4)\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 
\row }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx3240\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Parameter Block Encoding
\line ====================\cell Description\line ===============================================\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 
\cellx3240\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 USHORT EaErrorOffset\cell Offset into EAList of EA error\cell 
}\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx3240
\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
Data Block Encoding\line ====================\cell Description\line ===============================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 
\cellx3240\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG ListLength;\cell Length of the remaining data\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3240\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR EaList[]\cell The extended attributes list\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\kerning28 {\*\bkmkstart _Toc358532239}4.2.14.3\tab SMB_INFO_IS_NAME_VALID{\*\bkmkend _Toc358532239}
\par }\pard\plain \sa240\widctlpar\tx576 \f4\fs20 {\kerning28 This requests checks to see if the name of the file contained in the request's }{\i\kerning28 Data}{\kerning28 
 field has a valid path syntax.  No parameters or data are returned on this information request. An error is returned if the syntax of the name is incorrect.  }{\i\kerning28 Success}{\kerning28 
 indicates the server accepts the path syntax, but it does not ensure the file or directory actually exists. 
\par }\pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\kerning28 4.2.14.4\tab SMB_QUERY_FILE_BASIC_INFO
\par }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4860\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Data Block Encoding\line ===============================\cell 
Description\line ====================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LARGE_INTEGER CreationTime;\cell Time when file was created\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LARGE_INTEGER LastAccessTime;\cell Time of last file access\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LARGE_INTEGER LastWriteTime;\cell Time of last write to the file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
LARGE_INTEGER ChangeTime\cell Time when file was last changed\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Attributes;\cell File Attributes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\kerning28 4.2.14.5\tab SMB_QUERY_FILE_STANDARD_INFO
\par }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4860\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Data Block Encoding\line ===============================\cell 
Description\line ====================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LARGE_INTEGER AllocationSize\cell Allocated size of the file in number of bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LARGE_INTEGER EndofFile;\cell Offset to the first free byte in the file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG NumberOfLinks\cell Number of hard links to the file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
BOOLEAN DeletePending\cell Indicates whether the file is marked for deletion\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 BOOLEAN Directory\cell Indicates whether the file is a directory\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard 
\sa240\widctlpar\tx576 {\kerning28 
\par }\pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\kerning28 {\*\bkmkstart _Toc358532240}{\*\bkmkstart _Toc358532173}{\*\bkmkend _Toc358532172}4.2.14.6\tab SMB_QUERY_FILE_EA_INFO
\par }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4860\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Data Block Encoding\line ===============================\cell 
Description\line ====================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG EASize\cell Size of the file\rquote s extended attributes in number of bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard \sa240\widctlpar\tx576 
\par \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\kerning28 4.2.14.7\tab SMB_QUERY_FILE_NAME_INFO
\par }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4860\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Data Block Encoding\line ===============================\cell 
Description\line ====================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG FileNameLength\cell Length of the file name in number of bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd 
\trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
STRING FileName\cell Name of the file \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\kerning28 4.2.14.8\tab SMB_QUERY_FILE_ALL_INFO
\par }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4860\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Data Block Encoding\line ===============================\cell 
Description\line ====================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LARGE_INTEGER CreationTime;\cell Time when file was created\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LARGE_INTEGER LastAccessTime;\cell Time of last file access\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LARGE_INTEGER LastWriteTime;\cell Time of last write to the file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
LARGE_INTEGER ChangeTime\cell Time when file was last changed\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Attributes;\cell File Attributes\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LARGE_INTEGER AllocationSize\cell Allocated size of the file in number of bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LARGE_INTEGER EndofFile;\cell Offset to the first free byte in the file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG NumberOfLinks\cell Number of hard links to the file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
BOOLEAN DeletePending\cell Indicates whether the file is marked for deletion\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 BOOLEAN Directory\cell 
Indicates whether the file is a directory\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LARGE_INTEGER Index Number\cell A file system unique identifier\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG EASize\cell Size of the file\rquote s extended attributes in number of bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG AccessFlags\cell Access that a caller has to the file; Possible values and meanings are specified below\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LARGE_INTEGER Index Number\cell A file system unique identifier\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LARGE_INTEGER CurrentByteOffset\cell Current byte offset within the file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 ULONG Mode\cell Current Open mode of the file handle to the file; possible values and meanings are detailed below\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 ULONG AlignmentRequirement\cell Buffer Alignment required by device; possible values detailed below\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
ULONG FileNameLength\cell Length of the file name in number of bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING FileName\cell Name of the file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par 
\par The AccessFlags specifies the access permissions a caller has to the file and can have any suitable combination of the following values: {\fs24 
\par }\trowd \trgaph108\trleft-180\trbrdrt\brdrs\brdrw30\brdrcf11 \trbrdrb\brdrs\brdrw30\brdrcf11 \clbrdrt\brdrs\brdrw30\brdrcf11 \clbrdrb\brdrs\brdrw15\brdrcf11 \cellx3060\clbrdrt\brdrs\brdrw30\brdrcf11 \clbrdrb\brdrs\brdrw15\brdrcf11 \cellx4716\clbrdrt
\brdrs\brdrw30\brdrcf11 \clbrdrb\brdrs\brdrw15\brdrcf11 \cellx9756 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\fs2   }Value{\fs24 \cell }\cell Meaning{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 
\row }\trowd \trgaph108\trleft-180\trbrdrt\brdrs\brdrw30\brdrcf11 \trbrdrb\brdrs\brdrw30\brdrcf11 \cellx3060\cellx4716\cellx9756 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_READ_DATA{\fs24 \cell }{\f11 
0x00000001}\cell Data can be read from the file{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_WRITE_DATA{\fs24 \cell }{\f11 0x00000002}\cell 
Data can be written to the file{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_APPEND_DATA{\fs24 \cell }{\f11 0x00000004}\cell 
Data can be appended to the file{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_READ_EA{\fs24 \cell }{\f11 0x00000008}\cell 
Extended attributes associated with the file can be read{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_WRITE_EA{\fs24 \cell }{\f11 0x00000010}
\cell Extended attributes associated with the file can be written{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_EXECUTE{\fs24 \cell }{\f11 
0x00000020}\cell Data can be read into memory from the file using system paging I/O{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_READ_ATTRIBUTES{
\fs24 \cell }{\f11 0x00000080}\cell Attributes associated with the file can be read{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_WRITE_ATTRIBUTES
{\fs24 \cell }{\f11 0x00000100}\cell Attributes associated with the file can be written{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 DELETE{\fs24 
\cell }{\f11 0x00010000}\cell The file can be deleted{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 READ_CONTROL{\fs24 \cell }{\f11 0x00020000}\cell 
The access control list and ownership associated with the file can be read{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 WRITE_DAC{\fs24 \cell }{\f11 
0x00040000}\cell The access control list and ownership associated with the file can be written.{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
WRITE_OWNER{\fs24 \cell }{\f11 0x00080000}\cell Ownership information associated with the file can be written{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\trowd \trgaph108\trleft-180\trbrdrt\brdrs\brdrw30\brdrcf11 \trbrdrb
\brdrs\brdrw30\brdrcf11 \clbrdrb\brdrs\brdrw30\brdrcf11 \cellx3060\clbrdrb\brdrs\brdrw30\brdrcf11 \cellx4716\clbrdrb\brdrs\brdrw30\brdrcf11 \cellx9756 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SYNCHRONIZE{\fs24 
\cell }{\f11 0x00100000}\cell The file handle can waited on to synchronize with the completion of an input/output request{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard \sa240\widctlpar\tx576 
\par \pard \sa240\keepn\widctlpar\tx576 The Mode field specifies the mode in which the file is currently opened. The possible values may be a suitable and logical combination of the following:
\par \trowd \trgaph108\trleft-108\trbrdrt\brdrs\brdrw30\brdrcf11 \trbrdrb\brdrs\brdrw30\brdrcf11 \clbrdrt\brdrs\brdrw30\brdrcf11 \clbrdrb\brdrs\brdrw15\brdrcf11 \cellx4068\clbrdrt\brdrs\brdrw30\brdrcf11 \clbrdrb\brdrs\brdrw15\brdrcf11 \cellx6228\clbrdrt
\brdrs\brdrw30\brdrcf11 \clbrdrb\brdrs\brdrw15\brdrcf11 \cellx10116 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Value{\fs24 \cell }\cell Meaning{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row 
}\trowd \trgaph108\trleft-108\trbrdrt\brdrs\brdrw30\brdrcf11 \trbrdrb\brdrs\brdrw30\brdrcf11 \cellx4068\cellx6228\cellx10116 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_WRITE_THROUGH{\fs24 \cell }{\f11 
0x00000002}\cell File is opened in mode where data is written to file before the driver completes a write request\cell \pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 FILE_SEQUENTIAL_ONLY{\fs24 \cell }{\f11 0x00000004}\cell All access to the file is sequential\cell \pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
FILE_SYNCHRONOUS_IO_ALERT{\fs24 \cell }{\f11 0x00000010}\cell All operations on the file are performed synchronously\cell \pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\trowd \trgaph108\trleft-108\trbrdrt\brdrs\brdrw30\brdrcf11 \trbrdrb
\brdrs\brdrw30\brdrcf11 \clbrdrb\brdrs\brdrw30\brdrcf11 \cellx4068\clbrdrb\brdrs\brdrw30\brdrcf11 \cellx6228\clbrdrb\brdrs\brdrw30\brdrcf11 \cellx10116 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
FILE_SYNCHRONOUS_IO_NONALERT{\fs24 \cell }{\f11 0x00000020}\cell All operations on the file are to be performed synchronously. Waits  in the system to synchronize I/O queuing and completion are not subject to alerts.\cell \pard\plain \widctlpar\intbl 
\f4\fs20 {\fs24 \row }\pard \sa240\widctlpar\tx576 
\par \pard \sa240\keepn\widctlpar\tx576 The AlignmentRequirement field specifies buffer alignment required by the device and can have any one of the following values: {\fs24 
\par }\trowd \trgaph108\trleft-108\trbrdrt\brdrs\brdrw30\brdrcf11 \trbrdrb\brdrs\brdrw30\brdrcf11 \clbrdrt\brdrs\brdrw30\brdrcf11 \clbrdrb\brdrs\brdrw15\brdrcf11 \cellx3492\clbrdrt\brdrs\brdrw30\brdrcf11 \clbrdrb\brdrs\brdrw15\brdrcf11 \cellx5220\clbrdrt
\brdrs\brdrw30\brdrcf11 \clbrdrb\brdrs\brdrw15\brdrcf11 \cellx9772 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\fs2   }Value{\fs24 \cell }\cell Meaning{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 
\row }\trowd \trgaph108\trleft-108\trbrdrt\brdrs\brdrw30\brdrcf11 \trbrdrb\brdrs\brdrw30\brdrcf11 \cellx3492\cellx5220\cellx9772 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_BYTE_ALIGNMENT{\fs24 \cell }{\f11 
0x00000000}\cell The buffer needs to be aligned on a byte boundary{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_WORD_ALIGNMENT{\fs24 \cell }{
\f11 0x00000001}\cell The buffer needs to be aligned on a word boundary{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_LONG_ALIGNMENT{\fs24 \cell }
{\f11 0x00000003}\cell The buffer needs to be aligned on a 4 byte boundary{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_QUAD_ALIGNMENT{\fs24 
\cell }{\f11 0x00000007}\cell The buffer needs to be aligned on an 8 byte boundary{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_OCTA_ALIGNMENT{
\fs24 \cell }{\f11 0x0000000f}\cell The buffer needs to be aligned on a 16 byte boundary{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
FILE_32_BYTE_ALIGNMENT{\fs24 \cell }{\f11 0x0000001f}\cell The buffer needs to be aligned on a 32 byte boundary{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 FILE_64_BYTE_ALIGNMENT{\fs24 \cell }{\f11 0x0000003f}\cell The buffer needs to be aligned on a 64 byte boundary{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_128_BYTE_ALIGNMENT{\fs24 \cell }{\f11 0x0000007f}\cell The buffer needs to be aligned on a 128 byte boundary{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_256_BYTE_ALIGNMENT{\fs24 \cell }{\f11 0x000000ff}\cell The buffer needs to be aligned on a 256 byte boundary{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row 
}\trowd \trgaph108\trleft-108\trbrdrt\brdrs\brdrw30\brdrcf11 \trbrdrb\brdrs\brdrw30\brdrcf11 \clbrdrb\brdrs\brdrw30\brdrcf11 \cellx3492\clbrdrb\brdrs\brdrw30\brdrcf11 \cellx5220\clbrdrb\brdrs\brdrw30\brdrcf11 \cellx9772 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_512_BYTE_ALIGNMENT{\fs24 \cell }{\f11 0x000001ff}\cell The buffer needs to be aligned on a 512 byte boundary{\fs24 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\fs24 \row }\pard 
\sa240\widctlpar\tx576 
\par \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\kerning28 4.2.14.9\tab SMB_QUERY_FILE_ALT_NAME_INFO
\par }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx3377\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx8417 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Data Block Encoding\line ========================\cell 
Description\line ====================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3377\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx8417 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG FileNameLength\cell Length of the file name in number of bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd 
\trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3377\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx8417 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
STRING FileName\cell Name of the file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s16\sa240\widctlpar\tx576 \f11\fs20 {\f4 
\par }\pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\kerning28 4.2.14.10\tab SMB_QUERY_FILE_STREAM_INFO
\par }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4860\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Data Block Encoding\line ===============================\cell 
Description\line ====================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG NextEntryOffset\cell Offset to the next entry (in bytes)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG StreamNameLength\cell Length of the stream name in number of bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LARGE_INTEGER StreamSize\cell Size of the stream in number of bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 LARGE_INTEGER StreamAllocationSize\cell Allocated size of the stream in number of bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING FileName\cell Name of the stream \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard 
\sa240\widctlpar\tx576 
\par \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\kerning28 4.2.14.11\tab SMB_QUERY_FILE_COMPRESSION_INFO
\par }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4860\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Data Block Encoding\line ===============================\cell 
Description\line ====================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LARGE_INTEGER CompressedFileSize\cell Size of the compressed file in number of bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT CompressionFormat\cell A constant signifying the compression algorithm used\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR CompressionUnitShift\cell Size of the stream in number of bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 UCHAR ChunkShift\cell Allocated size of the stream in number of bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR ClusterShift\cell 
Allocated size of the stream in number of bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Reserved[3]\cell Name of the stream \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par typedef struct \{\line     LARGE_INTEGER CompressedFileSize;\line     USHORT CompressionFormat;\line     UCHAR CompressionUnitShift;\line     UCHAR ChunkShift;\line     UCHAR ClusterShift;\line     UCHAR Reserved[3];\line \} FILE_COMPRESSION_INFORMATION;

\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655329}4.2.15\tab  }{\*\bkmkstart _Toc382909325}{\*\bkmkstart _Toc382911236}
TRANS2_QUERY_FILE_INFORMATION: Get File Attributes Given FID{\*\bkmkend _Toc365655329}{\*\bkmkend _Toc382909325}{\*\bkmkend _Toc382911236}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 {\kerning28 This request is used to get information about a specific file or subdirectory given a handle to it.
\par }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4050\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Client Request\line ==========================\cell 
Value\line ==========================================\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4050\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 WordCount\cell 15\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 MaxSetupCount\cell 0\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 
SetupCount\cell 1\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Setup[0]\cell TRANS2_QUERY_FILE_INFORMATION\cell }\pard\plain 
\widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4050\clbrdrt
\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {
\kerning28 Parameter Block Encoding\line ==========================\cell Description\line ==========================================\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 
\clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4050\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 USHORT Fid;\cell 
Handle of file for request\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4050\clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 USHORT InformationLevel;\cell Level of information requested\cell }\pard\plain 
\widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard \sa240\widctlpar\tx576 {\kerning28 
\par The available information levels, as well as the format of the response are identical to }{\f11\fs18\kerning28 TRANS2_QUERY_PATH_INFORMATION}{\kerning28 .
\par }\pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\caps\f5 {\*\bkmkstart _Toc365655330}4.2.16\tab  }{\caps {\*\bkmkstart _Toc382909326}{\*\bkmkstart _Toc382911237}TRANS2_SET_PATH_INFORMATION}
{\*\bkmkend _Toc358532240}: Set File Attributes given Path{\caps {\*\bkmkend _Toc365655330}{\*\bkmkend _Toc382909326}{\*\bkmkend _Toc382911237}
\par }\pard\plain \sa240\widctlpar\tx576 \f4\fs20 {\kerning28 This request is used to set information about a specific file or subdirectory.
\par }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4050\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Client Request\line ==========================\cell 
Value\line =========================================\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4050\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 WordCount\cell 15\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 MaxSetupCount\cell 0\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 
SetupCount\cell 1\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Setup[0]\cell TRANS2_SET_PATH_INFORMATION\cell }\pard\plain \widctlpar\intbl 
\f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4050\clbrdrt\brdrs\brdrw15\brdrcf1 
\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 
Parameter Block Encoding\line ==========================\cell Description\line =========================================\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \cellx4050\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 USHORT InformationLevel;\cell 
Level of information to set\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 ULONG Reserved;\cell Must be zero\cell }\pard\plain 
\widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4050\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 STRING FileName;\cell File or directory name\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard 
\sa240\widctlpar\tx576 {\kerning28 
\par The following }{\i\kerning28 InformationLevels}{\kerning28  may be set:
\par }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4140\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Information Level\line ==========================
\cell Value\line =========================================\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4140\clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 SMB_INFO_STANDARD\cell 1\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 SMB_INFO_QUERY_EA_SIZE\cell 2\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4140\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
{\kerning28 SMB_INFO_QUERY_ALL_EAS\cell 4\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard \sa240\widctlpar\tx576 {\kerning28 
\par The response formats are:
\par }\pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\kerning28 {\*\bkmkstart _Toc358532241}4.2.16.1\tab SMB_INFO_STANDARD & SMB_INFO_QUERY_EA_SIZE{\*\bkmkend _Toc358532241}
\par }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Parameter Block Encoding\line 
==================================\cell Description\line =================================\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220
\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 USHORT Reserved\cell 0\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 
\row }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Data Block Encoding\line 
==================================\cell Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_DATE CreationDate;\cell Date when file was created\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_TIME CreationTime;\cell Time when file was created\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_DATE LastAccessDate;\cell Date of last file access\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
SMB_TIME LastAccessTime;\cell Time of last file access\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_DATE LastWriteDate;\cell Date of last write to the file\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_TIME LastWriteTime;\cell Time of last write to the file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG  DataSize;\cell File Size\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
ULONG AllocationSize;\cell Size of filesystem allocation unit\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Attributes;\cell File Attributes\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG EaSize;\cell Size of file's EA information ({\f11\fs18 SMB_INFO_QUERY_EA_SIZE})\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard 
\sa240\widctlpar\tx576 {\kerning28 {\*\bkmkstart _Toc358532242}
\par }\pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\kerning28 4.2.16.2\tab SMB_INFO_QUERY_ALL_EAS{\*\bkmkend _Toc358532242}
\par }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx3240\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Response Field\line ====================\cell Value
\line ===============================================\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3240\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 MaxDataCount\cell Length of FEAlist found (minimum value is 4)\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 
\row }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx3240\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Parameter Block Encoding
\line ====================\cell Description\line ===============================================\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 
\cellx3240\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 USHORT EaErrorOffset\cell Offset into EAList of EA error\cell 
}\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx3240
\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
Data Block Encoding\line ====================\cell Description\line ===============================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 
\cellx3240\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG ListLength;\cell Length of the remaining data\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3240\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR EaList[]\cell The extended attributes list\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 {\*\bkmkstart _Toc358532243}
{\*\bkmkstart _Toc358532244}
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\caps\f5 {\*\bkmkstart _Toc365655331}{\*\bkmkend _Toc358532243}4.2.17\tab  }{\caps {\*\bkmkstart _Toc382909327}{\*\bkmkstart _Toc382911238}
TRANS2_SET_FILE_INFORMATION}{\*\bkmkend _Toc358532244}: Set File Attributes Given FID{\caps {\*\bkmkend _Toc365655331}{\*\bkmkend _Toc382909327}{\*\bkmkend _Toc382911238}
\par }\pard\plain \sa240\widctlpar\tx576 \f4\fs20 {\kerning28 This request is used to set information about a specific file or subdirectory given a handle to the file or subdirectory.
\par }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4050\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Client Request\line ==========================\cell 
Value\line ==========================================\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4050\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 WordCount\cell 15\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 MaxSetupCount\cell 0\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 
SetupCount\cell 1\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Setup[0]\cell TRANS2_SET_FILE_INFORMATION\cell }\pard\plain \widctlpar\intbl 
\f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4050\clbrdrt\brdrs\brdrw15\brdrcf1 
\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 
Parameter Block Encoding\line ==========================\cell Description\line ==========================================\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \cellx4050\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 USHORT Fid;\cell Handle of file for request\cell 
}\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 USHORT InformationLevel;\cell Level of information requested\cell }\pard\plain \widctlpar\intbl 
\f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4050\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 USHORT Reserved;\cell }Ignored by the server{\kerning28 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard 
\sa240\widctlpar\tx576 {\kerning28 
\par }\pard \sa240\keepn\widctlpar\tx576 {\kerning28 The following }{\i\kerning28 InformationLevels}{\kerning28  may be set:
\par }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4950\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5958 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Information Level\line 
================================\cell Value\line =====\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4950\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx5958 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_INFO_STANDARD{\kerning28 \cell 1\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_INFO_QUERY_EA_SIZE{\kerning28 \cell 2\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
SMB_SET_FILE_BASIC_INFO{\kerning28 \cell 0x101\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_SET_FILE_DISPOSITION_INFO{\kerning28 \cell 0x102\cell 
}\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_SET_FILE_ALLOCATION_INFO{\kerning28 \cell 0x103\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 
\row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4950\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx5958 \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_SET_FILE_END_OF_FILE_INFO{\kerning28 \cell 0x104\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard \sa240\widctlpar\tx576 {\kerning28 
\par The two levels below 0x101 are as described in the }{\f11\fs18\kerning28 NT_SET_PATH_INFORMATION}{\kerning28 
 transaction.  The requested information is placed in the Data portion of the transaction response. For the information levels greater than 0x100, the transaction response has 1 parameter word which should be ignored by the client.
\par }\pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\kerning28 4.2.17.1\tab SMB_FILE_DISPOSITION_INFO
\par }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx3240\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Response Field\line ====================\cell Value
\line ===============================================\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3240\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 BOOLEAN  FileIsDeleted\cell A boolean which is TRUE if the file is marked for deletion\cell }\pard\plain \widctlpar\intbl 
\f4\fs20 {\kerning28 \row }\pard \sa240\widctlpar\tx576 
\par \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\kerning28 4.2.17.2\tab SMB_FILE_ALLOCATION_INFO
\par }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx3240\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Response Field\line ====================\cell Value
\line ===============================================\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3240\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 LARGE_INTEGER\cell File Allocation size in number of bytes\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row 
}\pard \sa240\widctlpar\tx576 
\par \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\kerning28 4.2.17.3\tab SMB_FILE_END_OF_FILE_INFO
\par }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx3240\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Response Field\line ====================\cell Value
\line ===============================================\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3240\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 LARGE_INTEGER\cell 
The total number of bytes that need to be traversed from the beginning of the file in order to locate the end of the file \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard \sa240\widctlpar\tx576 {\kerning28 
\par 
\par }\pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i\kerning28 {\*\bkmkstart _Toc365655332}{\*\bkmkend _Toc358532173}4.3\tab  }{\kerning28 {\*\bkmkstart _Toc382909328}{\*\bkmkstart _Toc382911239}Directory Requests
{\*\bkmkend _Toc365655332}{\*\bkmkend _Toc382909328}{\*\bkmkend _Toc382911239}
\par }\pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\kerning28 4.3.1\tab  }{\b0\f5 {\*\bkmkstart _Toc365655333} }TRANS2_CREATE_DIRECTORY: Create Directory (with optional EAs){\kerning28 
{\*\bkmkend _Toc365655333}
\par }\pard\plain \sa240\widctlpar\tx576 \f4\fs20 {\kerning28 This requests the server to create a directory relative to }{\i\kerning28 Tid}{\kerning28  in the SMB header, optionally assigning extended attributes to it.
\par }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4050\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Client Request\line ==========================\cell 
Value\line =========================================\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4050\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 WordCount\cell 15\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 MaxSetupCount\cell 0\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 
SetupCount\cell 1\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Setup[0]\cell TRANS2_CREATE_DIRECTORY\cell }\pard\plain \widctlpar\intbl 
\f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4050\clbrdrt\brdrs\brdrw15\brdrcf1 
\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 
Parameter Block Encoding\line ==========================\cell Description\line =========================================\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \cellx4050\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 ULONG Reserved;\cell Reserved--must be zero\cell 
}\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 STRING Name[];\cell Directory name to create\cell }\pard\plain \widctlpar\intbl \f4\fs20 {
\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4050\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 UCHAR Data[];\cell Optional FEAList for the new directory\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard \sa240\widctlpar\tx576 {
\kerning28 
\par }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4050\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Response Parameter Block\line 
==========================\cell Description\line =========================================\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \cellx4050\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 
USHORT EaErrorOffset\cell Offset into FEAList of first error which occurred while setting EAs\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {
\b0\f5 {\*\bkmkstart _Toc365655334}4.3.2\tab  }{\*\bkmkstart _Toc382909329}{\*\bkmkstart _Toc382911240}DELETE_DIRECTORY: Delete Directory{\*\bkmkend _Toc365655334}{\*\bkmkend _Toc382909329}{\*\bkmkend _Toc382911240}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 The delete directory message is sent to delete an empty directory.  The appropriate {\i Tid} and additional pathname are passed.  The directory must be empty for it to be deleted.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes;    min = 2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UCHAR BufferFormat;\cell 0x04\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING DirectoryName[];\cell Directory name\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard 
\sa240\widctlpar\tx576 
\par The directory to be deleted cannot be the root of the share specified by {\i Tid}.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc358532164}{\*\bkmkstart _Toc365655335}
4.3.3\tab  }{\*\bkmkstart _Toc382909330}{\*\bkmkstart _Toc382911241}CHECK_DIRECTORY: Check Directory{\*\bkmkend _Toc358532164}{\*\bkmkend _Toc365655335}{\*\bkmkend _Toc382909330}{\*\bkmkend _Toc382911241}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 
This SMB is used to verify that a path exists and is a directory.  No error is returned if the given path exists and the client has read access to it.  Client machines which maintain a concept of a "working directory" will find this useful to verify the v
alidity of a "change working directory" command.  Note that the servers do NOT have a concept of working directory for a particular client.  The client must always supply full pathnames relative to the {\i Tid} in the SMB header.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes;    min = 2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UCHAR BufferFormat;\cell 0x04\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING DirectoryPath[];\cell Directory path\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard 
\sa240\widctlpar\tx576 
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par DOS clients, in particular, depend on the SMB_ERR_BAD_PATH return code if the directory is not found.
\par \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\*\bkmkstart _Toc358532223}{\*\bkmkend _Toc358532198}4.3.3.1\tab Errors
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 ERRDOS/ERRbadfile\line ERRDOS/ERRbadpath\line ERRDOS/ERRnoaccess\line ERRHRD/ERRdata\line ERRSRV/ERRinvid\line ERRSRV/ERRbaduid\line ERRSRV/ERRaccess
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655336}4.3.4\tab  }{\*\bkmkstart _Toc382909331}{\*\bkmkstart _Toc382911242}TRANS2_FIND_FIRST2{\*\bkmkend _Toc358532223}
: Search Directory using Wildcards{\*\bkmkend _Toc365655336}{\*\bkmkend _Toc382909331}{\*\bkmkend _Toc382911242}
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4410\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ============================\cell Value
\line ==================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4410\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 WordCount\cell 15\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
TotalDataCount\cell Total size of extended attribute list\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SetupCount\cell 1\cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Setup[0]\cell TRANS2_FIND_FIRST2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl
\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4410\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10350 \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 
\clcfpat7\clcbpat8\clshdng3000 \cellx4410\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 \cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 
\cellx4410\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 Parameter Block Encoding\line ==================================\cell Description\line ==================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \cellx4410\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT SearchAttributes;\cell \cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT SearchCount;\cell Maximum number of entries to return\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Flags;\cell Additional information:\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20  
\cell Bit 0 - close search after this request\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell Bit 1 - close search if end of search reached\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell Bit 2 - return resume keys for each entry found\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell Bit 3 - continue search from previous ending place\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell 
Bit 4 - find with backup intent\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT InformationLevel;\cell See below\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG SearchStorageType;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
STRING FileName;\cell Pattern for the search\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4410\clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Data[ TotalDataCount ]\cell FEAList if InformationLevel is {\f11\fs18 QUERY_EAS_FROM_LIST
}\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4410\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Response Parameter Block\line ============================\cell 
Description\line ==================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4410\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Sid;\cell Search handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT SearchCount;\cell Number of entries returned\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT EndOfSearch;\cell Was last entry returned?\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT EaErrorOffset;\cell Offset into EA list if EA error\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT LastNameOffset;\cell Offset into data to file name of last entry, if server needs it to resume search; else 0\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4410\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Data[ TotalDataCount ]\cell Level dependent info about the matches found in the search\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par This request allows the client to search for the file(s) which match the file specification.  The search can be continued if necessary with {\f11\fs18 TRANS2_FIND_NEXT2. }
There are numerous levels of information which may be obtained for the returned files, the desired level is specified in the {\i InformationLevel} field of the request.
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx7740 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 InformationLevel Name\line =================================
\cell Value\line ================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx7740 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 SMB_INFO_STANDARD\cell }1\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 {\f11\fs18 SMB_INFO_QUERY_EA_SIZE\cell }2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 SMB_INFO_QUERY_EAS_FROM_LIST\cell }3\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 SMB_FIND_FILE_DIRECTORY_INFO\cell }0x101\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 SMB_FIND_FILE_FULL_DIRECTORY_INFO\cell }0x102\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {
\f11\fs18 SMB_FIND_FILE_NAMES_INFO\cell }0x103\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx7740 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 SMB_FIND_FILE_BOTH_DIRECTORY_INFO\cell }0x104\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 {\kerning28 
\par }The following sections detail the data returned for each InformationLevel. {\kerning28 The requested information is placed in the }{\i\kerning28 Data}{\kerning28  portion of the transaction response. Note: a} client which does not support long na
mes can only request {\f11\fs18 SMB_INFO_STANDARD.}  
\par A four-byte resume key precedes each data item (described below) if bit 2 in the Flags field is set, i.e. if the request indicates the server should return resume keys. 
\par \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\*\bkmkstart _Toc358532224}4.3.4.1\tab SMB_INFO_STANDARD{\*\bkmkend _Toc358532224}
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5040\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Response Field\line ================================\cell 
Description\line ==================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5040\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_DATE CreationDate;\cell Date when file was created\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_TIME CreationTime;\cell Time when file was created\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
SMB_DATE LastAccessDate;\cell Date of last file access\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_TIME LastAccessTime;\cell Time of last file access\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_DATE LastWriteDate;\cell Date of last write to the file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_TIME LastWriteTime;\cell Time of last write to the file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG  DataSize;\cell File Size\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG AllocationSize;\cell 
Size of filesystem allocation unit\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Attributes;\cell File Attributes\cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR FileNameLength;\cell Length of filename in bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5040\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 STRING FileName;\cell Name of found file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\*\bkmkstart _Toc358532225}4.3.4.2\tab SMB_INFO_QUERY_EA_SIZE
{\*\bkmkend _Toc358532225}
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Response Field\line =================================\cell 
Description\line ==================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_DATE CreationDate;\cell Date when file was created\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20  SMB_TIME CreationTime;\cell Time when file was created\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
 SMB_DATE LastAccessDate;\cell Date of last file access\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20  SMB_TIME LastAccessTime;\cell Time of last file access\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20  SMB_DATE LastWriteDate;\cell Date of last write to the file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20  SMB_TIME LastWriteTime;\cell Time of last write to the file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20  ULONG DataSize;\cell File Size\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20  ULONG AllocationSize;\cell 
Size of filesystem allocation unit\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20  USHORT Attributes;\cell File Attributes\cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20  ULONG EaSize;\cell Size of file's EA information\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20  UCHAR FileNameLength;\cell Length of filename in bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 
\clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20  STRING FileName;\cell 
Name of found file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\*\bkmkstart _Toc358532226}4.3.4.3\tab SMB_INFO_QUERY_EAS_FROM_LIST{\*\bkmkend _Toc358532226}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 This request returns the same information as {\f11\fs18 SMB_INFO_QUERY_EA_SIZE}, but only for files which have an EA list which match the EA information in the {\i Data} part of the request.
\par \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 {\*\bkmkstart _Toc358532227}4.3.4.4\tab SMB_FIND_FILE_DIRECTORY_INFO{\*\bkmkend _Toc358532227}
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Response Field\line =================================\cell 
Description\line ==================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG NextEntryOffset;\cell Offset from this structure to beginning of next one\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG FileIndex;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
LARGE_INTEGER CreationTime;\cell file creation time\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LARGE_INTEGER LastAccessTime;\cell last access time\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LARGE_INTEGER LastWriteTime;\cell last write time\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LARGE_INTEGER ChangeTime;\cell last attribute change time\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
LARGE_INTEGER EndOfFile;\cell file size\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LARGE_INTEGER AllocationSize;\cell size of filesystem allocation information 
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG ExtFileAttributes;\cell Extended file attributes (see section {\field{\*\fldinst  REF _Ref365631713 \\n 
}{\fldrslt 3.11}})\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG FileNameLength;\cell Length of filename in bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING FileName;\cell Name of the file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 {\*\bkmkstart _Toc358532228}
\par \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 4.3.4.5\tab SMB_FIND_FILE_FULL_DIRECTORY_INFO{\*\bkmkend _Toc358532228}
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Response Field\line =================================\cell 
Description\line ==================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG NextEntryOffset;\cell Offset from this structure to beginning of next one\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG FileIndex;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
LARGE_INTEGER CreationTime;\cell file creation time\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LARGE_INTEGER LastAccessTime;\cell last access time\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LARGE_INTEGER LastWriteTime;\cell last write time\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LARGE_INTEGER ChangeTime;\cell last attribute change time\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
LARGE_INTEGER EndOfFile;\cell file size\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LARGE_INTEGER AllocationSize;\cell size of filesystem allocation information 
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG ExtFileAttributes;\cell Extended file attributes (see section {\field{\*\fldinst  REF _Ref365631713 \\n 
}{\fldrslt 3.11}})\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG FileNameLength;\cell Length of filename in bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG EaSize;\cell Size of file's extended attributes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 STRING FileName;\cell Name of the file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 {\*\bkmkstart _Toc358532229}
\par \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 4.3.4.6\tab SMB_FIND_FILE_BOTH_DIRECTORY_INFO{\*\bkmkend _Toc358532229}
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Response Field\line =================================\cell 
Description\line ==================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG NextEntryOffset;\cell Offset from this structure to beginning of next one\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG FileIndex;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
LARGE_INTEGER CreationTime;\cell file creation time\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LARGE_INTEGER LastAccessTime;\cell last access time\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LARGE_INTEGER LastWriteTime;\cell last write time\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LARGE_INTEGER ChangeTime;\cell last attribute change time\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
LARGE_INTEGER EndOfFile;\cell file size\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 LARGE_INTEGER AllocationSize;\cell size of filesystem allocation information 
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG ExtFileAttributes;\cell Extended file attributes (see section {\field{\*\fldinst  REF _Ref365631713 \\n 
}{\fldrslt 3.11}})\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG FileNameLength;\cell Length of FileName in bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG EaSize;\cell Size of file's extended attributes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR ShortNameLength;\cell Length of file's short name in bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UCHAR Reserved\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 WCHAR ShortName[12];\cell File's 8.3 conformant name in Unicode\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING FileName;\cell Files full length name\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 {\*\bkmkstart _Toc358532230}
\par \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 4.3.4.7\tab SMB_FIND_FILE_NAMES_INFO{\*\bkmkend _Toc358532230}
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Response Field\line =================================\cell 
Description\line ==================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG NextEntryOffset;\cell Offset from this structure to beginning of next one\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG FileIndex;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
ULONG FileNameLength;\cell Length of FileName in bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING FileName;\cell Files full length name\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s16\sa240\widctlpar\tx576 \f11\fs20 {\f4 {\*\bkmkstart _Toc358532232}{\*\bkmkstart _Toc365655337} {\*\bkmkstart _Toc382909332}{\*\bkmkstart _Toc382911243}
\par }\pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 4.3.5\tab TRANS2_FIND_NEXT2{\*\bkmkend _Toc358532232}: Resume Directory Search Using Wildcards{\*\bkmkend _Toc365655337}{\*\bkmkend _Toc382909332}
{\*\bkmkend _Toc382911243}
\par \pard\plain \sa240\keepn\widctlpar\tx576 \f4\fs20 This request resumes a search which was begun with a previous {\f11\fs18 TRANS2_FIND_FIRST2} request.
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell 
Value\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 WordCount\cell 15\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
SetupCount\cell 1\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Setup[0]\cell TRANS2_FIND_NEXT2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd 
\trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Parameter Block Encoding\line ==================================\cell 
Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Sid;\cell Search handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT SearchCount;\cell Maximum number of entries to return\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT InformationLevel;\cell Levels described in {\f11\fs18 TRANS2_FIND_FIRST2} request\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG ResumeKey;\cell 
Value returned by previous find2 call\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Flags;\cell Additional information: bit set-\line 
0 - close search after this request\line 1 - close search if end of search reached\line 2 - return resume keys for each entry found\line 3 - resume/continue from previous ending place\line 4 - find with backup intent\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING FileName;\cell Resume file name\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par {\i Sid} is the value returned by a previous successful {\f11\fs18 TRANS2_FIND_FIRST2} call.  If {\i Bit3} of {\i Flags} is set, then {\i FileName} may be the NULL string, since the search is continued from the previous {\f11\fs18 TRANS2_FIND}
 request.  Otherwise, {\i FileName} must not be more than 256 characters long. 
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Response Field\line ==================================\cell 
Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT SearchCount;\cell Number of entries returned\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT EndOfSearch;\cell Was last entry returned?\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT EaErrorOffset;\cell Offset into EA list if EA error\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT LastNameOffset;\cell 
Offset into data to file name of last entry, if server needs it to resume search; else 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Data[TotalDataCount]
\cell Level dependent info about the matches found in the search\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 {\kerning28 {\*\bkmkstart _Toc358532256}{\*\bkmkstart _Toc365655338}{\*\bkmkstart _Toc358532196}
\par }\pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5\kerning28 4.3.6\tab  }{\kerning28 {\*\bkmkstart _Toc382909333}{\*\bkmkstart _Toc382911244}FIND_CLOSE2: Close Directory Search
{\*\bkmkend _Toc358532256}{\*\bkmkend _Toc365655338}{\*\bkmkend _Toc382909333}{\*\bkmkend _Toc382911244}
\par }\pard\plain \sa240\widctlpar\tx576 \f4\fs20 {\kerning28 This SMB closes a search started by the }{\f11\fs18\kerning28 TRANS2_FIND_FIRST2}{\kerning28  transaction request.
\par }\trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Client Request\line ==================================\cell 
Description\line ==================================\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 UCHAR WordCount;\cell Count of parameter words = 1\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row 
}\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 USHORT Sid;\cell Find handle\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
{\kerning28 USHORT ByteCount;\cell Count of data bytes = 0\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard \sa240\widctlpar\tx576 {\kerning28 
\par }\trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line {\kerning28 ==================================}
\cell Description\line {\kerning28 ==================================}\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl
\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20  USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 4.3.6.1\tab Errors
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 ERRDOS/ERRbadfid\line ERRSRV/ERRinvid\line ERRSRV/ERRaccess
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5\kerning28 {\*\bkmkstart _Toc365655339}{\*\bkmkend _Toc358532196}4.3.7\tab  }{\kerning28 {\*\bkmkstart _Toc382909334}{\*\bkmkstart _Toc382911245}
NT_TRANSACT_NOTIFY_CHANGE: Request Change Notification{\*\bkmkend _Toc365655339}{\*\bkmkend _Toc382909334}{\*\bkmkend _Toc382911245}
\par }\trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Client Setup Words\line 
==================================\cell Description\line =================================\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220
\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 ULONG CompletionFilter;\cell Specifies operation to monitor\cell }\pard\plain 
\widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 USHORT Fid;\cell Fid of directory to monitor\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row 
}\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 BOOLEAN WatchTree;\cell TRUE = watch all subdirectories too\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 
\clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 UCHAR Reserved;\cell MBZ\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard \sa240\widctlpar\tx576 {\kerning28 
\par }This command notifies the client when the directory specified by {\i Fid} is modified.  It also returns the name(s) of the file(s) that changed.  The command completes once the directory has been modified based on the supplied {\i CompletionFilter}
.  The command is a "single shot" and therefore needs to be reissued to watch for more directory changes.
\par A directory file must be opened before this command may be used.  Once the directory is open, this command may be used to begin watching files and subdirectories in the specified directory for changes.  The first time the command is issued, the {\i 
MaxParameterCount} field in the transact header determines the size of the buffer that will be used at the server to buffer directory change information between issuances of the notify change commands.
\par When a change that is in the {\i CompletionFilter} is made to the directory, the command completes.  The names of the files that have changed since the last time the command was issued are returned to the client.  The {\i ParameterCount}
 field of the response indicates the number of bytes that are being returned.  If too many files have changed since the last time the command was issued, then zero bytes are returned and an alternate status code is returned in the {\i Status}
 field of the response.
\par The {\i CompletionFilter} is a mask created as the sum of any of the following flags:
\par \trowd \trgaph108\trleft-108 \cellx5184\cellx8820 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_NOTIFY_CHANGE_FILE_NAME\cell 0x00000001\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd 
\trgaph108\trleft-108 \cellx5184\cellx8820 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_NOTIFY_CHANGE_DIR_NAME\cell 0x00000002\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_NOTIFY_CHANGE_NAME\cell 0x00000003\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
FILE_NOTIFY_CHANGE_ATTRIBUTES\cell 0x00000004\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_NOTIFY_CHANGE_SIZE\cell 0x00000008\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_NOTIFY_CHANGE_LAST_WRITE\cell 0x00000010\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_NOTIFY_CHANGE_LAST_ACCESS\cell 0x00000020\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
FILE_NOTIFY_CHANGE_CREATION\cell 0x00000040\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_NOTIFY_CHANGE_EA\cell 0x00000080\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_NOTIFY_CHANGE_SECURITY\cell 0x00000100\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_NOTIFY_CHANGE_STREAM_NAME\cell 0x00000200\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
FILE_NOTIFY_CHANGE_STREAM_SIZE\cell 0x00000400\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft-108 \cellx5184\cellx8820 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
FILE_NOTIFY_CHANGE_STREAM_WRITE\cell 0x00000800\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell 
Description\line ==================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ParameterCount\cell # of bytes of change data\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl
\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Parameters[ ParameterCount ]\cell FILE_NOTIFY_INFORMATION structures\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par The response contains FILE_NOTIFY_INFORMATION structures, as defined below.  The NextEntryOffset field of the structure specifies the offset, in bytes, from the start of the current entry to the next entry in the list.  If this is the last entry in the li
st, this field is zero.  Each entry in the list must be longword aligned, so NextEntryOffset must be a multiple of four.
\par \pard\plain \s22\sa240\sl-240\slmult0\widctlpar\tx576\tx1152\tx1728\tx2304 \f11\fs20 typedef struct \{\line     ULONG NextEntryOffset;\line     ULONG Action;\line     ULONG FileNameLength;\line     WCHAR FileName[1];\line \} FILE_NOTIFY_INFORMATION;

\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 Where {\i Action} describes what happened to the file named {\i FileName}:
\par \trowd \trgaph108\trleft-108 \cellx4140\cellx6120 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_ACTION_ADDED\cell 0x00000001\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft-108 
\cellx4140\cellx6120 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_ACTION_REMOVED\cell 0x00000002\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_ACTION_MODIFIED\cell 0x00000003\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_ACTION_RENAMED_OLD_NAME
\cell 0x00000004\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_ACTION_RENAMED_NEW_NAME\cell 0x00000005\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FILE_ACTION_ADDED_STREAM\cell 0x00000006\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 FILE_ACTION_REMOVED_STREAM\cell 0x00000007\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft-108 \cellx4140\cellx6120 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
FILE_ACTION_MODIFIED_STREAM\cell 0x00000008\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc365655340}{\*\bkmkstart _Toc358532247}{\*\bkmkstart _Toc358532183}{\*\bkmkend _Toc358532165}4.4\tab  }{\*\bkmkstart _Toc382909335}
{\*\bkmkstart _Toc382911246}DFS Operations{\*\bkmkend _Toc365655340}{\*\bkmkend _Toc382909335}{\*\bkmkend _Toc382911246}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 {\*\bkmkstart _Toc365655341} 
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\caps\f5 4.4.1\tab  }{\caps {\*\bkmkstart _Toc382909336}{\*\bkmkstart _Toc382911247}TRANS2_GET_DFS_REFERRAL: }Retrieve Distributed Filesystem{\caps  }
Referral{\caps {\*\bkmkend _Toc358532247}{\*\bkmkend _Toc365655341}{\*\bkmkend _Toc382909336}{\*\bkmkend _Toc382911247}
\par }\pard\plain \sa240\widctlpar\tx576 \f4\fs20 {\cf1 The client sends this request to ask the server to convert }{\i\cf1 RequestFilename}{\cf1  into an alternate name for this file.  This request can be sent to the server if the server response to the }{
\f11\fs18\cf1 NEGOTIATE SMB}{\cf1  included the }{\f11\fs18\cf1 CAP_DFS}{\cf1  capability.  The TID of the request must be IPC$.  }{\i\cf1 Bit15}{\cf1  of }{\i\cf1 Flags2}{\cf1  in the SMB header must be set, indicating this is a UNICODE request.
\par }\trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4050\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==========================\cell Description\line 
=========================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4050\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 WordCount\cell 15\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 TotalDataCount
\cell 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SetupCount\cell 1\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Setup[0]\cell {\f11\fs18 TRANS2_GET_DFS_REFERRAL
}\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4050\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd 
\trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4050\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl
\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4050\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Parameter Block Encoding\line =========================={\cf6 \cell }Description\line 
=========================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4050\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT MaxReferralLevel\cell Latest referral version number understood\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4050\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 WCHAR RequestFileName;{\cf6 \cell }DFS name of file for which referral is sought\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 {\i\cf1 
\par }\trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4050\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Response Data Block\line ==========================\cell Description
\line =========================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4050\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT PathConsumed;\cell Number of {\i RequestFilename} bytes client\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT NumberOfReferrals;\cell Number of referrals contained in this response\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Flags;\cell bit0 - The servers in {\i Referrals}{\i\caps  }are capable of fielding TRANS2_GET_DFS_REFERRAL.
\par bit1 - The servers in {\i Referrals} should hold the storage for the requested file.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4050
\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 REFERRAL_LIST Referrals[]\cell Set of referrals for this file
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4050\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UNICODESTRINGE Strings \cell Used to hold the strings pointed to by Version 2 Referrals in {\i\caps Referrals. }\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576\tx2898\tx7308 {\cf1 
\par The server response is a list of }{\i\cf1 Referrals}{\cf1  which inform the client where it should resubmit the request to obtain access to the file.   }{\i\cf1 PathConsumed}{\cf1  in the response indicates to the client how many characters of  }{\i\cf1 
RequestFilename}{\cf1  have been consumed by the server.  When the client chooses one of the referrals to use for file access, the client may need to strip the leading }{\i\cf1 PathConsumed}{\cf1  characters from the front of }{\i\cf1 RequestFileName}{
\cf1  before submitting the name to the target server.  Whether or not the pathname should be trimmed is indicated by the individual referral as detailed below. 
\par }{\i\cf1 Flags}{\cf1  indicates how this referral should be treated.  If }{\i\cf1 bit0}{\cf1  is clear, any entity in the }{\i\cf1 Referrals}{\cf1  list holds the storage for }{\i\cf1 RequestFileName}{\cf1 .  If }{\i\cf1 bit0}{\cf1 
 is set, any entity in the }{\i\cf1 Referrals}{\cf1  list has further referral information for }{\i\cf1 RequestFilename}{\cf1  \endash  a }{\f11\fs18\cf1 TRANS2_GET_DFS_REFERRAL}{\cf1  request should be sent to an entity in the }{\i\cf1 Referrals}{\cf1 
 list for further resolution.
\par The format of an individual referral contains version and  length information allowing the client to skip referrals it does not understand.  MaxReferralLevel indicates to the server the latest version of referral which the client can digest.  Sinc
e each referral has a uniform element, }{\i\cf1 MaxReferralLevel}{\cf1  is advisory only. Each element in }{\i\cf1 Referrals}{\cf1  has this envelope:
\par }\trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10350 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 REFERRAL_LIST element\line ======================================================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrt\brdrs\brdrw30\brdrcf1 
\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4050\clbrdrt\brdrs\brdrw30\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT VersionNumber
\cell Version of this referral element\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4050\clbrdrt
\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw30\brdrcf1 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ReferralSize\cell Size of this referral element\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576\tx2898\tx7308 {\cf1 
\par The following referral element versions are defined:
\par }\trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10350 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Version 1 Referral Element Format\line ======================================================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4050\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx10350 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ServerType\cell Type of {\i Node} handling referral:\line 0 - Don't know\line 1 - SMB Server\line 2 - Netware Server\line 3 - Domain\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd 
\trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4050\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ReferralFlags\cell Flags which describe this referral:\line 01 - Strip off {\i PathConsumed} characters before submitting {\i 
RequestFileName} to {\i Node}\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4050\clbrdrt
\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UNICODESTRING Node\cell 
Name of entity to visit next \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 {\cf1 
\par }\trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10350 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Version 2 Referral Element Format\line ======================================================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrt
\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4500\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 
\cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ServerType\cell Type of {\i Node} handling referral:\line 0 - Don't know\line 1 - SMB Server\line 2 - Netware Server\line 3 - Domain\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ReferralFlags\cell Flags which describe this referral:
\par 01 - Strip off {\i PathConsumed} characters before submitting {\i RequestFileName} to {\i Node}\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Proximity\cell 
A hint describing the proximity of this server to the client. 0 indicates the closest, higher numbers indicate increasingly "distant" servers. The number is only relevant within the context of the servers listed in {\i this} particular SMB.\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG TimeToLive\cell Number of seconds for which the client can cache this referral.\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DfsPathOffset\cell Offset, in bytes from the beginning of this referral, of  the DFS Path that matched {\i PathConsumed} bytes of the {\i 
RequestFileName}{\i\caps .}\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DfsAlternatePathOffset\cell 
Offset, in bytes from the beginning of this referral, of an alternate name (8.3 format) of the DFS Path that matched {\i PathConsumed} bytes of the {\i RequestFileName}{\i\caps .}\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrt
\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4500\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 
\cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT NetworkAddressOffset\cell Offset, in bytes from the beginning of this referral, of the entity to visit next.\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard \sa240\widctlpar\tx576 {\cf1 
\par The CIFS protocol imposes no referral selection policy.
\par }\pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc358532248}{\*\bkmkstart _Toc365655342}4.4.2\tab  }{\*\bkmkstart _Toc382909337}{\*\bkmkstart _Toc382911248}
TRANS2_REPORT_DFS_INCONSISTENCY: Inform a server about DFS Error{\*\bkmkend _Toc358532248}{\*\bkmkend _Toc365655342}{\*\bkmkend _Toc382909337}{\*\bkmkend _Toc382911248}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 {\cf1 
As part of the Distributed Name Resolution algorithm, a DFS client may discover a  knowledge inconsistency between the referral server (i.e., the server that handed out a referral), and the storage server (i.e., the server to which the client was redirect
ed to by the referral server). When such an inconsistency is discovered, the DFS client optionally sends this SMB to the referral server, allowing the referral server to take corrective action.
\par }\trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell Description
\line ==================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10350 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 WordCount\cell 15\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 MaxParameterCount
\cell 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SetupCount\cell {\f11\fs18 1\cell }\pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Setup[0]\cell {\f11\fs18 TRANS2_REPORT_DFS_INCONSISTENCY\cell }\pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10350 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 
\cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell \cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt
\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
Parameter Block Encoding\line ==================================\cell Description\line ==================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 
\clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UNICODESTRING RequestFileName;\cell DFS Name of file for which referral was sought\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 {\cf1 
\par The data part of this request contains the referral element (Version 1 format only) believed to be in error.  These are encoded as described in the }{\f11\fs18\cf1 TRANS2_GET_DFS_REFERRAL }{\cf1 
response.  If the server returns success, the client can resubmit the }{\f11\fs18\cf1 TRANS2_GET_DFS_REFERRAL}{\cf1  request to this server to get a new referral.  It is not mandatory for the DFS knowledge to be automatically repaired \endash 
 the client must be prepared to receive further errant referrals and must not wind up looping between this request and the }{\f11\fs18\cf1 TRANS2_GET_DFS_REFERRAL}{\cf1  request.
\par }{\i\cf1 Bit15}{\cf1  of }{\i\cf1 Flags2}{\cf1  in the SMB header must be set, indicating this is a UNICODE request.
\par }\pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc365655343}4.5\tab  }{\*\bkmkstart _Toc382909338}{\*\bkmkstart _Toc382911249}Print Spooling Operations{\*\bkmkend _Toc365655343}{\*\bkmkend _Toc382909338}
{\*\bkmkend _Toc382911249}
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655344}4.5.1\tab  }{\*\bkmkstart _Toc382909339}{\*\bkmkstart _Toc382911250}OPEN_PRINT_FILE: Create Print Spool file
{\*\bkmkend _Toc358532183}{\*\bkmkend _Toc365655344}{\*\bkmkend _Toc382909339}{\*\bkmkend _Toc382911250}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 This message is sent to create a new printer file which will be deleted once it has been closed and printed.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT SetupLength;\cell Length of printer setup data\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Mode;
\cell 0 = Text mode (DOS expands TABs)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell 1 = Graphics mode\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes;  min = 2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR BufferFormat;\cell 0x04\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130
\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING IdentifierString[];\cell Identifier string\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par {\i Tid} in the SMB header must refer to a printer resource type.
\par {\i SetupLength} is the number of bytes in the first part of the resulting print spool file which contains printer-specific control strings.
\par {\i Mode} can have the following values:
\par \trowd \trgaph108\trleft630 \cellx1530\cellx7740 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 0\cell Text mode.  The server may optionally expand tabs to a series of spaces.\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \trowd \trgaph108\trleft630 \cellx1530\cellx7740 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 1\cell Graphics mode.  No conversion of data should be done by the server.\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 {\i 
\par IdentifierString} can be used by the server to provide some sort of per-client identifying component to the print file.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 1\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Fid;\cell File handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130
\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par {\i Fid} is the returned handle which may be used by subsequent write and close operations.  When the file is finally closed, it will be sent to the spooler and printed.
\par \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 4.5.1.1\tab Errors
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 ERRDOS/ERRnoaccess\line ERRDOS/ERRnofids\line ERRSRV/ERRinvdevice\line ERRSRV/ERRbaduid\line ERRSRV/ERRqfull\line ERRSRV/ERRqtoobig
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc358532186}{\*\bkmkstart _Toc365655345}4.5.2\tab  }{\*\bkmkstart _Toc382909340}{\*\bkmkstart _Toc382911251}GET_PRINT_QUEUE
: Get Printer Queue Entries{\*\bkmkend _Toc358532186}{\*\bkmkend _Toc365655345}{\*\bkmkend _Toc382909340}{\*\bkmkend _Toc382911251}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 This message obtains a list of the elements currently in the print queue on the server.
\par \trowd \trgaph108\trleft252 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5382\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10422 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell 
Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft252 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5382\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10422 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT MaxCount;\cell Max number of entries to return\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT StartIndex;\cell First queue entry to return\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft252 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5382\clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10422 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par {\i StartIndex} specifies the first entry in the queue to return.
\par {\i MaxCount} specifies the maximum number of entries to return, this may be a positive or negative number.  A positive number requests a forward search, a negative number indicates a backward search.
\par \trowd \trgaph108\trleft252 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5382\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10422 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell 
Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft252 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5382\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10422 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Count;\cell Number of entries returned\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT RestartIndex;
\cell Index of entry after last returned\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes;  min = 3\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR BufferFormat;\cell 0x01 -- Data block\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DataLength;\cell Length of data\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft252 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \cellx5382\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10422 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Data[];\cell 
Queue elements\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par {\i Count} indicates how many entries were actually returned.  {\i RestartIndex} is the index of the entry following the last entry returned; it may be used as the {\i StartIndex} in a subsequent request to resume the queue listing.
\par The format of each returned queue element is:
\par \trowd \trgaph108\trleft252 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5112\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10422 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Queue Element Member\line ================================\cell 
Description\line ===================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft252 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5112\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10422 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_DATE FileDate;\cell Date file was queued\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_TIME FileTime;\cell Time file was queued\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Status;\cell 
Entry status.  One of:\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell 01 = held or stopped\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell 02 = printing\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell 03 = awaiting print
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell 04 = in intercept\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell 05 = file had error\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell 06 = printer error\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell 07-FF = reserved\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT SpoolFileNumber;\cell Assigned by the spooler\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
ULONG SpoolFileSize;\cell Number of bytes in spool file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Reserved;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \trowd \trgaph108\trleft252 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5112\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10422 \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR SpoolFileName[16];\cell Client which created the spool file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par SMB_COM_GET_PRINT_QUEUE will return less than the requested number of elements only when the top or end of the queue is encountered.
\par Support for this SMB is server optional.  In particular, no current Microsoft client software issues this request.
\par \pard\plain \s4\fi-864\li864\sb240\sa240\keepn\widctlpar\tx576\tx864 \b\f25 4.5.2.1\tab Errors
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 ERRHRD/ERRnotready\line ERRHRD/ERRerror\line ERRSRV/ERRbaduid
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i\kerning28 {\*\bkmkstart _Toc365655346}4.6\tab  }{\kerning28 {\*\bkmkstart _Toc382909341}{\*\bkmkstart _Toc382911252}Miscellaneous Operations{\*\bkmkend _Toc365655346}
{\*\bkmkend _Toc382909341}{\*\bkmkend _Toc382911252}
\par }\pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5\kerning28 {\*\bkmkstart _Toc365655347}4.6.1\tab  }{\kerning28 {\*\bkmkstart _Toc382909342}{\*\bkmkstart _Toc382911253}NT_TRANSACT_IOCTL
{\*\bkmkend _Toc365655347}{\*\bkmkend _Toc382909342}{\*\bkmkend _Toc382911253}
\par }\pard\plain \s21\sa240\sl-240\slmult0\widctlpar\tx360\tx600\tx840 \f4\fs20 This command allows device and file system control functions to be transferred transparently from client to server.
\par \trowd \trgaph108\trleft252 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4392\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10512 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Setup Words Encoding\line 
===========================\cell Description\line =========================================\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft252 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4392
\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10512 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 ULONG FunctionCode;\cell }NT device or file system control code{\kerning28 \cell 
}\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 USHORT Fid;\cell Handle for io or fs control.  Unless }{\i\caps\kerning28 bit0}{\kerning28  of }{
\i\caps\kerning28 IsFlags}{\kerning28  is set.\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 BOOLEAN IsFsctl;\cell }
Indicates whether the command is a device control (FALSE) or a file system control (TRUE).{\kerning28 \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {
\kerning28 UCHAR   IsFlags;\cell }{\i\caps\kerning28 bit0}{\kerning28  - command is to be applied to share root handle.  Share must be a DFS share. \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft252 \clbrdrt
\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4392\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 
\cellx10512 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft252 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4392\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10512 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft252 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4392\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10512 \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Data Block Encoding\line ===========================\cell Description\line =========================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd 
\trgaph108\trleft252 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4392\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10512 \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Data[ TotalDataCount ]\cell Passed to the Fsctl or Ioctl\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par \trowd \trgaph108\trleft252 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5382\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10512 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Server Response\line 
==================================\cell Description\line ==================================\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft252 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5382
\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10512 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 SetupCount\cell 1\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row 
}\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Setup[0]\cell Length of information returned by io or fs control\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 DataCount\cell Length of information returned by io or fs control\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft252 \clbrdrl
\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5382\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10512 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Data[ DataCount ]\cell The results of the io or fs control\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain 
\s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5\kerning28 {\*\bkmkstart _Toc358532254}{\*\bkmkstart _Toc365655348}{\*\bkmkstart _Toc358532253}{\*\bkmkstart _Toc358532252}4.6.2\tab  }{\kerning28 
{\*\bkmkstart _Toc382909343}{\*\bkmkstart _Toc382911254}NT_TRANSACT_QUERY_SECURITY_DESC{\*\bkmkend _Toc358532254}{\*\bkmkend _Toc365655348}{\*\bkmkend _Toc382909343}{\*\bkmkend _Toc382911254}
\par }\pard\plain \sa240\widctlpar\tx576 \f4\fs20 This command allows the client to retrieve the security descriptor on a file.
\par \trowd \trgaph108\trleft252 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5382\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10422 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Client Parameter Block\line 
==================================\cell Description\line =================================\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft252 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5382
\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10422 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 USHORT Fid;\cell FID of target\cell }\pard\plain \widctlpar\intbl \f4\fs20 {
\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 USHORT Reserved;\cell MBZ\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft252 \clbrdrl
\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5382\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10422 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 ULONG SecurityInformation;\cell Fields of descriptor to set\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard \sa240\widctlpar\tx576 {\f11\kerning28 
\par NtQuerySecurityObject}{\kerning28 () is called, requesting }{\i\kerning28 SecurityInformation}{\kerning28 .  The result of the call is returned to the client in the }{\i\kerning28 Data}{\kerning28  part of the transaction response.
\par }\pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5\kerning28 {\*\bkmkstart _Toc365655349}{\*\bkmkend _Toc358532253}4.6.3\tab  }{\kerning28 {\*\bkmkstart _Toc382909344}{\*\bkmkstart _Toc382911255}
NT_TRANSACT_SET_SECURITY_DESC{\*\bkmkend _Toc358532252}{\*\bkmkend _Toc365655349}{\*\bkmkend _Toc382909344}{\*\bkmkend _Toc382911255}
\par }\pard\plain \sa240\widctlpar\tx576 \f4\fs20 This command allows the client to change the security descriptor on a file.
\par \trowd \trgaph108\trleft252 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5382\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10512 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Client Parameter Block Encoding\line 
==================================\cell Description\line ==================================\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft252 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5382
\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10512 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 USHORT Fid;\cell FID of target\cell }\pard\plain \widctlpar\intbl \f4\fs20 {
\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 USHORT Reserved;\cell MBZ\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 ULONG SecurityInformation;\cell Fields of SD that to set\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft252 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl
\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5382\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10512 \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 \cell \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft252 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5382\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10512 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 \cell \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft252 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5382\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 
\cellx10512 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Data Block Encoding\line ==================================\cell Description\line ==================================\cell }\pard\plain 
\widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft252 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5382\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10512 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 Data[TotalDataCount]\cell Security Descriptor information\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row 
}\pard \sa240\widctlpar\tx576 {\kerning28 
\par }{\i\kerning28 Data}{\kerning28  is passed directly to }{\f11\kerning28 NtSetSecurityObject}{\kerning28 (), with }{\i\kerning28 SecurityInformation}{\kerning28  describing which information to set.  The transaction response contains no parameters or data.

\par }\pard\plain \s1\fi-432\li432\sb240\sa60\keepn\widctlpar\tx432\tx576 \b\f5\fs32\kerning28 {\b0 {\*\bkmkstart _Toc365655350}5\tab  }{\*\bkmkstart _Toc382909345}{\*\bkmkstart _Toc382911256}Obsolescent SMB Requests{\*\bkmkend _Toc365655350}
{\*\bkmkend _Toc382909345}{\*\bkmkend _Toc382911256}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 
This section lists the "obsolescent" SMB requests -- ones that are superseded by "best practice" requests, either in function or performance. Clients need not use them to get full function or performance, however, servers do need to support them in order 
to interoperate with existing clients.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc358532185}{\*\bkmkstart _Toc365655351}{\*\bkmkstart _Toc358532178}{\*\bkmkstart _Toc358532222}{\*\bkmkstart _Toc358532190}{\*\bkmkstart _Toc358532187}
{\*\bkmkstart _Toc358532192}{\*\bkmkstart _Toc358532188}{\*\bkmkstart _Toc358532176}{\*\bkmkstart _Toc358532179}5.1\tab  }{\*\bkmkstart _Toc382909346}{\*\bkmkstart _Toc382911257}CLOSE_PRINT_FILE:  Close and Spool Print Job{\*\bkmkend _Toc358532185}
{\*\bkmkend _Toc365655351}{\*\bkmkend _Toc382909346}{\*\bkmkend _Toc382911257}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 This message invalidates the specified file handle and queues the file for printing.
\par \trowd \trgaph108\trleft252 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5382\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10422 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell 
Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft252 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5382\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10422 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 1\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Fid;\cell File handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft252 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 
\cellx5382\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10422 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes = 0\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par {\i Fid} refers to a file previously created with SMB_COM_OPEN_PRINT_FILE.  On successful completion of this request, the file is queued for printing by the server.
\par \trowd \trgaph108\trleft252 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5382\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10422 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell 
Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft252 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5382\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10422 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft252 
\clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5382\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10422 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par Servers which negotiate dialects of LANMAN1.0 and newer allow all the other types of {\i Fid} closing requests to invalidate the {\i Fid} and begin spooling.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc365655352}5.2\tab  }{\*\bkmkstart _Toc382909347}{\*\bkmkstart _Toc382911258}CREATE: Create File{\*\bkmkend _Toc365655352}{\*\bkmkend _Toc382909347}
{\*\bkmkend _Toc382911258}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 This message is sent to create a new data file or truncate an existing data file to length zero, and open the file.  The handle returned can be used in subsequent read, write, lock, unlock and close messages.

\par \trowd \trgaph108\trleft252 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5382\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10422 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell 
Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft252 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5382\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10422 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 3\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT FileAttributes;\cell New file attributes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UTIME CreationTime;\cell Time file was created\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes;    min = 2\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR BufferFormat;\cell 0x04\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft252 \clbrdrl\brdrs\brdrw30\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5382\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10422 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 STRING FileName[];\cell File name\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par {\i FileName} is the fully qualified name of the file relative to {\i Tid}.
\par {\i FileAttributes} are encoded as described in "File Attribute Encoding",  section {\field{\*\fldinst  REF _Ref365632120 \\n }{\fldrslt 3.10}}.
\par Server support of the {\i CreationTime} field is optional.  Encoding of these fields is discussed in the "Time And Date Encoding" section.
\par \trowd \trgaph108\trleft252 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5382\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10422 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell 
Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft252 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5382\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10422 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 1\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Fid;\cell File handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft252 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 
\cellx5382\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10422 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes = 0\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par Clients must have write permission on the file's parent directory in order to create a new file, or write permission on the file itself in order to truncate it.  The access permissions granted on a 
created file will be read/write permission for the creator.  Access permissions for truncated files are not modified.  The newly created  or  truncated file is opened in read/write/compatibility mode.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc365655353}5.3\tab  }{\*\bkmkstart _Toc382909348}{\*\bkmkstart _Toc382911259}CREATE_DIRECTORY: Create Directory{\*\bkmkend _Toc365655353}
{\*\bkmkend _Toc382909348}{\*\bkmkend _Toc382911259}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 The create directory message is sent to create a new directory.  The appropriate {\i Tid} and additional pathname are passed.  The directory must not exist for it to be created.
\par \trowd \trgaph108\trleft-108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5022\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10062 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line 
==================================\cell Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft-108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5022\clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10062 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes;    min = 2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR BufferFormat;\cell 0x04\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft-108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 
\cellx5022\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10062 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING DirectoryName[];\cell Directory name\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par Servers require clients to have at least {\i create} permission for the subtree containing the directory in order to create a new directory.  The creator's access rights to the new directory are be determined by local policy on the server.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard \sa240\widctlpar\intbl\tx576 Server Response\line ==================================\cell Description\line =================================\cell \pard 
\widctlpar\intbl \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard \sa240\widctlpar\intbl\tx576 UCHAR WordCount;\cell 
Count of parameter words = 0\cell \pard \widctlpar\intbl \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10170 \pard \sa240\widctlpar\intbl\tx576 USHORT ByteCount;\cell Count of data bytes = 0\cell \pard \widctlpar\intbl \row \pard \sa240\widctlpar\tx576 
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc365655354}5.4\tab  }{\*\bkmkstart _Toc382909349}{\*\bkmkstart _Toc382911260}CREATE_NEW: Create File{\*\bkmkend _Toc358532178}{\*\bkmkend _Toc365655354}
{\*\bkmkend _Toc382909349}{\*\bkmkend _Toc382911260}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 This message is sent to create a new data file or truncate an existing data file to length zero, and open the file.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 3\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT FileAttributes;\cell New file attributes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UTIME CreationTime;\cell Creation time for created file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes;  min = 2\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR BufferFormat;\cell 0x04\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl
\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING FileName[];\cell File name\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par {\i FileAttributes} specify the attributes of the newly created file, their encoding is described in the "Attribute Encoding" section of this document.
\par {\i CreationTime} is  the creation timestamp the file should be given, server support for these is optional.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 1\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Fid;\cell File handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130
\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par The returned {\i Fid} can be used in subsequent {\i Fid}-related messages.
\par The access permissions granted on a created file are read/write permission for the creator.  Access permissions for truncated files are not modified.  The newly created or truncated file is opened in read/write/compatibility mode.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc365655355}5.5\tab  }{\*\bkmkstart _Toc382909350}{\*\bkmkstart _Toc382911261}LOCK_AND_READ: Lock and Read Bytes{\*\bkmkend _Toc365655355}
{\*\bkmkend _Toc382909350}{\*\bkmkend _Toc382911261}
\par \pard\plain \sa240\keepn\widctlpar\tx576 \f4\fs20 This  request is used to lock and "read ahead" the specified bytes of the file indicated by {\i Fid} in the SMB header
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4590\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==============================\cell Description
\line =====================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4590\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170
 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 5\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Fid;\cell File handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Count;\cell 
Count of bytes being requested\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Offset;\cell Offset in file of first byte to read\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Remaining;\cell Estimate of bytes to read if nonzero\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl
\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4590\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par {\i Fid} must refer to a disk file.  {\i Count} specifies the requested number of bytes.  {\i Offset}
 specifies the offset in the file of the first byte to be locked then read.  Note that this offset is limited to 32 bits, so this client request is inappropriate for files having 64 bit offsets.
\par {\i Remaining}
 is advisory.  If the value is not zero, then it is taken as an estimate of the total number of bytes that will be read, including those read by this request.  This additional information may be used by the server to optimize buffer allocation or read-ahe
ad.  {\i Remaining} is not included in the byte range to be locked.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 5\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Count;\cell Count of bytes actually returned\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT Reserved [4];\cell Reserved (must be 0)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR BufferFormat;\cell 0x01 -- Data block\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl
\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DataLength;\cell Length of data\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par {\i ByteCount} is the number of bytes actually being returned. {\i ByteCount} may be less than the count requested only if a read specifies bytes b
eyond the current file size.  In this case only the bytes that exist are returned.  A read completely beyond the end of file results in a response of length zero.  This is the only circumstance when a zero length response is generated.  A count returned w
hich is less than the count requested is the end of file indicator.
\par As in the core SMB_LOCK_BYTE_RANGE request,  if the lock can not be immediately granted an error should be returned to the client.  If an error occurs on the lock, the bytes should not be r
ead.  If a Read requests more data than can be placed in a message of the maximum-xmit-size for the {\i Tid} specified, the server will abort the connection to the client.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc365655356}5.6\tab  }{\*\bkmkstart _Toc382909351}{\*\bkmkstart _Toc382911262}LOCK_BYTE_RANGE: Lock Bytes{\*\bkmkend _Toc365655356}{\*\bkmkend _Toc382909351}
{\*\bkmkend _Toc382911262}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 
The lock record message is sent to lock the given byte range.  More than one non-overlapping byte range may be locked in a given file.  Locks prevent attempts to lock, read or write the locked portion of the file by other clients or {\i Pid}
s.  Overlapping locks are not allowed. Offsets beyond the current end of file may be locked.  Such locks will not cause allocation of file space.
\par Since {\i Offset} is a 32 bit quantity, this request is inappropriate for general locking within a very large file.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 5\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Fid;\cell File handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Count;\cell 
Count of bytes to lock\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Offset;\cell Offset from start of file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par Locks may only be unlocked by the {\i Pid} that performed the lock.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par This client request does not wait for the lock to be granted.  If the lock can not be immediately granted (within 200-300 ms), the server should return failure to the client
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc365655357}5.7\tab  }{\*\bkmkstart _Toc382909352}{\*\bkmkstart _Toc382911263}OPEN: Open File{\*\bkmkend _Toc365655357}{\*\bkmkend _Toc382909352}
{\*\bkmkend _Toc382911263}
\par \pard\plain \sa240\keepn\widctlpar\tx576 \f4\fs20 This message is sent to obtain a file handle for a data file.  This returned {\i Fid} is used in subsequent client requests such as read, write, close, etc.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DesiredAccess;\cell Mode - read/write/share\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT SearchAttributes;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes;    min = 2\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR BufferFormat;\cell 0x04\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
STRING FileName[];\cell File name\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par {\i FileName} is the fully qualified file name, relative to the root of the share specified in the {\i Tid} field of the SMB header.  If {\i Tid}
 in the SMB header refers to a print share, this SMB creates a new file which will be spooled to the printer when closed.  In this case, {\i FileName} is ignored.
\par {\i SearchAttributes} specifies the type of file desired.  The encoding is described in the "File Attribute Encoding" section.
\par {\i DesiredAccess} controls the mode under which the file is opened, and the file will be opened only if the client has the appropriate permissions.  The encoding of {\i DesiredAccess} is discussed in the section entitled "Access Mode Encoding".
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 7\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Fid;\cell File handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT FileAttributes;\cell 
Attributes of opened file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UTIME LastWriteTime;\cell Time file was last written\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG DataSize;\cell File size\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT GrantedAccess;\cell Access allowed\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell 
Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par {\i Fid} is the handle value which should be used for subsequent file operations.
\par {\i FileAttributes} specifies the type of file obtained.  The encoding is described in the "File Attribute Encoding" section.
\par {\i GrantedAccess} indicates the access permissions actually allowed, and may have one of the following values:
\par \trowd \trgaph108\trleft360 \cellx675\cellx3690 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 0\cell  read-only\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft360 \cellx675\cellx3690 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 1\cell  write-only\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 2\cell 
read/write\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft360 \cellx675\cellx3690 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard 
\sa240\widctlpar\tx576 File Handles ({\i Fid}s) are scoped per client.  A {\i Pid} may reference any {\i Fid} established by itself or any other {\i Pid} on the client (so far as the server is concerned).  The actual accesses allowed through the {\i Fid}
 depends on the open and deny modes specified when the file was opened (see below).
\par The MS-DOS compatibility mode of file open provides exclusion at the client level.  A file open in compatibility mode may be opened (also in compatibility mode) any number of times for any combination of reading and writing (subject to the user's permissi
ons) by any {\i Pid} on the
 same client.  If the first client has the file open for writing, then the file may not be opened in any way by any other client.  If the first client has the file open only for reading, then other clients may open the file, in compatibility mode, for rea
ding..  The above notwithstanding, if the filename has an extension of .EXE, .DLL, .SYM, or .COM other clients are permitted to open the file regardless of read/write open modes of other compatibility mode opens.  However, once multiple clients have the f
ile open for reading, no client is permitted to open the file for writing and no other client may open the file in any mode other than compatibility mode.
\par The other file exclusion modes (Deny read/write, Deny write, Deny read, Deny none) provide exclusion at the file level.  A file opened in any "Deny" mode may be opened again only for the accesses allowed by the Deny mode (subject to the user's permissions
).  This is true regardless of the identity of the second opener -a different client, a {\i Pid} from the same client, or the {\i Pid}
 that already has the file open.  For example, if a file is open in "Deny write" mode a second open may only obtain read permission to the file.
\par Although {\i Fid}s are available to all {\i Pid}s on a client, {\i Pid}s other than the owner may not have the full access rights specified in the open mode by the {\i Fid}'s creator.  If the open creating the {\i Fid} specified a deny mode, then any {\i 
Pid} using the {\i Fid}, other than the creating {\i Pid}, will have only those access rights determined by "anding" the open mode r
ights and the deny mode rights, i.e., the deny mode is checked on all file accesses.  For example, if a file is opened for Read/Write in Deny write mode, then other clients may only read the file and cannot write; if a file is opened for Read in Deny read
 mode, then the other clients can neither read nor write the file.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Ref339946637}{\*\bkmkstart _Toc358532200}{\*\bkmkstart _Toc365655358}{\*\bkmkstart _Toc358532166}5.8\tab  }{\*\bkmkstart _Toc382909353}
{\*\bkmkstart _Toc382911264}OPEN_ANDX:  Open File{\*\bkmkend _Ref339946637}{\*\bkmkend _Toc358532200}{\*\bkmkend _Toc365655358}{\*\bkmkend _Toc382909353}{\*\bkmkend _Toc382911264}
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell 
Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 15\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR AndXCommand;\cell Secondary (X) command;  0xFF = none\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UCHAR AndXReserved;\cell Reserved (must be 0)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT AndXOffset;\cell Offset to next command WordCount\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Flags;\cell Additional information: bit set-\line 0 - return additional info\line 1 - exclusive oplock requested\line 
2 - batch oplock requested\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DesiredAccess;\cell File open mode\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT SearchAttributes;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT FileAttributes;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UTIME CreationTime;\cell Creation timestamp for file if it gets created\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT OpenFunction;\cell Action to take if file exists\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG AllocationSize;\cell Bytes to reserve on create or truncate\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
ULONG Reserved[2];\cell Must be 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes;    min = 1\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR BufferFormat\cell 0x04\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 STRING FileName;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell 
Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 15\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR AndXCommand;\cell Secondary (X) command;  0xFF = none\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UCHAR AndXReserved;\cell Reserved (must be 0)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT AndXOffset;\cell Offset to next command WordCount\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Fid;\cell File handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT FileAttributes;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UTIME LastWriteTime;\cell \cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG DataSize;\cell Current file size\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT GrantedAccess;\cell Access permissions actually allowed\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT FileType;\cell Type of file opened\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DeviceState;\cell State of the named pipe\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Action;\cell Action taken\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG ServerFid;\cell Server unique file id\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Reserved;\cell 
Reserved (must be 0)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard 
\sa240\widctlpar\tx576 
\par {\i DesiredAccess} describes the access the client desires for the file (see section {\field{\*\fldinst  REF _Ref365651428 \\n }{\fldrslt 3.6}} - {\field{\*\fldinst  REF _Ref365651433 \\* MERGEFORMAT }{\fldrslt  Access Mode Encoding}}).
\par {\i OpenFunction} specifies the action to be taken depending on whether or not the file exists (see section {\field{\*\fldinst  REF _Ref365651301 \\n }{\fldrslt 3.8}} - {\field{\*\fldinst  REF _Ref365651301 \\* MERGEFORMAT }{\fldrslt 
 Open Function Encoding}}).  {\i Action} in the response specifies the action as a result of the Open request (see section {\field{\*\fldinst  REF _Ref365651322 \\n }{\fldrslt 3.9}} - {\field{\*\fldinst  REF _Ref365651363 \\* MERGEFORMAT }{\fldrslt 
 Open Action Encoding}}). 
\par {\i SearchAttributes} indicates the attri\-butes that the file must have to be found while searching to see if it exists.  The encoding of this field is described in the "File Attribute Encoding" section elsewhere in this document.  If {\i 
SearchAttributes} is zero then only normal files are returned.  If the system file, hidden or directory attributes are specified then the search is inclusive -- both the specified type(s) of files and normal files are returned.
\par {\i FileType} returns the kind of resource actually opened:
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4050\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Name\line ==========================\cell Value\line ======\cell Description\line ==================================\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4050\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FileTypeDisk\cell 0\cell Disk file or directory as defined in the attribute field\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FileTypeByteModePipe\cell 1\cell Named pipe in byte mode\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FileTypeMessageModePipe\cell 2\cell Named pipe in message mode\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
FileTypePrinter\cell 3\cell Spooled printer\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4050\clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 FileTypeUnknown\cell 0xFFFF\cell Unrecognized resource type\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par If bit0 of {\i Flags} is clear, the {\i FileAttributes}, {\i LastWriteTime}, {\i DataSize}, {\i FileType}, and {\i DeviceState} have indeterminate values in the response.
\par This SMB can request an oplock on the opened file.  Oplocks are fully described in the "Oplocks" section elsewhere in this document, and there is also discussion of oplocks in the SMB_COM_LOCKING_ANDX SMB description.  {\i Bit1} and {\i bit2} of the {\i 
Flags} field are used to request oplocks during open.
\par The following SMBs may follow SMB_COM_OPEN_ANDX:
\par \trowd \trgaph108\trleft360 \cellx2700\cellx5760 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_READ\cell SMB_COM_READ_ANDX\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft360 
\cellx2700\cellx5760 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_IOCTL\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {
\b0\i {\*\bkmkstart _Toc365655359}{\*\bkmkend _Toc358532166}5.9\tab  }{\*\bkmkstart _Toc382909354}{\*\bkmkstart _Toc382911265}PROCESS_EXIT: Process Exit{\*\bkmkend _Toc365655359}{\*\bkmkend _Toc382909354}{\*\bkmkend _Toc382911265}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 This command informs the server that a client process has terminated.  The server must close all files opened by {\i Pid} in the SMB header.  This must automatically release all locks the process holds.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
 USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par This SMB should not generate any errors from the server, unless the server is a {\i user mode} server and {\i Uid} in the SMB header is invalid.
\par Clients are not required to send this SMB, they can do all cleanup necessary by sending close SMBs to the server to release resources.  In fact, clients who have negotiated {\f11\fs18 LANMAN 1.0} and later probably do not send this message at all.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc358532171}{\*\bkmkstart _Toc365655360}5.10\tab  }{\*\bkmkstart _Toc382909355}{\*\bkmkstart _Toc382911266}QUERY_INFORMATION:  Get File Attributes
{\*\bkmkend _Toc358532171}{\*\bkmkend _Toc365655360}{\*\bkmkend _Toc382909355}{\*\bkmkend _Toc382911266}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 This request is sent to obtain information about a file.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes;    min = 2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UCHAR BufferFormat;\cell 0x04\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING FileName[];\cell File name\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard 
\sa240\widctlpar\tx576 {\i 
\par FileName} is the fully qualified name of the file relative to the {\i Tid} in the header.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 10\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT FileAttributes;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UTIME LastWriteTime;\cell 
Time of last write\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG FileSize;\cell File size\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Reserved [5];\cell Reserved - client should ignore\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par {\i FileAttributes} are as described in the "Attributes Encoding" section of this document.
\par Note that {\i FileSize} is limited to 32 bits, this request is inappropriate for files whose size is too large.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc358532194}{\*\bkmkstart _Toc365655361}5.11\tab  }{\*\bkmkstart _Toc382909356}{\*\bkmkstart _Toc382911267}QUERY_INFORMATION2: Get File Information
{\*\bkmkend _Toc358532194}{\*\bkmkend _Toc365655361}{\*\bkmkend _Toc382909356}{\*\bkmkend _Toc382911267} 
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 This SMB is gets information about the file represented by {\i Fid}. 
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell 
Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Fid;\cell File handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 
\cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes = 0\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell 
Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 11\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_DATE CreationDate;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_TIME CreationTime;\cell \cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_DATE LastAccessDate;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_TIME LastAccessTime;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_DATE LastWriteDate;\cell \cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_TIME LastWriteTime;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG FileDataSize;\cell File end of data\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
ULONG FileAllocationSize;\cell File allocation size\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT FileAttributes;\cell \cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes;  min = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576  
\par The file being interrogated is specified by {\i Fid}, which must possess at least read permission.
\par FileAttributes are described in the "File Attribute Encoding" section elsewhere in this document.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc365655362}5.12\tab  }{\*\bkmkstart _Toc382909357}{\*\bkmkstart _Toc382911268}READ: Read File{\*\bkmkend _Toc365655362}{\*\bkmkend _Toc382909357}
{\*\bkmkend _Toc382911268}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 The read message is sent to read bytes of a resource indicated by {\i Fid} in the SMB header.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4770\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ===============================\cell Description
\line ====================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4770\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 5\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Fid;\cell File handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Count;\cell 
Count of bytes being requested\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Offset;\cell Offset in file of first byte to read\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Remaining;\cell Estimate of bytes to read if nonzero\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl
\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4770\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par {\i Count} is used to specify the requested number of bytes.
\par {\i Offset} specifies the offset in the file of the first byte to be read.  Note that this offset is limited to 32 bits, so this client request is inappropriate for files having 64 bit offsets.
\par {\i Remaining}
 is advisory.  If the value is not zero, then it is taken as an estimate of the total number of bytes that will be read, including those read by this request.  This additional information may be used by the server to optimize buffer allocation or read-ahe
ad.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 5\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Count;\cell Count of bytes actually returned\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT Reserved [4];\cell Reserved (must be 0)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR BufferFormat;\cell 0x01 -- Data block\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl
\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DataLength;\cell Length of data\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par {\i ByteCount} is the number of bytes actually being returned.  If {\i Fid} refers to a disk file, {\i ByteCount}
 may be less than the count requested only if a read specifies bytes beyond the current file size.  In this case only the bytes that exist are returned.  A read completely beyond the end of file results in a response of length zero.  This is the only circ
umstance when a zero length response is generated.  A count returned which is less than the count requested is the end of file indicator.
\par If a Read requests more data than can be placed in a message of the maximum-xmit-size for the {\i Tid} specified, the server will abort the connection to the client.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Ref363022514}{\*\bkmkstart _Ref363023468}{\*\bkmkstart _Toc365655363}{\*\bkmkend _Toc358532222}5.13\tab  }{\*\bkmkstart _Toc382909358}
{\*\bkmkstart _Toc382911269}READ_MPX: Read Block Multiplex{\*\bkmkend _Toc358532190}{\*\bkmkend _Ref363022514}{\*\bkmkend _Ref363023468}{\*\bkmkend _Toc365655363}{\*\bkmkend _Toc382909358}{\*\bkmkend _Toc382911269}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 
 The Read Block Multiplexed protocol is used to maximize the performance of reading a large block of data from the server to the client while still allowing other operations to take place between the client and server in the meantime.  The NT server suppo
rts SMB_COM_READ_MPX only over connectionless transports.
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4950\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ================================\cell 
Description\line ===================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4950\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 8\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Fid;\cell File handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Offset;\cell 
Offset in file to begin read\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT MaxCount;\cell Max bytes to return (maximum 65535)\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT MinCount;\cell Min bytes to return (normally 0)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Reserved1;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Reserved2;\cell \cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4950\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par {\i Fid} identifies the resource being read, and may refer to a disk file or a spooled printer.
\par {\i Timeout} is the number of milliseconds to wait for completion {\i Fid} refers to a named pipe.
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell 
Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 8\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Offset;\cell Offset in file where data read\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Count;
\cell Total bytes being returned\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Reserved;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DataCompactionMode;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT Reserved;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DataLength;\cell Number of data bytes this buffer\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DataOffset;\cell Offset (from header start) to data\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Pad[];\cell 
Pad to SHORT or LONG\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Data[];\cell Data (size = DataLength)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard 
\sa240\widctlpar\tx576 
\par Other requests may be active between the client and server.  The server responds with the one or more response messages as defined above until the requested data amount has been returned.  Each response con\-tains the {\i Pid} and {\i Mid}
 of the original request and the {\i Offset} and {\i Count} of describing the placement of the data within the file.
\par The client knows the maximum amount of data bytes which the server may return (from {\i MaxCount} of the request).  Thus the client initializes its bytes expected variable to this va
lue.  The server then informs the client of the actual amount being returned via each part of the response in {\i Count}.  The server may reduce the expected bytes by lowering the total number of bytes expected in {\i Count} in any response.
\par When the amount of data bytes received (sum of the {\i DataLength} fields) equals the total amount of data bytes expected (smallest {\i Count}
 received), then the client  has received all the data bytes.  This allows the protocol to work even if the responses are received out of sequence.
\par Note that {\i DataLength} being returned here can not be larger than the smaller of the client's buffer size (as specified in {\i MaxBufferSize} on the COM_SESSION_SETUP_AND_X client request SMB) or the server's buffer size (as specified in {\i 
MaxBufferSize} of the COM_NEGOTIATE server response SMB).
\par As is true in SMB_COM_READ, the total number of bytes returned may be less than the number requested only if a read specifies bytes beyond the current file size and {\i Fid} refers to a disk file.  In this case only the bytes tha
t exist are returned.  A read com\-pletely beyond the end of file will result in a single response with a zero value in {\i Count}
.  If the total number of bytes returned is less than the number of bytes requested, this indicates end of file (if reading other than a standard blocked disk file, only ZERO bytes returned indi\-cates end of file).
\par Once started, the Read Block Multiplexed operation is expected to go to completion.  The client is expected to receive all the responses generated by the server.  Con\-flicti
ng commands (such as file close) must not be sent to the server while a multiplexed operation is in progress.
\par The flow for the SMB_COM_READ_MPX protocol is:
\par \pard \ri-1040\sa240\widctlpar\tx576 client ---------------> Read MPX. request >---------------------> server\line client <--------------< Read MPX response 1 with data <---------- server\line 
client <--------------< Read MPX response 2 with data <---------- server\line ...\line client <--------------< Read MPX response n with data <---------- server
\par 
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc358532189}{\*\bkmkstart _Toc365655364}{\*\bkmkend _Toc358532187}{\*\bkmkend _Toc358532192}{\*\bkmkend _Toc358532188}{\*\bkmkend _Toc358532176}5.14\tab  }
{\*\bkmkstart _Toc382909359}{\*\bkmkstart _Toc382911270}READ_RAW: Read Raw{\*\bkmkend _Toc358532189}{\*\bkmkend _Toc365655364}{\*\bkmkend _Toc382909359}{\*\bkmkend _Toc382911270}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 The SMB_COM_READ_RAW protocol is used to maximize the perfor\-mance of reading a large block of data from the server to the client.  This request can be applied to files and named pipes.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4860\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ================================\cell Description
\line ===================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 8\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Fid;\cell File handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Offset;\cell 
Offset in file to begin read\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT MaxCount;\cell Max bytes to return (maximum 65535)\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT MinCount;\cell Min bytes to return (normally 0)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Timeout;\cell Wait time if named pipe\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Reserved;\cell 
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par {\i Fid} identifies the resource being read, and may refer to a disk file or a named pipe.
\par {\i Timeout} is the number of milliseconds to wait for completion {\i Fid} refers to a named pipe.
\par When the client issues this request, the client must guarantee that there is (and will be) no other request to the server for the duration of the SMB_COM_READ_RAW.  The server will respond, in one send, with the raw data being read.  Thus the client is ab
le to request up to
 65,535 bytes of data and receive it directly into the user's buffer, since the server response has no header or trailer.  Note that the amount of data requested is expected to be larger than the negotiated buffer size for this protocol.
\par The reason that no other requests can be active on the client's connection to the server for the duration of the request is that if other receives are present, there is normally no way to guarantee that the data will be received into the user space, rathe
r the data may fill one (or more) of the other buffers.
\par The number of bytes actually returned is determined by the length of the message the client receives as reported by the transport layer.  If the request is to read more bytes than are present in the file, the read response will be of the length actually r
ead from the file.
\par If none of the requested bytes exist (EOF) or an error occurs on the read, the server responds with a zero byte send.  Upon receipt of a zero length response, the client should send a different type of
 request to the server.  The response to that read will then tell the client that EOF was hit or identify the error condition.
\par The number of bytes returned may be less than the number requested only if a read speci\-
fies bytes beyond the current file size.  In this case only the bytes that exist are returned.  A read completely beyond the end of file results in a response of zero 
length.  If the number of bytes returned is less than the number of bytes requested, this indicates end of file (if reading other than a standard blocked disk file, only ZERO bytes returned indicates end of file).
\par The transport layer guarantees delivery of all response bytes to the client.  Thus no  SMB level confirmation protocol is required.  If an error should occur at the clients end, all bytes must be received and thrown away.  There is no need to inform the s
erver of the error.
\par This message was introduced with {\f11\fs18 the LANMAN1.0} SMB dialect.  Whether or not this request is supported is returned in the response to {\f11\fs18 SMB_COM_NEGOTIATE}.
\par The flow for reading a sequential file using {\f11\fs18 SMB_COM_READ_BOCK_RAW} is:
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4680\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==============================\cell 
Server Response\line =====================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4680\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_OPEN file\cell Success\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_READ_RAW\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell raw data returned\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_READ_RAW\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell more raw data returned\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_READ_RAW\cell \cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell short (or 0 length) response returned\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_READ\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell 0 bytes returned indicating EOF\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4680\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_CLOSE\cell Success\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par SMB_COM_READ_RAW has no way to return errors.  Because the response is raw data only, a zero length response indicates EOF, a read error or that the server is temporarily out of large buffers.  The client should then retry using a different type of read r
equest.  This request will then either return the EOF condition, an error if the read is still failing, or will work if the problem was due to a temporary server condition.
\par If the negotiated dialect is {\f11\fs18 NT LM 0.12} or later, and the response to the SMB_COM_NEGOTIATE SMB has CAP_LARGE_FILES set in the {\i Capabilities}
 field, a new format of  the SMB_COM_READ_RAW request is allowed which accommodates very large files having 64 bit offsets.
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4950\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ================================\cell 
Description\line ===================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4950\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 10\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Fid;\cell File handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Offset;\cell 
Offset in file to begin read\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT MaxCount;\cell Max bytes to return (maximum 65535)\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT MinCount;\cell Min bytes to return (normally 0)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Timeout;\cell Wait time if named pipe\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Reserved;\cell 
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG OffsetHigh;\cell Upper 32 bits of offset\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd 
\trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4950\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
This form of the request is differentiated from the previous form of the request by the {\i WordCount} field.  In this case, the final offset to read from is used by combining {\i OffsetHigh} and {\i Offset}
, the resulting value can not be negative or the request will be rejected by the server.
\par SMB_COM_READ_RAW can not be used over connectionless transports.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc365655365}5.15\tab  }{\*\bkmkstart _Toc382909360}{\*\bkmkstart _Toc382911271}SEARCH: Search Directory using Wildcards{\*\bkmkend _Toc365655365}
{\*\bkmkend _Toc382909360}{\*\bkmkend _Toc382911271}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 This command is used to search directories.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT MaxCount;\cell Number of dir. entries to return\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT SearchAttributes;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes;  min = 5\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR BufferFormat1;\cell 0x04 -- ASCII\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR FileName[];\cell File name, may be null\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR BufferFormat2;
\cell 0x05 -- Variable block\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ResumeKeyLength;\cell Length of resume key, may be 0\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR ResumeKey[];\cell Resume key\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par {\i FileName} specifies the file to be sought.  {\i SearchAttributes} indicates the attributes that the file must have, and is described in the "File Attribute Encoding" section of this document.  If  {\i SearchAttributes}
 is zero then only normal files are returned.  If the system file, hidden or directory attributes are specified then the search is inclusive{{\field{\*\fldinst SYMBOL 45 \\f "Symbol" \\s 10}{\fldrslt\f1\fs20}}}
both the specified type(s) of files and normal files are returned.  If the volume label attribute is specified then the search is exclusive, and only the volume label entry is returned.
\par {\i MaxCount} specifies the number of directory entries to be returned.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 1\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Count;\cell Number of entries returned\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;
\cell Count of data bytes;  min = 3\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR BufferFormat;\cell 0x05 -- Variable block\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DataLength;\cell Length of data\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UCHAR DirectoryInformationData[];\cell Data\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par The response will contain one or more directory entries as determined by the {\i Count} field.  No more than {\i MaxCount} entries will be returned.  Only entries that match the sought {\i FileName} and {\i SearchAttributes} combination will be returned.

\par  {\i ResumeKey} must be null (length = 0) on the initial search request.  Subsequent search requests intended to continue a search must contain the {\i ResumeKey} field extracted from the last directory entry of the previous response.  {\i ResumeKey}
 is self-contained, for on calls containing a non-zero {\i ResumeKey} neither the {\i SearchAttributes} or {\i FileName} fields will be valid in the request.  {\i ResumeKey} has the following format:
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Resume Key Field\line ==================================\cell 
Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Reserved;\cell bit 7 - consumer use\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell bits 5,6 - system use (must preserve)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell 
bits 0-4 - server use (must preserve)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR FileName[11];\cell Name of the returned file\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR ReservedForServer[5];\cell Client must not modify\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl
\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR ReservedForConsumer[4];\cell Server must not modify\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par {\i FileName} is 8.3 format, with the three character extension left justified into {\i FileName}[9-11].  If the client is prior to the LANMAN1.0 dialect, the returned {\i FileName} should be uppercased.
\par SMB_COM_SEARCH terminates when either the requested maximum number of entries that match the named file are found, or the end of directory is reached without the maximum number of matches b
eing found.  A response containing no entries indicates that no matching entries were found between the starting point of the search and the end of directory.
\par There may be multiple matching entries in response to a single request as SMB_COM_SEARCH supports wildcards in the last component of {\i FileName} of the initial request.
\par Returned directory entries in the {\i DirectoryInformationData} field of the response each have the following format:
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Directory Information Field\line ==================================
\cell Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_RESUME_KEY ResumeKey;\cell Described above\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR FileAttributes;\cell Attributes of the found file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
SMB_TIME LastWriteTime;\cell Time file was last written\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_DATE LastWriteDate;\cell Date file was last written\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG FileSize;\cell Size of the file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl
\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR FileName[13];\cell ASCII, space-filled null terminated\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 {\i 
\par FileName} must conform to 8.3 rules, and is padded after the extension with 0x20 characters if necessary.  If the client has negotiated a dialect prior to the LANMAN1.0 dialect, or if {\i bit0} of the {\i Flags2}
 SMB header field of the request is clear, the returned {\i FileName} should be uppercased.
\par As can be seen from the above structure, SMB_COM_SEARCH can not return long filenames, and can not return UNICODE filenames.  Files which have a size greater than 2^32 bytes should have the least significant 32 bits of their size returned in {\i FileSize}
.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc365655366}{\*\bkmkend _Toc358532179}5.16\tab  }{\*\bkmkstart _Toc382909361}{\*\bkmkstart _Toc382911272}SET_INFORMATION: Set File Attributes
{\*\bkmkend _Toc365655366}{\*\bkmkend _Toc382909361}{\*\bkmkend _Toc382911272}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 This message is sent to change the information about a file.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 8\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT FileAttributes;\cell Attributes of the file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UTIME LastWriteTime;\cell Time of last write\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Reserved [5];\cell Reserved (must be 0)\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes;    min = 2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR BufferFormat;\cell 0x04\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130
\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING FileName[];\cell File name\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par {\i FileName} is the fully qualified name of the file relative to the {\i Tid}.
\par Support of all parameters is optional.  A server which does not implement one of the parameters will ignore that field.  If the {\i LastWriteTime} field contain zero then the file's time is not changed.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 {\*\bkmkstart _Toc358532193}{\*\bkmkstart _Toc365655367}
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i 5.17\tab  }{\*\bkmkstart _Toc382909362}{\*\bkmkstart _Toc382911273}SET_INFORMATION2: Set File Information{\*\bkmkend _Toc358532193}{\*\bkmkend _Toc365655367}
{\*\bkmkend _Toc382909362}{\*\bkmkend _Toc382911273}
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell 
Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 7\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Fid;\cell File handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_DATE CreationDate;\cell \cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_TIME CreationTime;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_DATE LastAccessDate;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_TIME LastAccessTime;\cell 
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_DATE LastWriteDate;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_TIME LastWriteTime;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 
\cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes = 0\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par SMB_COM_SET_INFORMATION2 sets informa\-tion about the file represented by {\i Fid}.  The target file is updated from the values specified.  A date or time value or zero indicates to leave that specific date and time unchanged.
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell 
Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl
\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par {\i Fid} must be open with (at least) write permission.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc358532181}{\*\bkmkstart _Toc365655368}5.18\tab  }{\*\bkmkstart _Toc382909363}{\*\bkmkstart _Toc382911274}QUERY_INFORMATION_DISK: Get Disk Attributes
{\*\bkmkend _Toc358532181}{\*\bkmkend _Toc365655368}{\*\bkmkend _Toc382909363}{\*\bkmkend _Toc382911274}
\par \pard\plain \sa240\keepn\widctlpar\tx576 \f4\fs20 The SMB_COM_QUERY_INFORMATION_DISK command is used to determine the capacity and remaining free space on the drive hosting the directory structure indicated by {\i Tid} in the SMB header.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 5\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT TotalUnits;\cell Total allocation units per server\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT BlocksPerUnit;\cell Blocks per allocation unit\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT BlockSize;\cell Block size (in bytes)\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT FreeUnits;\cell Number of free units\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Reserved;\cell Reserved (client should ignore)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell 
Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par The blocking/allocation units used in this response may be independent of the actual physical or logical blocking/allocation algorithm(s) used internally by the server.  However, they must accurately reflect the amount of space on the server.
\par This SMB only returns 16 bits of information for each field, which may not be large enough for some disk systems.  In particular {\i TotalUnits}
 is commonly > 64K.  Fortunately, it turns out the all the client cares about is the total disk size, in bytes, and the free space, in bytes.  So,  it is reasonable for a server to adjust the relative values of {\i BlocksPerUnit} and {\i BlockSize}
 to accommodate.  If after all adjustment, the numbers are still too high, the largest possible values for TotalUnit or FreeUnits (i.e. 0xFFFF) should be returned.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc365655369}5.19\tab  }{\*\bkmkstart _Toc382909364}{\*\bkmkstart _Toc382911275}TRANS2_OPEN2: Create or Open File with Extended Attributes
{\*\bkmkend _Toc365655369}{\*\bkmkend _Toc382909364}{\*\bkmkend _Toc382911275}
\par \pard\plain \sa240\keepn\widctlpar\tx576 \f4\fs20 This transaction is used to open or create a file having extended attributes.
\par \trowd \trgaph108\trbrdrl\brdrs\brdrw30\brdrcf1 \trbrdrr\brdrs\brdrw30\brdrcf1 \trbrdrv\brdrs\brdrw15\brdrcf1 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 
\clcfpat7\clcbpat8\clshdng3000 \cellx4320\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ============================\cell Value\line =======================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trbrdrl
\brdrs\brdrw30\brdrcf1 \trbrdrr\brdrs\brdrw30\brdrcf1 \trbrdrv\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4320\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 WordCount\cell 15\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 TotalDataCount\cell 
Total size of extended attribute list\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 DataOffset\cell Offset to extended attribute list in this request\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SetupCount\cell 1\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Setup[0]\cell TRANS2_OPEN2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trbrdrl\brdrs\brdrw30\brdrcf1 \trbrdrr\brdrs\brdrw30\brdrcf1 \trbrdrv\brdrs\brdrw15\brdrcf1 \clbrdrt
\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4320\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 
\cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trbrdrl\brdrs\brdrw30\brdrcf1 \trbrdrr\brdrs\brdrw30\brdrcf1 \trbrdrv
\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4320\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trbrdrl\brdrs\brdrw30\brdrcf1 \trbrdrr
\brdrs\brdrw30\brdrcf1 \trbrdrv\brdrs\brdrw15\brdrcf1 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4320\clbrdrt\brdrs\brdrw15\brdrcf1 
\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Parameter Block Encoding\line 
============================\cell Description\line =======================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trbrdrl\brdrs\brdrw30\brdrcf1 \trbrdrr\brdrs\brdrw30\brdrcf1 \trbrdrv\brdrs\brdrw15\brdrcf1 
\clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4320\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Flags; \cell 
Additional information: bit set-\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell 0 - return additional info\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell 1 - exclusive oplock requested\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 \cell 2 - batch oplock requested\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell 3 - return total length of EAs\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DesiredAccess;\cell Requested file access\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Reserved1;\cell Ought to be zero.  Ignored by the server.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT FileAttributes;\cell Attributes for file if create\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_TIME CreationTime;\cell 
Creation time to apply to file if create\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_DATE CreationDate;\cell Creation date to apply to file if create\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT OpenFunction;\cell Open function\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG AllocationSize;\cell Bytes to reserve on create or truncate\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT Reserved [5];\cell Must be zero\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING FileName;\cell Name of file to open or create\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trbrdrl\brdrs\brdrw30\brdrcf1 \trbrdrr\brdrs\brdrw30\brdrcf1 \trbrdrv\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4320\clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Data[ TotalDataCount ]\cell 
FEAList structure for file to be created\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par If secondary requests are required, they must contain 0 parameter bytes, and the {\i Fid} in the secondary request is 0xFFFF.
\par {\i DesiredAccess} is encoded as described in the "Access Mode Encoding" section elsewhere in this document.
\par {\i FileAttributes} are encoded as described in the "File Attribute Encoding" section elsewhere in this document.
\par {\i OpenFunction} specifies the action to be taken depending on whether or not the file exists (see section 3.7) . 
\par {\i Action} in the response specifies the action as a result of this request (see section 3.8).
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4140\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Response Parameter Block\line ==========================\cell 
Description\line =========================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4140\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Fid;\cell File handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT FileAttributes;\cell Attributes of file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
SMB_TIME CreationTime;\cell Last modification time\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_DATE CreationDate;\cell Last modification date\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG DataSize;\cell Current file size\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT GrantedAccess;\cell Access permissions actually allowed\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT FileType;\cell Type of file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DeviceState;\cell State of IPC device (e.g. pipe)\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Action;\cell Action taken\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Reserved;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT EaErrorOffset;\cell 
Offset into EA list if EA error\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4140\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG EaLength;\cell Total EA length for opened file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard \sa240\widctlpar\tx576 
\par {\i FileType} returns the kind of resource actually opened:
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx3690\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4770\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\clcfpat7\clcbpat8\clshdng3000 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Name\line =======================\cell Value\line ======\cell Description\line =====================================\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3690\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4770\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FileTypeDisk\cell 0\cell Disk file or directory as defined in the attribute field\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FileTypeByteModePipe\cell 1\cell Named pipe in byte mode\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 FileTypeMessageModePipe\cell 2\cell Named pipe in message mode\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
FileTypePrinter\cell 3\cell Spooled printer\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3690\clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4770\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 FileTypeUnknown\cell 0xFFFF\cell Unrecognized resource type\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par {\i DeviceState} is applicable only if the {\i FileType} is FileTypeByteModePipe or FileTypeMessageModePipe and is encoded as in section 3.9.
\par \pard \sa240\widctlpar\tx576\tx2430 If an error was detected in the incoming EA list, the offset of the error is returned in {\i EaErrorOffset}.
\par \pard \sa240\widctlpar\tx576 If {\i bit0} of {\i Flags} in the request is clear, the {\i FileAttributes}, {\i CreationTime}, {\i CreationDate}, {\i DataSize}, {\i GrantedAccess}, {\i FileType}, and {\i DeviceState}
 have indeterminate values in the response.  Similarly, if {\i bit3} of the request is clear, {\i EaLength} in the response has an indeterminate value in the response.
\par This SMB can request an oplock on the opened file.  Oplocks are fully described in the "Oplocks" section elsewhere in this document, and there is also discussion of oplocks in the SMB_COM_LOCKING_ANDX SMB description.  {\i Bit1} and {\i bit2} of the {\i 
Flags} field are used to request oplocks during open.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc358532159}{\*\bkmkstart _Toc365655370}{\*\bkmkstart _Toc358532162}5.20\tab  }{\*\bkmkstart _Toc382909365}{\*\bkmkstart _Toc382911276}
TREE_CONNECT: Tree Connect{\*\bkmkend _Toc358532159}{\*\bkmkend _Toc365655370}{\*\bkmkend _Toc382909365}{\*\bkmkend _Toc382911276}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 When a client connects to a server resource, an SMB_COM_TREE_CONNECT message is generated to the server. This command is almo
st exactly like SMB_COM_TREE_CONNECT_ANDX, except that no AndX command may follow; see section {\field{\*\fldinst  REF _Ref365634416 \\n }{\fldrslt 4.1.4}}.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes;    min = 4\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UCHAR BufferFormat1;\cell 0x04\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING Path[];\cell Server name and share name\cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR BufferFormat2;\cell 0x04\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 STRING Password[];\cell Password\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR BufferFormat3;\cell 0x04\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 STRING Service[];\cell Service name\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par The CIFS server responds with:
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4860\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT MaxBufferSize;\cell Max size message the server handles\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT Tid;\cell Tree ID\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard 
\sa240\widctlpar\tx576 
\par If the negotiated dialect is {\f11\fs18 MICROSOFT NETWORKS 1.03}
 or earlier, MaxBufferSize in the response message indicates the maximum size message that the server can handle.  The client should not generate messages, nor expect to receive responses, larger than this.  This must be constant for a given server.  For 
newer dialects, this field is ignored.
\par {\i Tid} should be included in any future SMBs referencing this tree connection. 
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc365655371}{\*\bkmkend _Toc358532162}5.21\tab  }{\*\bkmkstart _Toc382909366}{\*\bkmkstart _Toc382911277}UNLOCK_BYTE_RANGE: Unlock Bytes
{\*\bkmkend _Toc365655371}{\*\bkmkend _Toc382909366}{\*\bkmkend _Toc382911277}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 This message is sent to unlock the given byte range.  {\i Offset}, {\i Count}, and {\i Pid} must be identical to that 
specified in a prior successful lock.  If an unlock references an address range that is not locked, no error is generated.
\par Since {\i Offset} is a 32 bit quantity, this request is inappropriate for general locking within a very large file.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 5\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Fid;\cell File handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Count;\cell 
Count of bytes to unlock\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Offset;\cell Offset from start of file\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc365655372}5.22\tab  }{\*\bkmkstart _Toc382909367}
{\*\bkmkstart _Toc382911278}WRITE: Write Bytes{\*\bkmkend _Toc365655372}{\*\bkmkend _Toc382909367}{\*\bkmkend _Toc382911278}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 The write message is sent to write bytes into the resource indicated by {\i Fid} in the SMB header.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 5\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Fid;\cell File handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Count;\cell 
Number of bytes to be written\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Offset;\cell Offset in file to begin write\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Remaining;\cell Bytes remaining to satisfy request\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR BufferFormat;
\cell 0x01 -- Data block\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DataLength;\cell Length of data\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd 
\trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Data[ Count ];\cell The data to write\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par {\i Count} specifies the number of bytes to be written.  {\i Offset} is the offset in the file of the first byte to be written.  Since offset is 32 bits, this request is inappropriate for general use in a very large file.  {\i Remaining}
 is advisory:  if the value is not zero, then it is taken as an estimate of the number of bytes that will be written -including those written by this request.  This additional information may be used by the server to optimize cache behavior. 
\par When {\i Fid}
 represents a disk file and the request specifies a byte range beyond the current end of file, the file will be extended.  Any bytes between the previous end of file and the requested offset are initialized to 0.  When a write specifies a length of zero, 
the file is truncated (or extended) to the length specified by the offset.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 1\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Count;\cell Count of bytes actually written\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell 
Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par {\i Count} in the response indicates the actual number of bytes written, and for successful writes will always equal the count in the request message.  If the number of bytes written differs from the number reque
sted and no error is indicated, then the server has no resources available with which to satisfy the complete write.
\par If a Write sends a message of length greater than the {\i MaxBufferSize} for the TID specified, the server may abort the connection to the client.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc365655373}5.23\tab  }{\*\bkmkstart _Toc382909368}{\*\bkmkstart _Toc382911279}WRITE_AND_UNLOCK: Write Bytes and Unlock Range{\*\bkmkend _Toc365655373}
{\*\bkmkend _Toc382909368}{\*\bkmkend _Toc382911279}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 This request is used to first write the specified bytes and then unlock them. The locked portion of a file is "safe" to write behind because no other process can access the locked bytes until this pro
cess unlocks the bytes.  Thus the client can buffer the locked bytes locally while they are being updated, then when the unlock request is received submit this protocol to both write and then unlock bytes.  Whether or not this SMB is supported (along with
 {\f11\fs18 SMB_COM_READ_AND_LOCK}) is returned in {\i bit0} of the {\i Flags} field of the nego\-tiate response.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4860\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ================================\cell Description
\line ===================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 5\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Fid;\cell File handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Count;\cell 
Number of bytes to be written\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Offset;\cell Offset in file to begin write\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Remaining;\cell Bytes remaining to satisfy request\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR BufferFormat;
\cell 0x01 -- Data block\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4860\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DataLength;\cell Length of data\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard 
\sa240\widctlpar\tx576 
\par {\i Count} specifies the number of bytes to be written.  {\i Offset} is the offset in the file of the first byte to be written.  Since offset is 16 bits, this request is inappropriate for general use in a very large file.  {\i Remaining} is advisory:  if 
the value is not zero, then it is taken as an estimate of the number of bytes that will be written -including those written by this request.  This additional information may be used by the server to optimize cache behavior.  A value of 0 for {\i Count}
 is an error.
\par If the request specifies a byte range beyond the current end of file, the file will be extended.  Any bytes between the previous end of file and the requested offset are initialized to 0.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 1\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Count;\cell Count of bytes actually written\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell 
Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par {\i Count}
 in the response indicates the actual number of bytes written, and for successful writes will always equal the count in the request message.  If the number of bytes written differs from the number requested and no error is indicated, then the server has n
o resources available with which to satisfy the complete write.
\par If a Write sends a message of length greater than the {\i MaxBufferSize} for the TID specified, the server may abort the connection to the client. If an error occurs on the write, the bytes remain locked.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc358532199}{\*\bkmkstart _Toc365655374}5.24\tab  }{\*\bkmkstart _Toc382909369}{\*\bkmkstart _Toc382911280}WRITE_AND_CLOSE:  Write Bytes and Close File
{\*\bkmkend _Toc358532199}{\*\bkmkend _Toc365655374}{\*\bkmkend _Toc382909369}{\*\bkmkend _Toc382911280}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 This request is used to first write the specified bytes and then close the file.
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell 
Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 6\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Fid;\cell File handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Count;\cell 
Number of bytes to write\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Offset;\cell Offset in file of first byte to write\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UTIME LastWriteTime;\cell Time of last write\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell 1 (for pad) + value of Count\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Pad;
\cell To force to doubleword boundary\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Buffer[ Count ];\cell Data to write\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard 
\sa240\widctlpar\tx576 
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell 
Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 12\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Fid;\cell File handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Count;\cell 
Number of bytes to write\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Offset;\cell Offset in file of first byte to write\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UTIME LastWriteTime;\cell Time of last write\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Reserved[3];\cell Reserved, must be 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;
\cell 1 (for pad) + value of Count\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Pad;\cell To force to doubleword boundary\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Buffer[Count];\cell Data to write\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell 
Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 1\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Count;\cell Count of bytes actually written\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell 
Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par Since clients can formulate the request in either of two ways, {\i WordCount} must be used in order to correctly locate the data to be written.
\par {\i Count} specifies the number of bytes to be written.  {\i Offset} is the offset in the file of the first byte to be written.  Since {\i Offset} is 32 bits, this request is inappropriate for general use in a very large file.
\par If {\i LastWriteTime} and {\i LastWriteDate} are 0, the server should allow its local operating system to set the file's times.  Otherwise, the server should set the time 
to the values requested.  Failure to set the times, even if requested by the client in this message, should not result in an error response from the server.
\par If {\i Count} is 0, the file is truncated (or extended) to {\i Offset}.
\par If an error occurs on the write, the file should still be closed.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Ref363022529}{\*\bkmkstart _Ref363023460}{\*\bkmkstart _Toc365655375}{\*\bkmkstart _Toc358532184}5.25\tab  }{\*\bkmkstart _Toc382909370}
{\*\bkmkstart _Toc382911281}WRITE_MPX: Write Block Multiplex{\*\bkmkend _Ref363022529}{\*\bkmkend _Ref363023460}{\*\bkmkend _Toc365655375}{\*\bkmkend _Toc382909370}{\*\bkmkend _Toc382911281}
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell 
Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 12\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Fid;\cell File handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Count;\cell 
Total bytes, including this buffer\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Reserved;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Offset;\cell Offset in file to begin write\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 ULONG Timeout;\cell milliseconds to wait for completion\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT WriteMode;\cell Write mode:\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell bit 0 - complete write to disk and send final result response\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell bit 1 - return Remaining\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell 
bit 7 - Connectionless mode\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG RequestMask;\cell Connectionless mode mask\cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DataLength;\cell Number of data bytes this buffer\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DataOffset;\cell Offset (from header start) to data\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT ByteCount;\cell Count of data bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Pad[];\cell Pad to SHORT or LONG\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Data[];\cell Data (# = DataLength)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell 
Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 1\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG ResponseMask;\cell OR of all masks received\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell 
Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \ri-576\sa240\widctlpar\tx576 
\par \pard \sa240\widctlpar\tx576 SMB_COM_WRITE_MPX is used to maximize the performance of writing a large block of data from the client to the server.  The NT server supports SMB_COM_WRITE_MPX only over connectionless transports, consequently {\i bit7} of {
\i WriteMode} in the request must be set.
\par {\i Fid} in the request must refer to either a file or a spooled printer.
\par {\i Mask} contains a bit mask indicating where in the transfer that the SMB belongs.  The  response which contains the logical OR of all of the {\i Mask} values received and is always generated.  All in this exchange use the same SMB header {\i Mid}
 value but only final message is a connectionless sequenced request ({\i SequenceNumber} is non-zero).
\par The server keeps a {\i ResponseMask} which is the logical or-ing of the {\i RequestMask}
 value contained in each SMB_COM_WRITE_MPX received since the last sequenced SMB_COM_WRITE_MPX.  The server only responds to the final (sequenced) command, and this response contains the accumulated {\i ResponseMask}. The client uses the {\i ResponseMask}
 received to determine which packets, if any, must be retransmitted.  The server imposes no restrictions on the values in the mask nor upon the order or contiguity of the data being sent.  The client uses this behavior to only send the missing parts in th
e next write sequence when retransmitting.  The next SMB_COM_WRITE_MPX sequence sent must use a new {\i SequenceNumber} value or the server will incorrectly respond with the mask from the previous SMB_COM_WRITE_MPX command.
\par The flow is:
\par \trowd \trgaph108\trleft630 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx3420\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4950\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 
\clcfpat7\clcbpat8\clshdng3000 \cellx5760\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx9000 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client\line \line =================\cell Sequence\line Number\line =========\cell <->\line \line ====\cell Server\line \line =====================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\trowd \trgaph108\trleft630 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3420\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4950\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5760\clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx9000 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 SMB_COM_WRITE_MPX\cell 0\cell ->\cell \cell }\pard\plain \widctlpar\intbl \f4\fs20 {
\f11\fs18 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 SMB_COM_WRITE_MPX\cell 0\cell ->\cell \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\f11\fs18 \row }\pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 ...\cell \cell \cell \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\f11\fs18 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 
SMB_COM_WRITE_MPX\cell S\cell ->\cell \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\f11\fs18 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 \cell S\cell <-\cell SMB_COM_WRITE_MPX OK\cell 
}\pard\plain \widctlpar\intbl \f4\fs20 {\f11\fs18 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 SMB_COM_WRITE_MPX\cell 0\cell ->\cell \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\f11\fs18 \row 
}\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 SMB_COM_WRITE_MPX\cell 0\cell ->\cell \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\f11\fs18 \row }\pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 ....\cell \cell \cell \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\f11\fs18 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 
SMB_COM_WRITE_MPX\cell S+1\cell ->\cell \cell }\pard\plain \widctlpar\intbl \f4\fs20 {\f11\fs18 \row }\trowd \trgaph108\trleft630 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3420\clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4950\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5760\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx9000 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 \cell S+1\cell <-\cell SMB_COM_WRITE_MPX OK\cell }\pard\plain \widctlpar\intbl \f4\fs20 {
\f11\fs18 \row }\pard \sa240\widctlpar\tx576 
\par Other SMB requests can intervene during this protocol exchange.
\par A server response will be generated only after the sequenced SMB_COM_WRITE_MPX has been received unless this SMB is received over a connection oriented transport (in which case the error response is immediately sent).
\par At the time of the request, the client knows the number of data bytes expected to be sent and passes this information to the server in {\i Count.}  The server can use this information to reserve buffer space, if possible.
\par If {\i bit0} of {\i WriteMode}
 is clear, the request assumed to be a form of write behind on the part of the client.  If an error occurs while writing data to disk such as disk full, the next access of the file handle (another write, close, read, etc.) will return the fact that the er
ror occurred.  If {\i bit0} of {\i WriteMode} is set, the server will collect all the data, write it to disk and then send a final response indicating the result of the write .  The total number of bytes written is also returned in this response.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc365655376}5.26\tab  }{\*\bkmkstart _Toc382909371}{\*\bkmkstart _Toc382911282}WRITE_PRINT_FILE: Write to Print File{\*\bkmkend _Toc358532184}
{\*\bkmkend _Toc365655376}{\*\bkmkend _Toc382909371}{\*\bkmkend _Toc382911282}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 This message is sent to write bytes into a print spool file.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 1\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Fid;\cell File handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell 
Count of data bytes;  min = 4\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR BufferFormat;\cell 0x01 -- Data block\cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DataLength;\cell Length of data\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
UCHAR Data[];\cell Data\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par {\i Fid} indicates the print spool file to be written, it must refer to a print spool file.
\par {\i ByteCount} specifies the number of bytes to be written, and must be less than {\i MaxBufferSize} for the Tid specified.
\par {\i Data} contains the bytes to append to the print spool file.  The first {\i SetupLength} bytes in the resulting print spool file contain printer setup data.  {\i SetupLength} is specified in the SMB_COM_OPEN_PRINT_FILE SMB request.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5130\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Server Response\line ==================================\cell Description
\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5130\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par Servers which negotiate a protocol dialect of{\f11\fs18  LANMAN1.0} or later also support the application of normal write requests to print spool files.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc365655377}5.27\tab  }{\*\bkmkstart _Toc382909372}{\*\bkmkstart _Toc382911283}WRITE_RAW: Write Raw Bytes{\*\bkmkend _Toc365655377}{\*\bkmkend _Toc382909372}
{\*\bkmkend _Toc382911283} 
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 
The Write Block Raw protocol is used to maximize the performance of writing a large block of data from the client to the server.  The Write Block Raw command's scope includes files, Named Pipes, and spooled output (can be used in place COM_WRITE_PRINT_FIL
E ).
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4140\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==========================\cell Description
\line =========================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4140\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 12\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Fid;\cell File handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Count;\cell 
Total bytes, including this buffer\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Reserved;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Offset;\cell Offset in file to begin write\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 ULONG Timeout;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT WriteMode;\cell Write mode:\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell bit 0 - complete write to disk and send final result response\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell bit 1 - return Remaining (pipe/dev)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell 
(see WriteAndX for #defines)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ULONG Reserved2;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DataLength;\cell Number of data bytes this buffer\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT DataOffset;\cell Offset (from header start) to data\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
USHORT ByteCount;\cell Count of data bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Pad[];\cell Pad to SHORT or LONG\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4140\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Data[];\cell Data (# = DataLength)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4680\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 First Server Response\line ==============================\cell 
Description\line =====================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4680\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 1\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Remaining;\cell Bytes remaining to be read if pipe\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 
\clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4680\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell 
Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Final Server Response\line ==================================
\cell Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Command (in SMB header)\cell SMB_COM_WRITE_COMPLETE\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell 
Count of parameter words = 1\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT Count;\cell Total number of bytes written\cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;\cell Count of data bytes = 0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par The first response format will be that of the final server response in the case where the server gets an error while writing the data sent along with the request.  Thus {\i Count}
 is the number of bytes which did get written any time an error is returned.  If an error occurs after the first response has been sent allowing the client to send the remaining data, the final response should not be sent unless write through is set.  Rat
her the server should return this "write behind" error on the next access to the {\i Fid}.
\par The client must guarantee that there is (and will be) no other request on the connection for the duration of this request.  The server will reserve enough resources to receive the data and respond with a response SMB as defined above.  The client then sen
ds the raw data in one send.  Thus the server is able to receive up to 65,535 bytes of data directly into the server buffer.  The amount of data transferred is expected to be larger than the nego\-tiated buffer size for this protocol.
\par The reason that no o
ther requests can be active on the connection for the duration of the request is that if other receives are present on the connection, there is normally no way to guarantee that the data will be received into the correct server buffer, rather the data may
 fill one (or more) of the other buffers.  Also if the client is sending other requests on the connection, a request may land in the buffer that the server has allocated for the this SMB's data.
\par Whether or not SMB_COM_WRITE_RAW is supported is returned in the response to SMB_COM_NEGOTIATE.  SMB_COM_WRITE_RAW is not supported for connectionless clients.
\par When write through is not specified (({\i WriteMode} & 01) == 0) this SMB is assumed to be a form of write behind.  The tran\-
sport layer guarantees delivery of all secondary requests from the client.  Thus no "got the data you sent" SMB is needed.  If an error should occur at the server end, all bytes must
 be received and thrown away.  If an error occurs while writing data to disk such as disk full, the next access of the file handle (another write, close, read, etc.) will return the fact that the error occurred.
\par If write through is specified (({\i WriteMode} & 01) != 0), the server will receive the data, write it to disk and then send a final response indicating the result of the write.  The total number of bytes written is also returned in this response in the {
\i Count} field.
\par The flow for the SMB_COM_WRITE_RAW SMB is:
\par {\f11 client -----> SMB_COM_WRITE_RAW request (optional data) >-------> server\line client <------------------< OK send (more) data <---------------- server\line client  ----------------------> raw data >----------------------> server\line 
client  <---< data on disk or error (write through only) <------- server\line 
\par }This protocol is set up such that the SMB_COM_WRITE_RAW request may also carry data.  This is an optimization in that up to the server's buffer size ({\i MaxCount}
 from SMB_COM_NEGOTIATE response), minus the size of the SMB_COM_WRITE_RAW SMB request, may be sent along with the request.  Thus if the server is busy and unable to su
pport the raw write of the remaining data, the data sent along with the request has been delivered and need not be sent again.  The server will write any data sent in the request (and wait for it to be on the disk or device if write through is set), prior
 to sending the response.
\par The specific responses error class ERRSRV, error codes ERRusempx and ERRusestd, indicate that the server is tem\-porarily out of the resources needed to support the raw write of the remaining data, but that any data sent along with 
the request has been successfully written.  The client should then write the remaining data using a different type of SMB write request, or delay and retry using SMB_COM_WRITE_RAW.  If a write error occurs writing the initial data, it will be returned and
 the write raw request is implicitly denied.
\par The return field {\i Remaining} is returned for named pipes only.  It is used to return the number of bytes currently available in the pipe.  This information can then be used by the client to know when a subsequent (
non blocking) read of the pipe may return some data.  Of course when the read request is actually received by the server there may be more or less actual data in the pipe (more data has been written to the pipe / device or another reader drained it).  If 
the infor\-mation is currently not available or the request is NOT for a pipe or the server does not support this feature, a -1 value should be returned.
\par If the negotiated dialect is {\f11\fs18 NT LM 0.12} or later, and the response to the SMB_COM_NEGOTIATE SMB has CAP_LARGE_FILES set in the {\i Capabilities}
 field, an additional request format is allowed which accommodates very large files having 64 bit offsets:
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Client Request\line ==================================\cell 
Description\line =================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR WordCount;\cell Count of parameter words = 14\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20  USHORT Fid;\cell File handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20  USHORT Count;\cell 
Total bytes, including this buffer\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20  USHORT Reserved;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20  ULONG Offset;\cell Offset in file to begin write\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20  ULONG Timeout;\cell \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20  USHORT WriteMode;\cell Write mode:\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20   \cell bit 0 - complete write to disk and send final result response\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 \cell bit 1 - return Remaining (pipe/dev)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20  ULONG Reserved2;\cell 
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20  USHORT DataLength;\cell Number of data bytes this buffer\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20  USHORT DataOffset;\cell Offset (from header start) to data\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20  ULONG OffsetHigh;\cell Upper 32 bits of offset\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 USHORT ByteCount;
\cell Count of data bytes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 UCHAR Pad[];\cell Pad to SHORT or LONG\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd 
\trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10260 \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20  UCHAR Data[];\cell Data (# = DataLength)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par In this case the final offset in the file is formed by combining {\i OffsetHigh} and {\i Offset}, the resulting offset must not be negative.
\par \pard\plain \s1\fi-432\li432\sb240\sa60\keepn\widctlpar\tx432\tx576 \b\f5\fs32\kerning28 {\b0 {\*\bkmkstart _Toc365655378}{\*\bkmkstart _Toc358532261}6\tab  }{\*\bkmkstart _Toc382909373}{\*\bkmkstart _Toc382911284}SMB Symbolic Constants
{\*\bkmkend _Toc365655378}{\*\bkmkend _Toc382909373}{\*\bkmkend _Toc382911284}
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc365655379}6.1\tab  }{\*\bkmkstart _Toc382909374}{\*\bkmkstart _Toc382911285}SMB Command Codes{\*\bkmkend _Toc358532261}{\*\bkmkend _Toc365655379}
{\*\bkmkend _Toc382909374}{\*\bkmkend _Toc382911285}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 The following values have been assigned for the SMB Commands.
\par \trowd \trgaph108 \cellx4140\cellx5580 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_CREATE_DIRECTORY\cell 0x00\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \cellx4140\cellx5580 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_DELETE_DIRECTORY\cell 0x01\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
SMB_COM_OPEN\cell 0x02\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_CREATE\cell 0x03\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_CLOSE\cell 0x04\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_FLUSH\cell 0x05
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_DELETE\cell 0x06\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_RENAME\cell 0x07\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_QUERY_INFORMATION\cell 0x08\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_SET_INFORMATION\cell 0x09\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_READ\cell 0x0A\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_WRITE\cell 0x0B\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_LOCK_BYTE_RANGE\cell 0x0C\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_UNLOCK_BYTE_RANGE\cell 0x0D\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_CREATE_TEMPORARY\cell 
0x0E\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_CREATE_NEW\cell 0x0F\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_CHECK_DIRECTORY\cell 0x10\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_PROCESS_EXIT\cell 0x11
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_SEEK\cell 0x12\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_LOCK_AND_READ\cell 0x13\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_WRITE_AND_UNLOCK\cell 0x14
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_READ_RAW\cell 0x1A\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_READ_MPX\cell 0x1B\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_READ_MPX_SECONDARY\cell 0x1C
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_WRITE_RAW\cell 0x1D\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_WRITE_MPX\cell 0x1E\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_WRITE_COMPLETE\cell 0x20\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_SET_INFORMATION2\cell 0x22\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_QUERY_INFORMATION2\cell 0x23\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_LOCKING_ANDX\cell 
0x24\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_TRANSACTION\cell 0x25\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_TRANSACTION_SECONDARY\cell 0x26\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_IOCTL\cell 0x27
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_IOCTL_SECONDARY\cell 0x28\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_COPY\cell 0x29\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_MOVE\cell 0x2A\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_ECHO\cell 0x2B\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_WRITE_AND_CLOSE\cell 0x2C\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_OPEN_ANDX\cell 0x2D
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_READ_ANDX\cell 0x2E\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_WRITE_ANDX\cell 0x2F\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_CLOSE_AND_TREE_DISC\cell 0x31
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_TRANSACTION2\cell 0x32\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_TRANSACTION2_SECONDARY\cell 0x33\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_FIND_CLOSE2\cell 
0x34\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_FIND_NOTIFY_CLOSE\cell 0x35\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_TREE_CONNECT\cell 0x70\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_TREE_DISCONNECT\cell 0x71
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_NEGOTIATE\cell 0x72\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_SESSION_SETUP_ANDX\cell 0x73\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_LOGOFF_ANDX\cell 0x74
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_TREE_CONNECT_ANDX\cell 0x75\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_QUERY_INFORMATION_DISK\cell 0x80\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_SEARCH\cell 0x81
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_FIND\cell 0x82\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_FIND_UNIQUE\cell 0x83\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_NT_TRANSACT\cell 0xA0\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_NT_TRANSACT_SECONDARY\cell 0xA1\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_NT_CREATE_ANDX\cell 0xA2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_NT_CANCEL\cell 0xA4\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_OPEN_PRINT_FILE\cell 0xC0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_WRITE_PRINT_FILE\cell 0xC1\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_CLOSE_PRINT_FILE\cell 
0xC2\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \cellx4140\cellx5580 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SMB_COM_GET_PRINT_QUEUE\cell 0xC3\cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc358532221}{\*\bkmkstart _Toc365655380}{\*\bkmkstart _Toc358532262}6.2\tab  }{\*\bkmkstart _Toc382909375}{\*\bkmkstart _Toc382911286}
SMB_COM_TRANSACTION2 {\*\bkmkend _Toc358532221}Subcommand codes{\*\bkmkend _Toc365655380}{\*\bkmkend _Toc382909375}{\*\bkmkend _Toc382911286}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 The subcommand code for {\f11\fs18 SMB_COM_TRANSACTION2} request is placed in Setup[0].  The parameters associated with any particular request are placed in the {\i Parameters}
 vector of the request.  The defined subcommand codes are:
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx4680\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5670\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 
\cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Setup[0] Transaction2 Subcommand Code\line ===============================\cell Value\line \line =====\cell Description\line \line 
=============================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4680\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5670\clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 TRANS2_OPEN2\cell 0x00\cell }Create file with extended attributes\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 TRANS2_FIND_FIRST2\cell 0x01\cell }Begin search for files\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 TRANS2_FIND_NEXT2\cell 0x02\cell }Resume search for files\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 TRANS2_QUERY_FS_INFORMATION\cell 0x03\cell }Get file system information\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 \cell 0x04\cell }Reserved\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 
TRANS2_QUERY_PATH_INFORMATION\cell 0x05\cell }Get information about a named file or directory\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 
TRANS2_SET_PATH_INFORMATION\cell 0x06\cell }Set information about a named file or directory\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 
TRANS2_QUERY_FILE_INFORMATION\cell 0x07\cell }Get information about a handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 TRANS2_SET_FILE_INFORMATION\cell 
0x08\cell }Set information by handle\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 TRANS2_FSCTL\cell 0x09\cell }Not implemented by NT server\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 TRANS2_IOCTL2\cell 0x0A\cell }Not implemented by NT server\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 TRANS2_FIND_NOTIFY_FIRST\cell 0x0B\cell }Not implemented by NT server\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 TRANS2_FIND_NOTIFY_NEXT\cell 0x0C\cell }Not implemented by NT server\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 TRANS2_CREATE_DIRECTORY\cell 0x0D\cell }Create directory with extended attributes\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 TRANS2_SESSION_SETUP\cell 0x0E\cell }Session setup with extended security information\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18\cf1 TRANS2_GET_DFS_REFERRAL\cell 0x10\cell }{\cf1 Get a DFS referral\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\cf1 \row }\trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx4680\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5670\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18\cf1 TRANS2_REPORT_DFS_INCONSISTENCY\cell 0x11\cell }{\cf1 Report a DFS knowledge inconsistency\cell }\pard\plain 
\widctlpar\intbl \f4\fs20 {\cf1 \row }\pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc358532249}{\*\bkmkstart _Toc365655381}6.3\tab  }{\*\bkmkstart _Toc382909376}{\*\bkmkstart _Toc382911287}
SMB_COM_NT_TRANSACTION {\*\bkmkend _Toc358532249}Subcommand Codes{\*\bkmkend _Toc365655381}{\*\bkmkend _Toc382909376}{\*\bkmkend _Toc382911287}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 For these transactions, {\i Function} in the primary client request indicates the operation to be performed.  It may assume one of the following values:
\par \trowd \trgaph108\trleft90 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx5220\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx6210\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\clcfpat7\clcbpat8\clshdng3000 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 SubCommand Code\line ==================================\cell Value\line =====\cell Description\line 
===========================\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 
\cellx6210\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 NT_TRANSACT_CREATE\cell 1\cell File open/create\cell }\pard\plain 
\widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 NT_TRANSACT_IOCTL\cell 2\cell Device IOCTL\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row 
}\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 NT_TRANSACT_SET_SECURITY_DESC\cell 3\cell Set security descriptor\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 NT_TRANSACT_NOTIFY_CHANGE\cell 4\cell Start directory watch\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 NT_TRANSACT_RENAME\cell 5\cell Reserved (Handle-based rename)\cell }\pard\plain \widctlpar\intbl \f4\fs20 {\kerning28 \row }\trowd \trgaph108\trleft90 \clbrdrl\brdrs\brdrw30\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx5220\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx6210\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw30\brdrcf1 \cellx10350 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\kerning28 NT_TRANSACT_QUERY_SECURITY_DESC\cell 6\cell }Retrieve security descriptor info{\kerning28 \cell }\pard\plain 
\widctlpar\intbl \f4\fs20 {\kerning28 \row }\pard \sa240\widctlpar\tx576 {\kerning28 
\par }\pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc365655382}6.4\tab  }{\*\bkmkstart _Toc382909377}{\*\bkmkstart _Toc382911288}SMB Protocol Dialect Constants{\*\bkmkend _Toc365655382}
{\*\bkmkend _Toc382909377}{\*\bkmkend _Toc382911288}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 This is the list of  CIFS protocol dialects, ordered from least functional (earliest) version to most functional (most recent) version:
\par \trowd \trgaph108\trleft7 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx3420\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 
\clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx10177 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Dialect Name\line ===========================\cell Comment\line 
========================================\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft7 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3420\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\cellx10177 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 PC NETWORK PROGRAM 1.0\cell }The original MSNET SMB protocol (otherwise known as the "core protocol")\cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 PCLAN1.0\cell }Some versions of the original MSNET defined this as an alternate to the core protocol name\cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 MICROSOFT NETWORKS 1.03\cell }
This is used for the MS-NET 1.03 product.  It defines Lock&Read,Write&Unlock, and a special version of raw read and raw write.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 {\f11\fs18 MICROSOFT NETWORKS 3.0\cell }This is the  DOS {\f11\fs18 LANMAN 1.0} specific protocol.  It is equivalent to the {\f11\fs18 LANMAN 1.0}
 protocol, except the server is required to map errors from the OS/2 error to an appropriate DOS error.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 
LANMAN1.0\cell }This is the first version of the full {\f11\fs18 LANMAN 1.0} protocol\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 LM1.2X002\cell }
This is the first version of the full LANMAN 2.0 protocol\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 DOS LM1.2X002\cell }This is the DOS equiva
lent of the {\f11\fs18 LM1.2X002} protocol.  It is identical to the {\f11\fs18 LM1.2X002} protocol, but the server will perform error mapping to appropriate DOS errors.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 DOS LANMAN2.1\cell }DOS {\f11\fs18 LANMAN2.1}\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {
\f11\fs18 LANMAN2.1\cell }OS/2 {\f11\fs18 LANMAN2.1}\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 Windows for Workgroups 3.1a\cell }
Windows for Workgroups Version 1.0\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108\trleft7 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3420\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10177 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 {\f11\fs18 NT LM 0.12}{\f11\fs18\cf2 \cell }
The SMB protocol designed for NT networking.  This has special SMBs which duplicate the NT semantics.{\cf2 \cell }\pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par CIFS servers select the most recent version of the protocol known to both client and server.  Any CIFS server which supports dialects newer than the original core dialect must support all the messages and semantics of the dialects between the core dialect
 and the newer one.  This is to say that a server which supports the {\f11\fs18 NT LM 0.12 }dialect must also support all of the messages of the previous 10 dialects{\f11\fs18 .}
  It is the client's responsibility to ensure it only sends SMBs which are appropriate to the dialect n
egotiated.  Clients must be prepared to receive an SMB response from an earlier protocol dialect -- even if the client used the most recent form of the request.
\par \pard\plain \s1\fi-432\li432\sb240\sa60\keepn\widctlpar\tx432\tx576 \b\f5\fs32\kerning28 {\b0 {\*\bkmkstart _Toc365655383}7\tab  }{\*\bkmkstart _Toc382909378}{\*\bkmkstart _Toc382911289}Error Codes and Classes{\*\bkmkend _Toc358532262}
{\*\bkmkend _Toc365655383}{\*\bkmkend _Toc382909378}{\*\bkmkend _Toc382911289}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 This section lists all of the valid values for {\i Status.DosError.ErrorClass}, and most of the error codes for {\i Status.DosError.Error}.
\par The following error classes may be returned by the server to the client.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx1620\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx2430\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 
\cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Class\line =======\cell Code\line ====\cell Comment\line ====================================================\cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx1620\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx2430\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SUCCESS\cell 0\cell The request was successful.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 ERRDOS\cell 0x01\cell Error is from the core DOS operating system set.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRSRV\cell 0x02\cell 
Error is generated by the server network file manager.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRHRD\cell 0x03\cell Error is an hardware error.\cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx1620\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr
\brdrs\brdrw15\brdrcf1 \cellx2430\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRCMD\cell 0xFF\cell 
Command was not in the "SMB" format.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576\tx2340\tx3420 
\par \pard \sa240\keepn\widctlpar\tx576\tx2340\tx3420 The following error codes may be generated with the  SUCCESS error class.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx1620\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx2430\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 
\cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Class\line =======\cell Code\line ====\cell Comment\line ====================================================\cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx1620\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx2430\clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 SUCCESS\cell 0\cell The request was successful.\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard \sa240\widctlpar\tx576 
\par The following error codes may be generated with the ERRDOS error class.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx2430\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx3409\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 
\cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Error\line ===============\cell Code\line =====\cell Description\line =============================================\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx2430\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3409\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRbadfunc\cell 1\cell 
Invalid function.  The server did not recognize or could not perform a system call generated by the server, e.g., set the DIRECTORY attribute on a data file, invalid seek mode.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRbadfile\cell 2\cell File not found.  The last component of a file's pathname could not be found.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRbadpath\cell 3\cell Directory invalid.  A directory component in a pathname could not be found.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRnofids\cell 4\cell Too many open files.  The server has no file handles available.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRnoaccess\cell 5\cell Access denied, the client's context does not permit the requested function.  This includes the following conditions:
\par invalid rename command
\par write to Fid open for read only
\par read on Fid open for write only
\par attempt to delete a non-empty directory\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRbadfid\cell 6\cell 
Invalid file handle.  The file handle specified was not recognized by the server.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRbadmcb\cell 7\cell 
Memory control blocks destroyed.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRnomem\cell 8\cell Insufficient server memory to perform the requested function.  
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRbadmem\cell 9\cell Invalid memory block address.  \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRbadenv\cell 10\cell Invalid environment.  \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
ERRbadformat\cell 11\cell Invalid format.  \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRbadaccess\cell 12\cell Invalid open mode.\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRbaddata\cell 13\cell Invalid data (generated only by IOCTL calls within the server).  \cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRbaddrive\cell 15\cell Invalid drive specified.  \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRremcd\cell 16\cell A Delete Directory request attempted to remove the server's current directory.  \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRdiffdevice\cell 17\cell Not same device (e.g., a cross volume rename was attempted) \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRnofiles\cell 18\cell A File Search command can find no more files matching the specified criteria.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRbadshare\cell 32\cell The sharing mode specified for an Open conflicts with existing FIDs on the file.  \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRlock\cell 33\cell A Lock request conflicted with an existing lock or specified an invalid mode, or an Unlock requested attempted to remove a lock held by another process.  \cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx2430\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3409\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 
\cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRfilexists\cell 80\cell The file named in the request already exists. \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard 
\fi-1620\li1620\sa240\widctlpar\tx540\tx576\tx1170\tx1620 
\par \pard \fi-1627\li1627\sa240\keepn\widctlpar\tx540\tx576\tx1170\tx1620 The following error codes may be generated with the ERRSRV error class.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx2430\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx3409\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 
\cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Error\line ===============\cell Code\line =====\cell Description\line =============================================\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx2430\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3409\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRerror\cell 1\cell Non-specific error code.  It is returned under the following conditions:
\par {\pntext\pard\plain\intbl\f1\fs20 \'b7\tab}\pard \s24\fi-360\li360\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840{\*\pn \pnlvlblt\pnf1\pnstart1\pnindent360\pnhang{\pntxtb \'b7}}resource other than disk space exhausted (e.g.  TIDs)
\par {\pntext\pard\plain\intbl\f1\fs20 \'b7\tab}first SMB command was not negotiate
\par {\pntext\pard\plain\intbl\f1\fs20 \'b7\tab}multiple negotiates attempted
\par {\pntext\pard\plain\intbl\f1\fs20 \'b7\tab}internal server error \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRbadpw\cell 2\cell 
Bad password - name/password pair in a Tree Connect or Session Setup are invalid.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRaccess\cell 4\cell 
The client does not have the necessary access rights within the specified context for the requested function.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRinvnid
\cell 5\cell The Tid specified in a command was invalid.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRinvnetname\cell 6\cell Invalid network name in tree connect.
\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRinvdevice\cell 7\cell 
Invalid device - printer request made to non-printer connection or non-printer request made to printer connection.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
ERRqfull\cell 49\cell Print queue full (files) -- returned by open print file.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRqtoobig\cell 50\cell 
Print queue full -- no space.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRqeof\cell 51\cell EOF on print queue dump.\cell \pard\plain \widctlpar\intbl \f4\fs20 
\row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRinvpfid\cell 52\cell Invalid print file FID.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRsmbcmd\cell 64\cell The server did not recognize the command received.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 ERRsrverror\cell 65\cell The server encountered an internal error, e.g., system file unavailable.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRfilespecs
\cell 67\cell The Fid and pathname parameters contained an invalid combination of values.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRbadpermits\cell 69\cell 
The access permissions specified for a file or directory are not a valid combination.  The server cannot set the requested attribute.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRsetattrmode\cell 71\cell The attribute mode in the Set File Attribute request is invalid.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRpaused\cell 81\cell Server is paused.  (reserved for messaging)\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 ERRmsgoff\cell 82\cell Not receiving messages.  (reserved for messaging).\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRnoroom\cell 83\cell 
No room to buffer message.  (reserved for messaging).\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRrmuns\cell 87\cell 
Too many remote user names.  (reserved for messaging).\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRtimeout\cell 88\cell Operation timed out.\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRnoresource\cell 89\cell No resources currently available for request.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRtoomanyuids\cell 90\cell Too many Uids active on this session.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRbaduid\cell 91\cell The Uid is not known as a valid user identifier on this session.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRusempx\cell 250\cell Temporarily unable to support Raw, use MPX mode.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 
\f4\fs20 ERRusestd\cell 251\cell Temporarily unable to support Raw, use standard read/write.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRcontmpx\cell 252\cell 
Continue in MPX mode.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx2430\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 
\clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3409\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRnosupport\cell 65535
\cell Function not supported.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \fi-1620\li1620\sa240\widctlpar\tx540\tx576\tx1170\tx1620 
\par \pard \fi-1627\li1627\sa240\keepn\widctlpar\tx540\tx576\tx1170\tx1620 The following error codes may be generated with the ERRHRD error class.
\par \trowd \trgaph108 \clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx2430\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb
\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 \cellx3409\clbrdrt\brdrs\brdrw15\brdrcf1 \clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \clcfpat7\clcbpat8\clshdng3000 
\cellx10170 \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 Error\line ===============\cell Code\line =====\cell Description\line =============================================\cell \pard\plain \widctlpar\intbl 
\f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx2430\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3409\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRnowrite\cell 19\cell Attempt to write on write-protected media  \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRbadunit\cell 20\cell Unknown unit.  \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRnotready\cell 21\cell 
Drive not ready.  \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRbadcmd\cell 22\cell Unknown command.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain 
\s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRdata\cell 23\cell Data error (CRC).  \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
ERRbadreq\cell 24\cell Bad request structure length.  \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRseek\cell 25\cell Seek error.\cell \pard\plain 
\widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRbadmedia\cell 26\cell Unknown media type.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRbadsector\cell 27\cell Sector not found.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRnopaper\cell 28
\cell Printer out of paper.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRwrite\cell 29\cell Write fault.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row 
\pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRread\cell 30\cell Read fault.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
ERRgeneral\cell 31\cell General failure.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRbadshare\cell 32\cell A open conflicts with an existing open.  \cell 
\pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRlock\cell 33\cell 
A Lock request conflicted with an existing lock or specified an invalid mode, or an Unlock requested attempted to remove a lock held by another process.  \cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRwrongdisk\cell 34\cell The wrong disk was found in a drive.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard\plain \s24\sl-240\slmult0\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 
ERRFCBUnavail\cell 35\cell No FCBs are available to process request.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \trowd \trgaph108 \clbrdrl\brdrs\brdrw30\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx2430\clbrdrl
\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw15\brdrcf1 \cellx3409\clbrdrl\brdrs\brdrw15\brdrcf1 \clbrdrb\brdrs\brdrw15\brdrcf1 \clbrdrr\brdrs\brdrw30\brdrcf1 \cellx10170 \pard\plain \s24\sl-240\slmult0
\keep\keepn\widctlpar\intbl\tx360\tx600\tx840 \f4\fs20 ERRsharebufexc\cell 36\cell A sharing buffer has been exceeded.\cell \pard\plain \widctlpar\intbl \f4\fs20 \row \pard \fi-1620\li1620\sa240\widctlpar\tx540\tx576\tx1170\tx1620 
\par \pard\plain \s1\fi-432\li432\sb240\sa60\keepn\widctlpar\tx432\tx576 \b\f5\fs32\kerning28 {\b0 {\*\bkmkstart _Toc365655384}8\tab  }{\*\bkmkstart _Toc382909379}{\*\bkmkstart _Toc382911290}Legal Notice{\*\bkmkend _Toc365655384}{\*\bkmkend _Toc382909379}
{\*\bkmkend _Toc382911290}
\par \pard\plain \sa240\widctlpar\tx576\tx1440 \f4\fs20 {\cf1 Microsoft does not know of any third-party rights that are violated by this contribution.  Microsoft makes no other representations regarding this contribution}{\i\cf1 .}
\par \pard\plain \s1\fi-432\li432\sb240\sa60\keepn\widctlpar\tx432\tx576 \b\f5\fs32\kerning28 {\b0 {\*\bkmkstart _Toc365655385}9\tab  }{\*\bkmkstart _Toc382909380}{\*\bkmkstart _Toc382911291}References{\*\bkmkend _Toc365655385}{\*\bkmkend _Toc382909380}
{\*\bkmkend _Toc382911291}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20  [1] P. Mockapetris, "Domain Names - Concepts And Facilities", RFC 1034,\line     November 1987
\par [2] P. Mockapetris, "Domain Names - Implementation And Specification",\line     RFC 1035, November 1987
\par [3] Karl Auerbach, "Protocol Standard For A Netbios Service On A Tcp/Udp\line     Transport: Concepts And Methods", RFC 1001, March 1987
\par [4] Karl Auerbach, "Protocol Standard For A Netbios Service On A Tcp/Udp\line     Transport: Detailed Specifications", RFC 1002, March 1987
\par [5] {\f11\cf1 US National Bureau of Standards, "Data Encryption Standard",\line     Federal Information Processing Standard (FIPS) Publication\line     46-1, January 1988} 
\par [6] Rivest, R. - MIT and RSA Data Security, Inc., "The MD4 Message\line     Digest Algorithm", RFC 1320, April 1992
\par [7] X/Open Company Ltd., "X/Open CAE Specification - Protocols for\line     X/Open PC Interworking: SMB, Version 2", X/Open Document Number:\line     CAE 209, September 1992.
\par \pard\plain \s1\fi-432\li432\sb240\sa60\keepn\widctlpar\tx432\tx576 \b\f5\fs32\kerning28 {\b0 {\*\bkmkstart _Toc365655386}10\tab  }{\*\bkmkstart _Toc382909381}{\*\bkmkstart _Toc382911292}Security Considerations{\*\bkmkend _Toc365655386}
{\*\bkmkend _Toc382909381}{\*\bkmkend _Toc382911292}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 There are four authentication mechanisms, each with their own strengths and weaknesses, as well as attacks that are independent of the authentication protocol.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc359296902}{\*\bkmkstart _Toc365655387}10.1\tab  }{\*\bkmkstart _Toc382909382}{\*\bkmkstart _Toc382911293}Share level protection{\*\bkmkend _Toc359296902}
{\*\bkmkend _Toc365655387}{\*\bkmkend _Toc382909382}{\*\bkmkend _Toc382911293}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 
In share level protection, there are no per-user passwords; knowledge of the read or write password is what gives read or write access. Since the passwords must be disclosed to be used, and hence known by many people, the scheme is quite weak.
\par In addition, the passwords are sent in the clear over the network, so they have all the weaknesses of clear text passwords in user level security.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc359296903}{\*\bkmkstart _Toc365655388}10.2\tab  }{\*\bkmkstart _Toc382909383}{\*\bkmkstart _Toc382911294}Plaintext Password Authentication
{\*\bkmkend _Toc359296903}{\*\bkmkend _Toc365655388}{\*\bkmkend _Toc382909383}{\*\bkmkend _Toc382911294}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 This authentication protocol sends the client's password in the clear. It should 
be used only when needed for backwards compatibility, and only where the chances of eavesdropping is deemed acceptable, such as relatively isolated networks. Passwords sent to such servers should never be the same as passwords used for more secure servers
.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc359296904}{\*\bkmkstart _Toc365655389}10.3\tab  }{\*\bkmkstart _Toc382909384}{\*\bkmkstart _Toc382911295}LANMAN 2.1 (and earlier) Challenge/Response
{\*\bkmkend _Toc359296904}{\*\bkmkend _Toc365655389}{\*\bkmkend _Toc382909384}{\*\bkmkend _Toc382911295}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 This authentication protocol is subject to the following vulnerabilities:
\par {\pntext\pard\plain\fs20 o\tab}\pard \fi-360\li360\sa240\widctlpar\tx576{\*\pn \pnlvlblt\pnstart1\pnindent360 {\pntxtb o}}Known plaintext attack
\par {\pntext\pard\plain\fs20 o\tab}Small key space
\par {\pntext\pard\plain\fs20 o\tab}Chosen plaintext attack
\par {\pntext\pard\plain\fs20 o\tab}Dictionary attack
\par {\pntext\pard\plain\fs20 o\tab}Badly chosen passwords
\par \pard \sa240\widctlpar\tx576 These attack
s, if successful, compromise the client's password, and allow the attacker access to the client's files even after the client's session has ended. Because of these attacks, it should be used only when needed for backwards compatibility, or where the chanc
es of eavesdropping are deemed acceptable, such as relatively isolated networks. It is more secure than plaintext password authentication, because passwords are never seen in the clear on the network. Whenever possible, the use of the NT LM 0.12 authentic
ation is to be preferred.
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc359296905}{\*\bkmkstart _Toc365655390}10.3.1\tab  }{\*\bkmkstart _Toc382909385}{\*\bkmkstart _Toc382911296}Known Plaintext Attacks
{\*\bkmkend _Toc359296905}{\*\bkmkend _Toc365655390}{\*\bkmkend _Toc382909385}{\*\bkmkend _Toc382911296}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 
Because the challenge is plaintext, an eavesdropper can acquire known plaintext/ciphertext pairs. It can then test a guess at a password by using it to generate a key, encrypting the plaintext, and comparing it to the corresponding ciphertext.
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc359296906}{\*\bkmkstart _Toc365655391}10.3.2\tab  }{\*\bkmkstart _Toc382909386}{\*\bkmkstart _Toc382911297}Small Key Space
{\*\bkmkend _Toc359296906}{\*\bkmkend _Toc365655391}{\*\bkmkend _Toc382909386}{\*\bkmkend _Toc382911297}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 The combination of the use of only uppercase characters, the usual user practice of  choosing passwords that have alpha and perhaps numeric characters, plus the fact that the protocol trea
ts the upper and lower halves of the 14 bytes key almost identically means that the key space is rather small. Enumerating 7 uppercase characters and digits leads to a key space of 36**7, or 78.3 billion combinations. When this mechanism was introduced ne
arly a decade ago, this was probably an adequately large key space, but with today's much more powerful systems, it is now small enough to make a brute force search feasible upon a plaintext/ciphertext pair obtained via a known plaintext attack.
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc359296907}{\*\bkmkstart _Toc365655392}10.3.3\tab  }{\*\bkmkstart _Toc382909387}{\*\bkmkstart _Toc382911298}Chosen Plaintext Attacks
{\*\bkmkend _Toc359296907}{\*\bkmkend _Toc365655392}{\*\bkmkend _Toc382909387}{\*\bkmkend _Toc382911298}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 
A "main-in-the-middle" or a counterfeit server can choose the challenge "C8" which the client will then encrypt using a key derived from the client's password. The ability to choose the plaintext to be encrypted is known to make breaking many ciphers much
 easier.
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc359296908}{\*\bkmkstart _Toc365655393}10.3.4\tab  }{\*\bkmkstart _Toc382909388}{\*\bkmkstart _Toc382911299}Dictionary Attacks
{\*\bkmkend _Toc359296908}{\*\bkmkend _Toc365655393}{\*\bkmkend _Toc382909388}{\*\bkmkend _Toc382911299}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 The attacker can precompute the response for many common passwords to a challenge of its choice, and build a dictionary of (response, password) pairs. It can then use the chosen plaintext attack to a
cquire a response corresponding to that challenge, and just look up the password in the dictionary.
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc359296909}{\*\bkmkstart _Toc365655394}10.3.5\tab  }{\*\bkmkstart _Toc382909389}{\*\bkmkstart _Toc382911300}Badly Chosen Passwords
{\*\bkmkend _Toc359296909}{\*\bkmkend _Toc365655394}{\*\bkmkend _Toc382909389}{\*\bkmkend _Toc382911300}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 Passwords that are not long enough, or that are words in the language of the clients, make the above attacks even easier by reducing the key space even more. 
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc359296910}{\*\bkmkstart _Toc365655395}10.4\tab  }{\*\bkmkstart _Toc382909390}{\*\bkmkstart _Toc382911301}NT LM 0.12 Challenge/Response
{\*\bkmkend _Toc359296910}{\*\bkmkend _Toc365655395}{\*\bkmkend _Toc382909390}{\*\bkmkend _Toc382911301}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 Because it uses MD4 to generate the keying material from the password, and because it preserves the password's case, the key space of this protocol is essentially the full 56 bits that s
ingle DES allows; this is probably an acceptable length for most purposes (although future dialects may use triple-DES for more assurance). However, it is still subject to the same chosen plaintext and dictionary attacks as LANMAN 2.1 challenge/response i
f passwords are badly chosen. The only cure is to make sure that passwords are well-chosen, and long enough to have at least 56 bits of randomness.
\par Other considerations:
\par {\pntext\pard\plain\fs20 o\tab}\pard \fi-360\li360\sa240\widctlpar\tx576{\*\pn \pnlvlblt\pnstart1\pnindent360 {\pntxtb o}}Transforming the password into Unicode leaves a pattern of alternating zeros and cha
racters in the input to MD4.  This may allow MD4 to be reversed much more easily, although there is currently no known way to exploit this.
\par {\pntext\pard\plain\fs20 o\tab}
MD4 is known to be weak with respect to collisions.  There may be a way to exploit this to attack its one-wayness, or to exploit the collision properties to limit key search time, although there is currently no known way to do so.
\par \pard\plain \s2\fi-576\li576\sb240\sa240\keepn\widctlpar\tx576 \b\f25\fs32 {\b0\i {\*\bkmkstart _Toc365655396}10.5\tab  }{\*\bkmkstart _Toc382909391}{\*\bkmkstart _Toc382911302}Other attacks{\*\bkmkend _Toc365655396}{\*\bkmkend _Toc382909391}
{\*\bkmkend _Toc382911302}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20  
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655397}10.5.1\tab  }{\*\bkmkstart _Toc382909392}{\*\bkmkstart _Toc382911303}Hijack connections{\*\bkmkend _Toc365655397}
{\*\bkmkend _Toc382909392}{\*\bkmkend _Toc382911303}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 
Any attacker that can inject packets into the network that appear to the server to be coming from a particular client, can hijack that client's connection. Once a connection is set up and the client has authenticated, subsequent packets are not authentica
ted, so the attacker can inject requests to read, write, or delete files to which the client has access. Doing so require that the injected packets have the right transport level sequence numbers, which can be tricky, especially if the client is sending p
ackets at the same time. It is significantly more difficult to hijack a connection than to eavesdrop, and doing so only permits the attacker to access files as the client for the duration of the session.
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655398}10.5.2\tab  }{\*\bkmkstart _Toc382909393}{\*\bkmkstart _Toc382911304}Downgrade attack{\*\bkmkend _Toc365655398}
{\*\bkmkend _Toc382909393}{\*\bkmkend _Toc382911304}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 
A "man-in-the-middle" can remove the bit in the SMB_COM_NEGPROT response that says the server supports challenge/response, thus fooling a client into thinking that it should supply a plaintext password. This attack can be mitigated if clients are able to 
be configured to require challenge/response, either in general or for particular servers.
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655399}10.5.3\tab  }{\*\bkmkstart _Toc382909394}{\*\bkmkstart _Toc382911305}Spoofing by Counterfeit Servers
{\*\bkmkend _Toc365655399}{\*\bkmkend _Toc382909394}{\*\bkmkend _Toc382911305}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 
A counterfeit server is one that spoofs the DNS name resolution process so that the client gets the counterfeit's IP address instead of the genuine server's IP address, thus fooling the client into connecting to the counterfeit while believing it is conne
cting to the genuine server.  Counterfeit servers are not detectable by the challenge/response authentication mechanism, which only authenticates clients. A 
counterfeit server can use the downgrade attack above to obtain a client's password; it can also execute a denial of service attack by denying the client's requests or returning bogus results. Counterfeit server attacks can be mitigated by deployment of D
NSSEC.
\par \pard\plain \s3\fi-720\li720\ri115\sb240\sa240\keepn\widctlpar\tx576\tx720 \b\f25\fs28\lang1024 {\b0\f5 {\*\bkmkstart _Toc365655400}10.5.4\tab  }{\*\bkmkstart _Toc382909395}{\*\bkmkstart _Toc382911306}Storing Passwords Safely{\*\bkmkend _Toc365655400}
{\*\bkmkend _Toc382909395}{\*\bkmkend _Toc382911306}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 
The passwords used in any of the authentication mechanisms used by this protocol have to be protected from access from over the network and from physical access. If the server does not support access control at the in
dividual file level, but only at the file tree level, then password files can not be placed in a file tree that is accessible from the network, as all files in such a tree have to be at least equally readable.
\par \pard\plain \s1\fi-432\li432\sb240\sa60\keepn\widctlpar\tx432\tx576 \b\f5\fs32\kerning28 {\b0 {\*\bkmkstart _Toc365655401}11\tab  }{\*\bkmkstart _Toc382909396}{\*\bkmkstart _Toc382911307}Authors\rquote  Addresses{\*\bkmkend _Toc365655401}
{\*\bkmkend _Toc382909396}{\*\bkmkend _Toc382911307}
\par \pard\plain \sa240\widctlpar\tx576 \f4\fs20 Paul Leach\line Dilip Naik\line Microsoft\line 1 Microsoft Way\line Redmond, WA  98052\line paulle@microsoft.com\line  
\par 
\par }