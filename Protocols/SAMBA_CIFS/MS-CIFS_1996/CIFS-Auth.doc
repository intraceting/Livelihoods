{\rtf1\ansi\ansicpg1252\uc1 \deff0\deflang1033\deflangfe1033{\fonttbl{\f0\froman\fcharset0\fprq2{\*\panose 02020603050405020304}Times New Roman;}{\f1\fswiss\fcharset0\fprq2{\*\panose 020b0604020202020204}Arial;}
{\f2\fmodern\fcharset0\fprq1{\*\panose 02070309020205020404}Courier New;}{\f3\froman\fcharset2\fprq2{\*\panose 05050102010706020507}Symbol;}{\f16\froman\fcharset238\fprq2 Times New Roman CE;}{\f17\froman\fcharset204\fprq2 Times New Roman Cyr;}
{\f19\froman\fcharset161\fprq2 Times New Roman Greek;}{\f20\froman\fcharset162\fprq2 Times New Roman Tur;}{\f21\froman\fcharset186\fprq2 Times New Roman Baltic;}}{\colortbl;\red0\green0\blue0;\red0\green0\blue255;\red0\green255\blue255;
\red0\green255\blue0;\red255\green0\blue255;\red255\green0\blue0;\red255\green255\blue0;\red255\green255\blue255;\red0\green0\blue128;\red0\green128\blue128;\red0\green128\blue0;\red128\green0\blue128;\red128\green0\blue0;\red128\green128\blue0;
\red128\green128\blue128;\red192\green192\blue192;}{\stylesheet{\sa240\nowidctlpar\widctlpar\adjustright \fs20\cgrid \snext0 Normal;}{\s1\sb240\sa60\keepn\nowidctlpar\tx432\ls1\outlinelevel0\adjustright \b\f1\fs28\kerning28\cgrid \sbasedon0 \snext0 
heading 1;}{\s2\sb240\sa240\keepn\nowidctlpar\tx576\ls1\ilvl1\outlinelevel1\adjustright \b\i\f1\cgrid \sbasedon0 \snext0 heading 2;}{\s3\sb240\sa60\keepn\nowidctlpar\widctlpar\ls1\ilvl2\outlinelevel2\adjustright \f1\cgrid \sbasedon0 \snext0 heading 3;}{
\s4\sb240\sa60\keepn\nowidctlpar\widctlpar\ls1\ilvl3\outlinelevel3\adjustright \b\f1\cgrid \sbasedon0 \snext0 heading 4;}{\s5\sb240\sa60\nowidctlpar\widctlpar\ls1\ilvl4\outlinelevel4\adjustright \f1\fs22\cgrid \sbasedon0 \snext0 heading 5;}{
\s6\sb240\sa60\nowidctlpar\widctlpar\ls1\ilvl5\outlinelevel5\adjustright \i\fs22\cgrid \sbasedon0 \snext0 heading 6;}{\s7\sb240\sa60\nowidctlpar\widctlpar\ls1\ilvl6\outlinelevel6\adjustright \f1\fs20\cgrid \sbasedon0 \snext0 heading 7;}{
\s8\sb240\sa60\nowidctlpar\widctlpar\ls1\ilvl7\outlinelevel7\adjustright \i\f1\fs20\cgrid \sbasedon0 \snext0 heading 8;}{\s9\sb240\sa60\nowidctlpar\widctlpar\ls1\ilvl8\outlinelevel8\adjustright \b\i\f1\fs18\cgrid \sbasedon0 \snext0 heading 9;}{\*\cs10 
\additive Default Paragraph Font;}{\s15\qc\sb240\sa60\nowidctlpar\adjustright \b\f1\fs32\kerning28\cgrid \sbasedon0 \snext15 Title;}{\s16\fi-1440\li1440\nowidctlpar\widctlpar\tx1440\tx2160\tx7200\adjustright \f2\fs20\cgrid \sbasedon0 \snext16 Code;}{
\s17\qc\sa60\nowidctlpar\adjustright \f1\cgrid \sbasedon0 \snext17 Subtitle;}{\s18\sa240\nowidctlpar\widctlpar\tqc\tx4320\tqr\tx8640\adjustright \fs20\cgrid \sbasedon0 \snext18 header;}{\s19\sa240\nowidctlpar\widctlpar\tqc\tx4320\tqr\tx8640\adjustright 
\fs20\cgrid \sbasedon0 \snext19 footer;}{\*\cs20 \additive \sbasedon10 page number;}}{\*\listtable{\list\listtemplateid-1{\listlevel\levelnfc0\leveljc0\levelfollow0\levelstartat1\levelold\levelspace144\levelindent0{\leveltext\'02\'00.;}{\levelnumbers
\'01;}\s1}{\listlevel\levelnfc0\leveljc0\levelfollow0\levelstartat1\levelold\levelspace144\levelindent0{\leveltext\'03\'00.\'01;}{\levelnumbers\'01\'03;}\s2}{\listlevel\levelnfc0\leveljc0\levelfollow0\levelstartat1\levelold\levelspace144\levelindent0
{\leveltext\'05\'00.\'01.\'02;}{\levelnumbers\'01\'03\'05;}\s3}{\listlevel\levelnfc0\leveljc0\levelfollow0\levelstartat1\levelold\levelspace144\levelindent0{\leveltext\'07\'00.\'01.\'02.\'03;}{\levelnumbers\'01\'03\'05\'07;}\s4}{\listlevel\levelnfc0
\leveljc0\levelfollow0\levelstartat1\levelold\levelspace144\levelindent0{\leveltext\'09\'00.\'01.\'02.\'03.\'04;}{\levelnumbers\'01\'03\'05\'07\'09;}\s5}{\listlevel\levelnfc0\leveljc0\levelfollow0\levelstartat1\levelold\levelspace144\levelindent0
{\leveltext\'0b\'00.\'01.\'02.\'03.\'04.\'05;}{\levelnumbers\'01\'03\'05\'07\'09\'0b;}\s6}{\listlevel\levelnfc0\leveljc0\levelfollow0\levelstartat1\levelold\levelspace144\levelindent0{\leveltext\'0d\'00.\'01.\'02.\'03.\'04.\'05.\'06;}{\levelnumbers
\'01\'03\'05\'07\'09\'0b\'0d;}\s7}{\listlevel\levelnfc0\leveljc0\levelfollow0\levelstartat1\levelold\levelspace144\levelindent0{\leveltext\'0f\'00.\'01.\'02.\'03.\'04.\'05.\'06.\'07;}{\levelnumbers\'01\'03\'05\'07\'09\'0b\'0d\'0f;}\s8}{\listlevel
\levelnfc0\leveljc0\levelfollow0\levelstartat1\levelold\levelspace144\levelindent0{\leveltext\'11\'00.\'01.\'02.\'03.\'04.\'05.\'06.\'07.\'08;}{\levelnumbers\'01\'03\'05\'07\'09\'0b\'0d\'0f\'11;}\s9}{\listname ;}\listid-5}{\list\listtemplateid-1
\listsimple{\listlevel\levelnfc0\leveljc0\levelfollow0\levelstartat0\levelspace0\levelindent0{\leveltext\'01*;}{\levelnumbers;}}{\listname ;}\listid-2}}{\*\listoverridetable{\listoverride\listid-5\listoverridecount0\ls1}{\listoverride\listid-2
\listoverridecount1{\lfolevel\listoverrideformat{\listlevel\levelnfc23\leveljc0\levelfollow0\levelstartat1\levelold\levelspace0\levelindent360{\leveltext\'01\u-3913 ?;}{\levelnumbers;}\f3\fbias0 \fi-360\li360 }}\ls2}}{\info
{\title CIFS Authentication Protocol}{\author Paul Leach}{\operator Paul Leach}{\creatim\yr1997\mo3\dy28\hr11\min45}{\revtim\yr1997\mo3\dy28\hr15\min28}{\printim\yr1997\mo3\dy28\hr15\min26}{\version7}{\edmins44}{\nofpages4}{\nofwords1203}{\nofchars6858}
{\*\company Microsoft}{\nofcharsws0}{\vern71}}\margl1008\margr864 \widowctrl\ftnbj\aendnotes\aftnstart0\hyphhotz0\aftnnar\lytprtmet\hyphcaps0\viewkind4\viewscale100\pgbrdrhead\pgbrdrfoot \fet0\sectd \psz1\linex0\endnhere\titlepg\sectdefaultcl {\header 
\pard\plain \s18\sa240\nowidctlpar\widctlpar\tqc\tx4320\tqr\tx9360\adjustright \fs20\cgrid {\i Preliminary\tab }{CIFS Authentication Protocol\tab }{\i May change without notice}{
\par }}{\footer \pard\plain \s19\sa240\nowidctlpar\widctlpar\tqc\tx4320\tqr\tx8640\adjustright \fs20\cgrid {Paul J. Leach, Microsoft\tab [Page }{\field{\*\fldinst {\cs20  PAGE }}{\fldrslt {\cs20\lang1024 4}}}{\cs20 ]\tab }{\field{\*\fldinst {\cs20  DATE }
}{\fldrslt {\cs20\lang1024 03/28/97}}}{
\par }}{\footerf \pard\plain \s19\sa240\nowidctlpar\widctlpar\tqc\tx4320\tqr\tx8640\adjustright \fs20\cgrid {Paul J. Leach, Microsoft\tab [Page }{\field{\*\fldinst {\cs20  PAGE }}{\fldrslt {\cs20\lang1024 1}}}{\cs20 ]\tab }{\field{\*\fldinst {\cs20  DATE }
}{\fldrslt {\cs20\lang1024 03/28/97}}}{
\par }}{\*\pnseclvl1\pnucrm\pnstart1\pnindent720\pnhang{\pntxta .}}{\*\pnseclvl2\pnucltr\pnstart1\pnindent720\pnhang{\pntxta .}}{\*\pnseclvl3\pndec\pnstart1\pnindent720\pnhang{\pntxta .}}{\*\pnseclvl4\pnlcltr\pnstart1\pnindent720\pnhang{\pntxta )}}
{\*\pnseclvl5\pndec\pnstart1\pnindent720\pnhang{\pntxtb (}{\pntxta )}}{\*\pnseclvl6\pnlcltr\pnstart1\pnindent720\pnhang{\pntxtb (}{\pntxta )}}{\*\pnseclvl7\pnlcrm\pnstart1\pnindent720\pnhang{\pntxtb (}{\pntxta )}}{\*\pnseclvl8
\pnlcltr\pnstart1\pnindent720\pnhang{\pntxtb (}{\pntxta )}}{\*\pnseclvl9\pnlcrm\pnstart1\pnindent720\pnhang{\pntxtb (}{\pntxta )}}\pard\plain \s15\qc\sb240\sa60\nowidctlpar\adjustright \b\f1\fs32\kerning28\cgrid {CIFS Authentication Protocol
\par }\pard\plain \s17\qc\sa60\nowidctlpar\adjustright \f1\cgrid {Paul J. Leach
\par Microsoft
\par }{\i\fs20 Preliminary Draft \endash  do not cite
\par }{\fs16 Author's draft: 4 
\par }\pard\plain \sa240\nowidctlpar\widctlpar\adjustright \fs20\cgrid {This is a preliminary draft of a portion of specification of a proposed new version of the CIFS authentication protocol. It is supplied here as a st
andalone document for ease of review; if accepted and implemented, it may be incorporated into a future release of the CIFS specification. (This specification is subject to change without notice and should not be construed as a product commitment from Mic
rosoft Corporation.)
\par The original protocol from which this version descends was designed more than a decade ago; recently, quite a few weaknesses have been found in previous versions. This latest revision is an attempt to repair those weaknesses with as sma
ll a change to the protocol as possible, so that it can be incrementally and rapidly deployed. In particular, it must not be necessary for all users to change their passwords to deploy the upgraded protocol, or to deploy new key server software. Also, eff
iciency is an issue, so some more robust MAC schemes that could have been used weren't.
\par This portion of the specification describes the authentication protocol abstracted from the implementation details, in order to make scrutiny of its security properties 
easier. It also only describes the strongest of several variants of the authentication protocol; a brief summary of the other variants is at the end of the document, together with a description of how the real protocols vary from this abstraction. The ful
l details of the protocol are in the companion CIFS Authentication Protocols Specification document; a broader discussion of the security properties, including other attacks, may be found in the CIFS Security Considerations document.
\par {\listtext\pard\plain\s2 \b\i\f1\cgrid \hich\af1\dbch\af0\loch\f1 1.1\tab}}\pard\plain \s2\sb240\sa240\keepn\nowidctlpar\tx576\ls1\ilvl1\outlinelevel1\adjustright \b\i\f1\cgrid {Overview
\par }\pard\plain \sa240\nowidctlpar\widctlpar\adjustright \fs20\cgrid {Session au
thentication is done via a challenge response protocol based upon the shared knowledge of the user's password. Message authentication is done by attaching a message authentication code (MAC) to each message. 
\par The response is computed by DES encrypting a challenge (a nonce) selected by the server with three keys derived from the user's password.
\par The MAC is a keyed-MD5 construction (see [RFC 1828]), using a key derived from the user's password and the client and server nonces. Each message is either of known 
fixed length or contains an explicit length, and is longer than an MD5 block, which avoids the known weaknesses of MD5 as a MAC (see [Kal 95]).  Each message includes an implicit sequence number, to avoid replay.
\par We describe the authentication protocols as if the CIFS server communicates over some secure (private, authenticated) channel to a key server (KS) which keeps a database of hashes of clients' passwords, but a server might actually store the hashed
 passwords itself and be its own KS. Also, either type of server could store the passwords instead of a hash of the passwords
. We consider these topics to be outside the scope of this protocol. One of the design goals for this version of the protocol was to leave the server to key server protocol and the hashed password format unchanged from the previous version.
\par {\listtext\pard\plain\s2 \b\i\f1\cgrid \hich\af1\dbch\af0\loch\f1 1.2\tab}}\pard\plain \s2\sb240\sa240\keepn\nowidctlpar\tx576\ls1\ilvl1\outlinelevel1\adjustright \b\i\f1\cgrid {Definitions
\par }\pard\plain \sa240\nowidctlpar\widctlpar\adjustright \fs20\cgrid {Let
\par }\pard\plain \s16\fi-1440\li1440\nowidctlpar\widctlpar\tx1440\tx2160\tx7200\adjustright \f2\fs20\cgrid {U\tab }{\f0 be the user's name, blank padded to 16 bytes}{
\par P(U)\tab }{\f0 be U's password}{
\par Ks, Ks'\tab }{\f0 be a 128 bit session key
\par }{Ka, Ka'\tab }{\f0 be a 56 bit DES key extracted from the first seven bytes of Ks}{
\par Kb, Kb'\tab }{\f0 be another 56 bit DES key extracted from the second seven bytes of Ks}{
\par Kc, Kc'\tab }{\f0 be another 56 bit DES key extracted from the last two bytes of Ks, padded with zeros}{
\par SN, SN'\tab }{\f0 be a 32 bit sequence number
\par }{Km, Km'\tab }{\f0 be a 40 byte key for a keyed-MD5 MAC}{
\par [s]<n:m>\tab }{\f0 be the "n" bytes of s starting at byte "m" (the first byte is numbered 0).
\par }{[s]<n>\tab }{\f0 be the first "n" bytes of s}{
\par a,b,\'85z\tab }{\f0 be the concatenation of the byte strings a, b, \'85 z}{
\par \{ m \}K\tab }{\f0 be the DES encryption [FIPS] of the byte string m with key K
\par }{MD4(m)}{\f0 \tab be the MD4 message digest [RFC 1320] of the byte string m
\par }{MD5(m)}{\f0 \tab be the MD5 message digest [RFC 1321] of the byte string m
\par }{Z(n)\tab }{\f0 be a byte string of zeros of length n}{ }{\f0 
\par }{
\par CS\tab }{\f0 be an 8 byte nonce chosen by the server, used as a challenge}{
\par }{\f0 
\par {\listtext\pard\plain\s2 \b\i\f1\cgrid \hich\af1\dbch\af0\loch\f1 1.3\tab}}\pard\plain \s2\sb240\sa240\keepn\nowidctlpar\tx576\ls1\ilvl1\outlinelevel1\adjustright \b\i\f1\cgrid {Application protocol messages
\par }\pard\plain \sa240\nowidctlpar\widctlpar\adjustright \fs20\cgrid {
The application protocol being secured is a request/response protocol that has the following characteristics. Authentication is carried out in the process of setting up a session, during which session features are negotiated, the exact details o
f which do not affect the authentication protocol. Each of the elements of protocol messages is either a fixed length byte string, or contains an explicit length, and is at least 32 bytes long;, and requests are guaranteed to be distinguishable from respo
nses.
\par }\pard\plain \s16\fi-1440\li1440\nowidctlpar\widctlpar\tx1440\tx2160\tx7200\adjustright \f2\fs20\cgrid {Mneg\tab }{\f0 be a session negotiation request containing supported features
\par }{Mnegr}{\f0 \tab be a negotiation response indicating selected features
\par }{Msess}{\f0 \tab be a  session request}{
\par Msessr\tab b}{\f0 e a session response}{
\par Mreq\tab }{\f0 be a subsequent protocol request}{
\par Mrsp\tab }{\f0 be a subsequent protocol response}{
\par 
\par {\listtext\pard\plain\s2 \b\i\f1\cgrid \hich\af1\dbch\af0\loch\f1 1.4\tab}}\pard\plain \s2\sb240\sa240\keepn\nowidctlpar\tx576\ls1\ilvl1\outlinelevel1\adjustright \b\i\f1\cgrid {Session authentication protocol
\par }\pard\plain \sa240\nowidctlpar\widctlpar\adjustright \fs20\cgrid {1. The client computes the session keys from the user's password, initializes its sequence number, and sends a session negotiation request to the server.
\par }\pard\plain \s16\fi-1440\li1440\nowidctlpar\widctlpar\tx1440\tx2160\tx7200\adjustright \f2\fs20\cgrid {C:\tab Ks  = MD4(P(U))
\par \tab Ka = [Ks]<7>
\par \tab Kb = [Ks]<7:7>
\par \tab Kc = [Ks]<2:14>, Z(5)
\par 
\par C->S:\tab Mneg
\par 
\par }\pard\plain \sa240\nowidctlpar\widctlpar\adjustright \fs20\cgrid {2. The server responds with the features negotiated, and a challenge:
\par }\pard\plain \s16\fi-1440\li1440\nowidctlpar\widctlpar\tx1440\tx2160\tx7200\adjustright \f2\fs20\cgrid {S->C:\tab Mnegr, CS
\par 
\par }\pard\plain \sa240\nowidctlpar\widctlpar\adjustright \fs20\cgrid {
3. The client computes a response to the challenge. It computes the MAC key, and the MAC of the message, and  send the user name, challenge response, and session request parameters to the server.  Its message uses a sequence number of 0, and it expects a 
sequence number of 1 to be used in the response.
\par }\pard\plain \s16\fi-1440\li1440\nowidctlpar\widctlpar\tx1440\tx2160\tx7200\adjustright \f2\fs20\cgrid {C:\tab R = \{CS\}Ka, \{CS\}Kb, \{CS\}Kc
\par \tab Km = Ks, R
\par \tab SN = 0
\par \tab MC = [MD5(Km, SN, Msess, U, R)]<8>
\par \tab SN = 1
\par 
\par C->S:\tab Msess, U, R, MC
\par 
\par }\pard\plain \sa240\nowidctlpar\widctlpar\adjustright \fs20\cgrid {4. The server send the user's name, the challenge, and the response to a key server (KS) over a secure (private, authenticated) channel.
\par }\pard\plain \s16\fi-1440\li1440\nowidctlpar\widctlpar\tx1440\tx2160\tx7200\adjustright \f2\fs20\cgrid {S->KS:\tab U, CS, R
\par 
\par }\pard\plain \sa240\nowidctlpar\widctlpar\adjustright \fs20\cgrid {
5. The key server looks up the session key by looking up the user's name in a database containing the MD4 hash of users' passwords, and from the key and the client's challenge, computes the ex
pected response. If the expected response matches the actual response (R == R'), then it sends Ks' to the server, otherwise it tells the server to deny access.
\par }\pard\plain \s16\fi-1440\li1440\nowidctlpar\widctlpar\tx1440\tx2160\tx7200\adjustright \f2\fs20\cgrid {KS:\tab Ks'  = MD4(P(U))
\par \tab Ka' = [Ks']<7>
\par \tab Kb' = [Ks']<7:7>
\par \tab Kc' = [Ks']<2:14>, Z(5)
\par \tab R'  = \{CS\}Ka', \{CS\}Kb', \{CS\}Kc'
\par 
\par KS->S:\tab Ks'
\par 
\par }\pard\plain \sa240\nowidctlpar\widctlpar\adjustright \fs20\cgrid {
6. The server computes the MAC key, and the MAC for the request. If MC' == MC, then the client has authenticated to the server. The server computes the MAC of its response, then sends the session acknowledgment message, then s
ets its sequence number to 2, the expected value in the next request.
\par }\pard\plain \s16\fi-1440\li1440\nowidctlpar\widctlpar\tx1440\tx2160\tx7200\adjustright \f2\fs20\cgrid {S:\tab Km' = Ks', R
\par \tab MC' = [MD5(Km, SN', Msess, U, R)]<8>
\par \tab MS  = [MD5(Km', SN', Msessr)]<8>
\par 
\par S->C:\tab Msessr, MS
\par 
\par S:\tab SN' = 2
\par 
\par }\pard\plain \sa240\nowidctlpar\widctlpar\adjustright \fs20\cgrid {7. The client checks if MS' == MS; if so,  then the server has authenticated to the client, and the client's sequence number is set to the value to be used in the next request.
\par }\pard\plain \s16\fi-1440\li1440\nowidctlpar\widctlpar\tx1440\tx2160\tx7200\adjustright \f2\fs20\cgrid {C:\tab MS' = [MD5(Km, SN, Msessr)]<8>
\par \tab SN  = 2
\par 
\par {\listtext\pard\plain\s2 \b\i\f1\cgrid \hich\af1\dbch\af0\loch\f1 1.5\tab}}\pard\plain \s2\sb240\sa240\keepn\nowidctlpar\tx576\ls1\ilvl1\outlinelevel1\adjustright \b\i\f1\cgrid {Message authentication protocol
\par }\pard\plain \sa240\nowidctlpar\widctlpar\adjustright \fs20\cgrid {For each request/response interaction thereafter the following procedure is used:
\par 1. The client send the request together with a MAC of the request computed using the current sequence number, then bumps its sequence number to the one expected in the response:
\par }\pard\plain \s16\fi-1440\li1440\nowidctlpar\widctlpar\tx1440\tx2160\tx7200\adjustright \f2\fs20\cgrid {C->S:\tab Mreq, [MD5(Km, SN, Mreq)]<8>
\par C:\tab SN = SN + 1
\par 
\par }\pard\plain \sa240\nowidctlpar\widctlpar\adjustright \fs20\cgrid {2. The server checks the MAC, and if correct, sends the response with a sequence number one higher, then bumps its sequence number by 2 to the expected value in the next request:
\par }\pard\plain \s16\fi-1440\li1440\nowidctlpar\widctlpar\tx1440\tx2160\tx7200\adjustright \f2\fs20\cgrid {S->C:\tab Mrsp, [MD5(Km', SN'+1, Mrsp)]<8>
\par 
\par S:\tab SN' = SN' + 2
\par 
\par }\pard\plain \sa240\nowidctlpar\widctlpar\adjustright \fs20\cgrid {3. The client checks the MAC and if correct accepts the response and bumps its sequence number:
\par }\pard\plain \s16\fi-1440\li1440\nowidctlpar\widctlpar\tx1440\tx2160\tx7200\adjustright \f2\fs20\cgrid {C:\tab SN  = SN  + 1
\par 
\par {\listtext\pard\plain\s2 \b\i\f1\cgrid \hich\af1\dbch\af0\loch\f1 1.6\tab}}\pard\plain \s2\sb240\sa240\keepn\nowidctlpar\tx576\ls1\ilvl1\outlinelevel1\adjustright \b\i\f1\cgrid {Summary of other variants and differences
\par }\pard\plain \sa240\nowidctlpar\widctlpar\adjustright \fs20\cgrid {There are variants of the authentication protocols; they exist for backwards compatibility. The variants are creating by taking certain allowed combinations of the following differences:

\par {\pntext\pard\plain\f3\fs20\cgrid \loch\af3\dbch\af0\hich\f3 \'b7\tab}}\pard \fi-360\li360\sa240\nowidctlpar\widctlpar{\*\pn \pnlvlblt\ilvl0\ls2\pnrnot0\pnf3\pnstart1\pnindent360\pnhang{\pntxtb \'b7}}\ls2\adjustright {
The session key Ks is computed differently.
\par {\pntext\pard\plain\f3\fs20\cgrid \loch\af3\dbch\af0\hich\f3 \'b7\tab}}\pard \fi-360\li360\sa240\nowidctlpar\widctlpar{\*\pn \pnlvlblt\ilvl0\ls2\pnrnot0\pnf3\pnstart1\pnindent360\pnhang{\pntxtb \'b7}}\ls2\adjustright {
The message authentication protocol is omitted.
\par {\pntext\pard\plain\f3\fs20\cgrid \loch\af3\dbch\af0\hich\f3 \'b7\tab}}\pard \fi-360\li360\sa240\nowidctlpar\widctlpar{\*\pn \pnlvlblt\ilvl0\ls2\pnrnot0\pnf3\pnstart1\pnindent360\pnhang{\pntxtb \'b7}}\ls2\adjustright {A plaintext password may be sent

\par }\pard \sa240\nowidctlpar\widctlpar{\*\pn \pnlvlcont\ilvl0\ls0\pnrnot0\pndec }\adjustright {The feature negotiation
 step (the exchange of Mneg and Mnegr above)  is where the exact variant is selected. Both client and server can force the use of as strong a variant as they require to meet their security policy.
\par The actual authentication protocols differ from the one described in the following ways:
\par {\pntext\pard\plain\f3\fs20\cgrid \loch\af3\dbch\af0\hich\f3 \'b7\tab}}\pard \fi-360\li360\sa240\nowidctlpar\widctlpar{\*\pn \pnlvlblt\ilvl0\ls2\pnrnot0\pnf3\pnstart1\pnindent360\pnhang{\pntxtb \'b7}}\ls2\adjustright {
The order of fields in messages may be different
\par {\pntext\pard\plain\f3\fs20\cgrid \loch\af3\dbch\af0\hich\f3 \'b7\tab}}\pard \fi-360\li360\sa240\nowidctlpar\widctlpar{\*\pn \pnlvlblt\ilvl0\ls2\pnrnot0\pnf3\pnstart1\pnindent360\pnhang{\pntxtb \'b7}}\ls2\adjustright {
The MAC value is calculated by inserting the implicit sequence number into a field of the message, and computing the MAC; then that field is overwritten with the MAC value for transmission.
\par {\pntext\pard\plain\f3\fs20\cgrid \loch\af3\dbch\af0\hich\f3 \'b7\tab}}\pard \fi-360\li360\sa240\nowidctlpar\widctlpar{\*\pn \pnlvlblt\ilvl0\ls2\pnrnot0\pnf3\pnstart1\pnindent360\pnhang{\pntxtb \'b7}}\ls2\adjustright {
Multiple requests or responses may be "batched"  together into one message; single requests or responses may be spread out over multiple messages; and some requests have no response.
\par }\pard \sa240\nowidctlpar\widctlpar\adjustright {It is not believed that a
ny of these differences affect the security of the protocol. The full details of the protocol are in the CIFS Authentication Specification document; a broader discussion of the security properties, including other attacks, may be found in the CIFS Securit
y Considerations document.
\par {\listtext\pard\plain\s2 \b\i\f1\cgrid \hich\af1\dbch\af0\loch\f1 1.7\tab}}\pard\plain \s2\sb240\sa240\keepn\nowidctlpar\tx576\ls1\ilvl1\outlinelevel1\adjustright \b\i\f1\cgrid {References
\par }\pard\plain \sa240\nowidctlpar\widctlpar\adjustright \fs20\cgrid {[FIPS] DES, FIPS PUB 46-1, 1988.
\par [RFC 1320] RFC 1320, R. Rivest, The MD4 Message-Digest Algorithm
\par [RFC 1321] RFC 1321, R. Rivest, The MD5 Message-Digest Algorithm
\par [RFC 1828] RFC 1828, P. Metzger, W. Simpson, "IP Authentication using Keyed MD5", August 1995
\par [Kal 95] B. Kaliski, M.Robshaw,  "Message Authentication with MD5",  CryptoBytes, Sping 1995, RSA Inc, (http://www.rsa.com/rsalabs/pubs/cryptobytes/spring95/md5.htm)
\par 
\par }}